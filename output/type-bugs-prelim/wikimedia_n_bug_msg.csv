/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/toollabs/logging/sender.pp,tools: send logs to multiple servers		redundancy!		change-id: ia4cdb53bda2abaa8d5f2811f22245ccc1c1db0ff	|tools: move log sender to generic role		will apply to all instances on tools		change-id: i994a705502505d284d958210060e7f8e5cb090a4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ssh/manifests/init.pp,ssh: convert into a module		change-id: id080b3854138d3e3d81403f3b8e107f4c2bb777f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/director/jobdefaults.pp,bacula: minor linting		align arguments/braces better		change-id: ia6598b877c201098c2b108c4bdeb200c3c5b4d40	|fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/interface/manifests/rps.pp,reuse update-initramfs in lvs::balancer and interface::rps		reuse exec['update-initramfs'], introduced in ebe9658, in	interface::rps::modparams and lvs::balancer.		change-id: ib0f29e999d20aeb8957bcf46cdf4676b6124b85b	|interface: some lint fixes		change-id: ibbdba0954f81a04f21748c2a7cde51be00159783	|fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|remove trailing space from cmd if !rss_pattern		change-id: i69ce5c762014e93fefb84901fefc212ade89dc32	|move bnx2x num_queues from lvs::balancer to interface::rps		change-id: if632f51a0b5c6c7c4c3f44b783d5aa3e10a22716	|remove temporary file-removal for /etc/init/enable-rps...		change-id: i80040d2021bc6f7ac370ceec82ef71ef9a9df06f	|switch rps to using up_command		change-id: i0249f8be91817d6a5bd95fefdf3848926b95e28e	|only re-apply rps on change		change-id: i974c59109abb52b36ba0918a8fa47af4355a4349	|add optional rss setup to interface rps script		adds a second parameter as an rss pattern match in	/proc/interrupts for finding the rss irqs that match	the rps queues.  if specified, it will be used to do	matching rss+rps assignments to the cpus.  the pattern	must contain a "%d" placeholder for the location	of the queue number in the interrupt action name.		unfortunately i haven't found any generic way to	figure out the rss irq action name automagically, or	to avoid text-parsing /proc/interrupts.  the parameter,	when used, will be driver/hardware -specific.		this also disables irqbalance if rss is in use.		change-id: ib51ad49935e86d858362c5f8df3d6c16bbe21a6b	|split interface-rps script file resources to class		the interface-rps script file resource would cause duplicate definition	if more than one interface::rps resource was defined for a host. fix	this by moving the file resource into its own class and require that	class in the definition. add a comment about the above in order to avoid	future melding on the class into the define. this fixes a duplicate	definition issue introduced in ab47728		change-id: if76dbb328efe45de1ca803f36433b960aa6530aa	|replace linux rps setting with a smarter script		we were setting receive packet steering as "ff" (i.e. all cpus, up to 16	cpus) to all rx queues for a given interface (eth0). while is this what	basically everyone on the web recommends, experience in the field has	shown that this was very unbalanced, with cpu 0 getting most of the load	and even spending all of its time being busy -and producing packet loss	& latency- while other cpus remained relatively idle.		a smarter way of handling the load is pinning each queue to a separate	cpu, while isolating to the greatest extent the cpus for each. this has	proven to balance the load as fairly as possible. experimentation has	also shown that using hyperthreading siblings (even pairing them with	each other) is actively worse and it's best to ignore them completely.		finally, experimentation has shown that for our primary use case (lvs),	transmit packet steering makes little to no difference.		this replaces the older bash one-liner with a python script which tries	to be extra smart about how to distribute queues to cpus (and cpus with	ht). unfortunately, the number of cpus and queues can differ wildly	between boxes and -in cases such as amslvs1- can unconvienently be five	queues for four cpus, so we need to cover multiple cases.		this has been tested manually on amslvs1 & lvs1001 and made a	considerable difference.		change-id: i606d222616a62563cb0a2939d3e800d04db1de39	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/irqbalance/manifests/init.pp,add optional rss setup to interface rps script		adds a second parameter as an rss pattern match in	/proc/interrupts for finding the rss irqs that match	the rps queues.  if specified, it will be used to do	matching rss+rps assignments to the cpus.  the pattern	must contain a "%d" placeholder for the location	of the queue number in the interrupt action name.		unfortunately i haven't found any generic way to	figure out the rss irq action name automagically, or	to avoid text-parsing /proc/interrupts.  the parameter,	when used, will be driver/hardware -specific.		this also disables irqbalance if rss is in use.		change-id: ib51ad49935e86d858362c5f8df3d6c16bbe21a6b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/backup/manifests/weeklyschedule.pp,backup: ignore arrow alignment warnings		ignores "warning: indentation of => is not properly aligned"		because i think you want to leave it like it is,	in this case, right		change-id: ic156a8659607eb69b298d9280a18e18ca9c0fb5f	|modularize backups.pp		move all the dry defines in a wmf specific module	add (incomplete) rspec tests	add readme.md	delete backup::mysql which was unused		change-id: i7e2d1f933d57dc27f5933d826fadec2f64f74e47	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/openstack/manifests/repo.pp,move ubuntu-cloud.key to openstack module		change-id: ib016f41de17a6da3016c63942689b48c23e09e00	|openstack: some more lint fixes		http://puppet-compiler.wmflabs.org/1156/		change-id: i4707f12653df9100f56d7327244cdde725728667	|openstack: add links to docs for components, lint		adds comments with links to docs or info about	the various components of openstack.		by doing that fixes a bunch of	"class not documented in line 1" lint warnings.		also fixes a few other lint warnings such as aligned arrows	or "ensure" being first.		change-id: i592677d0f089f59bf72b1dbd2bd31f97f5932ac7	|openstack: cleanup up old repo setups		we are solid on trusty/kilo now		change-id: ice2e75e49887148f09296e012c0d418a9d35c5a9	|use cloud archive for non-icehouse openstack on trusty.		change-id: if191bab1886881dc33f33df39816ad961cb7e754	|move the openstack_version setting to hiera.		this used to be a node var, inconsistently handled.		change-id: i89378aaef4bbb6ba5a741a8638ca9ebc5fa87270	|openstack: folsom -> havana as default version		folsom is eol and we don't use it anywhere afaict	setting default to 'havana' instead		https://wiki.openstack.org/wiki/releases		change-id: i837187027eaa48ec52172ecc45dcf0465dea77a5	|openstack: lint fixes			hosts where compilation is identical:		    virt1001.eqiad.wmnet	    labnet1001.eqiad.wmnet	    virt1007.eqiad.wmnet	    virt1000.wikimedia.org		http://puppet-compiler.wmflabs.org/478/change/170499/html/		change-id: i897642c391f5e5b036a7a2defe4cbf1ea92ef965	|move openstack files and manifests into a module		this doesn't refactor or update anything, it's just a (mostly) blind move.		change-id: i79893f8715d826aa5359eeebc24041ffff47ebc5	|remove unused upstream openstack module		change-id: if4ccb291d6d3d3630620ac68e780761554e365f4	|import the stackforge openstack module for testing.		https://github.com/stackforge/puppet-openstack		change-id: i19e7dca4c5d85d4177ff4af133b079e563e4740d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/phaste.pp,add 'phaste' tool for pastebinning text to phabricator		provides the ability to pastebin text on wikimedia's phabricator installation	from anywhere in production by running 'phaste' -- e.g.:		    # read from stdin:	    grep xfs /var/log/syslog | phaste		    # read from file:	    phaste /var/log/upstart/service.log		change-id: i4705178445e4f1437cb606f92f2108755c095e87	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/pmacct/manifests/init.pp,pmacct: rewrite the module/role		the module was buggy in many ways and had several misconceptions on how	pmacct/nfacctd actually works. rewrite it almost from scratch and set up	a working config without mysql (as the current database setup was also	inactive) that can be improved in subsequent commits.		change-id: ie8c2a615f5f8f7c46df87b9c8d3f7990b9e65b13	|fix pmacct service name		this is pmacct instead of pmacctd,	so puppet did not find the init script	when trying to start the service		thanks for pointing that out faidon		change-id: ie6ed27db10e144c6234a43d4d01a76676cd849d4	|initial commit of pmacct module and role		fix indent spacing, set proper role name		change-id: i44f02a7911ac8f596f78ea0a6ae5a61c72e75e5c	|revert "initial commit of pmacct module"		this reverts commit 2e7954be2d24fe2ed6d246ce0b30f8b24750a8fa. this	violates a bunch of our conventions and really needs to go via a proper	code review process. it's also a broken pmacct configuration (no	/opt/maxmind, among others).		more importantly, it's also a doubly broken ferm configuration that	would break all other netmon1001 services if it was otherwise	non-broken.		change-id: i1865d1f2c69302eca83e29eb09a17105d21590e1	|initial commit of pmacct module		change-id: i8bb1cfb204d8b7fcf775a549d004edb72f039edf	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/geowiki/manifests/init.pp,create geowiki module		this commit finally removes misc/statistics.pp!		change-id: ib36c02b36a4bd4cb4e4ee8293108fe61754aba94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/rsync/manifests/repo.pp,manually adding modules/rsync for managing rsyncd modules.		puppetlabs-rsync:  https://github.com/puppetlabs/puppetlabs-rsync		see also abandoned change where i attempted to add these as git submodules:	https://gerrit.wikimedia.org/r/#/c/21744/		change-id: i2c811843b414fcbdbea4224157847135402af590	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/rsync/tests/init.pp,manually adding modules/rsync for managing rsyncd modules.		puppetlabs-rsync:  https://github.com/puppetlabs/puppetlabs-rsync		see also abandoned change where i attempted to add these as git submodules:	https://gerrit.wikimedia.org/r/#/c/21744/		change-id: i2c811843b414fcbdbea4224157847135402af590	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/varnish/manifests/logging/xcache.pp,set varnish::common::varnish4_python_suffix		rather than setting $varnish4_python_suffix every time we need it, set	it once and for all in varnish::common.		change-id: i953cd77595c2bfb18013f567e59a24a5f07adc46	|varnish{xcache,xcps,...}: subscribe to varnishlog.py		upon modification of varnishlog.py, we want to make sure that all	scripts depeding on it are restarted.		change-id: i0e3053a9c8c15e4414f84b24d92101819391fe02	|varnishxcache - new monitoring script for hit/miss stuff		change-id: ia8d5366b1fb0c2a82dc9fa340fdeddbf98f02fd8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_multi_instance/manifests/init.pp,fix whitespace-related lint issues		fix a lot of lint warnigns due to incorrectly aligned arrows.		change-id: ib062d7142a79a8cb6bb3abd86fd7499aa3edad03	|use apt::repository instead of file resources		change-id: ica0bf234c404dd7e32e9ca928da1b4766b966582	|fix trailing spaces		change-id: i878ab1238dd9e391aa02f287039155c3a6a61ca6	|modules/mysql_multi_instance/ sans systemuser		we want to get rid of generic::systemuser	and replace it with the regular puppet user type	again to remove a layer of abstraction that isn't	really needed		change-id: i6efc59e6ccc7edd2799fd5d4fcfc651816864e04	|puppet error after recent lint		change-id: i8f04cc6452e1c96a78b910b03978b697ddbf1211	|mysql_multi_instance : lint cleanup		change-id: id36f8ad8621124fa9751129a53c77c520ed22214	|add a 'generic' module.		this is a catch-all for bits of the old manifests/generic-definitions.pp	that had nowhere else to go.		change-id: i3a5ef3a200bf0d0722c99ab351ba0be98c1e9de1	|some cleanup for multi_instance mysql		change-id: i628f45907b2ee54edc2fd0e66ed7c54bd47a7ca4	|really basic module for multiple instance of mysql on a node		needs some more work, monitoring, white space, etc		change-id: idc956372f31906e72a582a377c5ff90ade595248	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/postgresql/manifests/ganglia.pp,postgresql - duplicate declaration of psycopg package, without appropriate	guard.		change-id: i8c742e6b471411276e63e6f5d22257dfd1e3695e	|ganglia: drop the "gmond" service alias		now that gmond is ganglia-monitor everywhere, drop the alias => gmond	from both ganglia and ganglia_new and adjust all call sites to notify	service['ganglia-monitor'] instead of service['gmond'].		change-id: if5dff9bd3f2032998a4712cb6d11a8e061874fe7	|add bgwriter ganglia stats to postgresql		background writer buffers inserted into ganglia stats		change-id: if12667592094d5a0038d1db3ac695bb4eeca4744	|postgresql.pyconf is a template not a file		also update tests		change-id: i34545aa6bbc8db8c1bd23e1dedae0ca1e3b41444	|postgresql ganglia plugins		add ganglia gmond plugins		change-id: icfe76e156dbd02ea01014eed30f44d141868cdc8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/swift/stats_reporter.pp,swift: move roles to modules/role/		split the file into one file per class and move them	into the proper autoload layout in the role module.		change-id: iab6bb38b47b172e07c60de23aefa180ec3f011c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/openstack/glance.pp,openstack: refactor glance role/module		* remove openstack::database-server	* this is legacy and openstack on labs is obsolete.		change-id: i77fc50d0a4c37453fe14309b57e23f08881bcc67	|openstack: more refactor and cleanup for multisite		this started as getting controller_firewall.pp out of the	module and into a role based abstraction.  there are various	levels of cleanup here as i removed portions of the controller	role there were not used and options that were obsolete.		change-id: ied6758c8eb13d438384a4255a45577d5abc82ab0	|further hiera-ize role/labs/openstack/		there is still some low hanging consolidation fruit	left here.  this isn't the final form		* moving values into yaml	* moving private values into hiera private	* using role keyword in site consistently (needed for lookup)	* refactor class relationships based on the reduced	  need for classes as param stores		change-id: ib7080dce519c99c5368d01380c8708ec43c069ce	|labs: cleanup and move role classes (part #1)		move to autolayout setup		change-id: i8e3489dbb5cf0d87fc6213c9303fde8cd180fd2d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/systemd/manifests/syslog.pp,service::node: output std out/err to a file		in case a service (or firejail) logs something to std out/err, it gets	sent to journalctl, which is not accessible to service owners. this	patch redirects them to a file so that service owners can consult and	inspect them.		note that this changeset is pertinent only for jessie installs since	upstart has no way of redirecting the std streams.		bug: t137878	change-id: i6f06d85bd1ada95c99b373a5f6b8f51c535eeee6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dataset/manifests/cron/job.pp,use generic job class to rsync cron datasets		remove mediacounts.pp, pagecounts_all_sites.pp and pageviews.pp	implementing their rsync jobs in primary.pp using the generic	job.pp class.		change-id: i053c4e54cfb6596e4b8bcf2a39c4e4986e46aea4	|dataset::cron::job now runs rsync command via bash instead of sh		this allows for fancier shell path wildcards		change-id: i3c30c9e922c494a075858a5888e776baf9b25226	|abstract rsync classes into a define, correct pageview to dumps synchro, add projectview		the path given for synchronization was not correct.	in addition, the projectview files need to be rsynced to the same	location, so this adds a second usage of the pageviews cron to do that.		otto got tired of so much non-dryness, so he made a define!		change-id: i421b2043bbcc9bb2ae78d67fc34d26082dfe113e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/geowiki/manifests/mysql_conf.pp,create geowiki module		this commit finally removes misc/statistics.pp!		change-id: ib36c02b36a4bd4cb4e4ee8293108fe61754aba94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/install_server/tests/web_server.pp,installserver: rename classes with dash characters		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		this is a follow-up to icb2122da0a43b7a1	where the module was already renamed due to this,	but not the classes inside it.		the classes ubuntu-mirror and caching-proxy are removed	from comments because they either moved to module/mirrors	or have been deleted meanwhile. this change doesn't touch them.		change-id: ib91faf62a8c4d2292f2a51e30fbf1c6583f15eaf	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/statistics/manifests/init.pp,statistics: lint fixes		fixes more puppet-lint warnings	for t93645		change-id: ie3adcc01011acaed04ee41331263ed0c91c0172c	|first commit in a multi-commit effort to move misc/statistics.pp into modules/		t87450		change-id: i49140d85ddea99f5d4d9a3c71e60cf7fa57d49b6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/mha/node.pp,role: align arrows in manifests		change-id: i7f2777652de46349e175ab0e8c68a5a840e866d6	|mha: move roles to module/role/		change-id: ia125c22c3d8ed9c2069d3c0920bff4e028b71f3a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/interface/manifests/txqueuelen.pp,interface: some lint fixes		change-id: ibbdba0954f81a04f21748c2a7cde51be00159783	|fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|fix interface::txqueuelen name param		change-id: i13d5e7c4a51358b29689d3a419e85c53e5118576	|add path param for txqueuelen check		(i hate you, puppet)		change-id: ic24c8f22565a0aa63b89b4d377e8f1c8c5e9fc37	|txqueuelen 10k for 10gbps lvs interfaces		change-id: i840fab97dc7e57c4bf37dc43f4b3b9fc40e508d7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/git/manifests/install.pp,git: add missing & (typo?) to exec		this hasn't been causing any apparent problems but it's almost	certainly incorrect.		change-id: i4b158c8cd88135cf8548200b8cf219609eb1ed02	|git::install: fix default mode		since ifb3935d6a, 0444 file mode for git::clone is broken and results in	an error.		change-id: i9fe43b4b593af696c3270c6c3867a6eb20880654	|git::install: make $lock_file truly optional		without this, if you don't define a lock file you get a puppet error:	creates must be a fully qualified path		so we add the parameter only if $lock_file is defined.		change-id: i0f0005e1a21eb43c2f35c68a9265ed8a3d504354	|git: remove out-of-sync alert		puppet is not a monitoring system and alerts have no place in puppet	runs.		change-id: i3c056f2af773a258c9be7b07786f57fdd25c30dc	|git: lint fixes		fixes more puppet-lint warnings	for t93645		change-id: i16455ec8192b0d18b7dcc94d09407974670ec8f5	|git::install do fetch tags explicitly		change-id: i4f513b970b254911ea7a70ffff3e47d221001b07	|git: fix param order		change-id: if0eaa7f355e051f1c32f50ac4cfe50fdeac506e4	|git::install updates (diff/file lock/diff notice)		updated the logic that verifies current tag by doing	a diff and forces an update if we don't match the intended.  this	also allows rolling backwards and forwards with tags.		to compliment the tag/branch diffing i put in logic to specify	a lock file that holds a tag until someone removes it regardless	of upstream state.		if there is a lock file and the local state is out of sync	with the upstream a notification shows in the puppet output.		i updated the header doc to match apache module style.		change-id: ie04a5793b09b0d783698115fe43ce839bdf60478	|puppet-compiler: module for installation		this module installs the puppet compiler. it should then be runnable	using the puppet-compiler command. note that this module does not	install the facts collection as this is mainly intended to run in labs,	where production facts can be used only after being cleaned of sensitive	data.		change-id: i07f46fe66b994d345a97cfc75345bfa2e5311ff2	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/nfs/backup.pp,labstore cleanup and role vs module arrange		this more accurately reflects the module and role	schemes used for other config.  we are also staging	to have primary/second/misc nfs setups so rename as	primary and misc to that effect.		change-id: id66499d22a7f40df8174fdfab8a89e10899beb7c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/alternatives/manifests/select.pp,alternatives::config -> alternatives::select		* fix alternatives::config and rename it to alternatives::select.	* remove alternatives::install (it was added for hhvm, but the	  alternative is now installed by the package itself, so this no	  longer has a concrete use-case.)		change-id: i0f2ccfe361265c1d8b1f897b6196d8c5981f7a16	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetdbquery/examples/query_resource_examples.pp,puppetmaster: add puppetdbquery module		also install puppetdb-terminus that is needed for the parser	functions. the module is version 1.6.1 (the latest version compatible	with puppetdb 2.3) from https://github.com/dalen/puppet-puppetdbquery		change-id: i305fc0eea19e75c4ba0ad511e0c76a842a1ec140	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/snapshot/dumper.pp,get rid of the useless snapshot cron role wrapper		just include the cron class in the module directly		change-id: i705c4ea480f1f887777203dd169c5e0da0090b03	|add system::role to the dump related roles for snapshots		also fix up the role name in existing system role		change-id: i7334862ea2ae9aa2dc2c8ce0b4e2c2d90044a2c4	|move dump related commonly included classes out to common role		change-id: i996ac5442320b42f6ca3304c29bdacfb31a30dab	|remove obsolete manifests from snapshot module/role		also include role::snapshot::common everywhere it should be		change-id: id3deb3814afccb584ac7f68d58cfd6977b707e78	|drop deployment-ssh rules from role::snapshot::dumper		already provided via modules/scap/manifests/ferm.pp		change-id: i481dfee6bcf74cf6131324136c6338d700d2b97e	|add ferm rules for role::snapshot::dumper		this needs access for deployment, but the rest should be covered by the	base rules provided by base::firewall (e.g. nrpe, sshd etc).		change-id: i2153ee4bf40f782a75a901e1f0cd3a2d915879e2	|swap classes on snapshot1002 for cron dump run job		avoid conflicts with old and refactored classes		change-id: i78951b7a26f0a37ab08459340629b711b4072834	|revert "add hhvm include to snapshots experimentally on jessie"		this reverts commit b9c88c73c0ed16cf0529385a464948c718bfda5a.		packages not ready so backing out.		change-id: iaabf8020e6e445f6b7df7475167bbe3c071788b3	|add hhvm include to snapshots experimentally on jessie		change-id: ib46946b2d11bba6f01acd3ef27e5bc464f495be8	|add mediawiki packages and other dependencies for snapshots		change-id: ic96e4205e5dcc381518356bf84967d978abcacfb	|basic snapshot role for dumps		set up config files dblists etc	scap3 deploy	cron job	hiera settings for things which vary from host to host	  (only one host needs to run en wiki, only one host needs to	  reserve cpus because it runs cron jobs)		change-id: i8d48878300de584bd5385a0c46b2fc0e25e5bf41	|start new snapshot role with the basics at first: scap3 deployment		change-id: iff3af71929a3cfedd9d234c472dd92786534388b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/conf.pp,mysql_wmf - autoload layout and lint fixes		move classes into autoload layout	fix lint warnings		change-id: ie7510e8c90e365f43ce621c3f524aa1e87e2c584	|move mysql_wmf into a module.		the manifest changes here are pretty brainless -- i split the major	classes into separate files and rearranged the file and template	includes to reflect the new position of the source files.		i also moved quite a few files that were filed under ganglia	or icinga but only used by these classes -- now they live in the	mysql_wmf module instead.		change-id: i31b8d8562f8eda4a6fde4a6110d83a339fc38b94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/coredb_mysql/manifests/heartbeat.pp,coredb_mysql: lint		no changes to behavior; only presentational changes in this commit.	 - spaces rather than tabs.	 - align arrows.	 - don't align equal sign, except in function signature	 - single quotes when not interpolating.	 - single resource per block.	 - quote strings.	 - quote octal permissions.	 - 'ensure' always first property.	 - use ensure => link w/ target rather than implicit symlinks.	 - every property ends with a comma	 - one class per include.	 - resource name and resource type on same line.	 - [ space ] in arrays	 - '&>/dev/null' instead of '>/dev/null 2>&1'		change-id: i419f48c9713e5c59deac093ac86142d4d938a25c	|renaming coredb module to coredb_mysql to avoid module/role class namespace fuckery		change-id: i1c8ab607514c63be7a9ab36ac337ae20918cfa6f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/deployment/manifests/rsync.pp,role::deployment: add a warning on the inactive server		the secondary deployment server gets updates from the primary via redis	replication and rsync (for trebuchet). we don't want people to	erroneously use tin or mira when one of the two is not the active	deployment host.		add a scary-looking motd so that it's easy enough to notice.		change-id: i8c86e553c2d3670e1b757eff8ab28fc08d76c566	|deployment::rsync: the inactive server should sync with the master		not vice-versa...		change-id: i0c117a6cb761e80cae5e7f8d84377b644d484c17	|deployment::rsync: fix cron		change-id: i23bffbcc94f42ca4b6c4cee7d06890fcb214284c	|role::deployment::server: syncronize /srv/deployment		we want both servers to be able to deploy code, so we do as follows:		- install an rsync server	- if a server is not the current master, install a cronjob that syncs	  data from the master every hour.		change-id: idf2ff5444c7928252daac3b45dc89b8dfae8736f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/php.pp,mysql: make lint ignore classes inhering from params		instead of globally turning this off in puppet-lint.rc,	mark the few actual occurences as fixmes and let lint ignore	them in those specific places only.		change-id: i5deef55101c5105007521ff366182af955baf29b	|initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/client.pp,reorder bacula keypair key/certificate		bacula can fail when trying to determine the correct key to use during	decryption. this has been observed in precise, trusty and jessie but is	not entirely deterministic. we have had quite a few successul restores	in the past in production, but there have been failed ones as well. in	testing, it has been reported to consistently fail. reversing the order	of certificate and private key in the keypair file and setting the key	first seems to solve the issue.		change-id: ic10b541fd37cfe341fe2edb86aea1e2e41875fac	|fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|bacula: lint clean		change-id: ifa52cd25ca01f73228243b797dff6eea2ea124bc	|fix various typos in bacula module		change-id: i6c05fb5902bb7cf2216595b880eb0253f55ae202	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/icinga/manifests/nsca/daemon.pp,icinga: no suprise upgrades with 'latest'		let's not have suprise version upgrades of icinga because monitoring	itself is pretty critical. let's do manual scheduled upgrades instead	in this case.		change-id: ia3b2762bc53a11d183a07cfc7bc69b53e3ec04be	|move majority of privates/files usage to secret()		this is all of the trivial cases, where a fixed path was hardcoded	as the source attribute of a 'file', 'ssh::userkey', or	'exim4::dkim' definition, all of which are known to handle the	source/content switch ok.		change-id: i0db6fdb1c75355b58095e0ec29d6028bbc614649	|icinga: move nsca code into module		- nsca::client does not seem to be used anywhere except the	  hadoop nodes	- the firewall rules misspelt nsca as ncsa, corrected (i assume,	  since the port numbers match nsca, and ncsa seems totally	  unrelated)		change-id: i4c6e84da376796253689a980a382ff62c8e29f56	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/postgresql/tests/spatial.pp,support spatial_ref_sys and comments in postgres		automate installing spatial_ref_sys and comments in a postgres	spatially enabled database.	automate grants handling	enable pgversion handling	add spatialdb tests		change-id: ibd781745ca923ea7668de15cdc62bc765eedb41b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/zuul/configuration.pp,zuul: use gerrit service hostname instead of server		move from lead.wikimedia.org to gerrit.wikimedia.org.		change-id: ibad4990afd31c1bee3fc3489973bcb1e4152de22	|gerrit: swap lead to point at production data		- points at proper hostname and database for lead	- enable replication from lead	- stops replication from ytterbium	- switches zuul config from ytterbium to lead		change-id: i312d405ce964a5b18d5f58815232fd25d5e02c14	|contint: remove zuul-merger from gallium		to ease the transition of ci services from gallium to contint1001 remove	the zuul-merger instance on gallium. one less service to migrate and we	have another instance on scandium.eqiad.wmnet		the zuul scheduler connects to gearman over the public ip, the ferm rule	comes from the zuul-merger though so:		* change the gearman_server setting so it can vary between server and	  merger instances	* have zuul scheduler to connect over 127.0.0.1	* ferm by default allow all traffic over 127.0.0.1, drop ::1 and	  127.0.0.1 from list of zuul merger hosts which was solely to open the	  firewall rule.		note: would need some manual changes:		* update /etc/default/zuul-merger and set start_daemon=0 to prevent it	  from running again	* prevent upstart from spawning it on boot		bug: t137418	change-id: i4b19cb348c883aa66e380746806ba5a12ec1fb5a	|zuul: move roles into role module		move the classes from manifests/role/ to	the role module in the proper autoload layout.		change-id: i3238035ee75b5e14ecae105d73d84ba921b32b26	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/planet/manifests/config.pp,wikistats,planet: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i202fe720deb1cb8407ac8cf66e222312aee3af47	|turn planet into a module		there has been an older attempt to do this	that had to be reverted due to a bug causing	puppet issues		so this is along the lines of	https://gerrit.wikimedia.org/r/#/c/54502/3	https://gerrit.wikimedia.org/r/#/c/58495/ etc,		but entirely new and _doesn't_ do things like dropping	the role class, putting config into module etc.		change-id: i980f9dc9f48e80d53dd2c920622ae67672d575df	|revert "make the planet logo a "per language" thing"		this reverts commit f2264e7a97f26b6b2d6548e9d730e01ce42baebe.		revert "resource references should now be capitalized"		this reverts commit 54d5baca9de9ea519c216ceb08030eb93cffc674.		revert "remove duplicate definition of locales package"		this reverts commit ebd76e02e4d7322a57a605b33afde16e4bf93a72.		revert "turn planet into a puppet module"		this reverts commit ec09aaefb8b9f7eafc82aaca5dff7e940c243f4e.		change-id: i093cfc85d1ca8550c19a246ae9ed8fb0e91149e3	|turn planet into a puppet module		- move all files, templates, into module subdirs	- add readme.md and turn role file into init.pp	- quoting and arrow alignment	- 2-space softtabs, etc. per puppet style guide		change-id: i9d0fda3f27715282068e760d2f01c2fc298314b7		rename planet class, per docs init.pp must exist and contain	a class matching the module name		change-id: i19034d090692387ca7e9d7f2d87fe4f9e13793e7		move defined resource types into separate files, one definition	per file inside a module as recommended by puppet docs		change-id: i91fc1ccad73b5498441de39a3e150e65e017df1b		move package install to own class and file,	move generic::locales out of init.pp		change-id: i63217308b7d3c6469ba3c30bc4a183e62f8b2b77		move webserver setup for planet out of init.pp		change-id: i00dde9965afe86b58ba609810bcaa6b588ac17af		move locales install and generation into own file,	step 1 to making module self contained instead	of declaring stuff from generic-definitions.pp		change-id: i239fa19a8bd40eadeb7a6aea3ab9feddb480610c		move needed planet directories to own class		change-id: i153848976801f3bd378f83dcfab0d70a4984fd66		move user/theme/apache_sites out of venus.pp, move index_site	setup to own file, move webserver setup out of init.pp		change-id: i9769542394ff96a46e0cf46e8269f9fbe9cc8e92		move language prefixes and translations to own class/file languages.	use a qualified variable to access it		change-id: i88a12546e4ed42b5d6ced9a4d68bf22fff64c486		various fixes to make puppet-lint like it,	like wrong quoting, unaligned arrows, variables without explicit scope,	lines longer than 80 chars, and more		change-id: i260c28ab1028f8d11e6e155540a708a45f63745f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/monitoring/manifests/ganglia.pp,add fixme's/ignores for all variable scope issues		all of these show up as "top-scope var without namespace" warnings	in puppet-lint.		and in the global puppet-lint.rc we have this comment:		# we still use the 2.6 way of referencing variables	# 2.8 will requires $::globalname. skip for now.	--no-variable_scope-check		so what i'm doing here is to mark the actual occurences of this	as fixmes and let lint ignore them, but then in turn will remove	that global exception that just turned this off all the time.		that way ci will discourage adding new variables without specific scope.		the existing ones should be fixed, but some cases are easy and some can	be pretty tricky. the ones that are left are mostly of the harder category.	a _lot_ of easy ones have been fixed in the past already,	but for example i remember we tried to fix the one in ganglia before	and it caused problems. so these have to be carefully tested.		we will have to get the fixmes done one by one before puppet 2.8, help	with that would be appreciated.				bug:t125042	change-id: i02619ef50ecb01905b6184bddd3d53fec212d7a3	|revert "monitoring: fix top-scope vars without namespace"		this reverts commit 843232e8c48d94b15d345b33afc16e03741e1651.		change-id: ie32ed49638b803f2a08fe927a70ec80756a7427c	|monitoring: fix top-scope vars without namespace		fix 4 x warning: top-scope variable being used without an explicit namespace		change-id: i15a11a6a06ce68d9342e844f05864ee6c483b8c5	|root out a long chain of quoted bools in nagios/icinga/nrpe		bug: t113783	change-id: i16cee528ddf05f90b2cc7c9f474fe8a4db914582	|ganglia: rename ganglia_new to ganglia		change-id: i1e92bc3e994e9a522c82b3b7c3b5136622d34250	|ganglia: remove references to ganglia::cname		change-id: id2006fed674b2f3b580178ffce1255fb6a0ab57b	|nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|monitoring: move stuff out of nagios.pp, part 3		we move monitor_ganglia in favour of monitoring::ganglia.		change-id: ib634fef02ac2be261d4af48b89174fb27535ee8b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/microsites/annualreport.pp,move microsite roles into a common place		move roles that setup microsites into one a common place.		this makes it easier to find similar roles in one place,	and it also moves more roles into proper autoloader layout.		also move the peopleweb::migration class into a separate file.		change-id: i74c16340c44318876db701ff37f84f780a40c5d3	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/wdqs/manifests/monitor/updater.pp,publishes non aggregated metrics for wdqs updater		previous configuration was publishing "meanrate", which is a meanrate since	the start of the application. this metric tend not show short term variation	of the underlying indicator. better metrics are the "count" (provided we	calculate the derivative in graphite) or the "oneminuterate". i'm adding	both here, we'll see how we might settle on a single one once we have some	experience with them.		at the same time i did some minor cleanup now that jolokia is run as a	java agent.		change-id: i4d047ea195fab69d4fb57344722d204580a50a0a	|diamond: wdqs and blazegraph collectors tweaks		* remove some debugging cruft	* call self.publish from collect	* file names are standard lower and snakecase	* we use a standard default prefix	(no need for special prefixing)	* move collectors to files/monitor	* set interval at default for aggregation integrity		change-id: i2bc918a177f42408b954875e623db03a7811d17c	|add definitions for wdqs service		task: t95679, t103904	change-id: ie60e8962304c878a122d042f1d973e7b31ae4470	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/stdlib/tests/file_line.pp,add the upstream stdlib module to the repo		change-id: i5b7c29b7fd20373b0d74f660609c628e5f3c8d54	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/mediawiki/jobrunner.pp,move jobrunner ferm service into the roles		ferm services should be configured in the respective roles, so migrate	the service into role::mediawiki::jobrunner and role::mediawiki::videoscaler.		change-id: i20c27a95314b23a1baa65bd5a4e1d284c0957ddf	|add nfconntrack and tcp states diamond collectors to jobrunners.		change-id: ie4efcbf339eb4069ae1c5816bfdb59ddca5dea23	|revert temporary bump of connection table, underlying bug has been fixed		change-id: i573db185c9b1a968637c97a2467885be148049bd	|bump connection tracking table size on job runners		temporary measure until t130364 is properly diagnosed.		change-id: ie13374352bd6b87f83aa1533ede7fe6ad1b0ffa9	|jobrunner: monitor the hhvm server health		we've been in the blind about the jobrunners not working for about a day	because there is no current way to monitor the hhvm server that is being	fed jobs from the jobqueue process. this patch introduces a simple check	that will hit hhvm and warn us in case of problems.		change-id: i6b99bba4eb3459f90bd27c0456308ebeedca3410	|mediawiki: split role classes, move to modules		instead of stuffing all roles into a single file,	use the correct structure for autoload layout and use	one file per class as per style guide.		move the classes to modules/role/ structure		change-id: if7626dba62cc14ff62a12cc1df7af49a61211429	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/mediawiki/generic_monitoring.pp,mediawiki: split role classes, move to modules		instead of stuffing all roles into a single file,	use the correct structure for autoload layout and use	one file per class as per style guide.		move the classes to modules/role/ structure		change-id: if7626dba62cc14ff62a12cc1df7af49a61211429	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/k8s/manifests/users.pp,k8s: make kubelet run as root as well		needs to manipulate cgroups and other things that	require root		change-id: i642f25fe11eb4385180b502d824a92697884cb44	|k8s: add kubernetes user to the docker group		change-id: i894ac6507019327179a736909539172f94afbe2d	|k8s: switch to running everything as a kubernetes user		change-id: i2386e6d9764ae31f993e37b6e4a76164451f9240	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/elasticsearch/manifests/monitor/diamond.pp,elastic: sane diamond collector for wmf		ref t111573		change-id: i9cefed6ee1ac7cbcf39a28e611bbe28bcff402f4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/google_api_proxy.pp,google_api_proxy: add role for google-api-proxy labs project		add a role that can be used to provision one or more nginx reverse	proxies in the google-api-proxy labs project. this project provides	static outbound ip addresses for tool labs tools and other labs projects	that are using google apis.		expected to be used with wikitech managed hiera configuration similar to:		  role::labs::google_api_proxy::instances:	    google-api-proxy.wmflabs.org:	      proxied: https://www.googleapis.com	      default: true	    googlevision-api-proxy.wmflabs.org:	      proxied: https://vision.googleapis.com		this was originally committed as i2fe9263 but then reverted in id199f0c	due to t119042 (putting roles into module/roles conflicts with role/*.pp	import). a readme is added to modules/role/manifests to help remind	people of this potential problem. nobody ever reads the docs, but hey it	is worth a shot.		bug: t144290	change-id: ie9e38b243309d110695c776908c22ce556a7b7b8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/smokeping/manifests/init.pp,smokeping: various cleanups		i'm suspecting this class has never worked properly (the suspicion	arises by the fact that we define two system::role['smokeping'] in what	should be the same catalog, but this doesn't result in a conflict).	cleanup a things a little bit. more specifically:	- include ::smokeping, not smokeping, from role::smokeping (typical	  recursion error)	- remove the system::role from the module; it only belongs in the role	  class	- fold class smokeping::config into class smokeping (no point in having	  it different). also drop the package -> class dependency which is a	  no-op given where it's defined.		change-id: ic7777b8ab39e3ac7939a95ca8761c01bc736980c	|smokeping: don't ensure latest		ensure the mere presence of packages instead of forcing the latest version.	we automatically sync the debian updates and with "ensure => latest" are	installed automatically, which may result in broken installations if an	update in debian or ubuntu introduces a regression.		only ensure the presence of the package; updates of installed packages are	performed via the standard softwre update procedures.		change-id: ic64345c891d4577c2cb33b9d800b0bce84ae5af2	|smokeping: fix minor compiler warnings		warning: unquoted file mode	warning: ensure found on line but it's not the first attribute	...		change-id: ia545d1331498eff9285e4097c03a4f1f898a470f	|fix misc jenkins warnings in multiple modules		change-id: i83c8de2318f11355c1ad0c23eced02792005efe4	|move smokeping to a module		change-id: i5bd6c6c8da602f13a3eff9e857fec4b10bae56ca	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/grub/manifests/init.pp,create a new grub module		this provides an almost dummy (but reusable) grub class, a	grub::defaults class that is used to remove quiet and splash from the	default (ubuntu) config. much more importantly, for newer systems it	provides a grub::bootparam define that can be used to set kernel	parameters from all over the tree, instead of relying on hacky	base::grub parameters.		change-id: if03604a07be59ac2be30ec14b1a532c2f16fabc7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/graphite/production.pp,graphite/production: limit to production_networks		data is only logged from production networks.		change-id: if15fc480eee49600f2079522c3412f0e663eaac7	|move graphite ferm rules out of role:graphite::base		move most graphite ferm rules from role:graphite::base to role::labs::graphite	and role::graphite::production. they are currently in role:graphite::base,	which is shared among the two, but they will need to customised in their	access in a followup patch, so that role::graphite::production is restricted	to $production_networks and role:graphite::base to a (not yet existing)	$labs_networks.		change-id: i0dac796422c0a05e3cbe55a779a7693424aae9ff	|graphite: add 'big_users' route and cluster		also introduce 'forward_clusters' to move beyond a single 'backends' cluster		bug: t85451	change-id: i83f71e5fc8965ef2d3e8ea5bf39f900677e67916	|graphite: fix hostnames / brown paperbag		ironically, this raced with the typos fix in	https://gerrit.wikimedia.org/r/#/c/287614		change-id: i41935b39605c77cc21539938cc9b1704fb331fd4	|graphite: export /var/lib/carbon via rsync		needed to transfer whisper files across machines		change-id: ib48aa8445ec29b16c3c0fb57b7eba426ac22d211	|puppet-lint: fix some more indentation warnings		change-id: i4804e40e6646b16b442b6fac9f0df87aa3fc8cb8	|fix copy&paste error in carbon ferm rule		change-id: ie3ddaadf66671b75e48d1b746f6a05138bae52b5	|add ferm rules for local carbon relay		after enabling base::firewall on graphite2001, traffic towards port	1903 from graphite1001 was dropped. this patch adds the necessary	ferm access rules.		change-id: iace95f62d2416e314a05070eb589901ff6aa06ed	|graphite: move roles to modules/role/		split the large file into one class per file	for readability and per style guide and lint.		move them into proper autoload layout in the	role module and out of manifests/role/.		change-id: i028f06277bd95bd8f0196cd24ea43bd9c3d8381f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/manifests/config.pp,modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/yubiauth/manifests/yhsm_daemon.pp,yubiauth: fix class name to use underscore		change-id: if96733e864dd5e912e23947a1fa0f48a4061a180	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/tests/python.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/zuul/install.pp,zuul: move roles into role module		move the classes from manifests/role/ to	the role module in the proper autoload layout.		change-id: i3238035ee75b5e14ecae105d73d84ba921b32b26	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/config/client.pp,mysql: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i712bb124c16d625cc639fca30a683dc11583b77c	|add defines for working with mysql config files, and mysql client settings		change-id: i81cf2238346455f229a5cdb79ea93371fdcce2af	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nrpe/manifests/monitor_systemd_unit_state.pp,nrpe: fix description for monitor_systemd_unit_state		change-id: ide74e6107e0d05a71ec432d8511856e37ee30390	|root out a long chain of quoted bools in nagios/icinga/nrpe		bug: t113783	change-id: i16cee528ddf05f90b2cc7c9f474fe8a4db914582	|redo "nrpe: merge check_systemd_unit_lastrun into _state"		this reverts commit 0d171b748a0e39592267be3f001b8dca7158e2f3.		(and adds a require_package() for python3, which was the	issue)		change-id: i91e58d2add83c5eaded426b9dd9d14c9bec356ad	|revert "nrpe: merge check_systemd_unit_lastrun into _state"		this reverts commit ac35c601ee4447baf2e1a21812856d78afb2ab19.		broken.		change-id: i92857030fd47c771b9a419c55f863a61c9b4f868	|nrpe: merge check_systemd_unit_lastrun into _state		_lastrun used a method that, while functional, requires privileged	access (which is not apropriate for nagios).		the flipside is that, in order to get last run status with this	method the unit must actually be set up as a systemd timer.		change-id: i19e62e625fb42fe496560df14aba4f707911028e	|nrpe: put the defines in the respectively named files		last changeset split the two - exactly in the wrong files.		change-id: i76c21ed10197ec11a3ec99e310724174d904671c	|nrpe: add new checks for systemd unit health		nrpe_check_systemd_unit_lastrun unit warn crit	    checks the time since unit last ran, and emits a warning	    or critical if it has been over (respectively) warn or crit	    hours.		also, nrpe_check_systemd_unit_status has been updated to be	also able to check result of a unit and emit a critical if it	is not running and the last run was not successful		this also renames the monitor_systemd_unit resource to	monitor_systemd_unit_state for consistency.		change-id: i9cba4f63e7fc60d2dcd9da3cb09b0a35fbb9f4cd	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/shinken/manifests/config.pp,fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|shinken: unify shinken::hosts and shinken::services		change-id: i8511a08aa183474f24a1f5005c44678c5449de73	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/toollabs/manifests/admin_web_updater.pp,tools: fix puppet-lint warnings		change-id: ib8a9b6bd5b84bdb97ca9a749c541f92278aca5fa	|tools: deploy root web automatically again		change-id: ia464364afd07a1ca8d2cb3c0c4aed7fe35bac91b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nagios_common/manifests/check/ganglia.pp,fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|icinga: make all config files belong to icinga:icinga		no reason they should all belong to root.		also remove the exec{} that munged permissions. add explicit	modes where required.		left as root ownership is:	- executable files	- files that specifically have a mode set that would not allow	  any access to non-root		change-id: i6d95a9b45e868d13b07dd5be42007b263c8f2cf3	|nagios_common: move check_ganglia into module		change-id: id04fa056ddbed5e94be45ddd3c08773e521afdab	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/python.pp,mysql: make lint ignore classes inhering from params		instead of globally turning this off in puppet-lint.rc,	mark the few actual occurences as fixmes and let lint ignore	them in those specific places only.		change-id: i5deef55101c5105007521ff366182af955baf29b	|initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/syslogs/readable.pp,base/syslogs: fix "defined typed defined inside a class"		change-id: i1690f29f7d86a92cc2aecbfad17bf7b5db57c07a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/statistics/manifests/sites/stats.pp,fix whitespace-related lint issues		fix a lot of lint warnigns due to incorrectly aligned arrows.		change-id: ib062d7142a79a8cb6bb3abd86fd7499aa3edad03	|move majority of privates/files usage to secret()		this is all of the trivial cases, where a fixed path was hardcoded	as the source attribute of a 'file', 'ssh::userkey', or	'exim4::dkim' definition, all of which are known to handle the	source/content switch ok.		change-id: i0db6fdb1c75355b58095e0ec29d6028bbc614649	|statistics: don't let apache listen on 443 anymore		there are no enabled virtualhosts on stat1001 anymore that have an ssl config / 443 port.		therefore apache also doesn't need to listen on it anymore, as came up when we were	adding firewalling in ia803fd1d7e30d14.		this custom ports.conf was only needed in the first place to add a "namevirtualhost *:443" as opposed	to the standard file that comes from the distro package.		change-id: ib942e07872d069eb9f4900a8f0c331983b527abd	|statistics: lint fixes		fixes more puppet-lint warnings	for t93645		change-id: ie3adcc01011acaed04ee41331263ed0c91c0172c	|create geowiki module		this commit finally removes misc/statistics.pp!		change-id: ib36c02b36a4bd4cb4e4ee8293108fe61754aba94	|fix document root for geowiki-private data in stats.wikimedia.org		change-id: i968924e5ac9363556053fbd01f22521997393997	|require statistics::web in statistics::sites classes		change-id: i3ec5366046d8a1952899e2a54b3d1d04cf63a8d8	|fix dependency, fix template variables		change-id: i1cb102d6a5220e3ce34b6be4e5cd12cdaa9298f5	|use proper path for statistics::sites templates		change-id: iee382cce771fabb41ed4ff7459269f844d280275	|first commit in a multi-commit effort to move misc/statistics.pp into modules/		t87450		change-id: i49140d85ddea99f5d4d9a3c71e60cf7fa57d49b6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/gridengine/manifests/hostgroup.pp,gridengine: lint fixes		change-id: i67605d493666c952d742d363a617d7720301d027	|tool labs: rm obsolete gridengine::resource param		completely, this time.		change-id: i59520e85c5dbd3caabb41de24da0ea84a75558f5	|tool labs: final fixes to gridengine iii		- make collection of dedicated queues depend on membership	- remove unneeded parameter to submit_host	- submit_host needs (noop) new-style config parameter	- add adminhosts support	- fix gridengine::hostgroup and gridengine::queue to use	  the new-style config parameter		change-id: ia41417e874e0152a889934a24bb30edad152ed28	|tool labs: final(?) fixes to gridengine iii		- add dedicated node queue config	- expand templates at the last minute so that $title is	  correct (and all variables are otherwise available)		change-id: i5bcc9d0cfbf9fc3962decd8a1b885cdde7c21398	|gridengine: proper puppetization, part deux		- fix default config (merge cannot support multiline values)	- group names must start with '@'	- rejigger how configuration is collected in the shared	  config directory	- move resource collection from the toollabs to its	  proper place in gridengine		change-id: id9249c61a0a5569e13e4a8fe1568bf9e79e9b1b9	|labs: further fixes to toollabs and gridengine		this reverts commit d67485f8d4cebe0cab1d9e2f6f585bed6e507e30.		change-id: i64627e202900b4d7bbf0334bf64261c9f86d73e7	|labs: puppetize gridengine		much of this will need tweaking and hacking; gridengine is /not/	amenable to simple puppetization because most of its configuration	lives in a bdb.		most actualy configuration bits are nooped with 'echo' at this	time while testing takes place.		change-id: i7856b65ebead6aae04777c4851ef3c7771b239f5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ci/jenkins_access.pp,ci: split and move role classes to modules/role/		split the large file into one file per class for	readability and per style guide and lint.		move them into ./modules/role/ and into the proper	autoload layout without renaming any classes or	changing content.		change-id: i3d514e64b56dcba5486ffbd2f22eb95d8326e1c9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/icinga/manifests/monitor/ripeatlas.pp,ripeatlas: lower intervals to 5/1 from 10/5		10/5 with 3 retries means that it'd take 15 minutes on average for us to	notice. lower to 5/1, i.e. 4.5 minutes.		change-id: ie03d208fa1f204acae249768174736bb200578ec	|ripeatlas: add ipv6 measurements as well		change-id: iff1ae0f2b0eea0a7558ada85f252f82572b5a547	|icinga: fix ripe atlas command definitions		change-id: i44d70773123a048e23dc56fdf14c5eaa17ac4b2f	|icinga: monitor failure rate to our anchors		we currently host ripe atlas anchors at	three datacenters. this will watch the built in	checks for the anchors and alert if their reachability	thresholds drop below a certain number of failures.		change-id: iae54d97cc5b43112e65c61ba87e4f36c9a6d16e1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/pybal/manifests/pool.pp,pybal: don't write pool files using confd		change-id: id6439e6362be80699624b580fd98ce15180ab109	|pybal: fix dependencies		change-id: id66b443981a51d3dce2a3851f2e6edb9626dafa1	|pybal: refactor pybal::pool, print pools in pybal::web		since we're moving away from out traditional schema where the pybal	pools are directly operated on via raw files, we still want to present	what's pooled and what's not pooled via an http request. so we:	- factor out the confd file generation from pybal::pool	- create the resources for all pools on hosts with the pybal::web	definition	- avoid monitoring all of those on palladium, as that's not really critical.		change-id: i30dd4ae6a0bce64c02c809e214fd868a897a97e7	|setup a node pool file from etcd for lvs cluster		with a conftool cluster and service definition	included in the lvs::configuration cluster hash	we setup a confd toml and template to allow	external definition of nodes in the pool.  the	config line change to actually use this etcd	sourced config is commented out as this will	rollout slowly.		example of confd files created for 'text':		/etc/confd/	├── conf.d	│   └── _etc_pybal_pools_text.toml	└── templates	    └── _etc_pybal_pools_text.tmpl		example toml file:		[template]	src = "_etc_pybal_pools_text.tmpl"	dest = "/etc/pybal/pools/text"	mode = "0444"	keys = [	        "/conftool/v1/pools/eqiad/cache_text/varnish-fe/",	    ]	check_cmd = "/usr/local/bin/pybal-eval-check {{.src}}"		this change assumes each lvs service has a conftool service	and cluster reference.		change-id: i6c0179738bc3dab0170a5ccba20f53cd42a06b79	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/coredb_mysql/manifests/packages.pp,remove support for ubuntu lucid/10.04		change-id: i49b16d717559c8126e2517bb5131dc0ae88e27bd	|use apt::repository instead of file resources		change-id: ica0bf234c404dd7e32e9ca928da1b4766b966582	|coredb_mysql/mysql_wmf: remove mysql-fb support		we've migrated fully to mariadb now. also, no lucid in any database \o/		there's still some ubuntu-12.04-specific code, but since the two modules	are deprecated in favor of the mariadb module, just add an "else fail()"	and be done with it.		change-id: i8b218226cb00c51b1a0708f32d4823683ae3bfad	|puppet3: fix $mariadb dynamic lookup		change-id: i001748655bb6a5513b6d0b66852ec2721d440480	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|coredb_mysql: convert a few additional leftover tabs to spaces		follows i419f48c97. i missed a few spots.		change-id: i7183fa78ee2f1eb41cc69e987d7a853e35583732	|coredb_mysql: lint		no changes to behavior; only presentational changes in this commit.	 - spaces rather than tabs.	 - align arrows.	 - don't align equal sign, except in function signature	 - single quotes when not interpolating.	 - single resource per block.	 - quote strings.	 - quote octal permissions.	 - 'ensure' always first property.	 - use ensure => link w/ target rather than implicit symlinks.	 - every property ends with a comma	 - one class per include.	 - resource name and resource type on same line.	 - [ space ] in arrays	 - '&>/dev/null' instead of '>/dev/null 2>&1'		change-id: i419f48c9713e5c59deac093ac86142d4d938a25c	|change from explicit mariadb version to present while testing multiple versions		change-id: ic890842397d573f9e5ff356d15d7e099c3fb8d94	|mariadb pacakges. but only for those who really want them		change-id: i0fccce1504e68f47d0ca49347a84f2680528b7e3	|backing out precise maria db repo		faidon has suggested a more reasonable way to do this.		change-id: i3b8b429282c9dc301e633cc61a3620f60980934e	|cp/paste error for mariadb repo		change-id: idf979a4dfb9b7bcba154e446e944d73ad2ee2df8	|adding mariadb apt repo to mariadb boxes		change-id: i3a86e4f78426f7db583df34d158be31162025351	|coredb: hacking in temporary mariadb support		note: full plan is to make a generic mariadb module, and also	a coredb_mariadb module		change-id: iad87087ac1c08ba00fa31dcb28af5e7297bee462	|coredb: cp/paste error for lucid package		change-id: ib80238b1db7523686faea361c71435fb92809680	|coredb: adding lucid support for packages		derp		change-id: i63962d7a3101e56cae64b6232f630159d9a98570	|renaming coredb module to coredb_mysql to avoid module/role class namespace fuckery		change-id: i1c8ab607514c63be7a9ab36ac337ae20918cfa6f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/icinga/manifests/monitor/legal.pp,icinga: define en.wb.o host		ref t108081		change-id: i080ae69411475230a23113153f075b094fab3bdc	|check legal html for en.wikibooks as requests		* copyright	* privacy policy	* terms of service		ref t108081		change-id: ie1bc6f663e6ae67f386fb62c45bfb8576284ff96	|icinga: fix host def for en.m.wp.o-legal-html check		change-id: i4f7cfcbf746f844081d4e7d5cded4742d613419c	|icinga: dupe resource name fix for legal		change-id: i16775355cf09169917df95a734c2720aac1ac1ad	|icinga: watch for the existence of certain html		this is going to be extremely iterative as	there is little consistency across projects for	these items: trademark, copyright, privacy	policy, and terms of use.		ref t108081		change-id: i7cdd33d6b097c0a34c97742110afaa6cf5a27cd5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/director/schedule.pp,fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/beta/bastion.pp,beta: move roles to modules/role/		- split the large file into one file per class,	  per style guide and lint		- move them into autoload layout in the role module	  and out of manifests/role/		change-id: if8f08467126ec607806c7b704f9953c96dc17e88	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/install_server/manifests/tftp_server.pp,installserver: rename classes with dash characters		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		this is a follow-up to icb2122da0a43b7a1	where the module was already renamed due to this,	but not the classes inside it.		the classes ubuntu-mirror and caching-proxy are removed	from comments because they either moved to module/mirrors	or have been deleted meanwhile. this change doesn't touch them.		change-id: ib91faf62a8c4d2292f2a51e30fbf1c6583f15eaf	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/microsites/releases/upload.pp,releases/upload: fix typo in class name		change-id: i04eeb3379e9afa15b05d47de6e70f95189ec867b	|releases: fix role name for upload from deploy servers		this class has been renamed in i74c16340c4431887.	also, move each class into a separate file and the proper	structure for autoloading.		change-id: ie8dcd8ff0d8cf75e054db4326ed95f97e7222ae5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/postgresql/tests/user.pp,postgresql/postgis module		introduce a postgresql module capable of setting up databases in master	or slave mode, and postgis. module also allows for setting up users both	in databases and pg_hba.conf		module contains tests and rspecs.		change-id: i118a987de1c0ed38037cc3a15ba3fa2b299f55c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/facilities/manifests/init.pp,monitoring: move all groups into hiera		instead of having groups scattered thoughout the tree, move them all	into a single yaml file used by hiera to create all monitoring_group	resources required by the role::icinga class		change-id: ifc44390880ad1477bbb1693a943336645b3826a8	|(fixing white space) adding init.pp & power.xml entries for ps1-d1 to d8-eqiad		change-id: ib46ce78ac248840d47b1e5358ab6d491ba6c42e9	|facilities: move to module		after the dc-cam class has been removed	facilities.pp is just pdu monitoring		first attempt was ib06d7943e315c0 to move this	to nagios_common module, but per comments from yuvi,	abandoned that and now creating a new module	'facilities' instead and moving it there		change-id: ia41e114465b61eb9d6d6402a58131a4598f7eab2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppet/tests/config.pp,puppet-tests: remove broken inclusion of nagios.pp		the file manifests/nagios.pp has been moved in i21a3ca32fd425dd20	and does not exist anymore in this place.		when trying to compile changes to the tests files itself you get:		error: no file(s) found for import of '../../../manifests/nagios.pp'	like on https://integration.wikimedia.org/ci/job/pplint-head/10231/console		change-id: i6b5279947b24c63e10d0b66974bb3b23c57d46e8	|modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/tools/checker.pp,tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/grub/manifests/defaults.pp,create a new grub module		this provides an almost dummy (but reusable) grub class, a	grub::defaults class that is used to remove quiet and splash from the	default (ubuntu) config. much more importantly, for newer systems it	provides a grub::bootparam define that can be used to set kernel	parameters from all over the tree, instead of relying on hacky	base::grub parameters.		change-id: if03604a07be59ac2be30ec14b1a532c2f16fabc7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/manifests/xmlconfig.pp,modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/swift/manifests/params.pp,rename swift_new to swift		can be reproduced with:	  git mv modules/swift{_new,}	  git mv hieradata/common/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}.yaml	  git mv hieradata/codfw/swift{_new,}	  git mv hieradata/codfw/swift{_new,}.yaml	  git mv hieradata/esams/swift{_new,}	  git mv hieradata/esams/swift{_new,}.yaml	  git grep -l swift_new | xargs sed -i 's/swift_new/swift/g'		change-id: i22102da8b14a31719927355ff3efbe19717fcfae	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/locales/manifests/init.pp,locales: add locales::all, debian support, purge		add a locales::all support for future use. add --purge to locale-gen's	exec as to purge non-configured locales, useful for system upgrades and	such. finally, add support for debian, which is a tiny bit different	than ubuntu.		change-id: i2cf856ff980848ebf01e179d1fe0ce6a4350657b	|split off module locales out of the generic module		"generic" isn't really a great module. split off locales out of it into	a separate module and replace generic::locales::international with it.		change-id: ie7cafb0bdf6eced01af5cedf35573190c401f053	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/tools/common.pp,tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/motd/manifests/defaults.pp,motd: add motd::defaults class		this provides defaults motd scripts, a generic but cleaned up (no help	text) mixture of what debian/ubuntu usually ship in their motd. this is	needed as the motd module recursively manages the update-motd.d	directory.		as this is just a simple header and footer, include this from the main	motd class as it should be harmless enough for all callers.		change-id: ib5b5e520b73588af4ef83acbe5b7f3ec62d52851	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/git/manifests/clone.pp,git::clone: rename $default_source to $source and add github		change-id: i6c723973e220e46b87595013f6551ecf3e2887ff	|scap: correct clone directives		also correct the erroneous documentation of git::clone		change-id: ie6705ea3b4f0c36675bbb67acb916c54b7ce7623	|support easy cloning of git repositories from phabricator		introduce a new $default_source parameter that can be set	to 'phabricator' so you don't have to rewrite the full phab	diffusion url each time in $origin		will also allow for easier gradual migration and an (eventual)	future in which phabricator repos are the default.		change-id: i166a5b77562742a5987c8e72aa27adb14b4b7f07	|replace package['git-core'] with package['git']		the package has been renamed upstream. the last wikimedia release that	did not have the package renamed was lucid and now that is gone so we	can proceed with the rename.		change-id: if812909df17eacc24f1e9bb67d93e5903b32b80d	|git: lint fixes		fixes more puppet-lint warnings	for t93645		change-id: i16455ec8192b0d18b7dcc94d09407974670ec8f5	|fix git::clone umask issues t87843		change-id: ifb3935d6ac310114d724ac6366255e583785c6f8	|remove git::clone support for converting clones to shared		the back story on this feature is that ori and i were trying to get	puppet to manage a clone of mediawiki/tools/scap that had initially been	cloned as root only and needed to be updateable by a non-root (me). scap	has since be changed to deploy via trebuchet so i think at this point	the labs_vagrant role is the only user of the shared clone logic.		the puppet code that attempted to convert an existing clone from	non-shared to shared was prone to causing puppet log spam and	potentially changing the permissions on files that were not part of the	actual git repository.		change-id: i86883ec708b104c8d5d267672b4c1a24453ea21b	|labs-vagrant: fix initial clone and ownership		followup to i3eea91a5933af31457a3ac24624e0fda82d61849. fix an ordering	issue in git::clone where the file resources for the target directory	was applied in the wrong order for creating clones in root owned	directories. also change the applied permissions to have the	mediawiki-vagrant clone owned by vagrant:wikidev instead of	vagrant:www-data. add a file resource to change the permissions on	the log output directory to allow www-data to write there.		change-id: i194d788d1254c1e05ea53937b4663faaed537b62	|git::clone: set core.sharedrepository=group for shared repos		fixes an omission of iace8ded93.		change-id: i4f61a922dad05457e78a2e783354f9b44cf463a8	|git::clone: correct onlyif checks		the exit status of 'find' is 0 if no problems were encountered executing the	search. the number of results have no bearing on it. '-print -quit' (both gnu	extensions) will cause find to print the first match and terminate the search;	grep '' checks if there was a match at all.		change-id: if6efa9bc17e2a78744cb2ad9a3c42fb962348834	|git::clone: correct group bit for shared repositories		follows iace8ded93.		change-id: i10b658b1777108ade3771b9343dc15742aaaf359	|set core.sharedrepository to 'group' for shared clones		change-id: iace8ded93ed57d8ac0644c24c079c98a4e2d8fa7	|fix typo from i96287df09		use double quotes when interpolating '${git}'.		change-id: icf6e7fc8848e9c9297feaf0b28a254ea4d21ac10	|git::clone: include umask as part of command		since umask param unsupported by puppet 2.7.		change-id: i96287df0900f7e3b6b858c675124cca3fd773b30	|git::clone: support shared repositories		git supports sharing repositories by users of the same group. it works well	enough if you set up the repository's directory with all the right permission	bits and and clone the repository with the right command-line incantations. but	if you don't, it becomes nightmarishly hard to make an existing repository	shared.		part of the verbosity of this particular patch is that i wanted to ensure each	exec had an onlyif / unless check so that it doesn't pollute the log when it's	not actually doing anything.		also got rid of now-dead 'notify-submodule-exec'.		change-id: i4c282b0ad14b3493026dead4e3b15f2749d5d22e	|adding submodule update support to git::clone		change-id: ib04883c3c71ae45d1e3fe20c102404053eef676b	|updating git::clone so that gerrit urls can be assumed by default		e.g. git::clone { 'analytics/wikimetrics': directory => '/srv/wikimetrics' }		this will clone analytics/wikimetrics from gerrit.		this is also for compatibility with the mediawiki-vagrant git::clone define,	so that submodules shared between mediawiki-vagrant and operations/puppet	and that use git::clone will work in both.		change-id: id76ff8bd9896d188d0a2c65d19e9d456be01d22f	|simplify our attempt to fix repo dir permissions.		otto obfuscated the file resource name on my suggestions, but it	turns out to do the opposite of what i'd hoped.  now puppet fails	to observe the if (!defined) bit, but still registers a conflict	when it comes to to actually create the dir.		this way at least we can rely on the if (!defined) bit.		change-id: i2e0815b305023816c8849d7232623eccbc633f19	|fixing git::clone so that it respects permissions on directory		change-id: i42bc5bf3068af44ad90cc863581dc18659d9a678	|moved git::clone into a new, skeletal 'git' module.		change-id: i3f849f4f77384f2b9e15d18f6b33a7d5806e3a38	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/mysqlpath.pp,mysql_wmf - autoload layout and lint fixes		move classes into autoload layout	fix lint warnings		change-id: ie7510e8c90e365f43ce621c3f524aa1e87e2c584	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/maintenance/refreshlinks/cronjob.pp,mediawiki/refreshlinks: move cronjob define out of class		change-id: i20ea82268689dffb6d4bc608cb79f189e1f452db	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/visualdiff/manifests/server.pp,fix whitespace-related lint issues		fix a lot of lint warnigns due to incorrectly aligned arrows.		change-id: ib062d7142a79a8cb6bb3abd86fd7499aa3edad03	|add the visualdiff module + instantiate visualdiffing services		* the visualdiff module provides:	- diffserver: a standalone webapp for one-off visualdiffing	  not very useful and is not instantiated in this patch.	- parsoid-vd and parsoid-vd-client: testreduce-based server	  and client for comparing parsoid html output with php parser	  output.		* several minor non-functional tweaks to testreduce puppet code.		* replaced upstart config files with systemd native config files.		bug: t118778	change-id: iae0a9515ff43d81185ee11c103deb20002f8516a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/config/file.pp,add defines for working with mysql config files, and mysql client settings		change-id: i81cf2238346455f229a5cdb79ea93371fdcce2af	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/wdqs/manifests/gui.pp,wdqs: indentation of => is not properly..		change-id: i5d814ec1ed1253247e8f35149fb8e1c2a5a1a715	|wdqs: move the ferm rules into the role		change-id: idc82c587b4ea3f3d763c832a2c8688728e6540d0	|t105080: add maintenance mode configs for nginx		change-id: i922b542ddacfd7a253092c86805322d3b8cb7250	|add definitions for wdqs service		task: t95679, t103904	change-id: ie60e8962304c878a122d042f1d973e7b31ae4470	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/website/labs.pp,contint: proxy the colocated gerrit instance		listening on port 8082 and on the host integration.wmflabs.org.		change-id: ib9f31a330c193b807bfb119469b1bdd3155249e9	|contint: website config on labs		for development purposes, i need the jenkins/zuul apache proxy	configuration to be set on integration.wmflabs.org.  that uses to be	some live hacks on the instance, but our apache class now manage the	configuration directory which removes them.		change-id: i0e16e5a83dde4e1fffc2b314262268ea15fa5fc6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/pybal/manifests/confd.pp,pybal: fix lint, indentation		change-id: iddbc5bc9e15efdfad71f83ac99b00084c4da4464	|pybal: remove most confd-related references		change-id: i89699eb58bba69fda5428cbec218a4ba19ce8544	|setup a node pool file from etcd for lvs cluster		with a conftool cluster and service definition	included in the lvs::configuration cluster hash	we setup a confd toml and template to allow	external definition of nodes in the pool.  the	config line change to actually use this etcd	sourced config is commented out as this will	rollout slowly.		example of confd files created for 'text':		/etc/confd/	├── conf.d	│   └── _etc_pybal_pools_text.toml	└── templates	    └── _etc_pybal_pools_text.tmpl		example toml file:		[template]	src = "_etc_pybal_pools_text.tmpl"	dest = "/etc/pybal/pools/text"	mode = "0444"	keys = [	        "/conftool/v1/pools/eqiad/cache_text/varnish-fe/",	    ]	check_cmd = "/usr/local/bin/pybal-eval-check {{.src}}"		this change assumes each lvs service has a conftool service	and cluster reference.		change-id: i6c0179738bc3dab0170a5ccba20f53cd42a06b79	|pybal additions for confd		* a golang template for generating external	  node pool definition files that are already	  accepted by pybal		* a brief script to validate the definition file		change-id: i634bbf70bea2865bdf3e012c5f7c8b4a75450a46	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/facilities/manifests/monitor_pdu_3phase.pp,facilities: move to module		after the dc-cam class has been removed	facilities.pp is just pdu monitoring		first attempt was ib06d7943e315c0 to move this	to nagios_common module, but per comments from yuvi,	abandoned that and now creating a new module	'facilities' instead and moving it there		change-id: ia41e114465b61eb9d6d6402a58131a4598f7eab2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/planet/manifests/docroot.pp,turn planet into a module		there has been an older attempt to do this	that had to be reverted due to a bug causing	puppet issues		so this is along the lines of	https://gerrit.wikimedia.org/r/#/c/54502/3	https://gerrit.wikimedia.org/r/#/c/58495/ etc,		but entirely new and _doesn't_ do things like dropping	the role class, putting config into module etc.		change-id: i980f9dc9f48e80d53dd2c920622ae67672d575df	|revert "make the planet logo a "per language" thing"		this reverts commit f2264e7a97f26b6b2d6548e9d730e01ce42baebe.		revert "resource references should now be capitalized"		this reverts commit 54d5baca9de9ea519c216ceb08030eb93cffc674.		revert "remove duplicate definition of locales package"		this reverts commit ebd76e02e4d7322a57a605b33afde16e4bf93a72.		revert "turn planet into a puppet module"		this reverts commit ec09aaefb8b9f7eafc82aaca5dff7e940c243f4e.		change-id: i093cfc85d1ca8550c19a246ae9ed8fb0e91149e3	|turn planet into a puppet module		- move all files, templates, into module subdirs	- add readme.md and turn role file into init.pp	- quoting and arrow alignment	- 2-space softtabs, etc. per puppet style guide		change-id: i9d0fda3f27715282068e760d2f01c2fc298314b7		rename planet class, per docs init.pp must exist and contain	a class matching the module name		change-id: i19034d090692387ca7e9d7f2d87fe4f9e13793e7		move defined resource types into separate files, one definition	per file inside a module as recommended by puppet docs		change-id: i91fc1ccad73b5498441de39a3e150e65e017df1b		move package install to own class and file,	move generic::locales out of init.pp		change-id: i63217308b7d3c6469ba3c30bc4a183e62f8b2b77		move webserver setup for planet out of init.pp		change-id: i00dde9965afe86b58ba609810bcaa6b588ac17af		move locales install and generation into own file,	step 1 to making module self contained instead	of declaring stuff from generic-definitions.pp		change-id: i239fa19a8bd40eadeb7a6aea3ab9feddb480610c		move needed planet directories to own class		change-id: i153848976801f3bd378f83dcfab0d70a4984fd66		move user/theme/apache_sites out of venus.pp, move index_site	setup to own file, move webserver setup out of init.pp		change-id: i9769542394ff96a46e0cf46e8269f9fbe9cc8e92		move language prefixes and translations to own class/file languages.	use a qualified variable to access it		change-id: i88a12546e4ed42b5d6ced9a4d68bf22fff64c486		various fixes to make puppet-lint like it,	like wrong quoting, unaligned arrows, variables without explicit scope,	lines longer than 80 chars, and more		change-id: i260c28ab1028f8d11e6e155540a708a45f63745f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/tests/labs.pp,modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/grafana/manifests/dashboard.pp,grafana::dashboard, $ensure first, present by default		change-id: ia85f566c2419c69575f938c04771d15a71f73bec	|grafana: fix top-scope var without namespace		add $ensure to resource parameters.		./modules/grafana/manifests/dashboard.pp	warning: top-scope variable being used without an explicit namespace on line 42		change-id: i0eb977bfa4ef1110128b59edefe5545ab14bd2b6	|grafana: provide the ability to provision dashboards via puppet		grafana dashboards are stored either in grafana's database, or as json files	in a specially-configured folder that grafana watches. this patch adds a puppet	resource representing a json file dashboard definition.		change-id: ia558d44249db98cedf9d2187709c0de6e8ed595a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/zuul/manifests/user.pp,zuul: introduce 'zuul' system user		will let us slowly migrate zuul server and merger daemons to run as zuul	users instead of jenkins. the real change is done in a future commit.		change-id: i0113f4282a27355eb01b7550667a072d4f32825f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/packages/analytics.pp,contint: remove packages from prod slave		contint::packages was historically for the production slaves. today we	only have gallium (replaced by contint1001) and it barely run any jobs.		move most packages from contint::packages to contint::packages::labs so	we get less mess installed on the production slave.		keep:		- doxygen / graphviz that is build directly on the host hosting	  doc.wikimedia.org due (it takes hours on labs).	- python-requests for the python script that auto update visualeditor in	  gerrit.		migrate analytics related packages to contint::packages::analytics		maven to contint::packages::java. also make sure openjdk-7-jdk is	required from there.		mediawiki::packages is now solely on labs. that brings a lot of packages	which are not needed on the prod slave / zuul / jenkins server.		move the rest of misc packages directly in contint::packages::labs.		change-id: i8d70b7857faab38ee5f565f771228f8b4f8d3773	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ci/slave.pp,role::contint::*: try to resolve circular dependencies correctly		change-id: ie0ea276575272af94d395b8a59fa7b42e93f5982	|role::ci::slave: require /srv/ssd as a file, not mountpoint		change-id: i6184de472c31301d1bcbbaf7661cf1ed6918b39d	|contint: move npmtravis out of prod slave		the npmtravis has been setup on role::ci::slave which is only meant to	be used on the production slave gallium.  we no more run jobs on that	production slave and have transitioned to use labs instance.		nothing seems to be using npmtravis right now, keep the bits though and	move them to a standalone class contint::npmtravis in case it get used	again.		bug: t114421	change-id: ief2dd9ca76afdd4da721f071c4df9afd0ad068ab	|contint: clean up role::ci::slave		the role::ci::slave is used on the production ci slave gallium. most of	the jobs have been migrated out of that machine in favor of using labs	instance.		remove:	* maven settings, has been ensure absent for a while.	* integration/* repos via trebuchet	* contint::worker_localhost	* tmpfs		have contint::website (used on gallium) to enable the apache rewrite	module.		update role::ci::slave class comment to indicate that class is solely	for gallium and hint about role::ci::labs::slave.		change-id: ide33a166faeba58be9c5ac46f351cfa6ddc945ab	|contint: increase tmpfs size to 384m (+128m)		there have been recent issues related to a full tmpfs and package	installation/compilation. this issue will be moot once we're fully moved	over to nodepool instances that make use of the package caching, but	let's increase the tmpfs size for now to accommodate jobs still running	on older instances.		change-id: idc3c7a2ff0daec351d4269f425d811f1e06a30a3	|ci: split and move role classes to modules/role/		split the large file into one file per class for	readability and per style guide and lint.		move them into ./modules/role/ and into the proper	autoload layout without renaming any classes or	changing content.		change-id: i3d514e64b56dcba5486ffbd2f22eb95d8326e1c9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/coredb_mysql/manifests/snapshot.pp,coredb_mysql: lint		no changes to behavior; only presentational changes in this commit.	 - spaces rather than tabs.	 - align arrows.	 - don't align equal sign, except in function signature	 - single quotes when not interpolating.	 - single resource per block.	 - quote strings.	 - quote octal permissions.	 - 'ensure' always first property.	 - use ensure => link w/ target rather than implicit symlinks.	 - every property ends with a comma	 - one class per include.	 - resource name and resource type on same line.	 - [ space ] in arrays	 - '&>/dev/null' instead of '>/dev/null 2>&1'		change-id: i419f48c9713e5c59deac093ac86142d4d938a25c	|renaming coredb module to coredb_mysql to avoid module/role class namespace fuckery		change-id: i1c8ab607514c63be7a9ab36ac337ae20918cfa6f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ipmi/mgmt.pp,ipmi: move role to module structure		change-id: ic5fecbbe5fd8f1d45d6a23b47e5c246e548233e3	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/zuul/manifests/monitoring/merger.pp,zuul: tweak git-daemon monitoring		on the zuul-merger instances, a monitoring probe ensure the git-daemon	process is present and raise a critical error if there is more than one.		to serve material, git-daemon spawns child process that causes the probe	to alarm:		critical: 2 processes with regex args ^/usr/lib/git-core/git-daemon		/etc/init.d/git-daemon on precise guarantee the first arg is '--user'.	add it to the monitoring regex to discard subprocess having '--serve'.		change-id: if2c7242bf17af77aa1a380a8c94006492e094067	|zuul: monitor git-daemon on zuul mergers		we expose the zuul merger repositories via a git-daemon. add an icinga	probe to make sure they are running.		impacts:	 gallium.wikimedia.org	 scandium.eqiad.wmnet		bug: t118856	change-id: i65fa6c03e5ea62276872c574521f27cf491c246c	|zuul: update monitoring regex check		0889192 switched zuul install to be provided by a debian package. the	merger and server process are now in /usr/bin and are invoked using	python from the zuul venv /usr/share/python/zuul/bin/python.		change-id: ia4d5667df870b7b60ef48c5dba412bd196ada5e5	|zuul: monitor zuul merger via nrpe		zuul has split the scheduler and merger operations in two daemon. the	new one (zuul-merger) remained unmonitored which is unfortunate.		we will have nodes having only a merger daemon, so create a new class	zuul::monitoring::merger		i verified the command manually on gallium which has a merger running:		gallium:~$ /usr/lib/nagios/plugins/check_procs -w 1:1 -c 1:1 \	--ereg-argument-array '^/usr/bin/python /usr/local/bin/zuul-merger'	procs ok: 1 process with regex args '^/usr/bin/python	/usr/local/bin/zuul-merger'	gallium:~$		the inclusion is still done in zuulwikimedia for sake of clarity. will	be moved around later on.		change-id: i493494e0a545496bd4036ba350a9e748ea535f9d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/zotero/tests/zotero.pp,puppet module for the zotero service		* add a puppet module for the zotero service.	* cleanup the citoid module as well since part of the zotero module	comes from it.	* zotero uses xulrunner to execute as an xpcshell javascript module	that then does xpcom calls to the zotero firefox extension that	should be deployed.	* deployment system is trebuchet.	* amend the role class to have firewall rules and monitoring as well as	include the zotero module class	* supply tests	* use trebuchet to deploy zotero deploy code and translators	* supports outgoing proxy	* translators dir is implied due to using trebuchet	* readme file		bug: t89867		change-id: i1a29116f7b0f62109994a501d8715c3dc7ac4624	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/openstack/manifests/nova/volume.pp,openstack: add links to docs for components, lint		adds comments with links to docs or info about	the various components of openstack.		by doing that fixes a bunch of	"class not documented in line 1" lint warnings.		also fixes a few other lint warnings such as aligned arrows	or "ensure" being first.		change-id: i592677d0f089f59bf72b1dbd2bd31f97f5932ac7	|openstack: lint fixes		"double quoted string containing no variables"	"indentation of => is not properly aligned"		and misc.		fixes more puppet-lint warnings	for t93645		change-id: iee2fd2441936f1c782534f66e86b9ec5655ddead	|move the openstack_version setting to hiera.		this used to be a node var, inconsistently handled.		change-id: i89378aaef4bbb6ba5a741a8638ca9ebc5fa87270	|openstack: folsom -> havana as default version		folsom is eol and we don't use it anywhere afaict	setting default to 'havana' instead		https://wiki.openstack.org/wiki/releases		change-id: i837187027eaa48ec52172ecc45dcf0465dea77a5	|file nova services in a 'nova' subdir and namespace.		change-id: i5d207390a7228fd1a3dfc132ae9c3e4eeb8072e8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/aptly/client.pp,aptly: move role to modules		rename role::aptly to role::aptly::server to avoid having a lonely	manifest under modules/role/manifests/		update the sole use in role::labs::tools::services		change-id: i67b40a9582239b52d6ee969898c7cbc99753cbfc	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/standard/manifests/mail/sender.pp,role::mail::sender: move to standard		this is not a role and should really be part of the "standard" module.		change-id: iabdf6bb29299d757e1a0c6b81c2490d206ac6430	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/vm/manifests/min_free_kbytes.pp,min_free_kbytes should always be an integer		change-id: i8bd1e13884c220e86f3ad0f1402a12a041d9ec87	|switch min_free_kbytes to $::memorysize_mb		change-id: iea8693a9d2b6f4402fcec913d0de298a8ec6fa7f	|vm: lint		change-id: i88768cece86ee450d1a32bc8b6b59b7a6c2e96d9	|bump vm.min_free_kbytes on lvs/cache nodes		also, introduces new module "vm" and vm::min_free_kbytes() to	set a somewhat-dynamic value based on memory size that's safe	and reasonable, and moves old generic::higher_min_free_kbytes	to vm::higher_min_free_kbytes as well (without change).		change-id: i4682a08d967f873bd069aaf0c17ad2b02a0d4d78	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/phabricator/manifests/monitoring.pp,phabricator: only send sms for issues on active server		add to hiera which server is the current active server.		change the contact groups based on the hostname being	the active server or not.		if group "sms" is used, that means paging.		this way we will not get paged for the inactive server	and if we switch it's in this one place in hiera, not	in .pp files.		change-id: i3c9a3bda0e6f2b3b20b7049c18c450ad4722a754	|phab: basic apache status metrics to graphite		change-id: i276290788e8923469d73a456509dd77887a56fcd	|phab: mod_status for monitoring		change-id: iec3f3c71b3bf1f2287df7e86dbe97af21d8a6b38	|phab: update phd monitoring		per upstream: "it's normal for the taskmasters	to restart when there's an exception so it can	show up as a failure when it's really	working as intended"		thus we are adjusting how we track procs		change-id: id6435deec2dd70aefd5f130715da3941285d0dfd	|phabricator: lint fixes		"indentation of => is not properly aligned"	"variable not enclosed in {}"	"double quoted string containing no variables"		fixes more puppet-lint warnings	for t93645		change-id: i0f3197f45ce76761e5fa2f141d00ea414137a15a	|phabricator: adjust monitoring of taskmasterdaemon		after the recent phabricator upgrade the number of taskmasterdaemon processes	running is way lower. with our previous minium of 10 processes we	kept getting icinga alarms now. it's more like "around 3" now when i checked.		change-id: i5e55d2649ec38be2f8c15d65abcf839cf3424f0b	|adding phabricator paging group		i added in a phabricator paging contact group in previous changes, which	now will page mukunda and chad with phabricator issues, as well as echo	in irc and page ops.		t96613		change-id: ie698fa7f6c685ecbad6a74a0110a3c1bfd8303ec	|phab better header docs for manifests files		change-id: i80df07e58b1f72158ba9f3577aca1b75bba5d003	|nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|phab: move defines into autoload layout		defines should also be in their own files	like classes are		error: phabricator::extension not in autoload module layout	error: phabricator::redirector not in autoload module layout		http://puppet-lint.com/checks/autoloader_layout/		also fixes some lint warnins about aligned errors		change-id: i4745cc5e02ef8bbb270fae22f50f690206d743ff	|add check for https://phabricator.wikimedia.org		adds a custom check to monitor phab behind misc-web	using check_http with -s gives us certificate monitoring as	well. we ask misc-web-lb for a specific url and we also	check for string "wikimedia and mediawiki" in there to make	sure we are not getting just a 200 with some other content		t957		change-id: ie790fd2e3b607e927260288c1c1adfaf95be0fee	|phab: add monitoring class, monitor taskmaster		add a monitoring class and include it		add process monitoring of phabricatortaskmasterdaemon		currently we have around 20 processes running that match this		setting it to warn/crit under 10 and over 30		also, want me to additionally monitor processes matching these?		"phabricatorgarbagecollectordaemon"	"phabricatorrepositorypulllocaldaemon"		t957		change-id: ibde3f548c7de34c038346ed62abf213b5d9384c2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/arcanist.pp,fix path to jenkins homedir for nodepool slaves		the .arcrc needs to be in the jenkins user's home directory on the	slave.  on the jenkins master it's /var/lib/jenkins but on the	slaves it's /home/jenkins		change-id: i7321efae42be5ed37ceb7225bef29a5be992d7ee	|install arcanist from apt rather than git.		change-id: icba0354d30ece9ae66e53518f3b2577d082c5729	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/mediawiki/appserver/canary_api.pp,mediawiki: split role classes, move to modules		instead of stuffing all roles into a single file,	use the correct structure for autoload layout and use	one file per class as per style guide.		move the classes to modules/role/ structure		change-id: if7626dba62cc14ff62a12cc1df7af49a61211429	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/prometheus/blackbox_exporter.pp,prometheus: add blackbox exporter role/class		https://wikitech.wikimedia.org/wiki/prometheus/black_box_exporter	explains how to build the deb. deb is currently available only	in the tools project		change-id: i9050ff361ecf4dcc432bab2c0b5cb3627c6bfbff	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/coredb_mysql/manifests/slow_digest.pp,use m1-master cname		change-id: i9bfe74f8bd283059dafcac4fd867281fe580f951	|remove bash-ism from cron job command		change-id: i45ed975823345df5cff6fa4eb1e5d92056c75786	|coredb_mysql: convert a few additional leftover tabs to spaces		follows i419f48c97. i missed a few spots.		change-id: i7183fa78ee2f1eb41cc69e987d7a853e35583732	|coredb_mysql: lint		no changes to behavior; only presentational changes in this commit.	 - spaces rather than tabs.	 - align arrows.	 - don't align equal sign, except in function signature	 - single quotes when not interpolating.	 - single resource per block.	 - quote strings.	 - quote octal permissions.	 - 'ensure' always first property.	 - use ensure => link w/ target rather than implicit symlinks.	 - every property ends with a comma	 - one class per include.	 - resource name and resource type on same line.	 - [ space ] in arrays	 - '&>/dev/null' instead of '>/dev/null 2>&1'		change-id: i419f48c9713e5c59deac093ac86142d4d938a25c	|moving mysql query digest collection (for ishmael) from db9 to db1001		change-id: i477426dfec7e308b958574a4491d462e5a437c04	|renaming coredb module to coredb_mysql to avoid module/role class namespace fuckery		change-id: i1c8ab607514c63be7a9ab36ac337ae20918cfa6f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/puppetmaster/common.pp,puppetmaster: allow using puppetdb as a backend for storeconfigs		also, refactor a few non-dry thing from the frontend and backend roles.		change-id: i47fae084d1536372c1f9dc50b689c131d590c9ba	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppet/tests/gitclone.pp,modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/cpufrequtils/manifests/init.pp,cpufrequtils: ensure configure governor is in use		* ensure the configured cpufreq governor is in effect, rather than rely on	  puppet event notification / boot-time setting.	* add documentation.	* use 'require_package' as a shorthand for making the package a requirement for	  all the class's resources.	* rename 'apply cpufrequtils' to 'set_cpufreq_governor', which is more	  informative and does not contain whitespace.		change-id: i0a775fb9fb4a03142dc60946eb3ae0b5e6af606c	|cpufrequtils: move ubuntu stupidity under if guard		change-id: i24ce0a31221418c90d71337265b1d6468637ca01	|disable ondemand service w/ cpufrequtils		change-id: i600da3744a64db0d169619382b7cc48a17e9e251	|cpufrequtils: lint clean		change-id: ibb87b35e6ad5ce49ce5d3146aee3229c14486faf	|cpufrequtils shouldn't be treated as a service, except to start at boot		change-id: iad5c63ed5ad6cde5f3299a7768d0c31df64abd99	|lack of status from init.d/cpufrequitls breaks file change -> service refresh		change-id: i7c5c39cb15b5a1fdfb0da056f673abc720779387	|module sets cpu frequency governor via cpufrequtils		change-id: i0cef4548931e007321f1486f5fa6344d7ddc2c0f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/coredb/ganglia.pp,ganglia: drop the "gmond" service alias		now that gmond is ganglia-monitor everywhere, drop the alias => gmond	from both ganglia and ganglia_new and adjust all call sites to notify	service['ganglia-monitor'] instead of service['gmond'].		change-id: if5dff9bd3f2032998a4712cb6d11a8e061874fe7	|mysql_wmf : lint cleanup		change-id: ie1062ceb9357e6a7502272c213e4324d49061217	|specify group & permissions for a couple of files.		for some reason these changed when these files were modularized.  safest	to be explicit.		change-id: id00a37206e18514610288c4c6812ced952e1b82b	|move mysql_wmf into a module.		the manifest changes here are pretty brainless -- i split the major	classes into separate files and rearranged the file and template	includes to reflect the new position of the source files.		i also moved quite a few files that were filed under ganglia	or icinga but only used by these classes -- now they live in the	mysql_wmf module instead.		change-id: i31b8d8562f8eda4a6fde4a6110d83a339fc38b94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/manifests/role/ircyall.pp,ircyall: introduce module for web2irc relay		change-id: i54b9e730d2e12d310c1b1162417d33d8b00284a9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dataset/manifests/html.pp,moving /analytics to /other/analytics		change-id: i4370550e1df4bf87d33af8cd45251900aba7d40f	|re-organize analytics dumps to their own page		notes:	    * the new unique devices dataset will start without a landing page	    * we won't move and symlink the old datasets because automated tools	      are likely to be accessing them where they are		bug: t115344		change-id: id4b93e5eb161407bd27f05faee8f1964a996ddbc	|puppet-lint: fix all 2sp_soft_tabs errors		these are the (only) errors that keep us from re-enabling 2sp_soft_tabs lint check.	this should allow us to enable that rule in ifc2dc02bdd02aff0055bb9 .		change-id: iac0f24d8eeb3d45da4ba1924cc75e4aca5c452b2	|puppet-lint: fix all 2sp_soft_tabs errors		these are the (only) errors that keep us from re-enabling 2sp_soft_tabs lint check.	this should make jenkins like ifc2dc02bdd02aff0055bb9 again.		change-id: i9c5d93fd6b5f22f6b17d3f45c1019adaa71e7975	|datasets: fix typo in html directory name		change-id: iab0a96dae1026355c7794164924603d54bc6a545	|datasets: add and update legal notice		change-id: ia0f13147dd060e18d9923d75916151de7d152189	|datasets: fix the other directory name, sheesh.		change-id: ib63c55fbdff90ab0bf350b2fef561f18459c0daa	|datasets: add the dirs vars manifest, never got committed, woops		also make name of that class consistent with the rest	change-id: ia19fc12036ee3a28f9f00aac56d3a9e3dee37bc7	|datasets: fix up html index files manifest		change-id: i428e01e9779f747514c75f096e574574f9553ade	|add index.html pages for various directories on dataset hosts		ps4: use //bits.wikimedia.org/skins/monobook/headbg.jpg	     instead of http://en.wikipedia.org/skins-1.5/monobook/headbg.jpg	     which is 404 nowdays, and make it proto-relative		change-id: ib4c5ad783bf503cec3de7fee53fd502ee590a24f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mongodb/manifests/decommission.pp,re-write of mongodb module		the mongodb module that we currently deploy came from puppetlabs and it sucks.	it had a gemfile, travisfile, modulefile, rakefile, specs, tests (which fail),	support for rhel and 10gen's custom apt repository -- none of which we want or	need. what we did need was for this module to manage the package and the	service, and it did so incorrectly: mongod was configured to fork by default	whereas the upstart configuration file was set to not expect forking (see	icf2113e84).		this patch drops the module in favor of a custom rewrite that is small and	functional. i also added a 'mongodb::decommission' class for decomming. it	completes an item in [[wikitech:puppet todo]].		change-id: i4da51efd4f71ccf7c14726d199ac8d43fc0b275f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/motd/manifests/script.pp,motd: misc fixes		- don't ignore priority 9* files. usage out there doesn't indicate that	  there is a special meaning of local vs. system priorities. for example	  update-notifier-common used to ship both 20-cpu-checker and	  98-reboot-required.		- don't call runparts after shipping update-motd.d scripts. pam_motd	  does this on every login so there's really no reason to unnecessarily	  spend time doing this in puppet.		- fix the example usage to include #!/bin/sh		change-id: id79b22334c617b6f35a84deef3d327bf69fb21b4	|motd - update-motd.d file must be executable		the files created by this in /etc/update-motd.d must	be executable scripts for this to work.		per default it will create them as 0644 and run-parts	will not execute it, so the output won't end up in /run/motd		change-id: i3e3a6f7408bd8ced944aaea50d274bada0aa7d40	|add 'motd' module from mediawiki-vagrant		i noticed coren doing some motd stuff in ib75c18f75, which reminded me that we	have a handy module for this in mediawiki-vagrant that has been working well.		change-id: i2a8708c4f7940bb8c1e7c6f9d5d330cc8279fa21	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/swift/manifests/ring.pp,swift: ignore warning: puppet:// url without modules/ found		fixes file ring.pp		change-id: idbf94ae8da931829e1f4362bd860140ae9c8e55e	|rename swift_new to swift		can be reproduced with:	  git mv modules/swift{_new,}	  git mv hieradata/common/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}.yaml	  git mv hieradata/codfw/swift{_new,}	  git mv hieradata/codfw/swift{_new,}.yaml	  git mv hieradata/esams/swift{_new,}	  git mv hieradata/esams/swift{_new,}.yaml	  git grep -l swift_new | xargs sed -i 's/swift_new/swift/g'		change-id: i22102da8b14a31719927355ff3efbe19717fcfae	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/stdlib/tests/has_ip_network.pp,update stdlib to latest supported release from puppetlabs		this patch updates the stdlib module to v3.2.1.	3.2.1 is compatible with puppet >=2.7.20. there are no breaking changes.		change-id: i570046371713b05c1ed99c771da2d405f782b191	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/parsoid/rt_server.pp,role: align arrows in manifests		change-id: i7f2777652de46349e175ab0e8c68a5a840e866d6	|parsoid: move rt/vd roles into role module		after having moved the other parsoid roles into the role	module and autoloader layout, also move the rt/vd client/server	role classes over here and rename them to parsoid::foo.		change-id: i8e121364056de4da4f4125e03e5902dff8a5371a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/exim4/manifests/init.pp,revert "exim: temp hack to stop exim when on fermium"		this reverts commit aaf8c189dc101939196ba8c42ecfbf66b1252c07.		change-id: i53f353b1d524f31263ea7bb089adc25bd54573a7	|exim: temp hack to stop exim when on fermium		add an ugly but temp. hack to ensure exim is not running	when on fermium but leave it unchanged on all other hosts (sodium).		this is to be able to apply the puppet role and test it for the migration	without having exim send out any emails.		bug:t109925	change-id: i1e336990d6e836c8b3a4c5da3530eabfebbf57f5	|exim: set o+x to /var/spool/exim4		we set /var/spool/exim4/{db,scan} to 1777, but /var/spool/exim4	permissions are too stringent and don't allow anything below to be	accessed.		change-id: id3c1b778f288a15cbb5ad0bc33443b4ffa95986c	|exim4: revert files' permission to previous state		stop being so aggressive with our all-users permissions and minimize the	risk by reducing the diff with what's currently on the system. also, set	spool directories to 1777 as exim expects them to and remove a spurious	notify.		change-id: i205bac5af660118096ec47116d9a08ad3243c89b	|introduce a new minimal exim4 module		introduce a new exim4 module that handles a very basic exim4	configuration. the module is not attempting to do anything smart with	the config files (yet) and just accepts a config argument for passing	the template.		also move convert half of mail.pp to use the new module; most of the old	exim::* classes, including exim::roled, persist but use the exim4	hierarchy for most of their implementation.		change-id: i076a849434594efb20da95badc2f31d0bfcb86d4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/toollabs/manifests/queue/continuous.pp,tool labs: final(?) fixes to gridengine iii		- add dedicated node queue config	- expand templates at the last minute so that $title is	  correct (and all variables are otherwise available)		change-id: i5bcc9d0cfbf9fc3962decd8a1b885cdde7c21398	|labs: puppetize gridengine		much of this will need tweaking and hacking; gridengine is /not/	amenable to simple puppetization because most of its configuration	lives in a bdb.		most actualy configuration bits are nooped with 'echo' at this	time while testing takes place.		change-id: i7856b65ebead6aae04777c4851ef3c7771b239f5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sslcert/manifests/ocsp/conf.pp,move tlsproxy's ocsp stapler/updater to sslcert		now that the tlsproxy's ocsp stapler/updater has been made more generic,	create the necessary abstractions within the sslcert module,	sslcert::ocsp::conf and sslcert::ocsp::hook, and move the vast majority	of the contents there. this makes it useful to other modules as well and	factors out functionality that doesn't fit the tlsproxy module all that	well.		change-id: i0a050585cb5f61fae8411f8db93228e9b81078cd	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/quarry/database.pp,quarry: move role classes to module role		change-id: idd7f078180d8d743de5f8602647b199421476ec0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/statistics/manifests/wikistats.pp,first commit in a multi-commit effort to move misc/statistics.pp into modules/		t87450		change-id: i49140d85ddea99f5d4d9a3c71e60cf7fa57d49b6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/mediawiki/canary_appserver.pp,mediawiki: split role classes, move to modules		instead of stuffing all roles into a single file,	use the correct structure for autoload layout and use	one file per class as per style guide.		move the classes to modules/role/ structure		change-id: if7626dba62cc14ff62a12cc1df7af49a61211429	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/motd/manifests/init.pp,motd: manage /etc/motd, support debian		the history around /var/run/motd, /run/motd.dynamic, /etc/motd &	/etc/motd.tail is messy and the current status quo in debian proper an	even worse mess. i followed-up multiple debian bugs (#741129, #764841)	and made a proposal on how to fix it under:	https://lists.debian.org/debian-devel/2014/12/msg00368.html		until this plays out, workaround this on debian systems from our motd	module. also dtrt with the different versions of ubuntu lts.		change-id: i4a9450c7bc84ef751ca8a2ba30ace967e5ad2035	|motd: add motd::defaults class		this provides defaults motd scripts, a generic but cleaned up (no help	text) mixture of what debian/ubuntu usually ship in their motd. this is	needed as the motd module recursively manages the update-motd.d	directory.		as this is just a simple header and footer, include this from the main	motd class as it should be harmless enough for all callers.		change-id: ib5b5e520b73588af4ef83acbe5b7f3ec62d52851	|motd: misc fixes		- don't ignore priority 9* files. usage out there doesn't indicate that	  there is a special meaning of local vs. system priorities. for example	  update-notifier-common used to ship both 20-cpu-checker and	  98-reboot-required.		- don't call runparts after shipping update-motd.d scripts. pam_motd	  does this on every login so there's really no reason to unnecessarily	  spend time doing this in puppet.		- fix the example usage to include #!/bin/sh		change-id: id79b22334c617b6f35a84deef3d327bf69fb21b4	|add 'motd' module from mediawiki-vagrant		i noticed coren doing some motd stuff in ib75c18f75, which reminded me that we	have a handy module for this in mediawiki-vagrant that has been working well.		change-id: i2a8708c4f7940bb8c1e7c6f9d5d330cc8279fa21	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/npmtravis.pp,contint: move npmtravis out of prod slave		the npmtravis has been setup on role::ci::slave which is only meant to	be used on the production slave gallium.  we no more run jobs on that	production slave and have transitioned to use labs instance.		nothing seems to be using npmtravis right now, keep the bits though and	move them to a standalone class contint::npmtravis in case it get used	again.		bug: t114421	change-id: ief2dd9ca76afdd4da721f071c4df9afd0ad068ab	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/rancid/server.pp,rancid: move role to module structure		change-id: i9828687a25825540f47eee714fafdf6237707a62	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/wdqs/manifests/packages.pp,add definitions for wdqs service		task: t95679, t103904	change-id: ie60e8962304c878a122d042f1d973e7b31ae4470	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/varnish/manifests/wikimedia_vcl.pp,varnish: mv wikimedia_vcl, netmapper_upd to separate files		fixing:		./modules/varnish/manifests/instance.pp -	error: varnish::wikimedia_vcl not in autoload module layout on line 1		./modules/varnish/manifests/zero_update.pp -	error: varnish::netmapper_update_common not in autoload module layout on line 2		change-id: i5e94fb5000d2bf38e39cd207a525ec421a5240d1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/clush/manifests/target.pp,introduce 'clush' module and toollabs role		change-id: i6f3ffa16b759ddb4c2fd6bf5753b82796d84c6d8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mirrors/manifests/debian.pp,mirrors: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: iebf6b43f559cf93d15b8afcbae70c3e6dc6bf6d3	|mirrors: fix perms for ::debian's log directory		change-id: i9eb598f322d3abd7d6ee59c1b49dbc05dab800d4	|mirrors: move to /srv/mirrors; new class ::serve		split mirrors into a separate /srv subdir, /srv/mirrors and set up an	index page for it		also, create a new subclass mirrors::serve that sets up a separate nginx	virtual host to serve just /srv/mirrors and include it from the	install-server role class (to be moved later).		change-id: i48ff568e52ea1c9c367ac9f41909c6ef20dfb89f	|mirrors: don't purge archvsync logs		change-id: i422cba430a47eb3efb9e4e013ee5fd26aa92bf35	|mirrors: introduce mirrors::debian and use it		introduce a mirrors::debian class that mirrors a debian ftp. this uses	debian's official mirrors scripts, archvsync (aka ftpsync). include the	class from the respective role class and while at it, add monitoring	based on the preexisting ubuntu check_apt_mirror, which now takes a	parameter. note that the mirror pulse for debian is set also every 6	hours but 40' far apart from the ubuntu pulse as to avoid overlap	between the two.		it should be noted that instead of archvsync, debmirror was also	explored. while debmirror was more well-documented and packaged, in the	end it seemed more oriented to "local" mirrors and tried to be too smart	in this regard. there were multiple occurences of this but the tipping	point was when debmirror choked when "experimental" had failing	checksums and ended up not syncing *any* suite.		so, stick with archvsync, which while a bit crude will allow us to	potentially become a (partial) official mirror.		finally, the mirrors module in general could probably use some extra	love as it's not very configurable right now and hardcodes a bunch of	settings. it isn't /too/ bad and should do it for now, though.		change-id: icafeaa3d0c80d5249bcc2027471a56bc8a487395	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/osm/manifests/users.pp,osm replication for maps		* don't run updates as a pg superuser	* add support for --flat-nodes to reduce db size	* make some things configurable:	 * proxy	 * number of threads and memory usage, to avoid overloading servers shared	   with kartotherian	 * zoom levels for which expiry files are generated	* make certain files/dirs world readable to assist debugging and because	  they have nothing secret anyway.		bug: t110262	change-id: id3a6264e1a069434221e62b9a292b34f5ff3e9d5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/snapshot/manifests/dumps/dblists.pp,remove 'enable' and 'ensure' class params from snapshot manifests		this is my official notice that i have given up on making puppet	clean up on removal of a class.  puppet is good for deployment and	nothing else.		change-id: i416d386b8381b6138b15da91084780964e330d5f	|basic snapshot role for dumps		set up config files dblists etc	scap3 deploy	cron job	hiera settings for things which vary from host to host	  (only one host needs to run en wiki, only one host needs to	  reserve cpus because it runs cron jobs)		change-id: i8d48878300de584bd5385a0c46b2fc0e25e5bf41	|snapshots: fix up all variable refs to dump dirs in templates		change-id: ibc1027b69289793a621937a65544268c1ed313fa	|snapshots: restructure directory handling a bit		* move all dumps dirs to /etc out of dumps repo area	* remove the declaration for the dumps repo dir, that now	  will be taken care of elsewhere	* move the actual dirs manifest into the dumps directory	* remove all hardcoded refs to dumps dir and replace	  them with snapshot::dumps::dirs::dumpsdir which means	  a few script files turned into templates and manifests	  setting those up were altered accordingly		* still to move: addschanges and wikiqueries dirs under /srv		change-id: i73b0072a6b50fb92a64c3bd3aa6d4ff427d5051f	|dumps: move all dumps-related dir decls to the dirs class		change-id: idb387c03396c6aaa2c2c50d89bbcfb8866aa1787	|dumps: add labtestwiki to list of wikis we don't dump		for permissions reasons		change-id: ie1cfcc215a1c51a68b945051eefc7698423b5788	|dumps: configure for parallelized runs for zhwiki, metawiki		don't commit til after this monthly run completes		change-id: ifdf643d3e28719878489aaabd579ca3d63b46c20	|dumps monitor config: skip labswiki, not reachable from snapshots		change-id: i52da70819c22e0e462777e178e2e4ddf64cacdfd	|add globalusage table config info for dumps, t87571		change-id: i05ec000854288ecec54a7ce33581b8daa2dc6b79	|dumps: move wikidatawiki, commonswiki to big wikis list		this means some jobs will be split up and run in parallel now		change-id: i488ac675cee252db5c6fbf9edff43b9d607f3c5f	|don't dump wikidata along with the regular wikis		for now manual runs, in a bit it will move to the bigwiki queue		change-id: i0e77ed8c39532200557fdb21339ef10b2519605a	|added labswiki to the dump skip list to avoid error spam		change-id: i988c0ae4f4fa6f606e666dcfcd809ec21312a447	|dumps templates, configs, dblists added to snapshot module		these were formerly unpuppetized, though sample templates	live in the dumps repo	this is the start of moving things to /srv on snapshot hosts	change-id: i1c8f2f61ff2d8986514bc75f80b678c4f4e4697a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/lists/migration.pp,role/lists: rename prod role, move to module/role		- move role classes to module/role	- rename ::server class to match description and to fit	  into this scheme avoiding the limitation of the role keyword	- move into autoloader layout	- minimal docs / lint-fix		change-id: i4834b14053c5f799b3df4514188fbbec0d9a806e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppet/manifests/self/client.pp,puppet,puppet_compiler: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: ifc691e10cba78a47d400a3b346fb3c63da73ee06	|update labs instances to use the new ldap-eqiad server		change-id: i0a68dd9c69179e51cdfeded7b9336f6ee378a5af	|puppet: lint cleanup		change-id: i9d2c5a2007ed6f4ef694f110011e32b3b7e4c821	|modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/manifests/monitor/aggregator/site_instances.pp,ganglia: fix "defined type defined inside a class"		change-id: i5e44cd0704ae8dc9514d3c08c5c40f5190bba9b8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/manifests/monitor/config.pp,ganglia: rename ganglia_new to ganglia		change-id: i1e92bc3e994e9a522c82b3b7c3b5136622d34250	|rename new module temporarily to resolve conflicts		change-id: i793465ff41746f5d520160977bf205eddb06e2a8	|initial attempt at a new ganglia module		untested. moves to a model with central aggregators, and	no multicast.		change-id: i0a00cc0ea51577b98332eac422a7ed1a1626ade6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/requesttracker/labs.pp,rt: move role classes to autoloader layout, split labs		change-id: if538ff9d4dae23b3e3f224aae63de62d8543763d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dataset/manifests/rsync/common.pp,datasets: make sure rsyncd is running on them		change-id: iff0e0b5cd50d70dc2d877b8bd6b7b0f4ae463f2d	|dataset: lint fixes		change-id: id3a946f7a1a0771e473130675f28c7083260d73a	|dataset: fix module path		change-id: i439a1854d743870d6be490fe2f3d0187ee3bc082	|pull rsync and cron jobs out of 'download' into new dataset module		rsync from/to dataset hosts and cron jobs doing copies may	move among servers, so this breaks up the rsync config into	small pieces that can be assembled as needed for a given	server; the dataset class will expect to be told explicitly	which cron/rsync jobs should be running.		additionally this code should be much more 'module-like'.		change-id: idbe3edadf95c049b0c8cc8a89cb33fdfce84316a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/hhvm/manifests/admin.pp,add ferm rules for hhvm admin site		change-id: ic497ed9278d753e6bb06fb13607a20ea62cb132d	|hhvm::admin: bring back $ensure		..accidentally dropped by bad merge. shame on me, etc.		change-id: i0f801c38ac16b6e1a9184b6da25215787b670098	|hhvm::status -> hhvm::admin + small lint fixes		* validate port param.	* don't set priority on site (default of 50 is fine).	* rename status -> admin.		change-id: i8e91d31246cc9e119d152db0ec540715119bd3a0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/storage/device.pp,fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|bacula: lint clean		change-id: ifa52cd25ca01f73228243b797dff6eea2ea124bc	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/microsites/peopleweb.pp,move microsite roles into a common place		move roles that setup microsites into one a common place.		this makes it easier to find similar roles in one place,	and it also moves more roles into proper autoloader layout.		also move the peopleweb::migration class into a separate file.		change-id: i74c16340c44318876db701ff37f84f780a40c5d3	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ci/slave/browsertests.pp,contint: create /mnt/redis		the redis::instance is passed dir => '/mnt/redis' but that directory is	not available on a fresh slave.		that needs to be created after:	* /mnt got mounted	* redis-server package is installed (which create the 'redis' user)		but *before* we start the redis instance or it will fail to start due	to:		    # can't chdir to '/mnt/redis': no such file or directory		moved the port number to a variable to avoid repetition.		change-id: ic2da7e20cbfd9bf3d70f33a5b83dbb208eca2ef5	|ci: split and move role classes to modules/role/		split the large file into one file per class for	readability and per style guide and lint.		move them into ./modules/role/ and into the proper	autoload layout without renaming any classes or	changing content.		change-id: i3d514e64b56dcba5486ffbd2f22eb95d8326e1c9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/postgresql/tests/ganglia.pp,postgresql.pyconf is a template not a file		also update tests		change-id: i34545aa6bbc8db8c1bd23e1dedae0ca1e3b41444	|postgresql ganglia plugins		add ganglia gmond plugins		change-id: icfe76e156dbd02ea01014eed30f44d141868cdc8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/coredb_mysql/manifests/init.pp,coredb_mysql:  puppet 3 compatibility fix: fully qualify variable		merged the conf class into the init.pp class, as it is tiny, and the spilt	wasn't needed. this by turn fixes the lookupvar scope.	change-id: i8130122ee7a99231c724538844e3e5755caf9f8d	|coredb_mysql: lint		no changes to behavior; only presentational changes in this commit.	 - spaces rather than tabs.	 - align arrows.	 - don't align equal sign, except in function signature	 - single quotes when not interpolating.	 - single resource per block.	 - quote strings.	 - quote octal permissions.	 - 'ensure' always first property.	 - use ensure => link w/ target rather than implicit symlinks.	 - every property ends with a comma	 - one class per include.	 - resource name and resource type on same line.	 - [ space ] in arrays	 - '&>/dev/null' instead of '>/dev/null 2>&1'		change-id: i419f48c9713e5c59deac093ac86142d4d938a25c	|coredb: this should make everything set to migrate es1		change-id: ib389f5e5aec72e281bb9be8f44cd803ab3a4dd11	|coredb: testing: ability to mark hosts as mariadb per node		also, set db1036 to coredb s4 mariadb		change-id: ib41c56ab0d9a293ed5cb144f03161de657c7976d	|coredb: hacking in temporary mariadb support		note: full plan is to make a generic mariadb module, and also	a coredb_mariadb module		change-id: iad87087ac1c08ba00fa31dcb28af5e7297bee462	|coredb: include slow_query_digest in a not ridiculous way		change-id: i868f6492d4b514da156138fc9203d4719bab073a	|attempt to hack around more coredb issues		change-id: i5e8513d0f84cd0dace3b862c28523ba6959ab993	|renaming coredb module to coredb_mysql to avoid module/role class namespace fuckery		change-id: i1c8ab607514c63be7a9ab36ac337ae20918cfa6f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/installserver/tftp_server.pp,tftp_server: add bacula backups to role		the role has been split out of the general installserver	role used on carbon, which added backups of several pathes in /srv.		add this here in the more specific role so that new hosts like install*	also get the same backups.		change-id: ic95d59dfd2fed2853697f7aeaaedd17855f474ed	|install_server::tftp_server: use production_networks		only used to provide tftp to systems installed in production.		change-id: i5a583ffb8379f205236c1bd763fe545eb036b8f4	|install_server: move tftp role to autoloader layout		bug:t132757	change-id: i06c515c761e65d3f4c98d6d24c7c06fdf02e186a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/trebuchet/manifests/packages.pp,remove support for ubuntu lucid/10.04		change-id: i49b16d717559c8126e2517bb5131dc0ae88e27bd	|trebuchet: install git-fat on debian too		change-id: i9a216969a9d02ec37edd1a0a2e0750247180d2d3	|replace usage of requires_ubuntu / ubuntu_version with requires_os / os_version		change-id: ia7a2052559fb46ae2d2b3e096ce37f90919a18f4	|consolidate python-redis package declarations in ::redis::client::python		different software stacks declared in operations/puppet require python-redis,	so let's consolidate the package declaration in a standalone, unparametrized	class that can be included unproblematically from anywhere it is needed.		fixes puppet on silver, broken by change ib487dd5d4:		error: could not retrieve catalog from remote server: error 400 on server:	duplicate declaration: package[python-redis] is already declared in file	/etc/puppet/modules/trebuchet/manifests/packages.pp:14; cannot redeclare at	/etc/puppet/manifests/mobile.pp:79 on node silver.wikimedia.org	warning: not using cache on failed catalog	error: could not retrieve catalog; skipping run		change-id: i7f7a7d795a15f2e435c3a0364a5dab79e6bdcbd9	|trebuchet::packages: s/hardy/lucid/		change-id: i7092f0b520270fcd2585f9e25bc51488ef7895d7	|trebuchet::packages: fix conditional install		change-id: i5c48edb6a4ea9f4fb28f5e6aa4c3bb895cfe335c	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|trebuchet::packages: use ensure_packages from stdlib		also fix a conflict with mobile::vumi class		change-id: i2e3b74aaa2ef8c97055392e40b5244493705a57c	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|ensure that dependent packages for trebuchet are installed		the python code for the deployment module needs several packages	installed on the host. if they are not present, salt will give the	cryptic and generally unhelpful error "function deploy.fetch is not	available" when running `salt-call deploy.fetch`.		change-id: ib487dd5d4680a255e02dc7ab727b6aa3e50af814	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/package_builder/manifests/hooks.pp,include base::firewall in role::package::builder		while at it lint the package_builder slightly		change-id: icc54445798647930045cd3dba9f31d9354f664ac	|improve package_builder tests		unit tests where missing for package_builder classes and definitions so	add them. also refactor a bit the use of basepath variable while at it		change-id: i51d2ba029cd0365b5dd24ca4dbc56a1d0924b809	|package builder module		a module used to create a debian package builder environment base on	cowbuilder. intended to be used in labs for streamlined debian package	building. creates 4 environments to build packages in:	 * precise	 * trusty	 * jessie	 * sid		respective hooks for the environments are being installed as well and a	mechanism to easily change between environment via an environment	variable is provided. tests included, as well as a readme		change-id: ic8452ee447dcf485f6af822627cc117b3931b795	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/tcpircbot/manifests/init.pp,fix whitespace-related lint issues		fix a lot of lint warnigns due to incorrectly aligned arrows.		change-id: ib062d7142a79a8cb6bb3abd86fd7499aa3edad03	|tcpircbot: use require_package		because it conflicts with ircecho otherwise on neon. this	also cleans up the 'require' section for ircecho		change-id: ia7619c29243b54b4b3adbe8b601ced7bfa659c06	|fix tcpircbot group setup?		change-id: i5af80cfbe022972d54b9382ba1ba18a37751835c	|revert recent generic::systemuser conversions		this isn't prettier, or more abstract. it's just uglier in syntax,	includes far too much magic that is also wrong. it's also conceptually	wrong as it adds a membership to a virtual supplementary group of	"systemusers" that won't and can't include all system users.		the right way to go here is to keep using system => true to mark system	users, that would in turn use adduser & adduser.conf's fist_system_uid &	last_system_uid to designate whether a user is system or not.		this reverts the conversions for the following users:	icinga, mirror, gitblit, ipython, librenms, limn, ocg, tcpircbot.		this reverts commits:	  - 13932dcfe3e092dc23c63f0df643c0408d46f351	  - dcf55c490c5c2990c807e3d692bba872981b8952	  - b66eb8c7a54d0e55899149d04435eec448d11865	  - 76fdd4a29d892089c8da9f41b0c2247abfa1fd35	  - b6f8462bb68a248b20b031ffcbc227688e707804	  - 98e6ab557e7b113e1724572910ce0a9cb7eaf14d	  - 9c5fc3843246f894a5919164ae10c429c983db4f	  - 3ba59bc5dc341e1a5e51c6a62c8cfbcb4146d53b	  - 3df220dbe688896723b3975131a7427d8c9860c7	  - 80d3f1fcb9be8a4087652b5200c8dc8c66a1db1b		change-id: i8445bf3a8fb1a47385aa36d226fe5291c2cacc1e	|tcpircbot use generic::systemuser		change-id: i32486eb2a3d28dd604732f09bfa3c7dbfde62717	|tcpircbot: fix multiple unreferenced var errors		the "few unrelated touch-ups" of commit i0e0209e were broken in multiple	ways, throwing errors because of missing dependencies.		attempt to fix those while keeping the original commit's rationale of	removing useless parameters that noone would ever customize.		change-id: if6379f5c2fedd54460494b98392e4f6d96d8ef8b	|make it possible for logmsgbot to report to more than one channel		some conversations in #wikimedia-dev end up drifting over to	announcements make #wikimedia-operations the natural place to coordinate	mediawiki code deployments and their outcomes. logmsgbot isn't especially	noisy, so perhaps the best solution is to have it log to both channels.	this patch modifies the tcpircbot module to make it multi-channel-capable, and	adds #wikimedia-dev to the list of channels logmsgbot should report to.		includes a few small but unrelated touch-ups to the tcpircbot module.		change-id: i0e0209e5c159210e112c07325e6a4023946cedba	|tcpircbot: tabs to spaces		change-id: id5b1e9e724e489d75804ec81338c3f747bc77daa	|rdoc for tcpircbot class and tcpircbot::instance resource		also parametrizes 'cidr' configuration option.		change-id: iaf0fc648c7700dc234a3bcf49cfbd56521d381b9	|add 'tcpircbot' puppet class		this puppet class configures a python script that listens on a tcp socket and	forwards incoming data to an irc channel. it allows setting up automatic	announcements to irc from machines in the cluster that do not have a public	interface. the script runs as an upstart service. by default, it connects to	freenode via ssl, and listens on port 9200 for messages to forward.		sample configuration:			include tcpircbot			tcpircbot::instance { 'announcebot':		  password => 'nickserv_secret123',		  channel  => '#wikimedia-operations',		}		if a "cidr" key is set, it is interpreted as an ipv6 cidr range. inbound	connections from addresses outside this range are rejected. if "cidr" is not	set, only private and loopback ip addresses are allowed to connect.		change-id: i6d4f661b70e6c4d4111672f5a7f8018389986a18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/webperf/manifests/ve.pp,webperf: port services from upstart to systemd		change-id: i7ffc28e985a2300e73987451f80fb120b57ced09	|add visualeditor timing data reporter		this is a copy-paste job, based on navtiming.py. this sort of barefaced code	duplication is something i try to avoid, so i tried extending eventlogging's	plugin architecture to cover the use-case of simple metric reporting modules in	id8596535c. but i'm not convinced i got the design right, so i am reluctant to	merge that change. so instead, this.		change-id: i5838ff77458eff4080e5bcff526ead410b6795d5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/postgresql/tests/master.pp,postgresql/postgis module		introduce a postgresql module capable of setting up databases in master	or slave mode, and postgis. module also allows for setting up users both	in databases and pg_hba.conf		module contains tests and rspecs.		change-id: i118a987de1c0ed38037cc3a15ba3fa2b299f55c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/tests/web.pp,modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sentry/manifests/packages.pp,move sentry packages into subclass		fixes iaec4877b9d30e477de1985fd50bdcc4364e8331b		change-id: idc44b59668c00024c2fcbe3996166e7d4b9ed83d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/monitoring/manifests/graphite_anomaly.pp,https for graphite monitor urls t132461		change-id: ib93f01782f8eff7705a242f977f59f1c6818ce3f	|monitoring: fail on graphite metrics using single quotes		as it turns out icinga will strip single quotes from the query, thus	resulting in 500s from graphite. prevent this behaviour by failing, not	the best behaviour however blindly substituting single quotes with	double quotes doesn't seem ideal either.		bug: t118398	change-id: if3c248d2c7bbdcd1e47d1c0cd508eae685f4d7b1	|root out a long chain of quoted bools in nagios/icinga/nrpe		bug: t113783	change-id: i16cee528ddf05f90b2cc7c9f474fe8a4db914582	|fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|monitoring: move stuff out of nagios.pp, part 2		move out monitor_graphite_anomaly, and remove two buggy checks based on	it that we had.		change-id: i76068932f7dc20ea2af9ca898358ff70c0ba122d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppet/tests/master.pp,puppetcompiler/puppet-tests: mini lint fixes (meta)		change-id: i6857631dcc3fef7ecb7ce101e9caa61ecc6a3d5d	|puppet-tests: remove broken inclusion of nagios.pp		the file manifests/nagios.pp has been moved in i21a3ca32fd425dd20	and does not exist anymore in this place.		when trying to compile changes to the tests files itself you get:		error: no file(s) found for import of '../../../manifests/nagios.pp'	like on https://integration.wikimedia.org/ci/job/pplint-head/10231/console		change-id: i6b5279947b24c63e10d0b66974bb3b23c57d46e8	|modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/package/builder.pp,package::builder: move role to modules/role/		change-id: ia52474a3d0ff99270048422508d3118333750a9e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/install_server/manifests/preseed_server.pp,installserver: rename classes with dash characters		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		this is a follow-up to icb2122da0a43b7a1	where the module was already renamed due to this,	but not the classes inside it.		the classes ubuntu-mirror and caching-proxy are removed	from comments because they either moved to module/mirrors	or have been deleted meanwhile. this change doesn't touch them.		change-id: ib91faf62a8c4d2292f2a51e30fbf1c6583f15eaf	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/rsyslog/manifests/init.pp,rsyslog: fix indentation warnings		change-id: ifd122e03f5983f99dfda14486ee1647acfd21aed	|remove provider => upstart from service[rsyslog]		puppet knows to do the right thing these days, do not depend on upstart	unnecessarily.		change-id: i4cf5d2b3aef211395509e0369e6864ccddeb641b	|rsyslog: ignore 50-default.conf instead of provisioning it		change-id: i5619dec08e5d79fd863eba980b3c862c7c0f69ee	|add rsyslog module and port existing usage		* make puppet manage /etc/rsyslog.d recursively.	* this means that packages that include their own rsyslog.d config will need	  to have that config file declared in puppet or it will get clobbered on the	  next run.	* this is the same decision we made with respect to sysctl.d.	* per apt-file, the set of packages with rsyslog.d files are:		   arno-iptables-firewall, cloud-init, gforge-shell-postgresql, maas,	   maas-region-controller, mythtv-common, octopussy, postfix, qpidd, sagan,	   sympa, ubuntu-orchestra-client, ubuntu-orchestra-logging-server, and ufw		  we don't run any of these in production. (we do have ufw installed because	  it's part of the 'standard' tasksel task for ubuntu, but we don't use it.)	* remove reference to i-000003a9.pmtpa.wmflabs:5544 as a syslog sink for	  non-beta-cluster hosts; the instance no longer exists.		change-id: ibceb48bd8c475696b900e89f38dea686394069d8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/beta/availability_collector.pp,beta: move roles to modules/role/		- split the large file into one file per class,	  per style guide and lint		- move them into autoload layout in the role module	  and out of manifests/role/		change-id: if8f08467126ec607806c7b704f9953c96dc17e88	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/postgresql/tests/postgis.pp,postgresql/postgis module		introduce a postgresql module capable of setting up databases in master	or slave mode, and postgis. module also allows for setting up users both	in databases and pg_hba.conf		module contains tests and rspecs.		change-id: i118a987de1c0ed38037cc3a15ba3fa2b299f55c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sudo/manifests/user.pp,sudo: fix sudo::user/group's ensure => absent		we don't currently use ensure => absent for sudo::user or sudo::group	anywhere yet, but it was broken (the template gets evaluated anyway and	borks if there are no privileges defined) and needed fixing anyway.		change-id: i706e891c8ce7d858d8ef59a1fabbc03a84ac2858	|sudo: actually make the linting safety checks work		the current linting execs, shamelessly stolen from the admin module, had	a logic error in which it tried doing "exit 0" as means to handle the	ensure => absent case, but ended up doing it unconditionally, therefore	rendering the whole check moot!		there's two ways to fix this: either move the "test -e" check to a	separate onlyif parameter, or guard the whole exec with an "if $ensure	== present" check. the latter feels cleaner, so pick that one.		change-id: i9b29d3e093446cbd602087d27718f6813cfe372b	|sudo: port over linting & sudoers from admin::sudo		admin::sudo pulls a nifty trick to lint bad sudoers values and	self-heal, as to not let mistakes break sudo for the whole system. port	it over to sudo::user & sudo::group. while at it, also cleanup our own	sudoers file, basing it off the admin::sudo sudoers (and also fixing the	undefined variable check).		change-id: i6fd4dd59242020f7e2b319a52d5a6a6ed9a630cf	|sudo: reduce delta between ::group & ::user		sudo::user has gained a few niceties that sudo::group hadn't, like	comments and a $title_safe regexp, so port them over.		change-id: i9c7bb4bd3ecc94599e213b4e92dd66a42b60cb4b	|sudo: ensure package['sudo'] is installed		the sudo module contains definitions to set up sudoers but class sudo is	empty and nothing actually gurantees that package "sudo" is installed	(other than ubuntu installing it by default).		fix this by ensuring => present for package['sudo'].		change-id: if3233ed70b4b4b232685f4db932e548ad1c48f56	|allow multiple sudo::user grants for same user		right now, the user receiving the sudo grant is specified via the resource	title. since resource titles must be unique, only one grant may be declared per	user. that's a stupid limitation, so let's fix it.		change-id: idd809d8c14052d9708531f9a5887727454e421d1	|sudo: create module, remove old files		for the sake of structuring our puppet classes/manifests according to	the "standard" structure expected by puppet.		also:	- removed the sudo::appserver class, that was used in role::snapshot::common	  and nowhere else.		change-id: ic7e883f85b81b516b424168be2a3380dcc5f3121	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/diamond/manifests/collector/nagios_lib.pp,diamond: move _lib classes to own files		each class should have its own file, per style guide	and lint check.		change-id: ibbdab575b26b3f06d9986351ac01b5db53534872	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/client/default_charset_binary.pp,fix wrong path for files/charset.cnf (mysql_wmf module)		change-id: ia5e24fc178052929604b7cc14d0f5d4711e4b160	|move mysql_wmf into a module.		the manifest changes here are pretty brainless -- i split the major	classes into separate files and rearranged the file and template	includes to reflect the new position of the source files.		i also moved quite a few files that were filed under ganglia	or icinga but only used by these classes -- now they live in the	mysql_wmf module instead.		change-id: i31b8d8562f8eda4a6fde4a6110d83a339fc38b94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/planet/manifests/theme.pp,turn planet into a module		there has been an older attempt to do this	that had to be reverted due to a bug causing	puppet issues		so this is along the lines of	https://gerrit.wikimedia.org/r/#/c/54502/3	https://gerrit.wikimedia.org/r/#/c/58495/ etc,		but entirely new and _doesn't_ do things like dropping	the role class, putting config into module etc.		change-id: i980f9dc9f48e80d53dd2c920622ae67672d575df	|revert "make the planet logo a "per language" thing"		this reverts commit f2264e7a97f26b6b2d6548e9d730e01ce42baebe.		revert "resource references should now be capitalized"		this reverts commit 54d5baca9de9ea519c216ceb08030eb93cffc674.		revert "remove duplicate definition of locales package"		this reverts commit ebd76e02e4d7322a57a605b33afde16e4bf93a72.		revert "turn planet into a puppet module"		this reverts commit ec09aaefb8b9f7eafc82aaca5dff7e940c243f4e.		change-id: i093cfc85d1ca8550c19a246ae9ed8fb0e91149e3	|make the planet logo a "per language" thing		otherwise duplicate definition, and we want this anyways	as soon as we have localized logos		change-id: idc70e02602d04e5260c3046f26e9101e32d19853	|turn planet into a puppet module		- move all files, templates, into module subdirs	- add readme.md and turn role file into init.pp	- quoting and arrow alignment	- 2-space softtabs, etc. per puppet style guide		change-id: i9d0fda3f27715282068e760d2f01c2fc298314b7		rename planet class, per docs init.pp must exist and contain	a class matching the module name		change-id: i19034d090692387ca7e9d7f2d87fe4f9e13793e7		move defined resource types into separate files, one definition	per file inside a module as recommended by puppet docs		change-id: i91fc1ccad73b5498441de39a3e150e65e017df1b		move package install to own class and file,	move generic::locales out of init.pp		change-id: i63217308b7d3c6469ba3c30bc4a183e62f8b2b77		move webserver setup for planet out of init.pp		change-id: i00dde9965afe86b58ba609810bcaa6b588ac17af		move locales install and generation into own file,	step 1 to making module self contained instead	of declaring stuff from generic-definitions.pp		change-id: i239fa19a8bd40eadeb7a6aea3ab9feddb480610c		move needed planet directories to own class		change-id: i153848976801f3bd378f83dcfab0d70a4984fd66		move user/theme/apache_sites out of venus.pp, move index_site	setup to own file, move webserver setup out of init.pp		change-id: i9769542394ff96a46e0cf46e8269f9fbe9cc8e92		move language prefixes and translations to own class/file languages.	use a qualified variable to access it		change-id: i88a12546e4ed42b5d6ced9a4d68bf22fff64c486		various fixes to make puppet-lint like it,	like wrong quoting, unaligned arrows, variables without explicit scope,	lines longer than 80 chars, and more		change-id: i260c28ab1028f8d11e6e155540a708a45f63745f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/ores/redis.pp,ores: move role classes to module role		change-id: ia93f8cbe4f427f50a449fe2bfd47314d3425b6c1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/labs_debrepo/manifests/repo.pp,lab_debrepo: fix the sources file's contents		this broke all labsdebrepos for a while and nobody noticed :)		change-id: ie79bb5de7ac457c7c59cf53942f405b4de6b3a0b	|labsdebrepo: fix names to match file paths		change-id: ieedb2518fada177d329756a87d2c210685ba6f58	|move misc/labsdebrepo out of misc to module		one more thing in ./misc. we would like to get rid	of the entire ./misc.		change-id: if357a88e0b42eafc76d92fba93027a522de68a56	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/webperf/manifests/deprecate.pp,webperf: port services from upstart to systemd		change-id: i7ffc28e985a2300e73987451f80fb120b57ced09	|webperf: add statsd module for mw-js-deprecate		change-id: i938eb55b6064c2744324bde8ddf48237c1036013	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/ores/precached.pp,ores: move role classes to module role		change-id: ia93f8cbe4f427f50a449fe2bfd47314d3425b6c1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/debdeploy/manifests/master.pp,debdeploy: rename init.pp to master.pp to match class name		this is to fix: 	"error: debdeploy::master not in autoload module layout"		change-id: i528099c868a1ed37b86b6a54b4b6e98eaa890b2a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/geowiki/manifests/job/monitoring.pp,create geowiki module		this commit finally removes misc/statistics.pp!		change-id: ib36c02b36a4bd4cb4e4ee8293108fe61754aba94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/snapshot/manifests/dumps/templates.pp,provide and use variable names for all dump related directories		instead of hardcoding in partial paths in many manifests and scripts,	provide variables in the manifest which declares the directories	and use those.		also fix a couple badly closed variable references in templates.		change-id: i40a78843f44f3b24a4deb0355dd530c54a7f8b42	|remove 'enable' and 'ensure' class params from snapshot manifests		this is my official notice that i have given up on making puppet	clean up on removal of a class.  puppet is good for deployment and	nothing else.		change-id: i416d386b8381b6138b15da91084780964e330d5f	|dumps: make dir var references easier on the eyes in the manifests		change-id: ib617e602512e4d8749e168525331e22f3b5c4167	|snapshots: restructure directory handling a bit		* move all dumps dirs to /etc out of dumps repo area	* remove the declaration for the dumps repo dir, that now	  will be taken care of elsewhere	* move the actual dirs manifest into the dumps directory	* remove all hardcoded refs to dumps dir and replace	  them with snapshot::dumps::dirs::dumpsdir which means	  a few script files turned into templates and manifests	  setting those up were altered accordingly		* still to move: addschanges and wikiqueries dirs under /srv		change-id: i73b0072a6b50fb92a64c3bd3aa6d4ff427d5051f	|dumps: move all dumps-related dir decls to the dirs class		change-id: idb387c03396c6aaa2c2c50d89bbcfb8866aa1787	|dumps templates, configs, dblists added to snapshot module		these were formerly unpuppetized, though sample templates	live in the dumps repo	this is the start of moving things to /srv on snapshot hosts	change-id: i1c8f2f61ff2d8986514bc75f80b678c4f4e4697a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/toollabs/clush/master.pp,tools: add a wrapper script to enforce clush access		make sure we log accesses to a log file, and that people are	running it as their own users rather than as root interactively.		note that this isn't foolproof - but can't really foolproof against	people with root!		change-id: i57156bb99dbc4a7e42c05efe06156ff001c1216b	|introduce 'clush' module and toollabs role		change-id: i6f3ffa16b759ddb4c2fd6bf5753b82796d84c6d8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/osm/manifests/planet_import.pp,osm: fix top-scope var without namespace, rm cruft		./modules/osm/manifests/planet_import.pp	warning: top-scope variable being used without an explicit namespace on line 25		removing the entire line that is not used anymore		change-id: ib941673a231f1de31a2f39346c3a15c6287f2f90	|osm planet import/sync, make sure we use hstore		hstore is a key/value store in postgresql that is used by openstreetmap	as a tagging scheme. pass the -k parameter to osm2pgsql to use it		change-id: i037057ea6e475dbac5f3ff424b72464f94e3f413	|import coastlines and land polygons into osm db		* using a manually and previously downloaded wgs84 coastline file from	http://openstreetmapdata.com/data/coastlines we populate a coastlines	table in osm dbs	* using a manually and previously downloaded wgs84 land polygon file from	http://openstreetmapdata.com/data/coastlines we populate a land_polygons	table in osm dbs	* while at it, fix sysctl::parameter priority	* rename osm::populatedb to osm::planet_import and move the shapefile	import functions to osm::shapefile_import	* update docs and rspec tests		change-id: i457b92a8a9339a80874db3e7e13fc364fd8b0822	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/citoid/tests/init.pp,update citoid tests		so that they pass		change-id: ic3840981f37000d083cc2aff96063027f4844970	|create a shim module for citoid around service::node		this is a shim layer module for citoid around service::node. the idea is	that in the future (or in other modules) we will end up with extra	functionality needed in citoid (or other services) that should not	however be provided by role classes or service::node. that functionality	can be added in the service module in the main or some other class,	making changes in the role class and the service module unneeded. that	is a path however a path that should not be taken lightly as it is meant	to be used to satisfy extra needs of services and not a way to diverge	from the norm that the service module provides		change-id: i49703d4375741f75890f1181b2f9a0a1cf7bafe6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dataset/manifests/user.pp,add dumps deployment key		change-id: ieffbced95e5fa23a8ad4e24a22b54d7325779cee	|dataset: move system user creation to module		the "datasets" user/group creation/maintainance has been wildly	inconsistent to say the least:	- it was created by role::dataset::systemusers which is clearly not a	  role.	- the class was applied by site.pp, although user['datasets'] was	  actually required upon by role::dataset::pagecountsraw which was in	  turn included by role::dataset::primary.	- the class dataset::dirs, included by dataset::html, included by class	  dataset (over at the dataset module, *not* the role), is actually	  hardcoded to use the user "datasets" so it actually requires	  role::dataset::systemusers to have been applied before, although there	  is no formal dependency (so it's broken puppet code)	- all the cronjobs have a $user parameter which defaulted to "datasets",	  except one, which defaulted to undef. all of the callsites passed the	  parameter to set it to "datasets", although in all but one cases it	  was superfluous.		create a dataset::user and move the user/group creation there as it is	(despite being broken in other ways, see the fixme); require it from the	main dataset class and remove the non-role role class.		change-id: iba922bc3f3f97c72a839fc5a1ef932ec783b5e17	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/snapshot/manifests/dumps/packages.pp,add back nutcracker to the dump setup for new snapshots		since they are on trusty or going back to it, they need this		change-id: i6e1fa0ece562a63d7b33336cfff8ea49c258282b	|remove nutcracker for now, broken manifest on jessie		change-id: ia05c43debe811e51763ea0c31ea1ab479ddccbe1	|add mediawiki packages and other dependencies for snapshots		change-id: ic96e4205e5dcc381518356bf84967d978abcacfb	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/interface/manifests/init.pp,rename ::interface to ::interface::ip		change-id: id5c079f7b89e358a89d7408bb57a3ea801f692c7	|create an 'interface' module.		this is mostly a copy-paste job from manifests::generic-definitions.pp		change-id: ia0bf79e227a6738f7072a8bf4bf984d445d81a4f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/scap/manifests/conftool.pp,scap: add conftool class		for a wide variety of hosts, scap will need to be able to	programmatically pool/depool hosts when deploying a change; it will be	enough to include the scap::conftool class in your project in order to	have that work.		change-id: i8b874b7b758f2dda123449532fd9451fbcfc1a47	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/piwik/server.pp,fix piwiki and grafana-admin http checks for 401		change-id: i5195859f36a0bc93491372ff4a7481d917e219c1	|piwik: move role class to autoloader layout		this moves the piwik role class from "role piwik"	to "role piwik::server" which means it will be in	proper "autoloader" layout and lint warnings will be fixed	too.		checked with the "watroles" tool that it's not used in	labs and with puppet compiler that it's no-op in prod.		change-id: i53918808937e09839772eeb303f738b418db5391	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/authdns/manifests/ganglia.pp,ganglia: drop the "gmond" service alias		now that gmond is ganglia-monitor everywhere, drop the alias => gmond	from both ganglia and ganglia_new and adjust all call sites to notify	service['ganglia-monitor'] instead of service['gmond'].		change-id: if5dff9bd3f2032998a4712cb6d11a8e061874fe7	|authdns: restart gmond when the plugin changes		change-id: ib15fa031b2ed21a718ffa88a777864b94a38d57b	|authdns: add ganglia plugin for gdnsd		mostly untested, let's see if this will output anything useful :)		change-id: i5ad089c6fd231ee758b7059aae7febb541ae6e50	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/kartotherian/tests/init.pp,introduce kartotherian service puppet module and role		built using new_wmf_service.py		change-id: i76f5f7c3314c3a3e65088cffe1d72d7f49a4b9c2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/interface/manifests/rpstools.pp,interface: some lint fixes		change-id: ibbdba0954f81a04f21748c2a7cde51be00159783	|fix a typo introduced in 1a0605b		class, not define		change-id: i46cfa976c41a395a1886cdc8970ef5176d3ca062	|split interface-rps script file resources to class		the interface-rps script file resource would cause duplicate definition	if more than one interface::rps resource was defined for a host. fix	this by moving the file resource into its own class and require that	class in the definition. add a comment about the above in order to avoid	future melding on the class into the define. this fixes a duplicate	definition issue introduced in ab47728		change-id: if76dbb328efe45de1ca803f36433b960aa6530aa	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/deprecated/labsvagrant.pp,labsvagrant: do not require secondary disk		is unneeded use of space...		change-id: i903b76287d958584f5c06134ed4a3a4fbc7a8d95	|labsvagrant: move role to deprecated		will be followed by a ldap based role name rename for all	the instances that currently have this role		change-id: i5e78f2fad4dadcb9c3fa80adbeef9ae2eb38b426	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/tests/web.pp,ganglia: rename ganglia_new to ganglia		change-id: i1e92bc3e994e9a522c82b3b7c3b5136622d34250	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/ores/lb.pp,ores: use str2bool the check presence of cache		puppet may interpret the empty string as false, but erb does not. so	force conversion to boolean		change-id: i9c04ead9fb61ec6bda794c7588f90db2deaac4f2	|ores: move the lb functionality into the role		the loadbalancer functionality present in the ores module is never going	to be used in production and was added specifically for labs. move the	loc that implement that functionality along with the template into the	labs role		change-id: i4471463e6e839b9275783b8d7bfc005d60f1373c	|ores: move role classes to module role		change-id: ia93f8cbe4f427f50a449fe2bfd47314d3425b6c1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/kibana/manifests/init.pp,reduce kibana logging levels		kibana tells syslog about every web request, which is a bit excessive.	lets limit to only error messages.		change-id: i2e07474b87ac6c5ebf69f0909f19c60e136a15a2	|update kibana module for kibana 4		* transition kibana from trebuchet deployment to deb	* proxy requests from apache to the node.js application.	* drop previous apache config focused around serving static files and	  proxying requests to elasticsearch.	* default_route argument to kibana module changed to default_app_id to	  match new config file.	* status check now hits an html page, but it's proxied to the node.js	  app so probably reasonable.	* makes no attempt to uninstall the kibana package, will nuke by hand	  once everything looks sane in prod.	* apache proxying tested in beta cluster. static assets are returning	  304 as expected, searches always return a 200.	* testing in beta cluster is a pain, because we want one server on	  kibana 3 and another on kibana 4. in prod though we will want only the	  upgrade so doing the patch like this.		todo:	* dependant patch, which imports kibana .deb to our apt repository, must	  be merged.		depends-on: i478c7fd4d	bug: t129138	change-id: i2a11a05be801c461caeb11228ea5f5b496d743a9	|kibana, labs_vmbuilder: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i36477f0e2d2cffa31b66d6392ab18f05dee0c5bc	|kibana: convert to package<|provider==trebuchet|>		the deployment::target resource has been deprecated in favor of	trebuchet's custom provider.		change-id: i9ccb0070e0822657d9467170b5c4e20b8331fde7	|kibana: set default dashboard		set the default dashboard to the "default" dashboard managed in	elasticsearch.		change-id: ie2fcdba2c2688712c7ac56a5f4e21866a271c968	|fix kibana init.pp file location		the file should have been nested under manifests/. follows i504c4c124.	also includes some minor tweaks to formatting, comments, and parameter order.		change-id: i33c0967470dd53519921326c17739e675b80d307	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/ores/web.pp,ores: move redisproxy into the labs role module		ores::redisproxy is environment specific and hence there is no reason	for it to be present in the ores module. move it to the labs role		change-id: i83af8f8dd151eb9a3d3b05082ebce1b375c363cf	|ores: move role classes to module role		change-id: ia93f8cbe4f427f50a449fe2bfd47314d3425b6c1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ci/slave/localbrowser.pp,ci: split and move role classes to modules/role/		split the large file into one file per class for	readability and per style guide and lint.		move them into ./modules/role/ and into the proper	autoload layout without renaming any classes or	changing content.		change-id: i3d514e64b56dcba5486ffbd2f22eb95d8326e1c9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/tools/shadow.pp,tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/rsync/tests/repo.pp,manually adding modules/rsync for managing rsyncd modules.		puppetlabs-rsync:  https://github.com/puppetlabs/puppetlabs-rsync		see also abandoned change where i attempted to add these as git submodules:	https://gerrit.wikimedia.org/r/#/c/21744/		change-id: i2c811843b414fcbdbea4224157847135402af590	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dataset/manifests/rsync/peers.pp,dataset: remove system::role from the dataset module		add system::role to the dataset roles and remove it from classes of the	dataset module. they don't belong there and under no definition of a	role is a cronjob a role.		change-id: ibb7027f280b8c6253691e8ed581af569cd143fb1	|remove role::mirror classes		role:mirror::media can be removed:	< apergos> at this point role/mirror.pp can go, actually	< apergos> we don't serve media via rsync to anyone	< apergos> so just pull it from any host that claims to have it		role::mirror::common was included from a bunch of the dataset module's	classes. it was simple enough and has now been renamed to	dataset::common, under the dataset module.		change-id: i9a45120bfdfae949f72e6f60cec132de137417e9	|dataset: lint fixes		change-id: id3a946f7a1a0771e473130675f28c7083260d73a	|dataset: fix module path		change-id: i439a1854d743870d6be490fe2f3d0187ee3bc082	|pull rsync and cron jobs out of 'download' into new dataset module		rsync from/to dataset hosts and cron jobs doing copies may	move among servers, so this breaks up the rsync config into	small pieces that can be assembled as needed for a given	server; the dataset class will expect to be told explicitly	which cron/rsync jobs should be running.		additionally this code should be much more 'module-like'.		change-id: idbe3edadf95c049b0c8cc8a89cb33fdfce84316a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/manifests/init.pp,modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sudo/manifests/group.pp,sudo: fix sudo::user/group's ensure => absent		we don't currently use ensure => absent for sudo::user or sudo::group	anywhere yet, but it was broken (the template gets evaluated anyway and	borks if there are no privileges defined) and needed fixing anyway.		change-id: i706e891c8ce7d858d8ef59a1fabbc03a84ac2858	|sudo: actually make the linting safety checks work		the current linting execs, shamelessly stolen from the admin module, had	a logic error in which it tried doing "exit 0" as means to handle the	ensure => absent case, but ended up doing it unconditionally, therefore	rendering the whole check moot!		there's two ways to fix this: either move the "test -e" check to a	separate onlyif parameter, or guard the whole exec with an "if $ensure	== present" check. the latter feels cleaner, so pick that one.		change-id: i9b29d3e093446cbd602087d27718f6813cfe372b	|sudo: port over linting & sudoers from admin::sudo		admin::sudo pulls a nifty trick to lint bad sudoers values and	self-heal, as to not let mistakes break sudo for the whole system. port	it over to sudo::user & sudo::group. while at it, also cleanup our own	sudoers file, basing it off the admin::sudo sudoers (and also fixing the	undefined variable check).		change-id: i6fd4dd59242020f7e2b319a52d5a6a6ed9a630cf	|sudo: reduce delta between ::group & ::user		sudo::user has gained a few niceties that sudo::group hadn't, like	comments and a $title_safe regexp, so port them over.		change-id: i9c7bb4bd3ecc94599e213b4e92dd66a42b60cb4b	|sudo: ensure package['sudo'] is installed		the sudo module contains definitions to set up sudoers but class sudo is	empty and nothing actually gurantees that package "sudo" is installed	(other than ubuntu installing it by default).		fix this by ensuring => present for package['sudo'].		change-id: if3233ed70b4b4b232685f4db932e548ad1c48f56	|sudo: create module, remove old files		for the sake of structuring our puppet classes/manifests according to	the "standard" structure expected by puppet.		also:	- removed the sudo::appserver class, that was used in role::snapshot::common	  and nowhere else.		change-id: ic7e883f85b81b516b424168be2a3380dcc5f3121	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/package_builder/tests/hooks.pp,improve package_builder tests		unit tests where missing for package_builder classes and definitions so	add them. also refactor a bit the use of basepath variable while at it		change-id: i51d2ba029cd0365b5dd24ca4dbc56a1d0924b809	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/snapshot/manifests/dumps.pp,include the dumps packages in the dumps manifest in snapshot module		treat it just like all the other dumps manifests		change-id: i9a30a3d2f111388f2ad821773092fe37a40fce63	|remove 'enable' and 'ensure' class params from snapshot manifests		this is my official notice that i have given up on making puppet	clean up on removal of a class.  puppet is good for deployment and	nothing else.		change-id: i416d386b8381b6138b15da91084780964e330d5f	|basic snapshot role for dumps		set up config files dblists etc	scap3 deploy	cron job	hiera settings for things which vary from host to host	  (only one host needs to run en wiki, only one host needs to	  reserve cpus because it runs cron jobs)		change-id: i8d48878300de584bd5385a0c46b2fc0e25e5bf41	|snapshot: create a proper role::snapshot		rather than including the "role" snapshot::common from site.pp and then	including directly the classes snapshot and snapshot::dumps, create a	proper role class "role::snapshot" which is included from the snapshot*	hosts.		while at it, remove all system::role references from the snapshot	module.		change-id: idc907a518ff21db6ba0f7714191c3643d85c6998	|dumps: generate conf files for dump stage scheduler		change-id: i8db89b6a1e4d4bc6996246d221b3c6c8ad068753	|system roles for snapshot xml dumps (they have it for everything else)		change-id: i399f5c64e5213cff55850045c0351d8c37d19f34	|dumps templates, configs, dblists added to snapshot module		these were formerly unpuppetized, though sample templates	live in the dumps repo	this is the start of moving things to /srv on snapshot hosts	change-id: i1c8f2f61ff2d8986514bc75f80b678c4f4e4697a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/apparmor/manifests/hardlink.pp,apparmor: minor lint fix		change-id: i7d544879d612b4ea4876df0139c24178e7165ea1	|apparmor: lint fixes		change-id: i33181168efe1e3445dbc67f875a5c35d5b765219	|apparmor module and profile for ocg		introducing the apparmor module! whoo!		ocg uses this to sandbox itself away from the rest of the world; so	does mysql but they weren't nice enough to create a module :'(		change-id: ie440d38cd9b792e084b1f3d159a9cbcbe54f3967	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/miredo/manifests/init.pp,miredo: minimal lint fix, add comment		change-id: i1a0f35e3acec1b8b9090b186f290588abe310d17	|miredo: fix typo in source => caused by conversion		the module conversion had an error in a file resource's "source", by	specifying /files/ inside the path.		change-id: i81d04b481ca6e7b451ae82558b6366b2f503cb11	|miredo: convert into a module		change-id: i5c0eac593a143b00e72a47d443cfe9d64c627af0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/tor/relay.pp,tor: move role to module/role		move the role from manifest/role to the role	module to be in autoload layout.		use tor::relay because that doesn't cause a problem	with the role keyword (unlike for role::tor -> tor/init.pp)	and it makes sense to be more specific what it is.		also adds the comment which may look a bit redundant	but fixes the remaining lint issue "class not documented".		change-id: if0e82c8816596289129449f6ac853e39de44d7ef	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/varnish/manifests/extra_vcl.pp,re-added varnish module directly (no longer submod)		change-id: i499c01c37ce517d57fcb0178089c2ab68aace21e	|removing modules/varnish in prep for adding it as a git submodule		change-id: i3a331b40b21a506ed5e270a738ce9342084e8d6b	|varnish: whitespace & lint cleanups		change-id: ib04d9b72a6398c110dcf5c1e0d6a59b46523d132	|move manifests/varnish.pp to a module		change-id: i12f9956c9a16829b4bcf53820c5df110dc81fbb5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/proxy_jenkins.pp,contint: proxy only enabled on wikimedia.org		the proxy configuration is server wide, which cause any virtual host to	serve them (ex: http://doc.mediawiki.org/ci/ ) when we only want to have	them served from integration.wikimedia.org.		this patch moves the proxy declaration from conf.d/ directly under the	serverroot where they can be included using 'include *_proxy'.		as a side effect, that makes the bots to honor the robots.txt :-]		change-id: i022a3b086bb9822a9c123440d2e71d6056dafbc7	|contint: move apache proxy configuration to module		continuous integration has two internal webservices (jenkins and zuul)	which are exposed publicly via an apache proxy. this patch moves the	definitions under the contint module and factor out common code in a new	contint::proxy_common class.		the zuul proxy is included in the role::zuul::* class.	the jenkins proxy is included from the old misc::contint::test::jenkins	which is roughly the equivalent of a role class.		change-id: ia140f6ed7ab9dc12d41422f109750e4018211516	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/swift/proxy.pp,role: align arrows in manifests		change-id: i7f2777652de46349e175ab0e8c68a5a840e866d6	|swift: move roles to modules/role/		split the file into one file per class and move them	into the proper autoload layout in the role module.		change-id: iab6bb38b47b172e07c60de23aefa180ec3f011c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/labstore/manifests/monitoring/interfaces.pp,labstore cleanup and role vs module arrange		this more accurately reflects the module and role	schemes used for other config.  we are also staging	to have primary/second/misc nfs setups so rename as	primary and misc to that effect.		change-id: id66499d22a7f40df8174fdfab8a89e10899beb7c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/elasticsearch/manifests/ganglia.pp,ganglia: drop the "gmond" service alias		now that gmond is ganglia-monitor everywhere, drop the alias => gmond	from both ganglia and ganglia_new and adjust all call sites to notify	service['ganglia-monitor'] instead of service['gmond'].		change-id: if5dff9bd3f2032998a4712cb6d11a8e061874fe7	|'gmond' is not a puppet keyword		at some point someone forgot to quote the name of the gmond service and for	whatever reason the practice just took off. i guess gmond jobs are common	and quite similar to one another. anyways, let's put a stop to this ritual.		change-id: i6db0bdb6c4502571111b2b096100fedf6a2029d2	|setup metrics collection for elasticserch		change-id: i901c4988bdbb1654ff5a083d8cfc824d788364ff	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/tests/discovery.pp,modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/snapshot/manifests/addschanges.pp,provide and use variable names for all dump related directories		instead of hardcoding in partial paths in many manifests and scripts,	provide variables in the manifest which declares the directories	and use those.		also fix a couple badly closed variable references in templates.		change-id: i40a78843f44f3b24a4deb0355dd530c54a7f8b42	|move addschanges dumps to snapshot1007		these dumps become just one more misc cron job included in	the cronrunner role.  cruft like the 'enable' parameter gets	removed, scripts, templates and conf files are run out of the	same directory as the regular dumps.		bug: t141282	change-id: i109583619dc3f6dfaa9ac0aa86360adfb26f9f40	|snapshots: restructure directory handling a bit		* move all dumps dirs to /etc out of dumps repo area	* remove the declaration for the dumps repo dir, that now	  will be taken care of elsewhere	* move the actual dirs manifest into the dumps directory	* remove all hardcoded refs to dumps dir and replace	  them with snapshot::dumps::dirs::dumpsdir which means	  a few script files turned into templates and manifests	  setting those up were altered accordingly		* still to move: addschanges and wikiqueries dirs under /srv		change-id: i73b0072a6b50fb92a64c3bd3aa6d4ff427d5051f	|snapshot: create a proper role::snapshot		rather than including the "role" snapshot::common from site.pp and then	including directly the classes snapshot and snapshot::dumps, create a	proper role class "role::snapshot" which is included from the snapshot*	hosts.		while at it, remove all system::role references from the snapshot	module.		change-id: idc907a518ff21db6ba0f7714191c3643d85c6998	|puppetize adds-changes dumps (so-called incrementals)		change-id: ic5ec85750fc61e8d7b5ef36c311bc195467b0684	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/beta/uploadservice.pp,beta: move roles to modules/role/		- split the large file into one file per class,	  per style guide and lint		- move them into autoload layout in the role module	  and out of manifests/role/		change-id: if8f08467126ec607806c7b704f9953c96dc17e88	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nutcracker/manifests/monitoring.pp,diamond: start collecting nutcracker stats		ref t107381		change-id: i3cf6a5ce7890e889e5828f0a49c5486d7e083944	|nutcracker: move declaration to role::mediawiki; parametrize		* set owner / group / mode for config files.	* only override nutcracker's default mbuf-size if caller requests it.	* don't declare defaults. especially if they conflict with nutcracker's!	* don't assume a single server pool. nutcracker supports arbitrarily many.	  we'll probably want to exploit this to ease the migration to a unix domain	  socket (if we choose to do that).	* move declaration to role::mediawiki / role::beta.	* fix icinga alert to expect a single process.		change-id: ifb4d25506ad5dddf046c3e6ba03f30541850d2be	|nutcracker: fix username arg for service check		change-id: i3fc186b6cb38bcd2a7da110465a1c39f5571d318	|nutcracker: move config in puppet, work with new packages		we are both moving the twemproxy config in puppet, and making the puppet	class work correctly with the new package, where we repackaged nutcracker with	its proper name and with saner defaults and init scripts directly in the	package.		this config can be deployed using tagged runs as well.		this change depends on 143892 being deployed in scap.		change-id: i42ee37f1431388e9659c2f44e334ac8db67fd2b3	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/maintenance/jobqueue_stats.pp,fix getjobqueue cronspam		"2&1" results into invoking "1", which in turn results into the cronspam	of "/bin/sh: 1: 1: not found", every single minute. presumably 2>&1 was	meant, but replace it with 2>/dev/null for extra clarity/posix	compatibility.		fixup for i78116df9ab8cfd27420b69f896a62da9f03b1fca.		change-id: i620112ec29b18caa8661ef444eec89dcfdc363fb	|add a cron job for reporting the job queue size to graphite		add mediawiki::maintenance::jobqueue_stats, which provisions a cron job that	will run every minute and report the size of the job queue to graphite.		change-id: i78116df9ab8cfd27420b69f896a62da9f03b1fca	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetdbquery/examples/nova_functions.pp,puppetmaster: add puppetdbquery module		also install puppetdb-terminus that is needed for the parser	functions. the module is version 1.6.1 (the latest version compatible	with puppetdb 2.3) from https://github.com/dalen/puppet-puppetdbquery		change-id: i305fc0eea19e75c4ba0ad511e0c76a842a1ec140	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/monitoring/errors.pp,ensure_service(): fix docs, add more usage		change-id: i8ad1a6fffa691afda814ae54cb7b0fc5539ddd1e	|mediawiki::monitoring::errors: add owner/group/mode		* specify owner / group / mode on files.	* fix $ensure parameter so it correctly stops the service before removing the	  config file when $ensure == absent.		change-id: ic24369de532ba06a6251a6c7efb350a27537de67	|mediawiki::monitoring::errors: report to statsd		mwerrors.py is a script that listens to the udp log stream coming from the app	servers, picking out individual error subtypes, and incrementing the	appropriate metric. it is the script that generates the mediawiki error count	graph that is mentioned in the channel topic of #wikimedia-operations.	this patch changes it from being a gmond module that reports to ganglia to a	standalone script that reports to statsd. (we didn't have statsd back when i	wrote it.)		change-id: i4cafb0d347d9af1966a90e9baa788703bc9c2f7b	rt: 7699	|mediawiki::monitor -> mediawiki::monitoring		per <https://wikitech.wikimedia.org/wiki/puppet_coding>	also change eventlogging::monitor to eventlogging::monitoring;	eventlogging::monitor::graphite was copied from mediawiki afaik.		change-id: i866c564dbbd6e207c5725f83454de39585297d65	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/package_builder/tests/init.pp,package builder module		a module used to create a debian package builder environment base on	cowbuilder. intended to be used in labs for streamlined debian package	building. creates 4 environments to build packages in:	 * precise	 * trusty	 * jessie	 * sid		respective hooks for the environments are being installed as well and a	mechanism to easily change between environment via an environment	variable is provided. tests included, as well as a readme		change-id: ic8452ee447dcf485f6af822627cc117b3931b795	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/deployment/config.pp,role::deployment: move to role module		change-id: i32f74d90307244a36795f143c6d7369e4cbb7966	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/microsites/peopleweb/migration.pp,move microsite roles into a common place		move roles that setup microsites into one a common place.		this makes it easier to find similar roles in one place,	and it also moves more roles into proper autoloader layout.		also move the peopleweb::migration class into a separate file.		change-id: i74c16340c44318876db701ff37f84f780a40c5d3	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ores/manifests/worker.pp,ores: fix typo		change-id: i8261fa9fd3124356f8adab482c516e99e31fd068	|ores: allow customizing log_level		change-id: i5a6fadd8aa6185dad39515c00585c38710a1184e	|ores: mark all roles requiring ores::base properly		change-id: i0ed748b1feb5bbe9e9ebfd277b40c0d38528c9b4	|ores: fix typo		change-id: i1b5a1ebd62c92c816c8777431a2df7f2fa779110	|ores: fix conflict on including ores::base		change-id: i98543886a7e6e37299cafac5a78b9eb70587f4f8	|ores: worker role to do celery processing		change-id: ia8dd63709cb8aaf097881bc7f825683cf1b51ae4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/mail/mx.pp,add "lint:ignore"s for several "puppet url without modules"		just adding lint:ignore's and comments. they are also	meant as a question if these should move into a module	or not and what the plan is for files that are actually	used by multiple modules. in other places we don't seem to	mind that modules use files from other modules but we also	don't like the global ./files/misc structure and neither	does puppet-lint.		fixes several "warning: puppet:// url without modules/ found"		bug:t93645	change-id: i1f510cb37a6391698519d5fd3f1f53a960dbef86	|role/mail: split file, move to module/role/		- split role class file into one file per class	- move into module/role/ into autoloader layout		change-id: i21ea06953859a38dc105e0d4e3f012c04dfb949c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/interface/manifests/ip.pp,brown paper bag fix for interface::ip $options		this makes the regular case of no options add a double-space to the	command, which makes augeas not finding the existing entries and adding	additional "up" statements to /etc/network/interfaces. fix this by	adding an $options_real variable (ugh, hate you puppet).		change-id: i7190bf3b719f540aa5cbac832fa7395e344b803d	|mark wiki-mail ipv6 addresses as deprecated		currently due to the (broken) way ipv6 address selection works on linux	systems, it's possible that the wiki-mail-eqiad/wiki-mail-codfw	addresses get picked up as the outgoing ips for non-wiki-mail traffic.	we only want these addresses to be used when exim4 specifically attempts	to use them, under certain conditions.		add an $options parameter to interface::ip and use it to set the	preferred lifetime of these addresses to 0, thus marking them	deprecated, never to be used unless explicitly bound to by an	application.		change-id: i85a347604858c610b1d1d3c98d5d36887c04fb29	|interface: drop support for ubuntu < 10.04		change-id: ifb5f1761c63971f0d6320c3f8631b3857a325de2	|interface: lint clean		change-id: if6f91529b1656bf5c214848afb8671a2c82a8290	|s/onlyif/unless/ on interface::ip (doh)		and to think this was tested first...		change-id: i5f965598094be62bc925ef048396dd4b55364953	|fixup for interface::ip		this looked harmless but augeas made it to not be.		change-id: i5c1aad94468d9d6d1b4a09e263336822f64c5959	|silence interface::ip with an onlyif		this is another useless execve, but it's factually more correct and	helps making puppet shut up and not print a message on each run.		change-id: ie7277be80dda72453b66384048b29023f9ae6262	|rename ::interface to ::interface::ip		change-id: id5c079f7b89e358a89d7408bb57a3ea801f692c7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/backup/storage.pp,backup: use production_networks		both the storage daemon and the director are only accessed from the	production networks.		change-id: i34949f3c8f3c6a6c2b7ab7a96bdd1d236c2b88f7	|backup: move roles to modules/role/		change-id: i39e8d35f8a19b6aa23ec681cc5efcb63e91292eb	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/bastionhost/general.pp,bastionhost::general: include dsh configuration		bastionhosts are used by parsoid deployers to restart parsoid machines	and they use the dsh groups that are maintained in scap::dsh.		note that this was historically present on the bastions and then has	been removed somewhow.		change-id: ib8e603cf4f14bb6cd35ffe15deab8c3324b4d832	|bastionhost: move roles to modules/role/		split the bastionhost roles into one file per	class and move into autoload layout in the role module.		change-id: i3aa1dc550571198255ed4b2067b05c07b75ac613	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/pybal/manifests/web/dc_pools.pp,pybal: refactor pybal::pool, print pools in pybal::web		since we're moving away from out traditional schema where the pybal	pools are directly operated on via raw files, we still want to present	what's pooled and what's not pooled via an http request. so we:	- factor out the confd file generation from pybal::pool	- create the resources for all pools on hosts with the pybal::web	definition	- avoid monitoring all of those on palladium, as that's not really critical.		change-id: i30dd4ae6a0bce64c02c809e214fd868a897a97e7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/wikimetrics/staging.pp,wikimetrics: rename prod role, move to module/role		- rename production role to ::production just like	  the description right below says, for consistent	  structure, like wikimetrics::staging	- mode to module/role into autoload layout		change-id: i3c0546bcba23b81ca636ca75efe2192ed15db0b0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/init.pp,introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mirrors/manifests/tails.pp,mirrors: mirror tails as well		change-id: i7d7f4e0a645c2168436bd01c2ac4c53f4f025b87	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/apache/manifests/def.pp,apache::def: port to env-{enabled,disabled}		change-id: i4316c0cbb47f2ddd1b6e82fbd68b36e9700fa1cf	|apache2: rename apache2_test_config => apache2_test_config_and_restart		the current name is misleading, because it does not communicate the fact that a	successful config test will lead to an apache 2 restart.		change-id: idcce8723d83b2a0fc231c005d94c6a099ab484a2	|apache module: test config before attempting restart		in an ideal world we'd never deploy broken apache configs. but unfortunately	sometimes we do. in such cases, attempting to restart apache causes the service	to stop and then fail to start, which leaves us dead in the water. to avoid	that, we should run 'apache2ctl configtest' before attempting a restart.		we could add an onlyif => 'apache2ctl configtest' parameter to the	exec['apache2_hard_restart'] resource, but the problem with that approach is	that puppet will be silent about broken configs. the service won't be	restarted, but there won't be any feedback for the deployer.		so instead make it a separate exec resource that notifies the restart exec.	this way, if configtest fails, puppet will fail loudly.		also remove the status check from the apache2 restart exec. since it depends on	the service (which is ensure => running) it must be true that apache is up.		change-id: ic095c2e78a3e48a01a6d6331f49cee2850582d92	|rename: exec['apache2-restart'] => exec['apache2_hard_restart']		change-id: i2b487389858699d60a2dd70691ef5abab3d8b40b	|apache: on service refresh, do a graceful reload instead of start/stop		with this change, when puppet refreshes service['apache2'], it'll initiate a	graceful reload rather than a full service stop / service start. a graceful	reload allows open requests to terminate gracefully, and it performs a config	check before shutting down, so it comes with the added benefit of not leaving	the service dead in the water if you happen to deploy a config change with a	syntax error.		change-id: id030fef0016fdc07076bb1d375e7b9b2c9c5229d	|add apache::def resource		the resource provides a convenient way to define runtime parameters	than can be checked with <ifdefine> directives.		change-id: ifdd6d2a66c99c3f8c35cf22c8a1db537dba3bf83	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/statistics/manifests/wmde/user.pp,move statistics::wmde::user to correct dir		change-id: i89db79fa7aad8ce3d272a89ed6c1538a7d328e16	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/salt/manifests/minion.pp,force salt minion to ping master every 15 minutes		we had an issue with the minion not noticing its connection	to the master was dead. if ping fails it will try to	auth again to the master, and if after 5 retries it	fails, the minion will restart.		change-id: i161c2fa7fc41f0f486ad5d1b2a84f603d70b126a	|fix typo in contents of salt minion systemd conf file		change-id: i67a24fda8c35ab6088a71ddb5134908d57e4cd72	|restart of salt minion should not kill all subprocesses		this fixes a problem with installs on jessie which used to leave	salt minion upgrades run via salt from the master in a broken	half-installed state.		change-id: i39494dc6e3897a0eb6b576850b42db2f7c162b1b	|lower max reconnect time for salt minion		this can be lowered for neodymium to a normal value		change-id: ifd56f2d5354105d5503edddf919beb4cd8df0581	|salt minion will wait up to 10 seconds to reauth to master		the longer value of 270 was useful on palladium but not at all on	a properly managed host		change-id: i777e254bb379c5a7f8d2962c6d991cd50a6fac72	|fix up log rotation for salt minions/masters		change-id: ie386935e7248828dfebba0a9734b01d011410792	|salt minions: prefer 2048 bit key size		change-id: i9930a2f1791b1fb11120f041cbf7085d791eb448	|add salt minion recon and auth timing params for performance		change-id: i00775f5e0b1547d4be34dcefabe4c4668023aa4a	|salt, spamassassin: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i837190a9b0a49a7efd006c72dfb4b37729bf58f6	|fix salt-minion on jessie		change-id: idc8775e325c46ebb13675e9248a484db14f99720	|fix up ordering for salt-minion package, config, service		recent deb packages autostart the minion after install so	we must have our config in place before that to avoid errors		change-id: i65fb8ddb24e8d721afa2c58674a042af3486c818	|add master_key param for salt_minion module		patch to overwrite /etc/salt/pki/minion/minion_master.pub on salt	minion host to allow contact to a non-default salt master in labs.		change-id: i96534f4eb4d3172ff9e36ec0a9dfb99257c7968a	|salt: remove provider => upstart from the service		puppet should know better and pick the right provider for the init	system that the system runs.		change-id: i4a6271d930e37d671264495755efbefd165f59bb	|remove salt-minion.override		i'm not sure how i ever thought it would make sense to salt-call test.ping	*pre* start. making this a post-start stanza won't help much since the exit	code of those is ignored.		change-id: i8ea5d58b0e9a52e97e299ef1619c665aedd1e8e0	|fix-up for param name and leading whitespace in id158f154		* client_id -> id	* dedent yaml outputted by ordered_yaml()		change-id: i0369e929cf1d41bbca34275f9ab5d4a9e9c61a69	|clean up salt::minion		* don't parametrize the module for options we don't set anywhere	* use ordered_yaml() to generate the config rather than a cumbersome erb file		change-id: id158f154f3b980df5cf8bd2f5e1af272c7957572	|salt-minion service should fail to start if master rejects key		salt-minion bails if the salt master rejects the minion's key, but by this	point the upstart job has emitted the start/running signal, so puppet thinks	the service is up, and it executes things that require it, like various	trebuchet operations. these usually hang.		so, perform a salt-call test.ping before starting salt-minion.		change-id: i78da7fec86b7991f7c1119fa59dde0471a4471cb	|salt: lint cleanup		change-id: i71dc0694f0d14b7064b8e880529d6c26f3c9f31c	|ensure a specific version of salt		currently we upgrade salt using salt, but if a minion isn't	accessible, we want to ensure that salt is running the upgraded	version.		change-id: i8502fbc3c666b717705f534a0a460782ccfe19cc	|refactor salt::grain & related tool		this patch renames 'grain-merge' to 'grain-ensure' and makes it accept an	action parameter, which may be one of 'add', 'remove', or 'contains'. the	'contains' action is then used to define satisfaction criteria for the exec	resource that sets or removes the grain value.		change-id: i5c8c292ad854bd5cfa262ceedab6b87f5ae10efd	|add support for adding salt grains via puppet		example:		salt::grain{ "parsoid":	  grain => "deployment_target",	  value => "parsoid";	}	salt::grain{ "mediawiki":	  grain => "deployment_target",	  value => "mediawiki";	}		the above would add parsoid and mediawiki to a grain's values,	allowing the minions to be targeted by grain values:		  salt -g 'deployment_target:parsoid' test.ping		grain-merge ensures that a value is merged into a grain's list	uniquely.		change-id: ie75ee013412950234fc06ab7d295c9cb703b29fe	|simplify salt module		change-id: i228b3294022efa391f0f79353ac1db8a2f8f35f4	|disable dns_check for our minions		dns_check is meant for environments where dns changes very often.	our dns for our masters will rarely change.		change-id: idd3b8c387c16e359c11bba46314164c1824b1977	|add master_finger configuration option		change-id: ib818ed8919ca19b32b0cb4b2e2e55f4b93dbd758	|initial checkin of salt puppet module		change-id: i92ecf0e6bf69526bd4b26e765e7564973e258004	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/eventlogging/manifests/plugin.pp,revert "wmflib: add ensure_final_newline()"		this reverts commit 04945e956f835cb9849146db49df0559a6d28f94.		change-id: ida7f2e2c6b889cc2a04d3569bf8de5ea4e17ef2b	|wmflib: add ensure_final_newline()		if the argument is a string, ensure it ends with a final newline.	if it is not a string, pass it through unmodified.		this function is designed to make it easier to write custom puppet	resource types that delegate to file resources and that take	either a "content" or a "source" parameter.		change-id: ib1f88b11b6308900a0bf0279eaca863793f614cd	|add eventlogging::plugin custom resource type		this patch adds a custom resource type, 'eventlogging::plugin'. eventlogging	plug-ins are python scripts which register themselves as handlers of some uri	scheme and which are placed in /usr/local/lib/eventlogging. if an eventlogging	service is directed at a stream that has a uri with a scheme matching the	plug-in's, eventlogging will delegate the handling of the stream to that	plug-in.		change-id: i3feae1458e99d30e22bdcc49ab04a5eadead1168	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/tests/director.pp,puppet-lint: fix or disable remaining alignment warns		for all remaining "warning: indentation of => is not properly aligned"	lint warnings, either fix them or put a special comment around them	to ignore them (which can be treated like a fixme).		change-id: i8d105e2f22adac3413a3c5e382bf922f949ddc5e	|properly align indentation of =>		change-id: iff8bb3f36a38e26c3edeaa93b14274db0860b940	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/tests/gmetad.pp,ganglia: rename ganglia_new to ganglia		change-id: i1e92bc3e994e9a522c82b3b7c3b5136622d34250	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/labstore/manifests/backup_keys.pp,labstore cleanup and role vs module arrange		this more accurately reflects the module and role	schemes used for other config.  we are also staging	to have primary/second/misc nfs setups so rename as	primary and misc to that effect.		change-id: id66499d22a7f40df8174fdfab8a89e10899beb7c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/conftool/manifests/master.pp,conftool: add support for acls, helper scripts		* if conftool::password is defined via hiera/private, install the	  corresponding etc user and role from the conftool master	* add conftool::credentials that allows to install an etcdrc file for a	  specific user with conftool's own credentials, for read/write access	* add some helper scripts that can be used e.g. from scap to	  pool/depool/drain servers.		change-id: i08f3f6ce581c764e327f55c5cd41c1685aabdd90	|conftool: fixup for e029eda		change-id: i323b16d20836403f17638638bf6c9bd755a10650	|puppet: extract the common parts of operations/puppet git clone		since it's referenced both in puppetmaster::gitclone and in	puppet::self::master::gitclone, we extrapolate that; also we make	conftool::master work with this change		change-id: idb96c7be237096ac06bcea49dc898c6c5d49700c	|conftool: separate master role out		change-id: i1b6b8ff0a58808b26bab7d6b23802d7d0859d86a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/noc/site.pp,noc site: move role class to autoloader layout		change-id: idf3010a8e25b2dc22929b86ec8a1b42c63fae9b5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/servermon/tests/init.pp,module/role class for servermon		introduce a module class for servermon and a role class for it as well	include rspec	include tests	using the deployment infrastructure. no upstream for now	settings.py/urls.py files added	linted	tested	apache reverse proxying to gunicorn	netmon1001 picked as the server to run this on	module/role documentation		change-id: ib48a0736a1d96e24c33d7a59c75e40eb73e3ceff	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/gridengine/manifests/shadow_master.pp,toollabs: remove role inheritance from gridengine shadow		added include in the gridengine class instead		change-id: ia8093cebeac53eb27a295bbafe862c50a3a04028	|gridengine: lint fixes		change-id: i67605d493666c952d742d363a617d7720301d027	|sge: 4 digit file mode		for some context around this change one should look at :	https://github.com/rodjek/puppet-lint/issues/394	and	https://github.com/puppetlabs/puppet-docs/pull/453		change-id: i08813892edb8fad627dbd496477545fa8d1984b2	|fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|tool labs: rm obsolete gridengine::resource param		completely, this time.		change-id: i59520e85c5dbd3caabb41de24da0ea84a75558f5	|gridengine: remove redundant inclusion of parent		class gridengine needs to be included globally now, not from	within the specific roles.  removed from gridengine::master	and gridengine::shadow_master.		change-id: i060ac8346452497d6d43f6b2750f1e7b527b709c	|labs: puppetize gridengine		much of this will need tweaking and hacking; gridengine is /not/	amenable to simple puppetization because most of its configuration	lives in a bdb.		most actualy configuration bits are nooped with 'echo' at this	time while testing takes place.		change-id: i7856b65ebead6aae04777c4851ef3c7771b239f5	|tool labs: shadow master for eqiad		change-id: ieba676d0df80f6ca2752731e8d4ab9aa52cbdd64	|tool labs: omnibus fix to gridengine for eqiad		change-id: i01592d50cc17a4acb25fd2d4b70881f450ad88cd	|gridengine: lint clean		change-id: i2a502c6755aaa17b34f388de35b080c0937af58d	|fix gridengine puppet manifest syntax		... to actually use puppet syntax.  doh!		change-id: i139192203a4267ca5d0e728d03323c3c49b36d64	|fix gridengine class to be parametrized		remove reliance on a global variable for configuration (but	keep the global as default for transition purposes)		change-id: i844113e7c073a30b3afd200d2970a0cb311e44ff	|(preliminary) gridengine module		this implements the gridengine module including classes for	specific node types.  note that key exchange is currently commented	out for the labs (no support of exported resources).		future plans include ::queue, ::project and ::node types.		change-id: i86fa89222bc7661d895cf622ea0a3844786cc9ce	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/k8s/manifests/ssl.pp,k8s: use regular puppet cert path		nodes no longer use the strange role::puppet::self related	stuff, so we can just treat them like 'normal' nodes		change-id: i8c06cf8319d99bdd1f5b8cde0925ba0fedb2ee61	|docker: use ssl for the registry		also hack k8s::ssl to be more generic		change-id: iab6fe10bbbd153692d533d8ea3bfedfa6739a63a	|k8s: make ssldir configurable for k8s master		to make it work for non-self-hosted puppetmasters		change-id: iaa86977a7ed555d9179ec6b3ce45e4eaca2ba8b4	|k8s: adjust ssldir for self hosted puppetmasters		change-id: ia4d824f031f2bd2959c9c330071eb7a1bbc76e17	|k8s: default ssl usergroup to be root than kubernetes		change-id: i338cba31345e93eb8a3ab04167c46f705c0919bf	|k8s: make kubelet run as root as well		needs to manipulate cgroups and other things that	require root		change-id: i642f25fe11eb4385180b502d824a92697884cb44	|k8s: switch to running everything as a kubernetes user		change-id: i2386e6d9764ae31f993e37b6e4a76164451f9240	|k8s: setup ssl certificates properly		change-id: ie3956095ad5cedbc681666becba9edfcce9aa1ec	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ores/manifests/config.pp,ores: move config file to /etc/ores		change-id: i8f67e8370e0ee2b8173f991d774b43f7d4c694e4	|ores: scap3 deployment configurations		change-id: ia133277a17a5757f81f47fed2146e406f443c135	|ores: setup separate staging config		change-id: if03ca94060845457a34f152c1902dacfe7aad8b4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki_singlenode/manifests/mwextension.pp,mediawiki_singlenode: rename defined type		classes and defined types should not have dash characters per puppet lint.		"warning: defined type name containing a dash"		change-id: i61d66bf0397bc8c999fb5312360baa7092a44a98	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/service_unit.pp,provide override file for base::service_unit		systemd implements a two-stage lookup for unit files:	/lib/systemd/system/foo.service is meant for distro-shipped units	and /etc/systemd/system/foo.service takes precedence over that.		base::service_unit writes puppet-generated systemd units to	/lib/systemd, because the "systemctl mask" command adds a symlink	to /dev/null in /etc/systemd, which fails if we have a puppet-generated	unit present. we need this functionality to allow service owners to	prevent services from starting without disabling puppet entirely.		on the other hand, this creates a problem for packages which ship	a systemd unit as part of their debian package, but which we need	to customise. in particular hhvm: it ships a native hhvm.service	unit, but we're extending it heavily to apply site-specific resource	limits, restart behaviour and handling of environment variables.	that means that after an upgrade hhvm, is running with incorrect	settings until the next puppet run.		this patch provides support for passing an override file to	base::service_unit; the settings made in override files amend /	extend the ones provided by the debian package.		there are some notable gotchas for override files:	- dependencies cannot be overridden	- to wipe an existing setting from a vendor file, it needs to be	  reset in the override with a blank line, e.g		execstart=	execstart=/bin/foo --daemon		change-id: i101b5f817bc429d9c252e3b4c485bb3515b006e0	|revert "revert "base: provide better error messages for service_unit""		my 'y' failed, apparently.		this reverts commit d9cc85222dc51969a72ae2fa3a7f967d1f7a702a.		change-id: i68bc10e513b4445402ecfcb131f1e31d9034430f	|revert "base: provide better error messages for service_unit"		not merged on puppetmaster, and i'm not taking the risk.	this reverts commit 31385444ecba24.		change-id: if3e8f992991f529dc9a563ea6b795411d84bd060	|base: provide better error messages for service_unit		change-id: i48f07b23e9497fa23ba031bb35f0228d6cd1205d	|base::service_unit: remove old cruft		as the subject says, remove old cruft that ensure absent an older	approach to shipping unit files by us		change-id: i2131110abea8a06720b5d92ac70c3e140bfa5a88	|base: further clarify service_unit ensure		validate_ensure barfs on values other than present/absent		change-id: i7edb34e931808e968e7d16daad9df961bb606dae	|base: reflow and expand parameters documentation		change-id: ib413cc68f78ef8bb4bd01ddcac9e409a136efab3	|base::service_unit: ship systemd units in /lib		when shipping systemd unit files in /etc there are a couple of commands	that break. specifically mask/unmask break because they rely in removing	the /etc/systemd/system/<service>.service file and replacing it with a	symlink to /dev/null. however it the mask command finds an actual file	in that place, it will fail. amend base::service_unit to ship files in	the /lib/systemd/system which is the standard place anyway for shipping	systemd unit files. this unbreaks the mask command and conforms to the	standard behavior anyway.		change-id: ia600f969da73ae33bf4476d06079c5d333b4c304	|base: fix spacing / indent for service_unit		change-id: i3e0276539849ea500c89b7609f7e8c36fb9af30f	|labstore: fix boolean conditional to do actual needed check		change-id: i2f16568550775fe8843912287008f93124e6716e	|base: properly support not specifying service {} in service_unit		change-id: i9a2c49ad0dbebd39c244b279ac6a38199a4ca3e7	|labstore: add systemd units for replicating nfs volumes		- also add a param to base::service_unit to allow it to not	  declare service stanzas, which is needed in this case since	  we do not want them to autostart yet		change-id: ib8be8230011a1f3dacdf8ca026ecadb4c6037cf4	|kill exec bit on systemd unit files		change-id: i02b26d196017d74526e4f31ed4dd4250520e61e7	|add $template_name param to service_unit		this is to support the pattern in e.g. varnish, where	varnish::instance defines multiple instances with distinct names	set by the (other-module) caller, but the init file template is	common to all instances and is defined and located within the	varnish module.		change-id: if9d589c0c0ba0b522e824b1d09dc2d5dacedca10	|service_unit: allow custom init script in a single initsystem		adding the parameter $strict with a default value of true i don't change	the default behaviour, but allows to set it to false in cases where we	want to install a custom init script for e.g. systemd alone, a thing	that may happen in fact quite regularly.		change-id: i8990484cac56cb5fae891c9665756ab718d8022f	|base: add the service_unit init wrapper		the base::service_unit resource aims at being a init-system-agnostic way	to manage a service in puppet, including its own init scripts if they	are created by us. it should also take care of reloading systemd if the	service file has changed.		as suggested, it allows you to choose wether to notify config changes to	the daemon or not.		this is a (partial? good enough?) solution for t89086		change-id: i5d1472f7c737aa7a917509394ec997b8e25f6d2b	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/wikistats/instance.pp,wikistats: remove $realm check, simplify role		this will never be production, remove the $realm	check, simplify it.		change-id: i9bc1ca7723c2fec0250daf2346ac4ec2640f7663	|wikistats: move role to module structure		move the role class to module/role and give it	the foo::bar structure which fixes autoloader warnings.		labs instance(s) have to be reconfigured.		change-id: i3ce4ef5d6f0a71d78cb023016c7dd9ea87d510e6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/manifests/discovery.pp,modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/hhvm/manifests/debug.pp,hhvm::debug: brown-paper-bag followup to i383bd23196		change-id: ib298aede326a99fcab15a5855db2e3f3d75ec7f9	|hhvm::debug: jessie compatibility		bug: t131749	change-id: i383bd231962bee1c1fb44c9c5730e62f46cdbe70	|hhvm: declare /tmp/heaps in init.pp		fix-up for ibb816474f3		change-id: idac024bd45c5245bfcada1d0f424be2d4fd9289f	|hhvm::debug: change owner of /tmp/heaps		otherwise, hhvm would not be able to write to it.		change-id: ibb816474f345de518262d8fe154deb7eeadb2bce	|hhvm: add memory leak isolation scripts		this patch adds two shell scripts i wrote based on my experience in t99525 and	t820. the two scripts are designed to help isolate hhvm memory leaks. the	first, `hhvm-collect-heaps`, enables jemalloc heap profiling and writes a heap	dump every 10 minutes to /tmp/heaps. the second, `hhvm-diff-heaps`, uses	google-pprof to subtract each diff from its successor, which shows where memory	was being allocated in the intervening time between the two dumps.		i tested both shell scripts and linted them with shellcheck.		change-id: i633613a3ec218ec7577dda35e136afdcb70197ae	|move idiosyncratic gdbinit to /home/ori		change-id: id044d14dcbb568ee31abd6ed1bc6a0c7a7d64e87	|provision hhvm source tree in /usr/src instead of /usr/local/src		when i introduced install-pkg-src, the debug symbols for hhvm referenced a	source tree in /home/joe/hhvm/hhvm. more recent packages were built with	/usr/src/hhvm instead. i previously normalized both variants to	/usr/local/src/hhvm using 'set substitute path' in a global gdbinit.	since we're getting rid of that, the simplest way to ensure source code context	is available to gdb is to simply provision the source tree in /usr/src and thus	eliminate the need for source path substitution.		change-id: id1d40d5cb12dd9f4d1ba4d969a39530fc09c6738	|hhvm::debug: provision perf-tools		change-id: i5107eb603c13636bed93e890b4caab58ad43d67f	|hhvm::debug: add apache2-utils		for `ab`.		change-id: i465cf54a844b36b4f230ca8544c36dd6e582b076	|hhvm: add hhvm_health ganglia module and hhvmadm script		* report the metrics provided by the /check-health endpoint of the hhvm admin	  server to ganglia.	* provision a simple shell script, 'hhvmadm', that helps with calling endpoints	  of the admin server from the shell.		change-id: i79d247d2702cc131224f2c3433fd784567cf66b4	|consolidate debugging-related configurations in hhvm::debug		the various tidbits designed to make debugging hhvm more pleasant were clogging	up init.pp, which i'd like to be a concise description of the things that are	absolutely essential to the setup (rather than peripheral to it, as the	debugging helpers are). for that reason, introduce a separate hhvm::debug	module, and move the debugging symbol package declarations there, too. since	this leaves hhvm::packages practically empty, move the hhvm package	declarations back to init.pp.		add a fix to a libstdc++ pretty-printer and source hhvm's pretty printers in	/etc/gdb/gdbinit.		change-id: ie3e5f6cb158e89dd4aaf0fe765bc39e2306ce8e3	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/interface/manifests/up_command.pp,interface: drop support for ubuntu < 10.04		change-id: ifb5f1761c63971f0d6320c3f8631b3857a325de2	|interface: lint clean		change-id: if6f91529b1656bf5c214848afb8671a2c82a8290	|cleanup, migrate the remaining interface_* stuff out of generic-definitions		change-id: i6f0eabc40f2ea6c003e2047f086fc8210a7f987d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/mysqluser.pp,add system => true to mysql_wmf::mysqluser		the only "mysql" user invocation across the puppet tree that isn't a	system user. the class seems to only be referenced by pc100x boxes.		change-id: iacd89800d72512511dcef20f235adab806fbf4a4	|mysql_wmf - autoload layout and lint fixes		move classes into autoload layout	fix lint warnings		change-id: ie7510e8c90e365f43ce621c3f524aa1e87e2c584	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/maps/slave.pp,maps: set up postgres replication lag monitoring		add an nrpe check used to check the postgres replication lag. add	critical/warning thresholds of 10 and 5 minutes respectively		change-id: i6692d472aacd85b23db2c4ce50c86834d0fa6959	|move everything postgres-related out of role::maps::server		this decouples database from kartotherian and allows provisioning	them seaprately. i need this for testing in labs but this could	also be useful in prod.		change-id: i4bce77574b3492c3e3487efc6a304ceae6707a0f	|maps: move roles to modules/role/		error: role::maps not in autoload module layout on line 4	error: role::maps::master not in autoload module layout on line 45	error: role::maps::slave not in autoload module layout on line 90		moved "role::maps" to "role::maps::server", but it seems like	only maps::master and maps::slave are used?		change-id: i2a44ee9c026d4290b932d8ccac15410fb6d4b00e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/apache/manifests/site.pp,add apache::conf		* i moved the bulk of code in apache::site to a new resource type,	  apache::conf, which can manage either a sites-{enabled,disabled} config file	  or a conf-{enabled,disabled} config file.	* i made apache::site be a thin wrapper around that.	  (why keep apache::site at all? because it's clearer and neater than	  "apache::conf { '..': type => 'sites', ... } ".)	* since the module now manages files in conf-enabled as well as sites-enabled,	  declare the former directory too and manage it in the same way.	* conf-enabled/* is ubuntu 13.10+; prior releases use conf.d/*. so provide a	  small shim for older versions, in keeping with the philosophy of seamless	  cross-compatibility.	* also remove unused service_enabled param and .gemfile, .gitignore,	  .travis.yml files.		change-id: i5bf6186d70e47cfc04e9d78da145d5f82b08504d	|add a lightweight apache::site resource		learn from the past and avoid creating a whiz-bang resource that tries to do	too much. instead, introduce a very lightweight apache::site that is little	more than a thin wrapper around a file resource. compared to a bare file	resource, using apache::site will give you filename normalization and automatic	dependencies and notifications.		change-id: i354355ef5c7c1d5a94f19680a04486c06fff1d95	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ircyall/manifests/init.pp,ircyall: stop using package=>latest		updates in production are managed centrally and in labs via	unattended-uprades.		change-id: i070153c6ec4c900959f6c519745f3cbebde20cc0	|uwsgi: add python3 support		remove explicit mentions of uwsgi-plugin-python3 from the various	classes throughout the tree using the uwsgi class directly or indirectly	(via the uwsgi::app)		change-id: i024017d680ba6e4661e32fe8f5932e1e52cd2621	|ircyall: fix top-scope var without namespace		./modules/ircyall/manifests/init.pp		warning: top-scope variable being used without an	explicit namespace on line 16		change-id: id341ef145226fce2b513c0d42672777f677a2847	|ircyall: migrate to redis::instance		change-id: i455a58e150dd039a41ff7d725da432091401e5fc	|rename ::redis to ::redis::legacy		the redis module is not very good, and not capable of provisioning more than a	single redis instance per host. at the same time, the redis class is used by	about a dozen different modules and roles, so just going to work on the module	with a pair of pliers and a blow torch would not be safe.		so, what to do? one option is the '.*_new' pattern -- that is, introducing a	'redis_new' module and leaving the old one untouched. the problem with that	approach is that the imagined glorious reunification never happens, and we end	up with code duplication.		what i propose to do instead is this:		- move the contents of the current ::redis class to ::redis::legacy.	- add a new, empty ::redis class.	- update users of ::redis to use ::redis::legacy.		this should all be a no-op.		in a follow up patch, i intend to move the resources that would be common to	all instances in a multi-instance setup to ::redis class -- for example, the	redis-server package, the /srv/redis directory, etc.		i think this strikes the right balance between implementing things the right	way and maintaining compatibility with existing code.		change-id: i90842b834563cd7113548ae29e050bddf334f05c	|publichtml,ircyall: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i91fa0887eac78bd4027d7e464a25b07f0900d641	|ircyall: introduce module for web2irc relay		change-id: i54b9e730d2e12d310c1b1162417d33d8b00284a9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sysfs/manifests/init.pp,sysfs: puppet always restarted the sysfsutils service		whenever using sysf::parameters() or sysfs::conffile() puppet ends up	attempting to start the service over and over again:		    debug: executing '/etc/init.d/sysfsutils status'	    debug: executing '/etc/init.d/sysfsutils start'	    notice: /stage[main]/sysfs/service[sysfsutils]/ensure: ensure	            changed 'stopped' to 'running'		the reason is the sysfsutils service does not have any permanent	process, it merely applies settings based on configuration files.	additionally the init script lacks a status command.		sysfs::conffile() does notify the 'sysfsutils' service which is	sufficient to have it restart.	sysfs::parameters() relies on sysfs::conffile()		service lacks a status command, and it is meaningless. override it with	/bin/true to skip it entirely.	have the service start on boot (enabled).	optimize restart when notified by setting 'hasrestart'. puppet will then	invokes 'restart' instead of 'stop' and then 'start'.		change-id: i8006166ba0e31f666d2790af9afc4d556ae4b4fd	|fix sysfsutils service metaparameter		ensure and not refreshonly		change-id: ic1ddd497f9ee00934907cdda51a87e06fe904bda	|add sysfs module, to handle /sys settings		copy the sysctl module to a sysfs module as their function and usage are	very similar to each other. this allows us to set arbitrary /sys values,	similarly to how we handle /proc/sys values.		note that support for /etc/sysfs.d was added post-precise, but we have	backported those changes in our own, internal version of sysfsutils for	precise.		change-id: i39d3004299f4bba4ae8142d96e1ce3c793119365	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/maintenance/updatequerypages/cronjob.pp,mediawiki/updatequerypages: move defines out of class		change-id: i24da60749b999c57ece8283888d40af9d4404084	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/admin/manifests/hashuser.pp,admin: stop passing around a huge data structure		our current puppet catalogs are huge becuse for every group and every	user we have a specialized copy of $::admin::data, which is a very large	hash indeed. use direct references to it instead.		change-id: i526f659dccabb1726c7dda14b3a50cc6fd5a0828	|admin: rename "privs" to "privileges"		currently, the "sudo" module is using "privileges", but the "admin"	module is using "privs". this is confusing, so pick one of the two.	since "privileges" is more explicit (and the "admin" module even	iterated "privs" into "privilege"), keep that one.		change-id: id4e793cf41b05b8e9bbe98ebd47ebc63fc9bb00d	|admin: puppet lint fixes		change-id: i809afb19a74926f303ebb47bc128fcf2a76f3d96	|admin module for user/group/permissions cleanup		users/groups/perms are meant to be defined in yaml.		applied like:		yaml:		  groups:	    test1:	      gid: 1	      members: [foo]	    test2:	      gid: 2	      members: []		  users:	    foo:	      uid: 1	      ...		.pp	  node /foo/ {	    #groups create their users (can overlap) and permissions	    #as well as system groups and handling user membership	    class { 'admin': groups => ['test', 'test2'], }	  }		more info see: admin/readme		change-id: i6982bfced50a22faac37246dff4d52ff163a34ed	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/debconf/manifests/set.pp,split off module debconf out of the generic module		debconf is a software on its own and despite this module only useful to	containg a trivial single definition, it's still better than a generic	module.		change-id: if616b401ec219bb08eb24276aab310223bf496b9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/locales/manifests/all.pp,ignore some warnings about case statements without default matches		bug: t87132	change-id: i841bd27e66887d9e71f158bbbe15fc4a5efcc135	|locales: add locales::all, debian support, purge		add a locales::all support for future use. add --purge to locale-gen's	exec as to purge non-configured locales, useful for system upgrades and	such. finally, add support for debian, which is a tiny bit different	than ubuntu.		change-id: i2cf856ff980848ebf01e179d1fe0ce6a4350657b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/client/job.pp,fixed spacing and alignment		this fixes lint 'two-space soft tabs not used'.		change-id: i78aae2a826ba663711964faaea9040247cd0022e	|fix indentation in various files		change-id: ib442c919c46f5ec0176de46e10f0d51a2aa94afe	|bacula: allow mysqldumps to be kept locally		should a local_dump_dir parameter be defined and mysqldump version is	using keep a dump locally in the machine in the directory defined by the	parameter. while at it create rspec rules for it		change-id: ib13604d83dd2a47467da41e6d6a01f9346b211f9	|fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|bacula: lint clean		change-id: ifa52cd25ca01f73228243b797dff6eea2ea124bc	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/puppet/params.pp,increase puppet-run interval from 20m to 30m		we're having load problems on the puppetmaster lately, and this	should help us cope until we do something better about it.		change-id: i0b57c7b186de7ad3ac1329ffa9d2e3709bb2860b	|split base::puppet to it own file. amend puppet freshness check		while at it also create a base::puppet::params file holding the various	configuration variables. do this to allow the usage of those variables	in other parts of the code as well. use that in base::monitoring::host	to enable warning/critical alerting threshold population		change-id: i8a38b93328fb6925fbe2026b9757291904f5cb8c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/logstash/manifests/input/redis.pp,logstash: add support for redis password		support providing a password for connecting to the redis server.		change-id: i6b2c594b646cd12ebee7f443ae8e21256b1e3f42	|logstash: fixes and tweaks		- make logstash inputs resources, not classes. there is no hard reason why	  logstash couldn't be configured to consume from multiple redis instances.	- change logstash::conf resources in role class to use underscores rather than	  dashes, which are problematic in puppet resource names.	- move elasticsearch package definitions to a class, elasticsearch::packages,	  which can be included multiple times.	- let the elasticsearch package create /etc/elasticsearch, and have	  puppet-managed subdirectories depend on the package as a way of ensuring the	  parent directory exists.	- rather than a discrete readme file resource, make it part of the conf.d	  directory resource.	- rename $config_file variable to $config_name, since it is not the full file	  name.	- make logstash::conf depend on conf.d rather than the logstash package.	  (the package doesn't create conf.d; we do.)	- leave owner / mode / group unspecified when puppet's defaults will do.	  specifying them explicitly makes it seem as though there is some hard reason	  why they must be set to these values, when instead the intent is simply for	  the files to be uniform with other files in /etc.	- don't use a pointless $config_dir variable when it is hard-coded anyway. it's	  easier to reason about manifests if you just have the string literal to stare	  at.	- make 'ensure' param first in cases where it was not.	- store "http://${host}:${port}" as $uri var for concision.	- provide a more descriptive comment header for the logstash's init.pp.		change-id: i3d016458826fa64031cf8e918c50437cdb468868	|remove unnecessary reference to logstash class		the configuration subclasses don't reference variables from the logstash	class, so there is no need to include or require the class within their	scope.		change-id: id3aa3f4017cd994fcad04df68218617ffe82fdc3	|fix circular dependency in logstash::conf		make logstash::conf declarations non-virtual and remove dependency of	class[logstash] on logstash::conf.		change-id: id190808ac003fac937ea1f941ef7e9481d6db8c6	|logstash puppet class		puppet class to install and configure logstash. this class assumes that	a logstash package exists in apt that is built from the debian package	components specified in the logstash github repository.		change-id: i18800e66b55ad9eb28acae160c88a2b9867231aa	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/tests/puppetmaster.pp,puppetmaster: lint-ignore layout in test/puppetmaster		change-id: ia154d242d96e9fdc0c218c110dc69bb37e2214df	|fix a couple of puppetmaster failing tests		ci might try to parse the tests and trigger on the failing imports.	remove them as they are no longer required		change-id: i6c3dc5510b4029d209eea1837d1ba8c9b2ba7306	|puppetmaster: puppet-lint fixes		change-id: ib2526afffd7270eee0432bce18e12ec396f8ae7b	|puppetmaster tests: remove broken includes		the files nagios.pp and backups.pp do not exist anymore	at this location. so there are just errors about missing	includes if you try to touch these files otherwise.		change-id: i338efaa299b0a8df921f31253808c931fa7158f9	|modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/tests/client.pp,revert "revert "bacula: rename mysql-bipe to mysql_bpipe""		this reverts commit 9d5338cf9f91122023bd5b9e4ce0104dfd34b021.		change-id: ie4a7f90bb3687bb8925a1241638d16e248a0305d	|revert "bacula: rename mysql-bipe to mysql_bpipe"		this reverts commit 91ab0db3f890a6880251ec907bea88b57b885f8f.		change-id: i5851863d1d9821f9c933b2eb5107a3417c89b469	|bacula: rename mysql-bipe to mysql_bpipe		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		change-id: i33e28d0342a19f881618b3fd7676043823db8a02	|bacula: lint fixes		change-id: id6584d139ec6f69bb71c2f217fbfea7d9b04bcc6	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/syslog.pp,use hiera to configure udp2log endpoint for ::mediawiki		partially revert iaa23f0e by restoring a class parameter for ::mediawiki	that allows setting the udp2log destination host and port. a default is	given in the class that will work for production and is also mirrored in	hiera. for the beta cluster, we will be able to set the destination via	[[:wikitech:hiera:deployment-prep]] to point to any host we choose	without requiring puppet realm switching or other hacks.		bug: t1295	bug: t74275	change-id: i4289fd81bd081c258153e79a3df9b5bcf0c4d417	|mediawiki::syslog: add docs		and touch-up the docs for mediawiki::cgroup		change-id: i0510d38714e43c32e7ccbfbd4e637d14d655c562	|mediawiki: use 'udplog' service alias instead of hard-coding fluorine		in production, udplog is a cname for fluorine.eqiad.wmnet; in beta, there is a	'udplog' instance with the relevant role applied. so 'udplog' will point to the	right location in both cases.		change-id: iaa23f0ee8dffebb149ceaf12d0da2f8d96e16585	|mediawiki/hhvm: log fatals to fluorine:/a/mw-log/hhvm-fatal.log		* remove hstr python script. it's not useful at the moment. it can always be	  ressurected later.	* set hhvm_trace_handler to "/usr/bin/logger --tag hhvm-fatal --file ".	  this will log the fatal to syslog with the 'hhvm-fatal' tag.	* configure mediawiki to forward syslog messages tagged with 'hhvm-fatal' to	  fluorine.	* rename syslog.pp's 'apache_log_aggregator' parameter to 'log_aggregator', to	  make it clear that it is not apache-specific.		change-id: i98f9fc20cbe9c32ddee04a77427e06446e2f6de1	|add rsyslog module and port existing usage		* make puppet manage /etc/rsyslog.d recursively.	* this means that packages that include their own rsyslog.d config will need	  to have that config file declared in puppet or it will get clobbered on the	  next run.	* this is the same decision we made with respect to sysctl.d.	* per apt-file, the set of packages with rsyslog.d files are:		   arno-iptables-firewall, cloud-init, gforge-shell-postgresql, maas,	   maas-region-controller, mythtv-common, octopussy, postfix, qpidd, sagan,	   sympa, ubuntu-orchestra-client, ubuntu-orchestra-logging-server, and ufw		  we don't run any of these in production. (we do have ufw installed because	  it's part of the 'standard' tasksel task for ubuntu, but we don't use it.)	* remove reference to i-000003a9.pmtpa.wmflabs:5544 as a syslog sink for	  non-beta-cluster hosts; the instance no longer exists.		change-id: ibceb48bd8c475696b900e89f38dea686394069d8	|consolidate applicationserver and mediawiki modules		fold ::applicationserver into ::mediawiki.		change-id: ie0807c7069498ea4a38d3bf093e27c990dc83147	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ganglia/views.pp,remove misc/monitoring.pp, remove import 'misc/*.pp'		remove misc/monitoring.pp, rename and move all the classes	to ganglia::views in the ganglia module.		this also removes the entire import 'misc/*.pp' from site.pp	because this was the last file in there. there is even	an error if i don't also remove that at the same time.		http://puppet-compiler.wmflabs.org/3244/uranium.wikimedia.org/		change-id: ie62b3041a6eae5aa06f7f172d80d223b10194cce	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/spec/fixtures/manifests/site.pp,adding bacula module rspec tests		change-id: ie075c20329b09d606b43aa35c37ded4af2bec321	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/client.pp,mysql_wmf - autoload layout and lint fixes		move classes into autoload layout	fix lint warnings		change-id: ie7510e8c90e365f43ce621c3f524aa1e87e2c584	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/manifests/role/db.pp,role::labsdb::manager: move under the role module		move the role and its files under the role module		change-id: i533cca1656b6bd32ed4f6a86374706cf4785837e	|add lint:ignore's for remaining files outside modules		these are all the remaining files that are not in modules	that don't already have lint-ignores or have been moved.		yea, that's all.		bug:t93645	change-id: i504b3f7bfccd2ddc12bf69fc9e36680f00cd3be7	|move scap-specific items out of mediawiki class		remove scap-python dependencies from the mediawiki module. create a main	scap class containing all python dependencies and scap package	installation. add a scap::target class that includes a ferm rule that	allows for scap deployments.		bug: t116606	change-id: i3ffe759730cc934a9282be91383d9dbd19a6b275	|adding tendril::maintenance class		this puppetizes the cron jobs that are currently running on	terbium, related to refresh some statistics about tendril.		this module has also been added to mariadb::maintenance,	and this one is being applied to terbium (and temporarelly,	to a separate mw host).		change-id: i8b5e6c6c0073804188ac562eb8839ce9157491ca	|lint: double quoted strings pt.1		these are fixes for the specific puppet-lint check	"double quoted string containing no variables".		once all of them are removed (not hundreds, just dozens)	we can re-enable that check again.		change-id: i385a9da5d1c272ff853113ab554e7926dc2f2731	|get rid of redundant and confusing $cluster defs.		also a couple of fixes where:	- one definition in site.pp was wrong	- $cluster gets tampered with in the kafka role.		change-id: i6ca776039260a800555302a1468e2ecc74f9856c	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|db: lint role		change-id: i90406592f22c5c6021d9f36551a9abbe6a5c9840	|added the system module and the system::role class.		also, massive search and replace!  s/system_role/system::role/g		some other things will land in here after while.		change-id: i1000245464fca3e0e98184f790fe01e7d6e98525	|fix up path for skrillex.yaml.erb (now in mysql_wmf module)		change-id: i1ce990687f59b0e7f2a3d6298f3a467c9dea2eed	|remove generic::mysql::packages in favor of mysql module		change-id: ic7ba3ff1fb48df962af7f369bd93d26caaf68501	|one more path fixup for icinga/percona files		change-id: i7468f3b98678d600c848abc27c8cfbf9b99d1664	|update path for icinga/percona files (now in mysql_wmf module)		change-id: iaeda762bfd1cc72e9fc4b41693912ec096ab0362	|db maintenance role for terbium		change-id: ia2892a373cc059387701b907cb86f6248973f08c	|detabify some files (in prevision of real changes)		change-id: i4490608c5f5dc5e4319de311ac44acad0baf8904	|make skrillex.py executable by wikidev group		change-id: i119fcefb7f3a16a3fae46fa3a9d60f8a367498fe	|template needs correct name		change-id: icdf41b2b58744fdd3254fd14341e1607a500c3ea	|adding a labsdb management tool and asociated class		change-id: if626c9bbab6f16847c95ab1584ec0560d5949939	|updating labsdb role class		also whitespace		change-id: i42322b9ee3be78c8a6f636e1b03bb5fca564bbf1	|including cpufrequtils in the sanitarium/labsdb db class		change-id: i927a757e4b45aa3dd094dcc79a0f7e87a2bc7c8a	|adding per-node and per-instance monitoring for sanitarium		change-id: i6a271b03474c55da9016e8884dd07fa304850d46	|trying the binasher namespacing model		also, yes, i need better variable names. i'm bad at it		change-id: id07ac77a50b7fbe1575d9edd4bb8826a24b9329d	|using correct metavariable		change-id: ic5c2d102f16f3a2bd5a60a303af03395512ebfd9	|correct usage of $title var for multi-instance mysql		change-id: icbf7e56784fcb1604607d4546834384f81a475f4	|really basic module for multiple instance of mysql on a node		needs some more work, monitoring, white space, etc		change-id: idc956372f31906e72a582a377c5ff90ade595248	|insufficiently abusable, it would seem...		change-id: if09e6a57cff1346a1f6f035162ea7b7e091111f9	|let's see just how abusable puppet is....		change-id: i81a3961ffb3f218f10c6f2ae1b87ad1c9dd6014b	|oh yeah, need the datadir...		change-id: i9014359f939b1658c551eeea133599364b585e30	|have to call templates correctly...		change-id: i68d900076fe3ac6ff42d0c2e5f2d2a953a19b562	|invoking mysql::config correctly		change-id: i47f9055d7e67ae14932118f4348fad58dbe1015b	|also need correct typing		change-id: ibcfe6f1a26a536567669a5c84252308ed47f0696	|correcting inline_template for sanitarium db def		change-id: i42fd494a67c17b5f2d6d7de5334ccef23fae4ca1	|wip: first bit of stuff for taming the mysql module and making the sanitarium		change-id: ifb7c6a717812906d584fe2a79fc7a507cf7fd45e	|moving all stuff in the ::mysql namespace to ::mysql_wmf		this is to import the honest to god puppet forge mysql module		change-id: ieb2aad9789eb21ae8e333e58a97a7ae71ad0c311	|merge "removing a whole bunch of unused db code" into production|moving mysql nagios group resources to coredb.pp		change-id: ifec8aff51a9f26eccb6f5181d7243223e08c29cb	|removing a whole bunch of unused db code		change-id: i3890abd8c4d24a7b5397fd9da2eadb495d3b3743	|new coredb module.		change-id: i70dad6a267dad1c15ee7b8a8aad1d72c79669018	|fundraising db config cleanup		change-id: i607d4ff02f8711d8c7372d897d614eae3407944b	|switch fundraising hosts to fundraising ganglia and nagios clusters, additional banner logging		change-id: if5269bcb5468358199d6e2213564466c6965ad23	|addin an es_eqiad nagios group		change-id: i759baa4846a47a4741c49cd7e10c28645a986707	|moving db role classes to role/db.pp.		also renaming to role::db::(core|es) and moving the nagios group	definitions to role/db.pp		change-id: i104597ccc465fa7a328243674f50c0b364b191da	|oops, modified wrong filename . . .		change-id: i852c4f6e4c98cd0bab0ee484d5a0ebf962813b2a	|setting up for host-specific /root/.dump_fundraisingdb config files		change-id: i9d89827030f2709b3b0cf761d09889fd33dabb6a	|fixing fundraising db nrpe checks		change-id: i39858989b49d34c368f70ab510fb7563a1b2f962	|fixing mysql fundraising checks to use nrpe		change-id: ia8ff55325ca4e0728d8cde00ea3a1d5a79ada6cc	|added conf file for fundraisingdb dump script		change-id: icccbb10a80b545c514a0168880b637550f3d7998	|added role::db::fundraising::dump class and applied to storage3		change-id: if3bdadba4fd4d28e93b0431d8639f0e19de24254	|attempting to establish a role class and start by moving fundraising db	stuff there		change-id: if3b8bc5011290183ea63cb6f41123eea41166c20	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/servermon/wmf.pp,followup fix for 450a2e6		move the template in the role module as well		change-id: i43a1797965d6483163f66c6c9a6ae0886ec0b48a	|servermon: move role to module, add system::role		moving the role class into module role and to a foo::bar	structure fixes autoloader lint warnings.		adding system::role for motd like the other services on netmon1001 have.		but if i do this i also have to reconfigure some instances at		https://wikitech.wikimedia.org/wiki/nova_resource:servermon		probably.		change-id: i43762fc0996335538a86b12e31a91eebfa03824c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/tmpreaper/manifests/init.pp,rename file_line resource in tmpreaper		fix-up for ibc013bbf583406.		change-id: i1128727aab2747475c38761ebade6b688c1f9747	|add tmpreaper module		adds a tmpreaper module with two custom resource types:		* tmpreaper::dir adds a directory to the set of directories which are 'reaped'	  by tmpreaper during its daily cron run. it does so by appending the directory	  to tmpreaper_dirs in /etc/tmpreaper.conf.	* tmpreaper::reap allows a path to be reaped by puppet, like puppet's native	  'tidy' resource, except not insanely broken. this may be used when the age	  setting or other settings in /etc/tmpreaper.conf (which are applied to all	  directories) are not optimal for the given path.		change-id: ibc013bbf58340664213273bbb97954e5a1e08f9c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/params.pp,mysql: fix the last double quoted strings		change-id: i1e402647da1bd4fb8980226cee207e96ed9f713e	|mysql: drop lucid support!		precise has 5.5 and so do trusty and jessie		change-id: i3e4a01d79e5bdf90630d3ef9e43fbca45b1d9396	|mysql: add jessie support by fixing conditional		change-id: ideb05d0764ccf8fc41161030bee12772088ea53c	|mysql: cleanup mysql::param		- remove support for oses that the wmf isn't going to	  be using anytime soon (freebsd?!)	- use $::initscript to figure out service provider		change-id: i1c01360829c7075cc211d17c0b718a9eeaa1e73e	|mysql: remove ubuntu 11.10 conditional for /run		change-id: if397522280ab8326a8e9e5aae1bfd01d61aea61c	|mysql: lint fixes		change-id: iad6ffec74cb57a7031932b0e790e8d90b1992c80	|pick the proper mysql version, depending on distro		change-id: i80ad0abf9cbbe7e277406ae4468dc9fbb255e43c	|rearrange mysql module my.cnf defaults.		this makes them somewhat closer to what generic::mysql-server does.		change-id: i02fbdd2e7d2ecb189427cb1c8581c262171d119c	|catch tests up with local changes to this module.		change-id: i83ccd13788bf54a2cd95d039621b7845020af4e4	|wip: first bit of stuff for taming the mysql module and making the sanitarium		change-id: ifb7c6a717812906d584fe2a79fc7a507cf7fd45e	|initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/html5depurate/server.pp,add html5depurate module and role		change-id: i606a3645b865ef5d9c96c8f44b0f0cc4b9e3122b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/manifests/xml_generation/cdn.pp,r::c::config::active_nodes -> hiera cache::$cluster::nodes		this breaks torrus module testing (still relies on local copy of	$r::c::config::active_nodes), but given that torrus cdn stuff	doesn't seem to work in practice anyways, and that the modules	shouldn't have this data access directly either, i'm not too	concerned to merge over it.		the changes for role::ipsec and role::analytics::kafkatee pass	human inspection of "looks right", but neither one is actually	applied on any real host currently (for the data access in	question), therefore can't be compiler-tested, but also wouldn't	break any live node and can be sorted out if necc when one exists	in the future.		the rest all checks out in puppet-compiler and seems to work!		change-id: i06f3fecf610524e14fd9256c9477931a735419b8	|torrus: remove stray characters in file causing failures		change-id: id1306556e328f3eba6539e003d568c6ef35a4ea3	|modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/geowiki/manifests/private_data.pp,fix git::clone umask issues t87843		change-id: ifb3935d6ac310114d724ac6366255e583785c6f8	|create geowiki module		this commit finally removes misc/statistics.pp!		change-id: ib36c02b36a4bd4cb4e4ee8293108fe61754aba94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/vagrant/manifests/plugin.pp,add role::labs::mediawiki_vagrant		add a role and modules to provision and configure vagrant to manage an lxc	container to run as a mediawiki-vagrant instance.		* create a new trusty instance (doesn't work on jessie)	* apply ::role::labs::mediawiki_vagrant	* force a puppet run	* log out and log back in to pick up profile.d magic	* cd /srv/mediawiki-vagrant	* vagrant up	* setup wikitech to proxy to :8080 on your vm	* profit!		requires: i343c8da6e345933e29f92523638d3b19e133894b	requires: i0ee0caf19019ce6415519561ff33b3453b310468	bug: t106213	change-id: i04cfa3d143cad92b2be57d3813f0b09ecfb45bf5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/requesttracker/manifests/config.pp,turn rt from misc/* into puppet module		move rt from misc/rt-server-apache to module	structure		add role class, move variables into role,	formatting, quoting, misc..		seperate into classes by function:		- packages	- config	- forms	- plugins	- apache		move all the apache related stuff together,	make separate file for installing more plugins,	same for the password reset form which still has issues,		move the files into module and fix "source"s		move the templates into module and fix "content"s		add monitoring		remove 2-spaces,.more..		change-id: ib0e7476a612b25f37905f9f475521606d3bb73d7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/client/mysql_bpipe.pp,revert "revert "bacula: rename mysql-bipe to mysql_bpipe""		this reverts commit 9d5338cf9f91122023bd5b9e4ce0104dfd34b021.		change-id: ie4a7f90bb3687bb8925a1241638d16e248a0305d	|revert "bacula: rename mysql-bipe to mysql_bpipe"		this reverts commit 91ab0db3f890a6880251ec907bea88b57b885f8f.		change-id: i5851863d1d9821f9c933b2eb5107a3417c89b469	|bacula: rename mysql-bipe to mysql_bpipe		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		change-id: i33e28d0342a19f881618b3fd7676043823db8a02	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/apt/manifests/noupgrade.pp,apt: lint clean		rebased		change-id: i1631f322f4a0131d76ea6d00060f562ccd9702a9	|remove update-manager-core in labs		update-manager-core has do-release-upgrade, which breaks labs	instances. if we remove it, people can't break their instances.		change-id: if6f6eacce1e5753a716a35c2482d5cfb04f26859	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/statistics/manifests/user.pp,change stats user git email address		this updates it to match the one in gerrit		change-id: i84aed5f87069113e85793408f33c7cfa4b9f022e	|puppet-lint: fix or disable remaining alignment warns		for all remaining "warning: indentation of => is not properly aligned"	lint warnings, either fix them or put a special comment around them	to ignore them (which can be treated like a fixme).		change-id: i8d105e2f22adac3413a3c5e382bf922f949ddc5e	|statistics: lint fixes		fixes more puppet-lint warnings	for t93645		change-id: ie3adcc01011acaed04ee41331263ed0c91c0172c	|first commit in a multi-commit effort to move misc/statistics.pp into modules/		t87450		change-id: i49140d85ddea99f5d4d9a3c71e60cf7fa57d49b6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/director/fileset.pp,bacula: allow mysqldumps to be kept locally		should a local_dump_dir parameter be defined and mysqldump version is	using keep a dump locally in the machine in the directory defined by the	parameter. while at it create rspec rules for it		change-id: ib13604d83dd2a47467da41e6d6a01f9346b211f9	|fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|bacula module fixes		bacula::director::fileset excludes parameter gets a default value of	undef. templates fixed accordingly	documentation fix		change-id: i2ec71a8fc9f1c02f51e774d01b8273e3085bf373	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/geoip/manifests/data/package.pp,geoip: remove the broken geoip::data base class		inheritance in puppet doesn't work like the author thought it did.	remove the base class altogether and replace it if !defined clauses for	the single useful resource that the class container.		this removes the instantiation of the /usr/local/share/geoip symlink	too. this was broken (as by the original intentions it'd make symlink	e.g. to volatile on puppetmasters) and a bad idea anyway, we should fix	the scripts if the need arises.		change-id: i1041c895de2a4877f788248b0330d840715f1462	|move geoip to a module.		functionally, this works the same as before.	wmf specific puppet configs (volatile, etc.) have	been removed.  these are now passed in from classes in	puppetmaster.pp and from misc/geoip.pp		python-geoip is no longer included by these classes,	you must do so yourself.		in misc::geoip, if $::realm is production,	.dat files will be synced from the puppetmaster,	else .dat files will be installed using the geoip-database	package.		* pass puppet-lint on all manifests:	 - get rid of tabs	 - enclose variables with ${} when in a string	 - replace double quotes with single quotes	 - remove double quotes when not needed	* split very long lines, specially in parameterized classes having lot	  of parameters. one parameter per line seems easier to read.		change-id: i0259a6e8b68b8b35bcc1e12c5426f558c5af2097	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/spamassassin/manifests/init.pp,spamassassin: honor proxy for sa-update		if a spamassassin installation exists without direct internet access,	sa-update will fail to fetch new antispam definitions. sa-update however	honors the http_proxy environment variable. ship a new crontab that	defines the variable if the $proxy parameter is passed to the puppet	class		change-id: i975cb7d60f83c6b80df55cc1052dd34693333c28	|salt, spamassassin: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i837190a9b0a49a7efd006c72dfb4b37729bf58f6	|spamassassin: fix failed dependency		note to self: first :wq, then git commit.		change-id: i4748a709418cad960f5c2829431b52a30df313fd	|spamassassin: don't create user/group debian-spamd		these are created by the (trusty) package's postinst and their existence	from puppet is making the postinst unhappy and the package	uninstallable.		as the creation is both redundant and hurtful, remove these user/group	definitions.		change-id: i1fee4bddc46b9b89cbf827bd9988645a67e6ec01	|run spamd as user debian-spamd and manage that user+homedir		change-id: i3ec14885022bcaca021208d844b0a2d4e13f251c	|typofix		change-id: ia9f8137e79bededf65b2534bf6add916da8fe86d	|enable spamassassin spf debug logging		change-id: i4dba0cf012ed4db3772cbbb62ab3efb8cabf0efc	|spamassassin: cleanup module		this is a separate commit to cleanup the spamassassin module, after	splitting it out. most of the changes are trivial, the exception being	the otrs spam scoring that was (and still is) lacking rationale and some	of its settings were removed from being obsolete or not making sense	anymore.		change-id: i288bf5c1bd3c22499e00b6449d618c1056de5461	|spamassassin: move into a module		move the spamassassin manifest & templates into a module. indent the	manifest, but perform no functional changes at this time.		change-id: i52371a77c87a415208f18799260bd43ba638f4a3	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/interface/manifests/ring.pp,interface: some lint fixes		change-id: ibbdba0954f81a04f21748c2a7cde51be00159783	|require ethtool package for ethtool execs		this caused some exec failures during initial puppetization of	lvs2006 as jessie.		change-id: ic04e42c20fc44ddd5322c0d7ba8c77b71dc1e69e	|interface: fix optional parameter listed before required parameter		change-id: i41dedb4210c58ceb3239e042710fa2b9568d63b6	|fix ethtool command for ring as well		change-id: i25e3e66b6f22770d82aae429b0b82d18b365f6cf	|set rx ring params for bnx2x on 10gbe lvs		change-id: ibc5018145bbbdb9289525070e866c69a8efea9c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/facilities/manifests/monitor_pdu_service.pp,change rt references to phabricator tickets		change-id: icf3b230b9a3192e53d71cf4dec98aefd5e917b71	|facilities: move to module		after the dc-cam class has been removed	facilities.pp is just pdu monitoring		first attempt was ib06d7943e315c0 to move this	to nagios_common module, but per comments from yuvi,	abandoned that and now creating a new module	'facilities' instead and moving it there		change-id: ia41e114465b61eb9d6d6402a58131a4598f7eab2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/standard/manifests/ntp.pp,ntp: further reorg, split of client and server code		since the ntp class was doing both client and server config at the same	time, mixing some configs that belong to the "standard" module and	things that do not, we split the two functions and we include the client	config in standard everywhere but on the ntp servers, where we declare a	role::ntp instead.		change-id: i4758c13a6e08b86d75492339bdce08eef154db54	|role::ntp: rename standard::ntp, move to the standard module		change-id: i63cde3e064e0a2cb59abec46093a069f15bb2729	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/manifests/role/pybaltest.pp,enable base::firewall for pybal-test		rules have been defined in previous commit.		change-id: i5e79d2478a1fca0b1e8baf319a495d563152063e	|add ferm rules (and role) for pybal-test		create a role pybaltest and add ferm rules to restrict access to http and	bgp amongst the pybal-test hosts.		change-id: ic0d9f41023bd76ac8bdc911a260dd460d07167f4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/redis/manifests/monitoring/instance.pp,redis::monitoring::instance: partially disable replication checks		for redises in a multi-dc setup, when we switch the replication flow	from one site to the other, the replication flow gets inverted by the	puppet run on the hosts; until they've completed running and puppet has	completed running on the monitoring host we have a discrepancy between	what we're testing for and what we're actually configuring. this results	in a ton of false positives that we want to avoid.		there is no quick and good solution to this, but for now we can live	without the replication lag alarm (we will check it manually around the	time of the switch anyways). it will probably be a wise choice to move	the redis checks to be nrpe checks that can thus be easily modified when	puppet runs on the individual host, and not when it runs on the	monitoring one; however, this hotfix (to be reverted after the	switchback to eqiad is done) will allow us to prevent the alarm spam.		bug: t133179	change-id: i78a6e1e370ba421d0da7cff70ee29898ef5e0aac	|redis::monitoring::instance: vary description based on instance name		change-id: i7eb33b95b44dab2169d2e90ea7c5092658e787b7	|redis::monitoring::instance: s/instance_name/port/		change-id: ia0bcb6c92f9b84b73edc0e5d34602ca85fcff312	|redis::monitoring: removed double declaration of $port		change-id: ia74f96273eeb7cd62a7ee5f4e53f18c2773a066a	|redis::monitoring: fixup and some more parameter checks		change-id: i6bb3019425a973ed75f5f3d7ae18d71ac5b9f905	|redis::monitoring::instance: fix inclusion of class		change-id: ie24dee7e83763866da42d608b1b054c9415cff6c	|redis: add monitoring define		the monitoring define takes the same argument as the redis::instance	class.		it is also applied to role::memcached		change-id: ie8b56ae8115412644be9b21684767da71bb43d0e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/tendril/manifests/maintenance.pp,tendril: fix alignment lint warnings		change-id: i3d1e2f435fb4582417ed77160a937703dadec940	|tendril::maintenance: write crons on one line.		change-id: ibc206ea37d5f76c151c3cfcd04cc1ff76cf9276b	|tendril::maintenance: fix class parameter		change-id: i7d8ea90d2d59e156d36785981320abdf53471b3c	|tendril::maintenance: add missing file		change-id: i413240c318b86069ca1f415d4241713c08ce38e7	|tendril::maintenance: fix dependency		change-id: ied248ccf71d3515a71dc0edcbaa6b8821b3ad120	|adding tendril::maintenance class		this puppetizes the cron jobs that are currently running on	terbium, related to refresh some statistics about tendril.		this module has also been added to mariadb::maintenance,	and this one is being applied to terbium (and temporarelly,	to a separate mw host).		change-id: i8b5e6c6c0073804188ac562eb8839ce9157491ca	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/clamav/manifests/init.pp,statsite,burrow,clamav: minimal quoting fixes		change-id: i5d53198cce41410157601f0ce6a3440c00cf238e	|clamav: fix proxy support		1) make proxy support a parameter, not enabled by default. no reason to	add dependencies to webproxies if it isn't needed (we might reuse the	module on mail::mx); also makes the module a little bit cleaner.		2) ensure service['clamav-freshclam'] is ensured running only after the	clamav-freshclam package has been installed. since the package is	implicitly installed by apt, add a package['clamav-freshclam'] to do the	dependency the right way.		change-id: i10eb5aca5c08a2be7d427dab6e6e187fcdf5bbf1	|freshclam: populate proxy settings		freshclam needs to access the internet to download fresh clamav	databases. set proxy settings to allow it to do just that		change-id: ib0d19ec242d3558bdba074e08ed63a09f857d114	|clamav: move into a module		move, indent and other minor manifest cleanups.		change-id: i0967f479f9bb8dda04e45bc7ff418784fbac4712	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/debug_proxy/manifests/init.pp,remove duplicate definition of service		ferm services should be defined in the roles.		change-id: iffe62d344e897f97a8ac6c5fcd02871e4fd0c7c0	|debug_proxy: add resolver param and set it to $::nameservers		change-id: i9b1707f0bbcb940489f67b776b4ad7fe1b0ff859	|add debug_proxy module, for x-wikimedia-debug request routing		the module configures an nginx instance that listens on port 80 and acts	as a transparent proxy which passes requests to a set of un-pooled app	servers that are reserved for debugging, based on the content of the	x-wikimedia-debug http header. the set of permissable backends which may	be selected via the header is configurable via a regexp.		bug: t129000	bug: t129003	change-id: i2ef40124c891c7f9039850f90c7dc2f6e2641487	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/gerrit/manifests/crons.pp,gerrit: attempt retaining logs for 10 days		gerrit supposedly rotates them on their own after 7 now. let's	up our pruning to 10 to see if that's actually the case.		change-id: idfd419a7ee9bd820d86bf2aa08f32bec5db315df	|revert "gerrit: run list_reviewer_counts cron as root"		this reverts commit b4ae8235c49fa72c935cd741ef5c6f06b3b51baa.		change-id: i3c927388f65524527c518edf17251db13f45d862	|gerrit: run list_reviewer_counts cron as root		it doesn't need to be done by gerrit2 anymore, and doing so just	risks it failing on permissions to /var/www		change-id: i6fce9dbdb70943f25af430fc383c202039edacc5	|gerrit: follow-up i8455189c,  isn't needed now		change-id: i194f7c1e5300876caf53eafcc8a9bfce0915c18a	|gerrit: remove ssh public key and last user of it		gerrit now supports doing its own garbage cleaning. stop	using this hack to trigger it.		i'm pretty sure the ssh key isn't being used anyway since it's	in gerrit itself.		change-id: i8455189c964cfd2f49521db88980073f1f0b9b5b	|gerrit: vary extension listing cron on git_dir		change-id: ia87eb02b2325b1918e28edd0c43287de4f1388b5	|gerrit: don't use ssh to connect to gsql, we can do it from shell itself		change-id: icbd43d9ce34ca5e068e5a39bb6be9490c4f0d3db	|gerrit: move nasty ssh key to crons class, only user		change-id: i40de2bfa1f42c7bcbb4198003bcb172e32bbc078	|servermon,ganglia,gerrit: minimal lint fixes		just removing the last couple occurences of this specific	warnign to later re-enable the check globally.		change-id: iaa6d9c569b59f3f15750e4cda0bb3cffffb4533b	|gerrit: move to module		change-id: i7976a20686b1fc5244cbefb8bb04a2ad96e44fca	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/parsoid/vd_client.pp,parsoid: move rt/vd roles into role module		after having moved the other parsoid roles into the role	module and autoloader layout, also move the rt/vd client/server	role classes over here and rename them to parsoid::foo.		change-id: i8e121364056de4da4f4125e03e5902dff8a5371a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/geoip/manifests/init.pp,geoip: simplify the module		instead of having the main geoip class have the superset of all the	configuration options of all the classes, provide a sensible data	provide default (puppet) and let users mix and match with geoip::bin and	geoip::data::* classes, while still providing a single class that one	can "include geoip" and expect geoip databases to appear.		change-id: ia98d7318ef6e02f480a5cb7bbd1df7b61bdce2dd	|move geoip to a module.		functionally, this works the same as before.	wmf specific puppet configs (volatile, etc.) have	been removed.  these are now passed in from classes in	puppetmaster.pp and from misc/geoip.pp		python-geoip is no longer included by these classes,	you must do so yourself.		in misc::geoip, if $::realm is production,	.dat files will be synced from the puppetmaster,	else .dat files will be installed using the geoip-database	package.		* pass puppet-lint on all manifests:	 - get rid of tabs	 - enclose variables with ${} when in a string	 - replace double quotes with single quotes	 - remove double quotes when not needed	* split very long lines, specially in parameterized classes having lot	  of parameters. one parameter per line seems easier to read.		change-id: i0259a6e8b68b8b35bcc1e12c5426f558c5af2097	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_multi_instance/manifests/instance.pp,mysql_multi_instance: remove duplicate keys		already declared a few lines above		change-id: icec34801d1ece043277e829c6c800da71a2ddb85	|puppet-lint: fix or disable remaining alignment warns		for all remaining "warning: indentation of => is not properly aligned"	lint warnings, either fix them or put a special comment around them	to ignore them (which can be treated like a fixme).		change-id: i8d105e2f22adac3413a3c5e382bf922f949ddc5e	|lint: fix some of the few remaining warnings		there is not that much left in this area, a small follow-up	to ib062d7142a79. very few warnings left in general.		change-id: i71dbdb10b6a480d120893262a2db05d23d311a05	|set userstat=on for mysql_multi_instance roles, to match coredb.	this was previously set global on labsdb, so make it stick.		change-id: i235edf3cb67ef7349060c967d60924e72d4ab0db	|expose max_user_connections var in mysql_multi instance .cnf		probably this never worked and was just set global...		change-id: i64607d735a484717bdcd1900dff6c45c5576ae8c	|mysql_multi_instance : lint cleanup		change-id: id36f8ad8621124fa9751129a53c77c520ed22214	|slight myisam tuning for labsdbs, enable xtradb's innodb_kill_idle_transaction feature		change-id: ic440515050d02cbda92ca808870b3b7a965def34	|reduce bufferpool size on labsdb s1 slave, set max_user_connections = 10 for all labs instances		change-id: idfb78d5a1dc6074f4d4fb699c79f254bec246713	|labsdb: set innodb_locks_unsafe_for_binlog for s4-5, set high slave_transaction_retries for all shards		change-id: ia1724e62f4a9ca8d711dc03487f99edfc4390ed7	|typo fix		change-id: i4eb1587813e18e92905e01c1d5bdcf88c9cf0771	|auto start mysql-multi instances		change-id: i7f77268fd6733702b93562ce01b768d50284bc77	|fixy silly typo 'readonly' -> 'read_only'		change-id: i0bf83cca335e1a1a964e98dd63405bace594fed9	|labsdb: make labsdb100? mysqld not read_only		- make mysql_multi_instance::instance take a read_only	  parameter to override the default of 1	- override said default to 0 for the labsdb instances		change-id: i655ab5ea6897ff78357b9b4ee19329a3b72f70cd	|log_bin should default to false		change-id: i3f8fde297d6fb706000ddbc6d8c2b9e375cf8c38	|labsdbs: disable binlogs, relax locking, bufferpool sized for hw		change-id: i0033642420264bc7e6f808113540d412f1ed67e2	|disable linux native aio for multi instances, use unique tmp dirs, fix client socket stanza		change-id: ibc488275b50fb57980374e0e60ad2d344a3d54d5	|add binlog control options to mysql_multi_instance		change-id: i88d71680331d97598a509506cdf517eaf11bcb84	|prelabsdb dbs: redacting tables		change-id: i39ae872cea381b4df22f57ebd75f6a8918e04e00	|labsdb: don't repl private wikis		also create $::private_wikis global in realm.pp		change-id: if79588d546f35a73b8560cc0631731c6056db1d5	|space -> _ in resource name		change-id: ie10b7f9ad35c0001d4094f5fc69f4389a48e671f	|different resource require different resource names		also, fire hot.		change-id: i05e00965374392236a4de3ba9d41ab333c9a7221	|adding per-node and per-instance monitoring for sanitarium		change-id: i6a271b03474c55da9016e8884dd07fa304850d46	|need to include --defaults-file for init script to actually work		change-id: i43c5cfdf6b270b94aed93b8c5c55b06e850c2296	|can't repeat a key in a hash and expect it to work right		even in the sanitarium. even in a yo-dog-style, nested define	situation.		change-id: id86f589a951772a769805e90c95ce2fb83addbd7	|pre-labsdb dbs: more node defs		and string quoting fix		change-id: ic688969ba11d8c22537a72d1b10a2223781c4c74	|trying the binasher namespacing model		also, yes, i need better variable names. i'm bad at it		change-id: id07ac77a50b7fbe1575d9edd4bb8826a24b9329d	|really basic module for multiple instance of mysql on a node		needs some more work, monitoring, white space, etc		change-id: idc956372f31906e72a582a377c5ff90ade595248	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/labstore/manifests/traffic_shaping.pp,labstore: tcp-setup path fix		change-id: i57d56e3360f5416b4dcd20ad18d5281d68873574	|labstore: real time application of tc setup		this is intended to be merged post careful manual post	staggered rollout of 272891		change-id: id3892fc74cb42cbb92622eebf783979ce119d70d	|labstore: stage tc script and enable on boot		we have been piloting this configuration for a few weeks to	limit the variable load exposure of labstore10* in tools.  labstore1001	especially has difficulty sustaining the extreme bursty load that any	operation can trigger.  these shaping values are based on data	collected from the nfsiostat diamond collector deployed a few	weeks ago.  this will all most likely require tweaking over time.		change-id: i19814c3da53f78666a8877937353f3987a904501	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/quarry/manifests/init.pp,fix whitespace-related lint issues		fix a lot of lint warnigns due to incorrectly aligned arrows.		change-id: ib062d7142a79a8cb6bb3abd86fd7499aa3edad03	|quarry: make redis listen on 0.0.0.0		change-id: i91ae5f7583077e76f9752dc7a404e75cbdb3cb52	|quarry: don't install python-pymqsl		breaks puppet for now, ugh		change-id: i9a4a75812e2178f003f7441fe6ff082586d488c0	|openstack,quarry: fix last "ensure" warnings		ensure found on line but it's not the first attribute		these are the only 2 remaning ones of this type globally.		change-id: ic1d02071534dc76586687552e4266af07e48c328	|quarry: move to redis::instance		change-id: i184095be6f43a9ba16e2626a16bf01b7bc7d5532	|rename ::redis to ::redis::legacy		the redis module is not very good, and not capable of provisioning more than a	single redis instance per host. at the same time, the redis class is used by	about a dozen different modules and roles, so just going to work on the module	with a pair of pliers and a blow torch would not be safe.		so, what to do? one option is the '.*_new' pattern -- that is, introducing a	'redis_new' module and leaving the old one untouched. the problem with that	approach is that the imagined glorious reunification never happens, and we end	up with code duplication.		what i propose to do instead is this:		- move the contents of the current ::redis class to ::redis::legacy.	- add a new, empty ::redis class.	- update users of ::redis to use ::redis::legacy.		this should all be a no-op.		in a follow up patch, i intend to move the resources that would be common to	all instances in a multi-instance setup to ::redis class -- for example, the	redis-server package, the /srv/redis directory, etc.		i think this strikes the right balance between implementing things the right	way and maintaining compatibility with existing code.		change-id: i90842b834563cd7113548ae29e050bddf334f05c	|quarry: fix typo		change-id: id098430dfd3e625faaaf3fe9f9a9f03956a7311f	|quarry: remove duplication of clone_path and other variables		change-id: i155f3b827a73dae806afafeaea0faf747143e12c	|quarry: don't install flask and mwoauth everywhere		not needed on runner hosts		change-id: i3e21f73eee1c1fb4c9f1867a2e3f508bbea00a94	|quarry: lint fixes		"double quoted string containing no variables"	"indentation of => is not properly aligned"	"ensure found on line but it's not the first attribute"		fixes more puppet-lint warnings	for t93645		change-id: i42b298609802e18a60e21bcae5a054b9c78f54e7	|fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|quarry: remove sudo hack for quarry		no longer required, we can allow users to sudo to anything	by modifying sudo policy on wikitech		change-id: iab1cb9fd80e8655ded432505ef882dbbbbbb70c1	|fix misc jenkins warnings in multiple modules		change-id: i83c8de2318f11355c1ad0c23eced02792005efe4	|consolidate python-redis package declarations in ::redis::client::python		different software stacks declared in operations/puppet require python-redis,	so let's consolidate the package declaration in a standalone, unparametrized	class that can be included unproblematically from anywhere it is needed.		fixes puppet on silver, broken by change ib487dd5d4:		error: could not retrieve catalog from remote server: error 400 on server:	duplicate declaration: package[python-redis] is already declared in file	/etc/puppet/modules/trebuchet/manifests/packages.pp:14; cannot redeclare at	/etc/puppet/manifests/mobile.pp:79 on node silver.wikimedia.org	warning: not using cache on failed catalog	error: could not retrieve catalog; skipping run		change-id: i7f7a7d795a15f2e435c3a0364a5dab79e6bdcbd9	|quarry: add python-translitcodec package		used for generating slugs that also handles unicode characters	properly		change-id: ic62da05f42468afbe675b099ba5c1b009512a651	|quarry: add python-unicodecsv module		change-id: i6c60b65777f6ba0fea2a1dc84131feb6fd8ba3d6	|quarry: add a cron based query killer		change-id: i75e5b9ed3c0a5f12524ea2f6d0af727dec4664cd	|quarry: use mariadb 10		change-id: ibd0636bf680a3f1e8b2cda0d7a735007fe676fb2	|quarry: add sqlalchemy as an explicit dependency		change-id: ice5a2981ebe76e3e3fca573f8b1d13f8f23abfa8	|quarry: switch to halfak's mwoauth library		packages present in labsdebrepo		change-id: ibbb06a3922809a7b030ff8ee712395dd5e615e08	|role + module for quarry labs tool		- implements	https://meta.wikimedia.org/wiki/research:ideas/public_query_interface_for_labs	- deployed via fabric file kept in the source	  repository at analytics/quarry/web	- nat rules and /etc/hosts for access to labsdb handled	  manually for now	- uses /srv for everything	- uses labsdebrepo for python packages		change-id: i6042041ffe853095970296c103d3d2e7e19b79e2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/mediawiki/scaler.pp,mediawiki: split role classes, move to modules		instead of stuffing all roles into a single file,	use the correct structure for autoload layout and use	one file per class as per style guide.		move the classes to modules/role/ structure		change-id: if7626dba62cc14ff62a12cc1df7af49a61211429	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/exim4/manifests/ganglia.pp,introduce a new minimal exim4 module		introduce a new exim4 module that handles a very basic exim4	configuration. the module is not attempting to do anything smart with	the config files (yet) and just accepts a config argument for passing	the template.		also move convert half of mail.pp to use the new module; most of the old	exim::* classes, including exim::roled, persist but use the exim4	hierarchy for most of their implementation.		change-id: i076a849434594efb20da95badc2f31d0bfcb86d4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/backup/manifests/schedule.pp,bacula: minor linting		align arguments/braces better		change-id: ia6598b877c201098c2b108c4bdeb200c3c5b4d40	|backup: ignore arrow alignment warnings		ignores "warning: indentation of => is not properly aligned"		because i think you want to leave it like it is,	in this case, right		change-id: ic156a8659607eb69b298d9280a18e18ca9c0fb5f	|modularize backups.pp		move all the dry defines in a wmf specific module	add (incomplete) rspec tests	add readme.md	delete backup::mysql which was unused		change-id: i7e2d1f933d57dc27f5933d826fadec2f64f74e47	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/parsoid/vd_server.pp,role: align arrows in manifests		change-id: i7f2777652de46349e175ab0e8c68a5a840e866d6	|parsoid: move rt/vd roles into role module		after having moved the other parsoid roles into the role	module and autoloader layout, also move the rt/vd client/server	role classes over here and rename them to parsoid::foo.		change-id: i8e121364056de4da4f4125e03e5902dff8a5371a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/storage.pp,fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|bacula: lint clean		change-id: ifa52cd25ca01f73228243b797dff6eea2ea124bc	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/statsd/manifests/init.pp,remove more excess service provider => upstarts		puppet knows to do the right thing these days, do not depend on upstart	unnecessarily. remove from apertium, mongodb, nutcracker, statsd that	upon inspection seem to be the only ones left that use it without	providing their own service files.		change-id: ib4e9fd444604c4765789004a5a5618e213cb3a44	|removing professor as an example from statsd/man/init.pp		change-id: i64f22a23eb5821d19d89d553adada85c7b8fc151	|make statsd module backend-agnostic; make navigationtiming instance ganglia-only		the statsd module currently makes the graphite back-end nonoptional. this makes	it impossible to use the module to provision a ganglia-only statsd instance.	this patch makes leaves the choice of backends up to the instantiator of the	class and updates the configuration of the hafnium statsd instance to be	ganglia-only.		change-id: ie5b11292bd6294506d7afb1ed2fb59feb6f2bc3f	|statsd: only report medians to ganglia		this patch prevents aggregate figures that aren't median from being reported to	ganglia. we do care about the other aggregate figures, but they will remain	available in graphite, and are not vital for rendering the navigation timing	view on ganglia (whereas the medians are).		change-id: i7078bf230198f71b11babdd89b331190a8e895bf	|make defaults for statsd module more sensible		* management interface available on localhost interface only.	* load graphite and ganglia backends by default. (the backend modules do	  nothing unless they are configured, so merely loading them does not	  alter behavior.)		change-id: ia24f0a7c0a6af32efed73cbdfea63a7fb8be8af8	|new module: 'statsd'		- remove 'pystatsd' module. it's only applied on hafnium at the moment,	  so i'll clean up behind it myself.	- add 'statsd' module, which configures etsy's statsd.	- declare histogram for browser latency stats.		tested.		change-id: if65995400913da14dce8ee36c6081efd64a9c1a6	|replace gmetric implementation		i didn't like gmetric.js's quality and i thought it might gain something by way	of concision if it were re-written. i did so (and tested) and it works.		change-id: i0c3198d122511aa856906e9bd7b8233a4dbda332	|statsd module: provision ganglia backend support		statsd logs to graphite by default, but it has a pluggable architecture	that allows for additional backends to be configured by placing a javascript	module in a special file path. this patch adds a ganglia backend and instructs	puppet to deploy it to the backend module directory. i'm not going with	git-deploy because i don't expect to be revising it continuously. my plan is to	be satisfied that the implementation is stable after running it for a while and	then move the code to our repo / package.		change-id: i79f0d05c59cb7715df413940a13aaf55e8787a94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/interface/manifests/offload.pp,require ethtool package for ethtool execs		this caused some exec failures during initial puppetization of	lvs2006 as jessie.		change-id: ic04e42c20fc44ddd5322c0d7ba8c77b71dc1e69e	|interface: fix optional parameter listed before required parameter		change-id: i41dedb4210c58ceb3239e042710fa2b9568d63b6	|set rx ring params for bnx2x on 10gbe lvs		change-id: ibc5018145bbbdb9289525070e866c69a8efea9c4	|interface: lint clean		change-id: if6f91529b1656bf5c214848afb8671a2c82a8290	|create an 'interface' module.		this is mostly a copy-paste job from manifests::generic-definitions.pp		change-id: ia0bf79e227a6738f7072a8bf4bf984d445d81a4f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sysfs/manifests/parameters.pp,use / instead of . in sysfs paths		change-id: i3534509755a5261d29cf830ab9572f13a6ccb7ad	|add sysfs module, to handle /sys settings		copy the sysctl module to a sysfs module as their function and usage are	very similar to each other. this allows us to set arbitrary /sys values,	similarly to how we handle /proc/sys values.		note that support for /etc/sysfs.d was added post-precise, but we have	backported those changes in our own, internal version of sysfsutils for	precise.		change-id: i39d3004299f4bba4ae8142d96e1ce3c793119365	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/packages/tex.pp,mediawiki: add texlive-generic-extra		on ubuntu trusty, a tex with greek characters such as:		    \usepackage{teubner}	    \digama		dies out with:		   latex error: file `iftex.sty' not found.		that is a change between precise and trusty. since we have migrated the	jenkins jobs from precise to trusty, the math extensions test have been	failling.		it has hit ocg previously:	https://gerrit.wikimedia.org/r/#/c/107585/		add texlive-generic-extra on all hosts which provide iftex.sty.		bug: t126422	change-id: i13e7b321b98c0213d6113237ea4ef5cf1d912878	|separate math and tex packages classes		we need to deploy texvc on silver to allow the math extension	to work on wikitech.		as we need to cherry-pick among packages included in the	mediawiki::packages class, this change moves the tex and	math packages into separate classes.		change-id: ib5deed6dece2a78f8004f1ff6a2d3d371aa164a6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/geowiki/manifests/params.pp,create geowiki module		this commit finally removes misc/statistics.pp!		change-id: ib36c02b36a4bd4cb4e4ee8293108fe61754aba94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ldap/manifests/client/openldap.pp,ldap: split client.pp into one file per class		each class should be in a separate file. so i'm	removing the existing client.pp and put each class	into a separate file. no other changes to the classes.		this is the right structure and fixes these:		error: ldap::client::pam not in autoload module layout on line 1	error: ldap::client::nss not in autoload module layout on line 37	error: ldap::client::utils not in autoload module layout on line 116	error: ldap::client::sudo not in autoload module layout on line 245	error: ldap::client::openldap not in autoload module layout on line 256	error: ldap::client::includes not in autoload module layout on line 269		change-id: i01bfae251fff687fce1efcbbb94794be9bf863b2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/puppet/config.pp,introduce base::puppet::config definition		add a definition that allows to provide puppetmaster configuration	stanzas in /etc/puppet.conf.d/ and notifies the configuration	compilation process. this removes the burden of populating files and	notifying the compilation process from consumers like base::puppet	and puppetmaster::config which are being transitioned in this commit	as well.		change-id: i45d96ee338d191bd4d6baf63ec02484cd6854913	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/salt/masters/labs/project_master.pp,role: align arrows in manifests		change-id: i7f2777652de46349e175ab0e8c68a5a840e866d6	|salt: move the role manifests into role module		create the, rather badly named, salt role hierarchy classes manifest	files in the role module. this will unblock id1d3cfaa01		change-id: i92c44cf77ab342e5b61a1320f5999277d8085fee	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/bugzilla/static.pp,bugzilla-static: move role to modules/role/		move the bugzilla-static role into autoload layout	and rename it to bugzilla::static instead of using an underscore	which fixes both.		change-id: i80883b177bdbbb1566d515e4395c8ebdb3d22877	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/manifests/views/kafkatee.pp,remove misc/monitoring.pp, remove import 'misc/*.pp'		remove misc/monitoring.pp, rename and move all the classes	to ganglia::views in the ganglia module.		this also removes the entire import 'misc/*.pp' from site.pp	because this was the last file in there. there is even	an error if i don't also remove that at the same time.		http://puppet-compiler.wmflabs.org/3244/uranium.wikimedia.org/		change-id: ie62b3041a6eae5aa06f7f172d80d223b10194cce	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/openstack/keystone.pp,role::labs::openstack::keystone::server: decom redis instance		we used redis replication when we migrated from pmtpa to eqiad. now that labs	is single datacenter this feature isn't used (and the upstream keystone broke	the entrypoint interface that it relied on.)		i'll clean up the leftovers manually.		change-id: i015847282f8dd2608b0eafe341980d92cfceebc6	|openstack: more refactor and cleanup for multisite		this started as getting controller_firewall.pp out of the	module and into a role based abstraction.  there are various	levels of cleanup here as i removed portions of the controller	role there were not used and options that were obsolete.		change-id: ied6758c8eb13d438384a4255a45577d5abc82ab0	|further hiera-ize role/labs/openstack/		there is still some low hanging consolidation fruit	left here.  this isn't the final form		* moving values into yaml	* moving private values into hiera private	* using role keyword in site consistently (needed for lookup)	* refactor class relationships based on the reduced	  need for classes as param stores		change-id: ib7080dce519c99c5368d01380c8708ec43c069ce	|labs: cleanup and move role classes (part #1)		move to autolayout setup		change-id: i8e3489dbb5cf0d87fc6213c9303fde8cd180fd2d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/archiva/manifests/init.pp,adding archiva module and role, applying on titanium		change-id: ib77056e035df677b004cee59d482fa0ac02c3411	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/tests/passenger.pp,fix a couple of puppetmaster failing tests		ci might try to parse the tests and trigger on the failing imports.	remove them as they are no longer required		change-id: i6c3dc5510b4029d209eea1837d1ba8c9b2ba7306	|puppetmaster: puppet-lint fixes		change-id: ib2526afffd7270eee0432bce18e12ec396f8ae7b	|puppetmaster tests: remove broken includes		the files nagios.pp and backups.pp do not exist anymore	at this location. so there are just errors about missing	includes if you try to touch these files otherwise.		change-id: i338efaa299b0a8df921f31253808c931fa7158f9	|modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/grub/manifests/bootparam.pp,create a new grub module		this provides an almost dummy (but reusable) grub class, a	grub::defaults class that is used to remove quiet and splash from the	default (ubuntu) config. much more importantly, for newer systems it	provides a grub::bootparam define that can be used to set kernel	parameters from all over the tree, instead of relying on hacky	base::grub parameters.		change-id: if03604a07be59ac2be30ec14b1a532c2f16fabc7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/phpunit.pp,contint: decouple slave_scripts and composer		contint::slave_scripts installed a lot of stuff. with the recent removal	of phpcs, the class ended up:		* creating /srv/deployment/integration	* installing composer	* clone phpunit	* clone slave scripts		factor out /srv/deployment/integration creation to	contint::deployment_dir		move composer installation to contint::composer. update a toolllabs	reference.	move phpunit installation to contint::phpunit. it is still needed by	operations/mediawiki-config job.		while at it remove the git::clone ensure => absent for phpcs. no more needed.		finally, the sole place where we need composer and phpunit is on the ci	labs slaves, thus add contint::composer and contint::phpunit in the	role::ci::slave::labs.		bug: t128092	change-id: i4063ff1c1576b2bfc400cdb7a85c6b39ce0e44ca	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/tmpreaper/manifests/dir.pp,add tmpreaper module		adds a tmpreaper module with two custom resource types:		* tmpreaper::dir adds a directory to the set of directories which are 'reaped'	  by tmpreaper during its daily cron run. it does so by appending the directory	  to tmpreaper_dirs in /etc/tmpreaper.conf.	* tmpreaper::reap allows a path to be reaped by puppet, like puppet's native	  'tidy' resource, except not insanely broken. this may be used when the age	  setting or other settings in /etc/tmpreaper.conf (which are applied to all	  directories) are not optimal for the given path.		change-id: ibc013bbf58340664213273bbb97954e5a1e08f9c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ifttt/manifests/web.pp,ifttt: specify the right uwsgi plugin for python2		there is no such plugin as python2, the right name is python		change-id: i69db78358371d75f4192d429f9b18305b622b296	|uwsgi: always die on term!		there are no cases when we do not want to have the normal	unix behavior of dying on sigterm, instead of whatever uwsgi	used to think was normal.		change-id: i010cdefa7604ba7af1dd77afb45fb73d51822f5f	|ifttt: pass callable option to uwsgi		change-id: ic10eaa31aba796d2edb2561b84cf343e288d6c48	|ifttt: set up wikimedia ifttt channel service using puppet on labs		change-id: i4460e1886e376a526df4e8babfce92d516a2b484	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/mediawiki/imagescaler.pp,mediawiki: split role classes, move to modules		instead of stuffing all roles into a single file,	use the correct structure for autoload layout and use	one file per class as per style guide.		move the classes to modules/role/ structure		change-id: if7626dba62cc14ff62a12cc1df7af49a61211429	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/snapshot/manifests/cron/wikidatadumps/common.pp,dumsp: move cron related templates into templates/cron subdir		change-id: i0e42df08c3fd291e601b7259611e07a275f4d168	|dumps: move cron related files to files/cron		this follows up the previous rearrangement of manifests	next wil be the templates		change-id: iab30f475d1437a9150197f47542433f3bd2b685b	|dumps: move (most) cron job manifests into cron directory		change-id: i4ab27bd52c38ce422abbc2b129eb665428762331	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/interface/manifests/add_ip6_mapped.pp,lint: fix 'variable not enclosed' warnings		we globally disabled this puppet-lint check in puppet-lint.rc.		the comment right above it is "variables should be enclosed in {}".		nowadays there are actually just about 68 of these to fix in the	entire repository and if we do that we can re-enable this check.		change-id: i1526f6387254919ad492cdb969b0c1c748ba4d4f	|interface: access template variable via '@'		puppet emits a deprecation warning when rendering this template.		change-id: i7573ea9f2f1b1ae005f49dd59491f5b6346f5238	|deploy v6 token approach to all jessie/trusty		change-id: i60440c0f888eb2fb7d1573aeda970d55ebce2811	|deploy v6 token approach to some jessie/trusty hosts		change-id: i3cb9332962335fad248c027790c8a13646406a8e	|ipv6 token stuff: re-enable cp1008 testing		change-id: i324ebde7b3935ba180bba94f34430e1308619e33	|ipv6 token stuff: add flush on first set, update comments		change-id: ie3a0c781318f856af7b89cd5b37aab895f0afd3d	|remove v6 token puppetization from cp1008 for testing		change-id: i71afd6710464a54aa2b177e5da2e600d9b2e92e8	|fix token augeaus matching		change-id: i46dbabca0018456addea4d450e493f8c2282251e	|add_ip6_mapped: use tokens on trusty/jessie+		note that for currently-running hosts that get the token command,	the old macaddr-based autoconf address will remain in the list	seen with e.g. "ip addr" for now, but its valid/preferred	lifetimes will stop updating, which will de-prioritize its use and	effectively render it unused for further outbound traffic.  it	will take 30 days or so for it to acutally expire from the list	and be removed.		this should take care of t94417 for ipsec for the edge cache	machines as well (which are all jessie).		initial commit tests on cp1008 only, will remove conditional later	if everything looks ok.		bug: t94417		change-id: i4b3f19c7b41db11fff8e81a140b83e9dab9e0c4e	|add_ip6_mapped: no-op refactor to make +token commit simpler		change-id: i82b1fd15c7bc5d33b580d5897f9efdf9b65adccf	|add_ip6_mapped: remove temporary code from last year		change-id: i31108511973b0b7df560677c19af8be58a8f26ea	|turn autoconf back on for v6_mapped ifaces		the slaac-removal commit earlier this week was	naive and won't work.  restore previous behavior	until a better commit, as otherwise there might	be strange fallout when the current slaac addrs	eventually expire.		change-id: if08f1d29c6a54a1bce6aac8e2f5b020b74f1849e	|disable ipv6 global autoconf if explicit addr config for interface		should clean up the mess of wondering which global address is	configured in which order for source address selection.		change-id: i24fd4fbc04f7e81ad6ca162621d1211f8ffd14c2	|interface: lint clean		change-id: if6f91529b1656bf5c214848afb8671a2c82a8290	|rename ::interface to ::interface::ip		change-id: id5c079f7b89e358a89d7408bb57a3ea801f692c7	|create an 'interface' module.		this is mostly a copy-paste job from manifests::generic-definitions.pp		change-id: ia0bf79e227a6738f7072a8bf4bf984d445d81a4f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/otrs/tests/web.pp,modularize otrs		this was a single role before, move it to the module/role paradigm,	splitting up the various classes and moving templates/files around.	add tests, documentation for the new classes.		change-id: i04cc8d734cd83acc2ce4c4d26cea9c0fbd1da2ec	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/instance_upstarts.pp,base::labs: rename class with dash character		puppet class names should not contain the dash character	per style/lint guidelines.		renaming one of them and replacing with underscore.		change-id: ifaadd596a6ea7e49ae8b61a34f8bce79c73b2e4b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/planet/manifests/index_site.pp,planet: rm ssl settings and ports.conf.ssl		no ssl related settings are used here anymore, we are terminating	ssl at misc-web nginx.		change-id: i222c7ff1a1de3a719a4033de84acefb40b7d0786	|planet - use ssl_ciphersuite		change-id: i9d4b01fdd82a0a97beb899c3e5c6dbd26d8d384f	|fix site name for planet default site		remove leading /etc/sites-enabled,	this is done automatically by apache::site		change-id: ic4ecbf162e37a4c869a95b419f7c697a2d464d08	|fix apache site setup for planet		just like i306feeb35196e	but for the default page (non language page)		follow-up fix to iddc778a281639		change-id: if187286be4d6390417927a383ddeba78ff91b3bc	|kill apache_site		all that apache_site is doing is creating a symlink to the relevant file in	sites-available. the approach of the new apache module is to provision files	directly in sites-enabled rather than symlinks to files in sites-available.		thus the following is true:		* each apache_site resource has a corresponding	  file['/etc/apache2/sites-available/foo'] resource.	* by replacing sites-available with sites-enabled, the need for a symlink is	  gone, and the apache_site resource can be discarded.		change-id: iddc778a28163947edef53a288bd986d0bfe2f309	|turn planet into a module		there has been an older attempt to do this	that had to be reverted due to a bug causing	puppet issues		so this is along the lines of	https://gerrit.wikimedia.org/r/#/c/54502/3	https://gerrit.wikimedia.org/r/#/c/58495/ etc,		but entirely new and _doesn't_ do things like dropping	the role class, putting config into module etc.		change-id: i980f9dc9f48e80d53dd2c920622ae67672d575df	|revert "make the planet logo a "per language" thing"		this reverts commit f2264e7a97f26b6b2d6548e9d730e01ce42baebe.		revert "resource references should now be capitalized"		this reverts commit 54d5baca9de9ea519c216ceb08030eb93cffc674.		revert "remove duplicate definition of locales package"		this reverts commit ebd76e02e4d7322a57a605b33afde16e4bf93a72.		revert "turn planet into a puppet module"		this reverts commit ec09aaefb8b9f7eafc82aaca5dff7e940c243f4e.		change-id: i093cfc85d1ca8550c19a246ae9ed8fb0e91149e3	|turn planet into a puppet module		- move all files, templates, into module subdirs	- add readme.md and turn role file into init.pp	- quoting and arrow alignment	- 2-space softtabs, etc. per puppet style guide		change-id: i9d0fda3f27715282068e760d2f01c2fc298314b7		rename planet class, per docs init.pp must exist and contain	a class matching the module name		change-id: i19034d090692387ca7e9d7f2d87fe4f9e13793e7		move defined resource types into separate files, one definition	per file inside a module as recommended by puppet docs		change-id: i91fc1ccad73b5498441de39a3e150e65e017df1b		move package install to own class and file,	move generic::locales out of init.pp		change-id: i63217308b7d3c6469ba3c30bc4a183e62f8b2b77		move webserver setup for planet out of init.pp		change-id: i00dde9965afe86b58ba609810bcaa6b588ac17af		move locales install and generation into own file,	step 1 to making module self contained instead	of declaring stuff from generic-definitions.pp		change-id: i239fa19a8bd40eadeb7a6aea3ab9feddb480610c		move needed planet directories to own class		change-id: i153848976801f3bd378f83dcfab0d70a4984fd66		move user/theme/apache_sites out of venus.pp, move index_site	setup to own file, move webserver setup out of init.pp		change-id: i9769542394ff96a46e0cf46e8269f9fbe9cc8e92		move language prefixes and translations to own class/file languages.	use a qualified variable to access it		change-id: i88a12546e4ed42b5d6ced9a4d68bf22fff64c486		various fixes to make puppet-lint like it,	like wrong quoting, unaligned arrows, variables without explicit scope,	lines longer than 80 chars, and more		change-id: i260c28ab1028f8d11e6e155540a708a45f63745f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/labs_debrepo/manifests/init.pp,labsdebrepo: fix names to match file paths		change-id: ieedb2518fada177d329756a87d2c210685ba6f58	|move misc/labsdebrepo out of misc to module		one more thing in ./misc. we would like to get rid	of the entire ./misc.		change-id: if357a88e0b42eafc76d92fba93027a522de68a56	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nagios_common/manifests/check_command/config.pp,nagios: move check_command/config to own file		change-id: if4a86c988f35792175cb1e76262ff76604b70021	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/tests/backup.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/mediawiki/videoscaler.pp,move jobrunner ferm service into the roles		ferm services should be configured in the respective roles, so migrate	the service into role::mediawiki::jobrunner and role::mediawiki::videoscaler.		change-id: i20c27a95314b23a1baa65bd5a4e1d284c0957ddf	|mediawiki: split role classes, move to modules		instead of stuffing all roles into a single file,	use the correct structure for autoload layout and use	one file per class as per style guide.		move the classes to modules/role/ structure		change-id: if7626dba62cc14ff62a12cc1df7af49a61211429	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/lists/server.pp,add "lint:ignore"s for several "puppet url without modules"		just adding lint:ignore's and comments. they are also	meant as a question if these should move into a module	or not and what the plan is for files that are actually	used by multiple modules. in other places we don't seem to	mind that modules use files from other modules but we also	don't like the global ./files/misc structure and neither	does puppet-lint.		fixes several "warning: puppet:// url without modules/ found"		bug:t93645	change-id: i1f510cb37a6391698519d5fd3f1f53a960dbef86	|role/lists: rename prod role, move to module/role		- move role classes to module/role	- rename ::server class to match description and to fit	  into this scheme avoiding the limitation of the role keyword	- move into autoloader layout	- minimal docs / lint-fix		change-id: i4834b14053c5f799b3df4514188fbbec0d9a806e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mongodb/manifests/init.pp,remove more excess service provider => upstarts		puppet knows to do the right thing these days, do not depend on upstart	unnecessarily. remove from apertium, mongodb, nutcracker, statsd that	upon inspection seem to be the only ones left that use it without	providing their own service files.		change-id: ib4e9fd444604c4765789004a5a5618e213cb3a44	|re-write of mongodb module		the mongodb module that we currently deploy came from puppetlabs and it sucks.	it had a gemfile, travisfile, modulefile, rakefile, specs, tests (which fail),	support for rhel and 10gen's custom apt repository -- none of which we want or	need. what we did need was for this module to manage the package and the	service, and it did so incorrectly: mongod was configured to fork by default	whereas the upstart configuration file was set to not expect forking (see	icf2113e84).		this patch drops the module in favor of a custom rewrite that is small and	functional. i also added a 'mongodb::decommission' class for decomming. it	completes an item in [[wikitech:puppet todo]].		change-id: i4da51efd4f71ccf7c14726d199ac8d43fc0b275f	|change 'mongofork' param to false by default		rather than fix this in one place but leave it for others to struggle with the	same problem in the future, let's just make the correct value the default.		change-id: icf2113e84b67fab51690a44ca457916adb53b2d2	|adding mongodb module.		cloned from https://github.com/puppetlabs/puppetlabs-mongodb at	commit sha 691620d9058e7b41110793abe59442c4d463d568	and then slightly modified.		change-id: i7ce74bceda325903f9af1f9d04cc7b221a769b5b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ldap/manifests/yamlcreds.pp,ldap: factor out role that provides ldap.yaml file		is used in other places, including the puppetmaster		change-id: i8e35ac14db0717ce1e97f56e2655d33be674e480	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/swift/storage.pp,swift: move roles to modules/role/		split the file into one file per class and move them	into the proper autoload layout in the role module.		change-id: iab6bb38b47b172e07c60de23aefa180ec3f011c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/tools/proxy.pp,move dynamicproxy ferm rules into role::labs::novaproxy and role::labs::tools::proxy		ferm rules/services should be defined in the roles, not the individual	modules (since the access restrictions might differ per role).		also drop dependency on ferm service in proxymanager's nginx::site,	ferm is started during early boot.		change-id: ied72f52aa3f5b72f546dc31eab39b46392de6f94	|tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/locales/manifests/extended.pp,locales: add locales::all, debian support, purge		add a locales::all support for future use. add --purge to locale-gen's	exec as to purge non-configured locales, useful for system upgrades and	such. finally, add support for debian, which is a tiny bit different	than ubuntu.		change-id: i2cf856ff980848ebf01e179d1fe0ce6a4350657b	|split off module locales out of the generic module		"generic" isn't really a great module. split off locales out of it into	a separate module and replace generic::locales::international with it.		change-id: ie7cafb0bdf6eced01af5cedf35573190c401f053	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/gridengine/manifests/resource.pp,fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|tool labs: final(?) fixes to gridengine iii		- add dedicated node queue config	- expand templates at the last minute so that $title is	  correct (and all variables are otherwise available)		change-id: i5bcc9d0cfbf9fc3962decd8a1b885cdde7c21398	|gridengine: proper puppetization, part deux		- fix default config (merge cannot support multiline values)	- group names must start with '@'	- rejigger how configuration is collected in the shared	  config directory	- move resource collection from the toollabs to its	  proper place in gridengine		change-id: id9249c61a0a5569e13e4a8fe1568bf9e79e9b1b9	|labs: more explicit paths		change-id: idc1ecaa8d59c7b3f9d0263177ecf10e4a31feb6a	|labs: more fixes to gridengine class		change-id: ie85f138ba16f0729c0b1ace0ef3d0244a33d7aef	|labs: further fixes to toollabs and gridengine		this reverts commit d67485f8d4cebe0cab1d9e2f6f585bed6e507e30.		change-id: i64627e202900b4d7bbf0334bf64261c9f86d73e7	|labs: puppetize gridengine		much of this will need tweaking and hacking; gridengine is /not/	amenable to simple puppetization because most of its configuration	lives in a bdb.		most actualy configuration bits are nooped with 'echo' at this	time while testing takes place.		change-id: i7856b65ebead6aae04777c4851ef3c7771b239f5	|labs: clean exec resources in gridengine class		rather than attempt overcomplicated command => invocations,	move them to cleaner script files and invoke those instead.		change-id: ibc76809bc84879938593ce79f7fa12842ca5d6d9	|labs: quoting and explicit bash -c in gridengine		change-id: i3e7960c9d4882383368a31b043383c044f489885	|labs: more gridengine puppetness		change-id: i3f54a4716edeaa8727456bf3aad32d2719ba9b89	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ifttt/production.pp,ifttt: set up wikimedia ifttt channel service using puppet on labs		change-id: i4460e1886e376a526df4e8babfce92d516a2b484	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/director.pp,properly align indentation of =>		change-id: iff8bb3f36a38e26c3edeaa93b14274db0860b940	|fix typo in bacula module		introduced in d7c02f3, note the extra > characters		change-id: i9ce9f2f5b094390cb4a66559148a545f1af749c2	|bacula-dir reads a copy of puppet's private key		puppet handles the permissions of its private key file aggresively	setting to 600, too restrictive for any other group/user to read it.	copy it, keep it in sync and set the require permissions for bacula-dir	to be able to read it. this is needed for bacula-dir to reload. the	aggresive handling of permissions might be a change in puppet 3.x		change-id: ibd632a3fd03eea3493b0406e89bfad7e57c74a52	|fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|restore/migrate job templates		add root fileset	fix bacula-dir.conf permissions	whitespace/type cleanups/fixes		change-id: idcb1420e8d29cd194112a81d8833ba4922e1e2ba	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/tests/init.pp,modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/install_server/tests/tftp_server.pp,installserver: rename classes with dash characters		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		this is a follow-up to icb2122da0a43b7a1	where the module was already renamed due to this,	but not the classes inside it.		the classes ubuntu-mirror and caching-proxy are removed	from comments because they either moved to module/mirrors	or have been deleted meanwhile. this change doesn't touch them.		change-id: ib91faf62a8c4d2292f2a51e30fbf1c6583f15eaf	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/quarry/celeryrunner.pp,quarry: move role classes to module role		change-id: idd7f078180d8d743de5f8602647b199421476ec0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/requesttracker/manifests/init.pp,rt: do not load shredder plugin		plugins are currently just a single one and that isn't used and	needs puppet fixes anyways.		change-id: id632fe1e4d522753a24ff3b7b314268d7540e982	|rt - add mail aliases		on the rt server, magnesium, exim is configured like	"# use the system aliasfile /etc/aliases for system domains"	and rt.wikimedia.org is a system domain		in t675 for phabricator, we will want to be able to	redirect just some of the rt queues over to phab	but without redirecting them all		first i wanted to puppetize the entire /etc/aliases	but paravoid pointed out how there is the native puppet	type mailalias for that. so i'm using that.		the "ops-request"->"ops-requests" thing already exists	on the server like that. and the other redirect is to	test forwarding things to phabricator		later we will forward some queues over to phabricator	but not all of them at once		bug: t675	change-id: i0f81033477188dae4821b8b25eb729078a4d83d2	|turn rt from misc/* into puppet module		move rt from misc/rt-server-apache to module	structure		add role class, move variables into role,	formatting, quoting, misc..		seperate into classes by function:		- packages	- config	- forms	- plugins	- apache		move all the apache related stuff together,	make separate file for installing more plugins,	same for the password reset form which still has issues,		move the files into module and fix "source"s		move the templates into module and fix "content"s		add monitoring		remove 2-spaces,.more..		change-id: ib0e7476a612b25f37905f9f475521606d3bb73d7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/memcached/manifests/ganglia.pp,remove support for ubuntu lucid/10.04		change-id: i49b16d717559c8126e2517bb5131dc0ae88e27bd	|ganglia: drop the "gmond" service alias		now that gmond is ganglia-monitor everywhere, drop the alias => gmond	from both ganglia and ganglia_new and adjust all call sites to notify	service['ganglia-monitor'] instead of service['gmond'].		change-id: if5dff9bd3f2032998a4712cb6d11a8e061874fe7	|no longer ensure => absent package python-memcache		other manifests (including the up-and-coming horizon manifest)	require python-memcache, and removing it here causes bad behavior.		change-id: i829dcf14eed7a3fdd85fb73bc514eac88b4dd6dd	|move ganglia memcache.py to gmond_memcached.py		this should prevent naming collisions with python-memcached.		change-id: i35c87cdb39979498f0a9da4fa264b6a30268b578	|memcached: convert into a module		change-id: if58dd9d428e9421f70055c66c77fddbe412de797	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/yubiauth/manifests/yhsm_yubikey_ksm.pp,puppetise yubikey key storage module		change-id: i926f943ed217dc051cdbd746ac58b8aa445d652b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/zuul/server.pp,contint: remove zuul-merger from gallium		to ease the transition of ci services from gallium to contint1001 remove	the zuul-merger instance on gallium. one less service to migrate and we	have another instance on scandium.eqiad.wmnet		the zuul scheduler connects to gearman over the public ip, the ferm rule	comes from the zuul-merger though so:		* change the gearman_server setting so it can vary between server and	  merger instances	* have zuul scheduler to connect over 127.0.0.1	* ferm by default allow all traffic over 127.0.0.1, drop ::1 and	  127.0.0.1 from list of zuul merger hosts which was solely to open the	  firewall rule.		note: would need some manual changes:		* update /etc/default/zuul-merger and set start_daemon=0 to prevent it	  from running again	* prevent upstart from spawning it on boot		bug: t137418	change-id: i4b19cb348c883aa66e380746806ba5a12ec1fb5a	|zuul: move roles into role module		move the classes from manifests/role/ to	the role module in the proper autoload layout.		change-id: i3238035ee75b5e14ecae105d73d84ba921b32b26	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/swift/manifests/stats/dispersion.pp,rename swift_new to swift		can be reproduced with:	  git mv modules/swift{_new,}	  git mv hieradata/common/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}.yaml	  git mv hieradata/codfw/swift{_new,}	  git mv hieradata/codfw/swift{_new,}.yaml	  git mv hieradata/esams/swift{_new,}	  git mv hieradata/esams/swift{_new,}.yaml	  git grep -l swift_new | xargs sed -i 's/swift_new/swift/g'		change-id: i22102da8b14a31719927355ff3efbe19717fcfae	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/vagrant_lxc.pp,vagrant_lxc: move role class to module role		change-id: i9aee5dccc2b36b72c28f7e52fba4670964d44d11	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ores/manifests/precached.pp,ores: add support for running precached as a systemd unit		precaching as a daemon is vital for ores		change-id: i6c16cec2d6f5d17e94d1e0b68aa670d5e3ac1399	|ores: mark all roles requiring ores::base properly		change-id: i0ed748b1feb5bbe9e9ebfd277b40c0d38528c9b4	|ores: add role+class for the precached daemon		it reads new revisions from rcstream and makes ores	pre-compute the required scores before they are	requested by actual clients (hopefully)		only one instance of this should be running.		change-id: idd419dd3ecc02a9caa2540744994a479417afe3b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/publichtml/manifests/init.pp,people.wikimedia.org: https only		use the standard blob we use to make apaches that sit behind varnish to use	https only.		change-id: i2577bd04f93841d8a6b9ad01bb6177aac2248e63	|publichtml,ircyall: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i91fa0887eac78bd4027d7e464a25b07f0900d641	|nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|publichtml: tidy		change-id: i84d5ec279f881b545d5f67b19bce98a51e887c24	|load mod_rewrite on terbium apache		needed for rewrites such as in ib48b514cf8080f7b3	or we are getting "invalid command 'rewriteengine'.."	and apache config test fails		change-id: ie82addf1f521b71f57b7ec5a38d3729eff835d9d	rt: 6862	|fix duplicate declaration of http check		we gotta use more specific names than just	'http' for those checks, or if we combine	the roles on one host, as i just did, we are getting	puppet errors not liking this:		error 400 on server: duplicate declaration:	monitor_service[http] is already declared ...		change-id: id6d8bf8b99407cc82bc2e5b4cc561cdd8476cf85	|public_html directory service, see rt #6862		module for public_html service, hostname people.wikimedia.org	added to misc cache cluster, to be served by terbium,	caching disabled.  manifests not yet tested.		rt: 6862	change-id: i2716be4629380404b21aa46ae63e0ce3928a015c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/config.pp,mysql: make lint ignore classes inhering from params		instead of globally turning this off in puppet-lint.rc,	mark the few actual occurences as fixmes and let lint ignore	them in those specific places only.		change-id: i5deef55101c5105007521ff366182af955baf29b	|selector outside a resource		change-id: i68dead24eb8b85ad47abcd0cd0d2258f13afa8ae	|mysql: lint fixes		change-id: iad6ffec74cb57a7031932b0e790e8d90b1992c80	|allow setting mysql_mode though mysql::config		for phabricator i have a want to set mysql to	strict mode.  i talked to springle who concurred	that would be good.  this makes it possible.		example:		        class { 'mysql::config':	            sql_mode      => 'strict_all_tables',	        }		change-id: if76237cdd30e1ccb566e6e50203326448a05106c	|wip: first bit of stuff for taming the mysql module and making the sanitarium		change-id: ifb7c6a717812906d584fe2a79fc7a507cf7fd45e	|initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/icinga/manifests/monitor/checkpaging.pp,check_to_check_nagios_paging: alert admins instead of pager_testing		the latter was removed from contactgroups.cfg earlier today.		change-id: i6913fe433871dd696eef20f012f6e2300fccc4ff	|nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|nagios_common: move check_paging into module		also move the actual service into icinga module		change-id: if9ccfbe1278d8d7fa8037a1f42c265a9141bdf63	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/performance/site.pp,role performance::site, adjust name in comment		change-id: ieb0cc7a04cae0026bf53e67b5121c2a6c59acf4f	|performance site: move role class to autoloader layout		this moves the role class from "role performance" to	"role performance::site" which means it will be in proper	autoloader layout and lint warnings will be fixed.		checked with watroles it wasn't used in labs and with	puppet compiler that it's no-op in prod.		change-id: i6d924f9c4bf5bc8bd09dacd469e330254ed095fe	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nrpe/tests/nrpe.pp,refactor nrpe to a module		turned the manifests into a module, added/cleaned up documentation, made	puppet-lint happy, moved/created templates and/or files. added unit	tests. also update site.pp/base.pp to not explicitly load nrpe.pp	still needs some love but this will work for starters. rspec tests have	also been added, but fail at this point		change-id: i64a9f1d60cbabeef3a096981d634d7399d39bc45	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/drac/tests/drac.pp,fix drac module broken in 22d7837		the drac.py was wrongly placed. this fixes it		change-id: i508ee65243f1fe32f183540f7d6bbd5363788899	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/tests/xmlconfig.pp,modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dataset/manifests/common.pp,remove role::mirror classes		role:mirror::media can be removed:	< apergos> at this point role/mirror.pp can go, actually	< apergos> we don't serve media via rsync to anyone	< apergos> so just pull it from any host that claims to have it		role::mirror::common was included from a bunch of the dataset module's	classes. it was simple enough and has now been renamed to	dataset::common, under the dataset module.		change-id: i9a45120bfdfae949f72e6f60cec132de137417e9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/changeprop/manifests/packages.pp,changeprop: update config for the new driver		to switch to the new kafka driver we need to set	the uv_threadpool_size to the maximum in order to	get bigger libuv thread pool. this is a temporary	solution until upstream kafka driver switches to	custom thread pool implementation.		additionally, new driver needs a list of brockers,	not zookeeper uri, so provide it.		change-id: i53c2590e0f084b846f45ecf5619e4aacab97fabb	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/squid3/tests/init.pp,add readme, rspecs and tests for squid3 module		the squid3 module relies on wmflib and stdlib for validate_re and	ensure_service. this rakefile honors that		change-id: i2519f3ce6764590e7d7900c3975af80e6354f6a7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/package_builder/manifests/environments.pp,package_builder: support distribution name aliases		the default environement creates the debian image for sid/unstable with	the name sid.  some packages target the release 'unstable' and thus can	not be build because there is no image associated to it.		we could use the hook to transparently rename the distribution from	'unstable' to 'sid'.  seems easier to just symbolic link the image.		add to package_builder::pbuilder_base a $distribution_alias parameter	which let you create such symlink.	factor out dupe paths forging in a single variable $cowdir	document the package_builder::pbuilder_base define.		bug: t111097	change-id: i48f9f9a4e99db489e7d6c6a5c225dec4c5ccd9a8	|include base::firewall in role::package::builder		while at it lint the package_builder slightly		change-id: icc54445798647930045cd3dba9f31d9354f664ac	|improve package_builder tests		unit tests where missing for package_builder classes and definitions so	add them. also refactor a bit the use of basepath variable while at it		change-id: i51d2ba029cd0365b5dd24ca4dbc56a1d0924b809	|package_builder: use mirrors.wikimedia.org		instead of nova.clouds.archive.ubuntu.com		change-id: i312c9cbff6e416a494ad2a22c64aeead3a4458af	|package builder module		a module used to create a debian package builder environment base on	cowbuilder. intended to be used in labs for streamlined debian package	building. creates 4 environments to build packages in:	 * precise	 * trusty	 * jessie	 * sid		respective hooks for the environments are being installed as well and a	mechanism to easily change between environment via an environment	variable is provided. tests included, as well as a readme		change-id: ic8452ee447dcf485f6af822627cc117b3931b795	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/web/modules.pp,mediawiki: extract php config from web::modules, use in noc		as we want to make ::noc compatible with trusty, we need to include the	relevant configuration in the module. we abstract this common config to	a separate class that we can include here as well.		change-id: ifeacd1610660085979f33c036463124f1eaee287	|mediawiki: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i6556485fe63a656d8f8505cef3141fba618a1752	|replace usage of requires_ubuntu / ubuntu_version with requires_os / os_version		change-id: ia7a2052559fb46ae2d2b3e096ce37f90919a18f4	|mediawiki: fix passing of the authorization header in hat		change-id: i56a59db10249e25ffd7fcc8904fefe6b2e91f69c	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|hat: mark failed requests with an additional header		as we need to be sure we're catching all errors on hhvm and we are not	replaying more requests than we should on zend, we need an easy way to	track that. the easiest path i found is to add an additional	x-has-hhvm-failures header in this case.		change-id: if406727960c9175c024f8fbf243de4d746b49b91	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|hat: turn off mod_php		with this change, hhvm appservers will not use mod_php anywhere and all	php files will be interpreted via hhvm. subsequent changes will make	direct proxy calls for all the main wiki endpoints, which is more performant.		change-id: ie7c0dc64f7c6268af79b774e8653f5d4da1710d9	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|revert "mediawiki: hat appserver should turn off mod_php"		this reverts commit 38184b77ba700741d01a4aca05aa2229323c12f8.		temporarily reverted while all sites get their hhvm config portion.		change-id: i6110757148e883464144f0ba218f9ff0a6892452	|mediawiki: hat appserver should turn off mod_php		apparently, installation on php-fss causes installation of	libapache2-mod-php, which will run a2enmod by default. we don't want to	waste memory and processing time to load this module as it's completely useless.		change-id: i0ba331cd8b5e4d47d429d89123102f767a7dea32	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|mediawiki: use hhvm module on trusty		* get rid of various $use_hhvm/$jobrunner_hhvm-style parameters. we can't run	  mediawiki on trusty without hhvm, so the distro version check is both	  necessary and sufficient for determining which interpreter we should use.	* for the same reason: include ::mediawiki::hhvm from ::mediawiki if >= trusty.	* get rid of mediawiki::jobrunner::hhvm. there is no longer anything unique	  about the jobrunner hhvm setup. (we don't want to disable the service either	  since we're transitioning to dispatching jobs via fastcgi).	* lint: alphabetize modules in mediawiki::web::modules; fix indent; add	  trailing comma to last param; alphabetize lists.	* get rid of duplicate max_req_workers in mediawiki::web::modules (the modules	  class already has to call lookupvar for getting other variables from	  mediawiki::web, so there's no reason to duplicate it).	* drop mpm_worker.conf.erb; not in use and doesn't work. (scope lookup	  failures.)	* make mpm_prefork be an apache::conf resource.		change-id: i4aa104920d8121033e664458bb72c59233ef3868	|mediawiki: re-enabling mod_filter		mod_filter is used in our config, but gets included later only. this	removal was just to avoid a warning on apache startup.		change-id: i3ef6f8a48082f21b22866b58deab0f32f20c3b07	|fix duplicate inclusion of resource		change-id: i09aa07026d501229f9aa31c86ba54f41ed5c5fca	|mediawiki: syntax typo fix, remove unused modules		a few modules get loaded by default in debian's apache, but we do not	use them in the original config we had, so it's safer (and more memory	conscious) to remove them for now and reenable just the ones we need or	think are useful later on.		change-id: idc1e4dbf002443cd7966bbbb9010ae8dd941c37c	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|mediawiki fix service name		change-id: ie243154d7d77e99124e29cdff282b8c9c0778c53	|mediawiki: fix typo (again)		change-id: i6c9fe4a74b57bcfcac40c2fbed802031c8cc6b86	|mediawiki: fix typo		change-id: iefbf147d717987d2c4e4c18060710fab0492bbf5	|mediawiki: fix issues with moving to mods-enabled		change-id: i2c3583141d416a2279139cc05ad495206ebbbca0	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|mediawiki: use mods-enabled, prepare for hat		we move the whole management of all apache modules to the standard	debian location, mods-enabled, and out of the apache2 main config file,	that becomes much shorter with this modifications.		we also include modules depending on whether we're on a hat installation	or on a standard mod_php5 installation.		this change needs patchset 147086 to be merged in order to work.		change-id: ia463120718dceab087ad3f8e3f35917fa879f387	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/planet/manifests/dirs.pp,turn planet into a module		there has been an older attempt to do this	that had to be reverted due to a bug causing	puppet issues		so this is along the lines of	https://gerrit.wikimedia.org/r/#/c/54502/3	https://gerrit.wikimedia.org/r/#/c/58495/ etc,		but entirely new and _doesn't_ do things like dropping	the role class, putting config into module etc.		change-id: i980f9dc9f48e80d53dd2c920622ae67672d575df	|revert "make the planet logo a "per language" thing"		this reverts commit f2264e7a97f26b6b2d6548e9d730e01ce42baebe.		revert "resource references should now be capitalized"		this reverts commit 54d5baca9de9ea519c216ceb08030eb93cffc674.		revert "remove duplicate definition of locales package"		this reverts commit ebd76e02e4d7322a57a605b33afde16e4bf93a72.		revert "turn planet into a puppet module"		this reverts commit ec09aaefb8b9f7eafc82aaca5dff7e940c243f4e.		change-id: i093cfc85d1ca8550c19a246ae9ed8fb0e91149e3	|turn planet into a puppet module		- move all files, templates, into module subdirs	- add readme.md and turn role file into init.pp	- quoting and arrow alignment	- 2-space softtabs, etc. per puppet style guide		change-id: i9d0fda3f27715282068e760d2f01c2fc298314b7		rename planet class, per docs init.pp must exist and contain	a class matching the module name		change-id: i19034d090692387ca7e9d7f2d87fe4f9e13793e7		move defined resource types into separate files, one definition	per file inside a module as recommended by puppet docs		change-id: i91fc1ccad73b5498441de39a3e150e65e017df1b		move package install to own class and file,	move generic::locales out of init.pp		change-id: i63217308b7d3c6469ba3c30bc4a183e62f8b2b77		move webserver setup for planet out of init.pp		change-id: i00dde9965afe86b58ba609810bcaa6b588ac17af		move locales install and generation into own file,	step 1 to making module self contained instead	of declaring stuff from generic-definitions.pp		change-id: i239fa19a8bd40eadeb7a6aea3ab9feddb480610c		move needed planet directories to own class		change-id: i153848976801f3bd378f83dcfab0d70a4984fd66		move user/theme/apache_sites out of venus.pp, move index_site	setup to own file, move webserver setup out of init.pp		change-id: i9769542394ff96a46e0cf46e8269f9fbe9cc8e92		move language prefixes and translations to own class/file languages.	use a qualified variable to access it		change-id: i88a12546e4ed42b5d6ced9a4d68bf22fff64c486		various fixes to make puppet-lint like it,	like wrong quoting, unaligned arrows, variables without explicit scope,	lines longer than 80 chars, and more		change-id: i260c28ab1028f8d11e6e155540a708a45f63745f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sysctl/manifests/conffile.pp,revert "wmflib: add ensure_final_newline()"		this reverts commit 04945e956f835cb9849146db49df0559a6d28f94.		change-id: ida7f2e2c6b889cc2a04d3569bf8de5ea4e17ef2b	|wmflib: add ensure_final_newline()		if the argument is a string, ensure it ends with a final newline.	if it is not a string, pass it through unmodified.		this function is designed to make it easier to write custom puppet	resource types that delegate to file resources and that take	either a "content" or a "source" parameter.		change-id: ib1f88b11b6308900a0bf0279eaca863793f614cd	|replace service['procps'] with an exec		procps is a task job, not a service, and it is only hackery that makes it	appear like a well-behaved service. so replace it with a refreshonly exec.		change-id: i8edb51a519c68050f577aebea1df9045b2c4b933	|sysctl: make the default priority 70		udp2log broke because the kernel parameters it requires were being clobbered.	this is because both sysctl::parameters['big rmem'] and	sysctl::parameters['wikimedia base'] were set to the default priority of 60,	and each was attempting to set net.core.rmem_max to a different value.		in change i50d929847, andrew b. and i fixed things by setting the priority on	sysctl::parameters['big rmem'] to 70. in hindsight, this doesn't go far enough.	we can safely assume that in case of conflict between 'wikimedia base' and some	other sysctl::parameters resource, it's the other resource that should win,	since it is more specific than 'wikimedia base', which specifies cluster-wide	defaults.		having the default priority set to 60 is unfortunate, because that is the	lowest possible value that is not reserved by debian/ubuntu for sysctl configs	bundled with packages, so it doesn't leave room for declaring broad defaults.	so: make the default 70, and change 'wikimedia base' to 60.		also add documentation and remove the 'filename' parameter from both	sysctl::parameters and sysctl::conffile, since it is both unnecessary and	leaves a way to circumvent the naming convention.		i tested this on vagrant. i also confirmed that integer values are	automatically cast to strings for the purpose of regex matching, so a literal	'70' (the number, not the string) does indeed match /^\d?\d$/.		change-id: i02673456fdaec1e065dff449a12435c5ecccf14a	|add icinga checks for important sysctl params		add 'check_sysctl', an icinga plug-in that issues alerts whenever the actual	and expected values of sysctl parameters are not the same.		i made two additional changes that were prompted by rereading the readme of the	debian procps package:		  "in general, files in the 10-*.conf range come from the procps package and	  serve as system defaults.  other packages install their files in the	  30-*.conf range, to override system defaults.  end-users can use 60-*.conf	  and above, or use /etc/sysctl.conf directly, which overrides anything in	  this directory."		thus:		* make the default priority of sysctl::conffile and sysctl::parameters	  resources 60, rather than 10. any additional sysctl::parameters resources	  won't come from the procps package itself, so the default priority of 10 is	  neither sensible nor safe.	* change priority of sysctl::parameters['lvs'] to 60 so that it conforms with	  the priority namespacing policy of the package. (the 50 range is not	  defined.)		change-id: if004835fb369810bba553dce2d2b8df7b8d364ac	|remove a bunch of dangling commas in param lists.		puppet 2.7.7 chokes on these.		change-id: id8a5d8efa8fe3b1d004c21d72668dccaa04a2f81	|clean up sysctl parameters.		this patch reorganizes the sysctlfile module and sysctl resource into a	reworked sysctl module and configures puppet to manage /etc/sysctl.d	recursively. this means puppet _will_ purge defaults installed into	/etc/sysctl.d by default. however, the defaults installed by ubuntu precise	have been expressed as sysctl::parameters['ubuntu precise defaults'] in class	base::sysctl.		change-id: ib294b691dad8500c2e0cd39896882f8cf4f3a286	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/wdq_mm/manifests/lb.pp,wdq_mm: rename module to standard naming (underscores)		change-id: ifad416c7eaadc227fbcb806596821c40d59190a5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/requesttracker/manifests/aliases.pp,monitoring, rt: lint fixes		unquoted file modes and users, double quoted	strings without variables		fixes more puppet-lint warnings	for t93645		change-id: i19dec3c1c3e3de33a1677d3bec9a0f7851b3253b	|fix aliases file url		change-id: i67c2d1a316ff03ef0c2a66f7394486ddca809a9d	|create a special alias router for rt		moves the existing 'mailalias' puppet type aliases to a simple	static file. as in this case there's no existing file to manage,	it's simpler.		change-id: i99292b51dd8448c068f4adbee3773176e06d3063	|rt redirect relevant queues to ops-private		this is temporary as these addresses will go to	phabricator post-migration.		change-id: id0ec26dfaeb7c3c4dc4b9f9324e514594719ef7c	|rt - add mail aliases		on the rt server, magnesium, exim is configured like	"# use the system aliasfile /etc/aliases for system domains"	and rt.wikimedia.org is a system domain		in t675 for phabricator, we will want to be able to	redirect just some of the rt queues over to phab	but without redirecting them all		first i wanted to puppetize the entire /etc/aliases	but paravoid pointed out how there is the native puppet	type mailalias for that. so i'm using that.		the "ops-request"->"ops-requests" thing already exists	on the server like that. and the other redirect is to	test forwarding things to phabricator		later we will forward some queues over to phabricator	but not all of them at once		bug: t675	change-id: i0f81033477188dae4821b8b25eb729078a4d83d2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/lvs/manifests/realserver.pp,lvs: double quoted string and other lint		this fixes a bunch of puppet-lint warnings of the type	"double quoted string not containing a variable".		it's part of a series of patches to fix this globally	and be able to remove "--no-double_quoted_strings-check"	from the global .puppet-lint.rc in the repo.		change-id: i95e54bd8a18293f0847a55ae0aecc64d5ec84ae1	|lvs::realserver: lint it		* double quotes to single quotes	* quote various strings	* reorder parameters for a more readable output	* reorder resources		change-id: idfe694bd726174ed36ab4f05241b4a46734c8ddd	|lvs: convert to a module		change-id: i07cf6227f3d443df006cb18c2dbf73b9c03ad280	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/tests/ddxfile.pp,modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/icinga/manifests/naggen.pp,nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|monitoring: move monitor_host to monitoring::host		change-id: i362dac76eb4d2d58d91c138a2b708396888ad721	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|nagios: fix virtual resource collection		change-id: i62dd3b278e180920b73e0553f3492d63edacceeb	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|icinga: make all config files belong to icinga:icinga		no reason they should all belong to root.		also remove the exec{} that munged permissions. add explicit	modes where required.		left as root ownership is:	- executable files	- files that specifically have a mode set that would not allow	  any access to non-root		change-id: i6d95a9b45e868d13b07dd5be42007b263c8f2cf3	|include icinga base class in ::web and ::naggen		attempting to fix dependency cycle.  include kinda makes sense here	anyway, and any dependent resources themselves can notify the icinga	service (which sets up a resource dependency).		change-id: i7c944a3b0a62ce523dc0f15628874c25c1f4d7aa	|move dependencies into icinga module classes		attempting to fix dependency cycle.		change-id: i23c85c89744ee03f19a4d225cd23609364e6d470	|icinga: move config into module		- no need for $static_files, since service refresh is triggered	  by notify in the class declaration	- no need for individual service notifications inside naggen,	  are handled in the class declaration		change-id: i11cdd1817a3c14ff4bd0a31eef2a0e2d2e7f2ccb	|icinga: move naggen into module		- setup service notification in the file {} definitions,	  and setup a dependency to make sure it executes in order.	  this is more consistent than using subscribes	- remove the 'permissions fix' code, since all the files	  seem to be generated with appropriate permissions anyway		change-id: icc37c98309b0106de3174a8c39de2c77f50d5652	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/manifests/role/pybal_config.pp,pybal_config: use production_networks		not used in labs, only accessed from production networks.		change-id: i5f059a753b8be851619b7e6b3b890d10e9da5337	|add ferm rules for pybal_conf / http		change-id: iaffd0aa7b40a90b89589544325e1a764a4a69aef	|fixed spacing and alignment		this fixes lint 'two-space soft tabs not used'.		change-id: i78aae2a826ba663711964faaea9040247cd0022e	|config-master: serve through misc-web-lb		change-id: i84a42ea0e1032b0be0c8c53748924bf412d34872	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|pybal: serve the virtualhost with pybal lb files with a dedicated vhost		change-id: i030d8ccd9f77da50a2ba1509bbd953bdce1bcbc9	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/icinga/manifests/monitor/stream.pp,icinga: add virtual host and ssl check for stream.wm.org		we do have monitoring for service https on the backends	rcs1001 etc using their private ips,	but this adds virtual host that actually	uses the ip of stream.wikimedia.org and connects to that,	for better monitoring.		change-id: i2dd97cd75d07d1c5aa0df94462a5a8d39a76aa85	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/aptrepo/manifests/distribution.pp,install_server: split out reprepro to module aptrepo		split the reprepro role out of the install_server module	as faidon said on t132757.		merge apt_repository into init.pp.		rename module to "aptrepo", role to aptrepo::wikimedia.		remove all the duplicate definitions of files and files	that had been replaced by templates.		changes on carbon itself as minimal as possible in this change:		http://puppet-compiler.wmflabs.org/2898/carbon.wikimedia.org/		bug:t132757	change-id: ie259b939971a5affed178ed25c31373de1110e57	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/manifests/web/view.pp,ganglia: rename ganglia_new to ganglia		change-id: i1e92bc3e994e9a522c82b3b7c3b5136622d34250	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mirrors/manifests/ubuntu.pp,mirrors: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: iebf6b43f559cf93d15b8afcbae70c3e6dc6bf6d3	|mirrors: move to /srv/mirrors; new class ::serve		split mirrors into a separate /srv subdir, /srv/mirrors and set up an	index page for it		also, create a new subclass mirrors::serve that sets up a separate nginx	virtual host to serve just /srv/mirrors and include it from the	install-server role class (to be moved later).		change-id: i48ff568e52ea1c9c367ac9f41909c6ef20dfb89f	|mirrors: introduce mirrors::debian and use it		introduce a mirrors::debian class that mirrors a debian ftp. this uses	debian's official mirrors scripts, archvsync (aka ftpsync). include the	class from the respective role class and while at it, add monitoring	based on the preexisting ubuntu check_apt_mirror, which now takes a	parameter. note that the mirror pulse for debian is set also every 6	hours but 40' far apart from the ubuntu pulse as to avoid overlap	between the two.		it should be noted that instead of archvsync, debmirror was also	explored. while debmirror was more well-documented and packaged, in the	end it seemed more oriented to "local" mirrors and tried to be too smart	in this regard. there were multiple occurences of this but the tipping	point was when debmirror choked when "experimental" had failing	checksums and ended up not syncing *any* suite.		so, stick with archvsync, which while a bit crude will allow us to	potentially become a (partial) official mirror.		finally, the mirrors module in general could probably use some extra	love as it's not very configurable right now and hardcodes a bunch of	settings. it isn't /too/ bad and should do it for now, though.		change-id: icafeaa3d0c80d5249bcc2027471a56bc8a487395	|install-server::ubuntu-mirror -> mirrors::ubuntu		move install-server::ubuntu-mirror into a class in a separate new	module, mirrors::ubuntu. also move the mirror system user/group from the	install-server role class into the top mirrors class.		the class is module "mirrors", mainly to avoid confusion with	role::mirror which is something else entirely, namely our "mirrors"	service, which is the name e.g. kernel.org has picked for the same	service. while it /could/ still lead to confusion, there's really no	other name to call this; in the long-run, role::mirror should probably	be renamed instead to something more descriptive.		change-id: ib3e2b99a119b0cea4f5a14a8846bf2df92ffc261	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/labstore/manifests/monitoring/ldap.pp,labstore cleanup and role vs module arrange		this more accurately reflects the module and role	schemes used for other config.  we are also staging	to have primary/second/misc nfs setups so rename as	primary and misc to that effect.		change-id: id66499d22a7f40df8174fdfab8a89e10899beb7c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/logster/manifests/job.pp,fixing quieting of logster job		change-id: if53eb54760012ad9f5331a7f76efcc20bd82d381	|quieting logster::job cron		logtail2 is run by logster and spits out a message when a file doesn't	exist.  we don't need to know this, since logster properly logs to its	own log file on run (/var/log/logster/logster.log), and does the right	thing when a file doesn't exist.		change-id: i08cceecdc802b42345093c30e1a43606e5b24e0e	|adding logster module and using it to monitor cirrussearch-slow.log		this is for rt 7118		change-id: i92e4b9c4fd29f802de38ac127d4dcbc58addddf1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/deployment/manifests/umask_wikidev.pp,extract /etc/profile.d/umask-wikidev.sh to a shared class		make applying role::deployment::server and role::labs::mediawiki_vagrant	to the same labs instance possible by refactoring the puppet code that	provisions the /etc/profile.d/umask-wikidev.sh for both roles.		three roles (role::deployment::server, role::statistics, and	role::labs::mediawiki_vagrant) all provision an	/etc/profile.d/umask-wikidev.sh file which sets the default umask to	0002 for members of the wikidev user group. two of the three roles	actually used the same file resource but via separate file defines.		change-id: i4bc08455c84e2c822b6a0f6ce384784f05127948	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/rcstream/manifests/init.pp,rcstream: remove requires_os('ubuntu >= trusty')		it's not strictly true (it just needs a new enough nginx, which we're	probably going to backport to precise anyway) and it's not like anyone	is going to attempt to provision rcstream on a precise instance anymore.		change-id: ia4f498c65e80711f28bf15b72f8a5ac9dcc1609d	|replace usage of requires_ubuntu / ubuntu_version with requires_os / os_version		change-id: ia7a2052559fb46ae2d2b3e096ce37f90919a18f4	|consolidate python-redis package declarations in ::redis::client::python		different software stacks declared in operations/puppet require python-redis,	so let's consolidate the package declaration in a standalone, unparametrized	class that can be included unproblematically from anywhere it is needed.		fixes puppet on silver, broken by change ib487dd5d4:		error: could not retrieve catalog from remote server: error 400 on server:	duplicate declaration: package[python-redis] is already declared in file	/etc/puppet/modules/trebuchet/manifests/packages.pp:14; cannot redeclare at	/etc/puppet/manifests/mobile.pp:79 on node silver.wikimedia.org	warning: not using cache on failed catalog	error: could not retrieve catalog; skipping run		change-id: i7f7a7d795a15f2e435c3a0364a5dab79e6bdcbd9	|rcstream: remove duplicate package declaration		change-id: i0609d40fcb17f6845e56be3bceb209f6b7904eac	|use trebuchet package provider for rcstream		rcstream is not officially launched yet so it's a low-stakes case for testing	the package provider.		change-id: i0a13652b423567fd188b72e572138e4018bb3a69	|rcstream: require ubuntu >= trusty		not > trusty. fixes if91d79178.		change-id: ia5f1ea474aa3e6c0d579f0dd1828c86e2c9065d6	|wmflib: add funcs requires_realm() and requires_ubuntu()		these convenience functions provide a bit of syntactic sugar to make a common	idiom more elegant and concise.		this patch introduce usage to demonstrate how these functions are to be used.		change-id: if91d79178f50f3125bbf8b4e7acaf8b1ff94e55c	|move rcstream server implementation to external repo		the python rcstream server code is now in mediawiki/services/rcstream.	this patch removes the server code from this repository and updates the	puppetization to deploy the server via trebuchet instead.		change-id: ib8bb8f5aae93d19eb2faa0b5c11b3554347cbe71	|add 'rcstream' module for broadcasting recent changes over websockets		this change introduces an 'rcstream' module, which provisions a small and	self-contained software stack for broadcasting recent changes using websockets.	it is designed to work with the redispubsubfeedengine class in mediawiki.		the setup consists of the following components:		* a single-file python server, powered by gevent and socket.io.	  each instance of such server can serve multiple clients concurrently.		* an upstart task (rcstream/init) that spawns multiple instances of this server.		* nginx as load-balancer / reverse proxy. nginx 1.4+ (and therefore, trusty) is	  required, as earlier versions are not capable of proxying websocket	  connections.		why websockets? admittedly, it is not the world's prettiest protocol. but it is	very widely supported, and it is what users want.		please see the included readme file and the in-line documentation for details	about the setup.		rfcs fulfilled / obsoleted by this change:		* <https://www.mediawiki.org/wiki/requests_for_comment/publishing_the_recentchanges_feed>		bug: 14045	bug: 17450	change-id: id819246a947dfe1e32d9fd9c13570858cdaaa39d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/tools/redis.pp,tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/tests/mysql_database.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/geoip/manifests/bin.pp,geoip: simplify the module		instead of having the main geoip class have the superset of all the	configuration options of all the classes, provide a sensible data	provide default (puppet) and let users mix and match with geoip::bin and	geoip::data::* classes, while still providing a single class that one	can "include geoip" and expect geoip databases to appear.		change-id: ia98d7318ef6e02f480a5cb7bbd1df7b61bdce2dd	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sysfs/manifests/conffile.pp,add sysfs module, to handle /sys settings		copy the sysctl module to a sysfs module as their function and usage are	very similar to each other. this allows us to set arbitrary /sys values,	similarly to how we handle /proc/sys values.		note that support for /etc/sysfs.d was added post-precise, but we have	backported those changes in our own, internal version of sysfsutils for	precise.		change-id: i39d3004299f4bba4ae8142d96e1ce3c793119365	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/toollabs/manifests/queues.pp,tool labs: gridengine puppetization, iii		this phase adds the host-unrestricted node config for the new	compute::dedicated node type.  it also now places nodes in the	proper hostgroups and queues.		it also adds the needful gridengine::collectors::queues class.		change-id: i9931a2603e74b814529aa9f639036a442b64c7b8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/diamond/manifests/collector/nginx.pp,adding metric collection to nginx in the context of elasticsearch		question to reviewer: i'm not yet familiar with our metric collection. do	i need to be carefull about something in particular? not sending too many	metrics to graphite? anything else?		this change depends on https://gerrit.wikimedia.org/r/#/c/278276/		bug: t130365	change-id: if43defbeb9e61ae17451071098ef77e6dfb3395e	|diamond: add diamond::collector::nginx resource		* update nginx submodule for i9450b8cf0.	* see <https://github.com/brightcoveos/diamond/wiki/collectors-nginxcollector>	  for details.	* provision a collector for the rcstream nginxes.		change-id: i79611947724ba6dc424c1267128687abd30c10bb	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/director/catalog.pp,fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|bacula module fixes		bacula::director::fileset excludes parameter gets a default value of	undef. templates fixed accordingly	documentation fix		change-id: i2ec71a8fc9f1c02f51e774d01b8273e3085bf373	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/monitor/percona/files.pp,fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|icinga: remove misc/icinga.pp		moved the one use of the variables left (in percona) to use	a class parameter with a default, so can be overriden in	hiera later if required.		finally, this file has died		change-id: i7172cef23398693516f9da56b0c7a58fcee1d157	|mysql_wmf : lint cleanup		change-id: ie1062ceb9357e6a7502272c213e4324d49061217	|move mysql_wmf into a module.		the manifest changes here are pretty brainless -- i split the major	classes into separate files and rearranged the file and template	includes to reflect the new position of the source files.		i also moved quite a few files that were filed under ganglia	or icinga but only used by these classes -- now they live in the	mysql_wmf module instead.		change-id: i31b8d8562f8eda4a6fde4a6110d83a339fc38b94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nagios_common/manifests/notification_commands.pp,nagios_common: kill all the love		remove the ❤❤❤❤❤ suffices and $lover_name. i'm really no fun.		change-id: i5d21f7d405d8ae0169c7d5d5bb0b228f164d7bcb	|fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|nagios_common: parameterize path used for ircecho		change-id: ie3419b9d9fd068e4eb8413d1ca147bef6f8ea475	|shinken: don't say 'icinga' in shinken notification emails		change-id: i11e745dc3d37ce474c11a814f782f18acdee123a	|icinga: make all config files belong to icinga:icinga		no reason they should all belong to root.		also remove the exec{} that munged permissions. add explicit	modes where required.		left as root ownership is:	- executable files	- files that specifically have a mode set that would not allow	  any access to non-root		change-id: i6d95a9b45e868d13b07dd5be42007b263c8f2cf3	|nagios_common: move notification_commands into own class		change-id: i43471fd6f7822b603b69ee167a760622d39bd718	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/statistics/manifests/password.pp,first commit in a multi-commit effort to move misc/statistics.pp into modules/		t87450		change-id: i49140d85ddea99f5d4d9a3c71e60cf7fa57d49b6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dnsrecursor/manifests/monitor.pp,dnsrecursor: minimal quoting fixes		change-id: iea416ccff3ec3439f2c367c4f3af756952eec3c1	|moved the dns::recursor class into a module		change-id: i0e20676d2e4b54022610363483681b7b8efa14f2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dnsrecursor/manifests/metrics.pp,dnsrecursor: minimal quoting fixes		change-id: iea416ccff3ec3439f2c367c4f3af756952eec3c1	|moved the dns::recursor class into a module		change-id: i0e20676d2e4b54022610363483681b7b8efa14f2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/server/package.pp,add fixme's/ignores for all variable scope issues		all of these show up as "top-scope var without namespace" warnings	in puppet-lint.		and in the global puppet-lint.rc we have this comment:		# we still use the 2.6 way of referencing variables	# 2.8 will requires $::globalname. skip for now.	--no-variable_scope-check		so what i'm doing here is to mark the actual occurences of this	as fixmes and let lint ignore them, but then in turn will remove	that global exception that just turned this off all the time.		that way ci will discourage adding new variables without specific scope.		the existing ones should be fixed, but some cases are easy and some can	be pretty tricky. the ones that are left are mostly of the harder category.	a _lot_ of easy ones have been fixed in the past already,	but for example i remember we tried to fix the one in ganglia before	and it caused problems. so these have to be carefully tested.		we will have to get the fixmes done one by one before puppet 2.8, help	with that would be appreciated.				bug:t125042	change-id: i02619ef50ecb01905b6184bddd3d53fec212d7a3	|mysql: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i712bb124c16d625cc639fca30a683dc11583b77c	|mysql: selector outside a resource + 4 spaces		change-id: i448387252f4650dbb48f1a803bf6498132c18d24	|use apt::repository instead of file resources		change-id: ica0bf234c404dd7e32e9ca928da1b4766b966582	|mysql: lint fixes		change-id: iad6ffec74cb57a7031932b0e790e8d90b1992c80	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/proxy_gerrit.pp,contint: linting fixes and autoload module		change-id: if14293939f2614bb6096f35a27df6debb036cf5c	|contint: proxy the colocated gerrit instance		listening on port 8082 and on the host integration.wmflabs.org.		change-id: ib9f31a330c193b807bfb119469b1bdd3155249e9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/screenconfig.pp,base: move screenconfig to manifest		change-id: if9653bb8e9afd5802f2964d7e52a89840fdaa70d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/external_proxy/manifests/instance.pp,google_api_proxy: add role for google-api-proxy labs project		add a role that can be used to provision one or more nginx reverse	proxies in the google-api-proxy labs project. this project provides	static outbound ip addresses for tool labs tools and other labs projects	that are using google apis.		expected to be used with wikitech managed hiera configuration similar to:		  role::labs::google_api_proxy::instances:	    google-api-proxy.wmflabs.org:	      proxied: https://www.googleapis.com	      default: true	    googlevision-api-proxy.wmflabs.org:	      proxied: https://vision.googleapis.com		this was originally committed as i2fe9263 but then reverted in id199f0c	due to t119042 (putting roles into module/roles conflicts with role/*.pp	import). a readme is added to modules/role/manifests to help remind	people of this potential problem. nobody ever reads the docs, but hey it	is worth a shot.		bug: t144290	change-id: ie9e38b243309d110695c776908c22ce556a7b7b8	|revert "google_api_proxy: add role for google-api-proxy labs project"		this reverts commit 14c72b33d0ef83f60cdf25fa7598fe1e1c77b8d7.		change-id: id199f0c60c58c361c97bac874ffa68dd548175f7	|google_api_proxy: add role for google-api-proxy labs project		add a role that can be used to provision one or more nginx reverse	proxies in the google-api-proxy labs project. this project provides	static outbound ip addresses for tool labs tools and other labs projects	that are using google apis.		expected to be used with wikitech managed hiera configuration similar to:		  role::google_api_proxy::instances:	    google-api-proxy.wmflabs.org:	      proxied: https://www.googleapis.com	      default: true	    googlevision-api-proxy.wmflabs.org:	      proxied: https://vision.googleapis.com		bug: t144290	change-id: i2fe92633d716b0bfb4f9b9928cd7bbc7d3977be0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dataset/manifests/rsync/public.pp,dataset: remove system::role from the dataset module		add system::role to the dataset roles and remove it from classes of the	dataset module. they don't belong there and under no definition of a	role is a cronjob a role.		change-id: ibb7027f280b8c6253691e8ed581af569cd143fb1	|remove role::mirror classes		role:mirror::media can be removed:	< apergos> at this point role/mirror.pp can go, actually	< apergos> we don't serve media via rsync to anyone	< apergos> so just pull it from any host that claims to have it		role::mirror::common was included from a bunch of the dataset module's	classes. it was simple enough and has now been renamed to	dataset::common, under the dataset module.		change-id: i9a45120bfdfae949f72e6f60cec132de137417e9	|dataset: lint fixes		change-id: id3a946f7a1a0771e473130675f28c7083260d73a	|dataset: fix module path		change-id: i439a1854d743870d6be490fe2f3d0187ee3bc082	|datasets: rsyncd conf file pieces must end in .conf for the concat		change-id: i71f57bea84e42ed63c0efa62081690c7a474ebd8	|pull rsync and cron jobs out of 'download' into new dataset module		rsync from/to dataset hosts and cron jobs doing copies may	move among servers, so this breaks up the rsync config into	small pieces that can be assembled as needed for a given	server; the dataset class will expect to be told explicitly	which cron/rsync jobs should be running.		additionally this code should be much more 'module-like'.		change-id: idbe3edadf95c049b0c8cc8a89cb33fdfce84316a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/manifests/role/simplelap.pp,put simplelamp/simplelap roles in autolayout		change-id: i7b1dc45affec823bfae54b70f6b6f0f735394799	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/logstash/manifests/conf.pp,labs: new role::logstash::stashbot class		add a new role and configuration for use in the stashbot labs project to	create instances for logging irc messages.		the irc filters have special handling for messages with certain prefixes:	* !log for server admin log (sal) logging	* !bash for quips logging		* remove role::logstash::ircbot which was previously only used in the	  beta cluster.	* refactor role::logstash to include role::logstash::elasticsearch	  rather than duplicating its configuration.	* update role::logstash::elasticsearch to only apply	  ::elasticsearch::ganglia when $::standard::has_ganglia is true. this	  mirrors usage in role::elasticsearch.	* refactor role::kibana to allow fine grained configuration via hiera.		change-id: ia04219138f3dab667d7c2a667994681aeeabc563	|revert "wmflib: add ensure_final_newline()"		this reverts commit 04945e956f835cb9849146db49df0559a6d28f94.		change-id: ida7f2e2c6b889cc2a04d3569bf8de5ea4e17ef2b	|wmflib: add ensure_final_newline()		if the argument is a string, ensure it ends with a final newline.	if it is not a string, pass it through unmodified.		this function is designed to make it easier to write custom puppet	resource types that delegate to file resources and that take	either a "content" or a "source" parameter.		change-id: ib1f88b11b6308900a0bf0279eaca863793f614cd	|logstash: fixes and tweaks		- make logstash inputs resources, not classes. there is no hard reason why	  logstash couldn't be configured to consume from multiple redis instances.	- change logstash::conf resources in role class to use underscores rather than	  dashes, which are problematic in puppet resource names.	- move elasticsearch package definitions to a class, elasticsearch::packages,	  which can be included multiple times.	- let the elasticsearch package create /etc/elasticsearch, and have	  puppet-managed subdirectories depend on the package as a way of ensuring the	  parent directory exists.	- rather than a discrete readme file resource, make it part of the conf.d	  directory resource.	- rename $config_file variable to $config_name, since it is not the full file	  name.	- make logstash::conf depend on conf.d rather than the logstash package.	  (the package doesn't create conf.d; we do.)	- leave owner / mode / group unspecified when puppet's defaults will do.	  specifying them explicitly makes it seem as though there is some hard reason	  why they must be set to these values, when instead the intent is simply for	  the files to be uniform with other files in /etc.	- don't use a pointless $config_dir variable when it is hard-coded anyway. it's	  easier to reason about manifests if you just have the string literal to stare	  at.	- make 'ensure' param first in cases where it was not.	- store "http://${host}:${port}" as $uri var for concision.	- provide a more descriptive comment header for the logstash's init.pp.		change-id: i3d016458826fa64031cf8e918c50437cdb468868	|fix file permissions and command args for logstash		logstash stubbornly demands to be able to read its config files and	doesn't like to be told about a plugin directory that doesn't exist.	java also really wants us to specify the location of the jar file that	we are attempting to execute.		change-id: iad8822ce5612d3e0c9370a5a6d27dd54ce2ede6d	|remove unnecessary reference to logstash class		the configuration subclasses don't reference variables from the logstash	class, so there is no need to include or require the class within their	scope.		change-id: id3aa3f4017cd994fcad04df68218617ffe82fdc3	|fix circular dependency in logstash::conf		make logstash::conf declarations non-virtual and remove dependency of	class[logstash] on logstash::conf.		change-id: id190808ac003fac937ea1f941ef7e9481d6db8c6	|logstash puppet class		puppet class to install and configure logstash. this class assumes that	a logstash package exists in apt that is built from the debian package	components specified in the logstash github repository.		change-id: i18800e66b55ad9eb28acae160c88a2b9867231aa	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/monitoring/manifests/icinga/bad_directory_owner.pp,deployment/icinga: fix bad directory owner check		- instead of @owner and @group, it's @uid and @gid,	  they did not get passed to the resulting command,	  it was " -uid  -or -gid ", which gave	  "find: invalid argument `-gid' to `-uid'" 	  	- the file name should not end in "needs-merge", that's	  just a copy/paste from another check	  	- remove duplicate underscore "check__srv_m..."			change-id: i2fcb6ee81cb88903c1f8b34902ccae34c21d0f0e	|deployment-server: fix icinga plugin owner/group		the icinga plugin is executed via nrpe, so on the remote	server that is being monitored and not on the icinga server.		therefore, there is no icinga user/group here (on tin/mira) and	this fails with dependency errors.		the other existing checks in that directory are all root owned.		change-id: i650bebf0ecd1e3c09e1847637c7ddd164682fdb3	|deploy masters: improve icinga check for bad ownership		- exit 2 so it'll actually alert irc as critical	- wrap in class & template so it can be reused, roughly based on the	  git staleness check		change-id: ia0e3716393bcadb01452cff14dde974fd44457bf	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/zuul/manifests/configfile.pp,zuul: split conf file for server and merger		we can get zuul merger process on different boxes.  the zuul.conf has	the jenkins api key and i only want it to be exposed on the zuul server.		this generates a zuul-merger.conf file that does not have the [jenkins]	section. merger only requires the gearman, gerrit, merger, and zuul	sections per upstream documentation.		make the merger to subscribe to that configuration file.  we do not	notify since we might not have a merger process (installed via	zuul::merger) on the node.		change-id: i1cbfa8446311b18c9075da023051b528548ae017	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/manifests/logstash.pp,puppetmaster::logstash remove inclusion of base::puppet		no need to include a class that has nothing to do with the resources or	the functionality of the containing class		change-id: ia5ea8e4672c55eb232a36f6de5bea2adcad11b26	|remove the unneeded priorites in filenames		now that we use base::puppet::config, priorities in filenames are not	needed		change-id: i8305150f8edc1bfb619f1793f7af667152e3b93f	|puppetmaster::logstash. fix out of module dependencies		instead of notifying specific out of module resources, use	base::puppet::config to populate the config stanza and allow it to	notify the compilation process		change-id: i4e8ab6864654f457d94cff7ed6c25173a01dffc3	|puppetmaster::reporter::logstash. remove the reporter namespace		having a reporter namespace in puppetmaster::reporter::logstash which is	not being used by anything else is superfluous. fold back to the main	module namespace. while at it perform minor lints to the file		change-id: ife56525a6bafa99be8a106bfcbac4e42fe64fc1e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/bastionhost/opsonly.pp,bastionhost: move roles to modules/role/		split the bastionhost roles into one file per	class and move into autoload layout in the role module.		change-id: i3aa1dc550571198255ed4b2067b05c07b75ac613	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/mwrepl.pp,fix-up(?) for i33966cc28		we're not sure why i33966cc28 blanked values in	/usr/local/lib/mw-deployment-vars.sh, but the best guess we have is that the	require / include caused the classes to be evaluated in a different order. so	change the require to an include, and leave the dependency on scap implicit for	now.		change-id: i9fe789f8179182228444130635fbb2aab59c874a	|better mediawiki repl		this sets up the hhvm interactive mode to be used as a repl to help	debugging. because the repl is always run as the mediawiki web user	shell users don't have their own configuration file. this works	around that limitation by storing per-user configuration files in	/var/lib/hphpd/<user>.hphpd.ini all owned by the mediawiki web	user.		change-id: i33966cc28a62d48642f3e8d875558c6e24205ba4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/librenms/manifests/syslog.pp,librenms: add librenms::syslog class		add a librenms::syslog class which sets up a syslog listener that	pipes to librenms.		this sets up a separate rsyslog instance that receives messages in	syslog (udp 514) and pipes them to syslog.php.		using a separate instance seems more complicated at first but provides	certain important benefits:	* the separate instance runs as the librenms user and hence is able to read	  the configuration file without giving access to the whole syslog	  group.	* there's no mixing of system syslog with the remote syslog and no messy	  filtering to avoid logging the local system's logs to librenms.	* the received loglines are only stored in librenms and are not forwarded to	  the rest of the syslog config (local log files, remote syslog servers	  etc.).		while at it, also add some default options to ignore spammy juniper	lines from the logs.		change-id: i7428047f04ae690af807f211218537c8e79628d0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppet/tests/client.pp,puppet-tests: remove broken inclusion of nagios.pp		the file manifests/nagios.pp has been moved in i21a3ca32fd425dd20	and does not exist anymore in this place.		when trying to compile changes to the tests files itself you get:		error: no file(s) found for import of '../../../manifests/nagios.pp'	like on https://integration.wikimedia.org/ci/job/pplint-head/10231/console		change-id: i6b5279947b24c63e10d0b66974bb3b23c57d46e8	|modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/etherpad/server.pp,etherpad: move role to module, rename to ::server		change-id: idce150f4720e80def1897c72696506c33ddfc6aa	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/backup/config.pp,backup: move roles to modules/role/		change-id: i39e8d35f8a19b6aa23ec681cc5efcb63e91292eb	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/redis/manifests/client/python.pp,use require_package for python-redis		change-id: i74dcf5c606b48174c888ddf77e1c9b5de9a8bd41	|consolidate python-redis package declarations in ::redis::client::python		different software stacks declared in operations/puppet require python-redis,	so let's consolidate the package declaration in a standalone, unparametrized	class that can be included unproblematically from anywhere it is needed.		fixes puppet on silver, broken by change ib487dd5d4:		error: could not retrieve catalog from remote server: error 400 on server:	duplicate declaration: package[python-redis] is already declared in file	/etc/puppet/modules/trebuchet/manifests/packages.pp:14; cannot redeclare at	/etc/puppet/manifests/mobile.pp:79 on node silver.wikimedia.org	warning: not using cache on failed catalog	error: could not retrieve catalog; skipping run		change-id: i7f7a7d795a15f2e435c3a0364a5dab79e6bdcbd9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/quarry/manifests/celeryrunner.pp,quarry: remove duplication of clone_path and other variables		change-id: i155f3b827a73dae806afafeaea0faf747143e12c	|quarry: fix typo i've been making for time immemorial		change-id: i4a148d2880e7677078a9c2c073d2832a178daeb7	|quarry: make the worker nodes use the celery module		change-id: idd7d0de7e0fc3eec44edc869e9f4e759d62eed53	|quarry: lint fixes		"double quoted string containing no variables"	"indentation of => is not properly aligned"	"ensure found on line but it's not the first attribute"		fixes more puppet-lint warnings	for t93645		change-id: i42b298609802e18a60e21bcae5a054b9c78f54e7	|quarry: add a cron based query killer		change-id: i75e5b9ed3c0a5f12524ea2f6d0af727dec4664cd	|role + module for quarry labs tool		- implements	https://meta.wikimedia.org/wiki/research:ideas/public_query_interface_for_labs	- deployed via fabric file kept in the source	  repository at analytics/quarry/web	- nat rules and /etc/hosts for access to labsdb handled	  manually for now	- uses /srv for everything	- uses labsdebrepo for python packages		change-id: i6042041ffe853095970296c103d3d2e7e19b79e2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/backup.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/stdlib/tests/init.pp,add the upstream stdlib module to the repo		change-id: i5b7c29b7fd20373b0d74f660609c628e5f3c8d54	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/salt/minions.pp,salt: fix top-scope var without namespace		./modules/role/manifests/salt/minions.pp	warning: t top-scope variable being used without an explicit namespace on line 30		change-id: ia00738e449c80e9680e8f7e6ca24d2987266d7bc	|remove palladium from list of salt masters on all minions		change-id: i1372ae23c5213a52f1544d02c12d6269e1c09286	|make neodymium primary salt master		change-id: i2095718629380b17521f33096c12bb0632d14a0b	|labs: setup saltmaster separately from puppetmaster		change-id: i748d3e54009f29776c08b20af209fa0e0b10f5ac	|salt: move the role manifests into role module		create the, rather badly named, salt role hierarchy classes manifest	files in the role module. this will unblock id1d3cfaa01		change-id: i92c44cf77ab342e5b61a1320f5999277d8085fee	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/tcpircbot/manifests/instance.pp,tcpircbot: also take input from files		don't start reading the data until we are in the channels though.		change-id: i3226f93ae42863093c7ee0ca2d7f31d3080007d2	|tcpircbot: allow 'channels' to be either a string or an array		'channels' can be a single channel specified as a string.		change-id: i61caa435c88fcd72c1469281ba51fa2f0e07f0e2	|tcpircbot: fix multiple unreferenced var errors		the "few unrelated touch-ups" of commit i0e0209e were broken in multiple	ways, throwing errors because of missing dependencies.		attempt to fix those while keeping the original commit's rationale of	removing useless parameters that noone would ever customize.		change-id: if6379f5c2fedd54460494b98392e4f6d96d8ef8b	|make it possible for logmsgbot to report to more than one channel		some conversations in #wikimedia-dev end up drifting over to	announcements make #wikimedia-operations the natural place to coordinate	mediawiki code deployments and their outcomes. logmsgbot isn't especially	noisy, so perhaps the best solution is to have it log to both channels.	this patch modifies the tcpircbot module to make it multi-channel-capable, and	adds #wikimedia-dev to the list of channels logmsgbot should report to.		includes a few small but unrelated touch-ups to the tcpircbot module.		change-id: i0e0209e5c159210e112c07325e6a4023946cedba	|tcpircbot: tabs to spaces		change-id: id5b1e9e724e489d75804ec81338c3f747bc77daa	|tcpircbot: work with ipv6 & no acl, clarify option		tcpircbot bailed out if the address wasn't ipv4 and skipped the check	for private & loopback, although netaddr supports those methods fine for	ipv6 too. remove that piece of code, making the behavior the same on	both ipv4/ipv6.		also, the cidr option isn't limited to ipv6 at all, so clarify the	puppet documentation to reflect that. while at it, use some better	examples with addresses from the reserved for documentation ranges.		change-id: if23b0802cb19743a40d4fecdd662964735576cea	|tcpircbot: subscribe to (rather than require) config		requiring the config means the bot doesn't get restarted if the configuration	changes, as did in fact happen with change ib33d3cc66: the bot was not	restarted by the puppet run that made the configuration change.		change-id: icd89287f06c289c34ea71940e22447999404245b	|allow multiple cidr ranges to be specified		this patch allows multiple cidr ranges to be specified as a puppet array. this	is required for permitting both tin and fenari to connect to logsmsgbot, since	a single cidr range cannot span exactly those two machines' ips.		change-id: i35c043361b60ea99efb5f06117bd6f107280dde5	|rdoc for tcpircbot class and tcpircbot::instance resource		also parametrizes 'cidr' configuration option.		change-id: iaf0fc648c7700dc234a3bcf49cfbd56521d381b9	|add 'tcpircbot' puppet class		this puppet class configures a python script that listens on a tcp socket and	forwards incoming data to an irc channel. it allows setting up automatic	announcements to irc from machines in the cluster that do not have a public	interface. the script runs as an upstart service. by default, it connects to	freenode via ssl, and listens on port 9200 for messages to forward.		sample configuration:			include tcpircbot			tcpircbot::instance { 'announcebot':		  password => 'nickserv_secret123',		  channel  => '#wikimedia-operations',		}		if a "cidr" key is set, it is interpreted as an ipv6 cidr range. inbound	connections from addresses outside this range are rejected. if "cidr" is not	set, only private and loopback ip addresses are allowed to connect.		change-id: i6d4f661b70e6c4d4111672f5a7f8018389986a18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/openstack/manifests/nova/spiceproxy.pp,openstack: lint, fix alignment		fixes these files	conductor.pp, network.pp, scheduler.pp and spiceproxy.pp		@dzahn helped me to to do my first puppet-lint :)		change-id: i994ce37253be10fe0ef355f3de24f85025cb78bb	|turn on spiceproxy and consoleauth on the labs controller.		change-id: ic0cb07a23ad4c0ec6687bcfe7d89c803a81d76ce	|i can't stop making typos		change-id: if07eb204d1234ee194fa5c054f21ea703b7b2b6f	|typo fix re: spice package name		change-id: icec63ccdd29ba91e307f004a2251ef790eab5044	|changes to spice proxy to work behind misc-web:		- use a hacked spice_auto.html that uses wss:	- update urls accordingly		change-id: i795d7f61ae5d9509cdb02610d63e0d9d7922f2a4	|set up spice-based remote consoles for labs instances		- console is restricted to admin_api for now	- since this is an incremental step, the console proxy is	  stopped by default,	- this requires an accompanying misc-web patch which is done	  for labtest but not for normal labs	- this also rips out and turns off some old novnc configs that were	  never good for much.		bug: t141399	change-id: ic1eb875808660f00802794d61c12d1176d3823a9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/swift/manifests/storage/monitor_swift_daemon.pp,rename swift_new to swift		can be reproduced with:	  git mv modules/swift{_new,}	  git mv hieradata/common/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}.yaml	  git mv hieradata/codfw/swift{_new,}	  git mv hieradata/codfw/swift{_new,}.yaml	  git mv hieradata/esams/swift{_new,}	  git mv hieradata/esams/swift{_new,}.yaml	  git grep -l swift_new | xargs sed -i 's/swift_new/swift/g'		change-id: i22102da8b14a31719927355ff3efbe19717fcfae	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/phragile/labs.pp,phragile: move role class to autoloader layout		move the role class to module role to a foo::bar	structure to put it in proper "autoloader layout".		in this case "labs" just makes sense for what it is.		fix "class not documented" by adding a link to	mediawiki.org about phragile.		change-id: ifaf729d862d2f5fe59d297c75a1acc2086fa9d79	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/authdns/manifests/monitoring/global.pp,authdns: page on global alerts		a failed ns0/ns1/ns2 is probably bad enough to warrant a page.		change-id: i4bc8844904bd25db13d4f43af017a6ef3a8de670	|nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|monitoring: move monitor_host to monitoring::host		change-id: i362dac76eb4d2d58d91c138a2b708396888ad721	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|authdns: switch to all ips on all hosts		under this model, the daemon listens on the any-addresses,	and the interfaces are set up so that all of them can	answer any of the public addrs so that routing/anycast is	independent of server config.  if any public dns service ip	gets routed to any box with role::authdns::server, it will	answer those requests.		change-id: ic64c2a8955dd560234c2fbcc6fd6084e7917baaf	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/programdashboard/manifests/init.pp,program dashboard configuration for initial labs rollout		defined role::programdashboard::app and programdashboard::app which	provision rails application dependencies, passenger setup, and the	deployment directory. this setup assumes that deployments will be	executed using capistrano and the existing configuration within the	application repo.		a labs specific database setup will be included in a follow-up patch.		bug: t105967	change-id: if6d8deed74dd6def372dee6df786c7594bddbe0c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/maintenance/updatequerypages/enwiki/cronjob.pp,monthly update of the "slowest" querypages on the english wikipedia		per user reports, an update every six months is not enough to keep	up with the amount of maintenance work (for instance, the new pages	to be tagged as orphan are probably more than 10k per year).		the other cached special pages are updated twice a month on the english	wikipedia; some update is run on s1 on the days 8–13, 11 and 22–27.	days 15–20 are free and should not cause strain on the dedicated slaves;	in any case, the query killer should prevent damage and reverting	this patch is easy.		bug: t142936	change-id: i06f7ca60bc3caa0b68f093182682248961288a59	|mediawiki/updatequerypages: move defines out of class		change-id: i24da60749b999c57ece8283888d40af9d4404084	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sslcert/manifests/ocsp/hook.pp,move tlsproxy's ocsp stapler/updater to sslcert		now that the tlsproxy's ocsp stapler/updater has been made more generic,	create the necessary abstractions within the sslcert module,	sslcert::ocsp::conf and sslcert::ocsp::hook, and move the vast majority	of the contents there. this makes it useful to other modules as well and	factors out functionality that doesn't fit the tlsproxy module all that	well.		change-id: i0a050585cb5f61fae8411f8db93228e9b81078cd	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/manifests/views/dns.pp,remove misc/monitoring.pp, remove import 'misc/*.pp'		remove misc/monitoring.pp, rename and move all the classes	to ganglia::views in the ganglia module.		this also removes the entire import 'misc/*.pp' from site.pp	because this was the last file in there. there is even	an error if i don't also remove that at the same time.		http://puppet-compiler.wmflabs.org/3244/uranium.wikimedia.org/		change-id: ie62b3041a6eae5aa06f7f172d80d223b10194cce	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/requesttracker/manifests/forms.pp,turn rt from misc/* into puppet module		move rt from misc/rt-server-apache to module	structure		add role class, move variables into role,	formatting, quoting, misc..		seperate into classes by function:		- packages	- config	- forms	- plugins	- apache		move all the apache related stuff together,	make separate file for installing more plugins,	same for the password reset form which still has issues,		move the files into module and fix "source"s		move the templates into module and fix "content"s		add monitoring		remove 2-spaces,.more..		change-id: ib0e7476a612b25f37905f9f475521606d3bb73d7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/squid3/spec/fixtures/manifests/site.pp,add readme, rspecs and tests for squid3 module		the squid3 module relies on wmflib and stdlib for validate_re and	ensure_service. this rakefile honors that		change-id: i2519f3ce6764590e7d7900c3975af80e6354f6a7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/diamond/manifests/collector/servicestats_lib.pp,diamond: move _lib classes to own files		each class should have its own file, per style guide	and lint check.		change-id: ibbdab575b26b3f06d9986351ac01b5db53534872	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/admin/manifests/init.pp,admin: stop passing around a huge data structure		our current puppet catalogs are huge becuse for every group and every	user we have a specialized copy of $::admin::data, which is a very large	hash indeed. use direct references to it instead.		change-id: i526f659dccabb1726c7dda14b3a50cc6fd5a0828	|admin: add all-users group		it might sometimes be useful to group all users with a shell in a single	unprivileged group.		change-id: i315cb201108470c6b4fbc4c1dc9e3446254194cd	|admin module enable user cleanup		change-id: id1f558cf1674b4204473a2dc7da212fab4f2c467	|move /etc/sudoers from module "admin" to "sudo"		this isn't specific to the admin module, so might just as well move it	to the sudo module and include "sudo" instead.		the sudo module also had a "sudoers.labs" sudoers file that would	conflict with this, but fortunately it had the exact same contents, so	we can just drop it. yay deduplication!		this is part of a broader admin/sudo consolidation.		change-id: i43e0c56c055c0f213b49a1f59ce1f049d86c95b8	|admins: use concat() instead of an inline template		* also backport concat() from more recent stdlib versions		change-id: idfb7c5c769181ca086d6d10d2467be55b177bfb2	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|fix sudo stuff for ops/sudoers		allow ops members to sudo for all,	make explicit ownership of /etc/sudoers		change-id: i92227c1df2e4295964607e9d78eba40ca16166da	|manage wikidev group explicitly		change-id: if744b12ead67b7673a2ea840e8c601c98c9e48a2	|removing automatic cleanup logic.		for initial rollout we need to audit the systems in groups	and probably individually before enabling this.  i am removing	it all cleanly in one commit leaving the script for manual	investigations for revert.		change-id: idc077904212c3d917de984c88f2d1106fb27d54d	|admin module for user/group/permissions cleanup		users/groups/perms are meant to be defined in yaml.		applied like:		yaml:		  groups:	    test1:	      gid: 1	      members: [foo]	    test2:	      gid: 2	      members: []		  users:	    foo:	      uid: 1	      ...		.pp	  node /foo/ {	    #groups create their users (can overlap) and permissions	    #as well as system groups and handling user membership	    class { 'admin': groups => ['test', 'test2'], }	  }		more info see: admin/readme		change-id: i6982bfced50a22faac37246dff4d52ff163a34ed	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/toollabs/manifests/hostgroups.pp,tool labs: gridengine puppetization, iii		this phase adds the host-unrestricted node config for the new	compute::dedicated node type.  it also now places nodes in the	proper hostgroups and queues.		it also adds the needful gridengine::collectors::queues class.		change-id: i9931a2603e74b814529aa9f639036a442b64c7b8	|gridengine: proper puppetization, part deux		- fix default config (merge cannot support multiline values)	- group names must start with '@'	- rejigger how configuration is collected in the shared	  config directory	- move resource collection from the toollabs to its	  proper place in gridengine		change-id: id9249c61a0a5569e13e4a8fe1568bf9e79e9b1b9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/rcstream/manifests/proxy.pp,rcstream: listen on ipv6 too; apply lvs::realserver		..and lint some whitespace in the nginx erb	..and refresh the nginx service		change-id: ief7b8843ec2db03950c1af7c1d129ac9e605225a	|add 'rcstream' module for broadcasting recent changes over websockets		this change introduces an 'rcstream' module, which provisions a small and	self-contained software stack for broadcasting recent changes using websockets.	it is designed to work with the redispubsubfeedengine class in mediawiki.		the setup consists of the following components:		* a single-file python server, powered by gevent and socket.io.	  each instance of such server can serve multiple clients concurrently.		* an upstart task (rcstream/init) that spawns multiple instances of this server.		* nginx as load-balancer / reverse proxy. nginx 1.4+ (and therefore, trusty) is	  required, as earlier versions are not capable of proxying websocket	  connections.		why websockets? admittedly, it is not the world's prettiest protocol. but it is	very widely supported, and it is what users want.		please see the included readme file and the in-line documentation for details	about the setup.		rfcs fulfilled / obsoleted by this change:		* <https://www.mediawiki.org/wiki/requests_for_comment/publishing_the_recentchanges_feed>		bug: 14045	bug: 17450	change-id: id819246a947dfe1e32d9fd9c13570858cdaaa39d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/manifests/monitoring.pp,puppetmaster: puppet-lint fixes		change-id: ib2526afffd7270eee0432bce18e12ec396f8ae7b	|change rt references to phabricator tickets		change-id: icf3b230b9a3192e53d71cf4dec98aefd5e917b71	|nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|monitoring: add check for git merging of important repos		a check for outstanding merges in the puppet tree on the puppet masters	and of mediawiki-config on the deployment masters is introduced. see	rt #1658 and #7427.		also, some reorg of the puppetmaster module resources is done.		change-id: i9bd1e7ef79ef148a6c31ab3a538c2d90e70a1c5b	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/salt/manifests/master_environment.pp,salt: lint cleanup		change-id: i71dc0694f0d14b7064b8e880529d6c26f3c9f31c	|simplify salt module		change-id: i228b3294022efa391f0f79353ac1db8a2f8f35f4	|add salt reactors for bootstrapping puppet		reactors can respond immediately to events sent by salt. our	current bootstrapping process in labs for puppet involves a cron	that runs once a minute. by installing salt first, and having salt	run puppet we can more immediately start a puppet run, eliminating	up to one minute of time needed to create an instance.		the reactor chain works like so:		1. salt requests a certificate -> auth: pend (auth.sls)	1a. an ldap lookup is performed for the key, if found, it's signed	2. salt key is signed -> key: accept	2a. a temporary file is written to the master indicating a first	    salt run has not occured yet	3. the minion's salt process starts -> minion_start	3a. if puppet hasn't requested a cert, run a command on the minion	    requesting a cert and have it fire a puppet: first_run event	3b. if puppet has request a cert, have the minion fire a	    puppet: first_run event	4. a puppet event is fired on the minion -> puppet: first_run	4a. a command is sent to the minion to do a full puppet run, and	    to fire an event: puppet: run_finished	5. a puppet event is fired on the minion -> puppet: run_finished	5b. the temporary file is removed		change-id: ia23557cc7c69b3d1ed6da6a1cc6b738566adce7a	|merge "adding reactor support" into production|adding reactor support		change-id: ic1d3208c0aa79ac656e51279c2e46b68788a6df6	|only define the directories if they aren't already		change-id: i66360371343d2478c4272c349c917c6223184d94	|add the sync_all salt state		change-id: i1c88953fb37612b7ce3c05f89626d8f111712b25	|actually deploy deploy_redis		change-id: ifb3fd5fe044697e28062bd935871eab226451397	|add module, runner and add module directory		change-id: i0c758868a3df8a7b2065241c1ec04e8d099968fc	|initial commit of deployment module		change-id: i704fb98c4c651b10fcdea16eb151e92d3e88fd06	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/tools/master.pp,tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/librenms/manifests/init.pp,imagemagick: create class imagemagick::install, use on librenms		this installs both the imagemagick package and the corresponding policy		change-id: ie15257bb47695ba433d189b66eee190b279c36e9	|librenms: add new cronjobs, remove stale settings		* new alerts.php cronjob is needed for alerts.	* email configuration was moved into the web ui/database, remove from	  our config.		change-id: ibb1877b250c50aa1876696154bd8005159e2df28	|librenms: provide a database purge script		the syslog and eventlog tables in librenms grow without a limit. that	can cause problems after an amount of time. provision a python purging	script that will purge everyday the last month of data for syslog,	eventlog and perftimes tables		change-id: idf622aafd06871abc95997b34164c22967b85268	|librenms requires snmp		librenms requires the snmp package to work. seems like it calls	snmpget/snmpwalk and the rest of the family. this had been commented out	in i6620ff7bb206d8fee4fb18607930195382611ec9 since base::puppet also	included it and ended up in a duplicate definition. since that part is	no longer true, uncomment the snmp package in librenms		change-id: i8c067162b1ff4be6bbbed83ae6c7688896ce39e8	|revert recent generic::systemuser conversions		this isn't prettier, or more abstract. it's just uglier in syntax,	includes far too much magic that is also wrong. it's also conceptually	wrong as it adds a membership to a virtual supplementary group of	"systemusers" that won't and can't include all system users.		the right way to go here is to keep using system => true to mark system	users, that would in turn use adduser & adduser.conf's fist_system_uid &	last_system_uid to designate whether a user is system or not.		this reverts the conversions for the following users:	icinga, mirror, gitblit, ipython, librenms, limn, ocg, tcpircbot.		this reverts commits:	  - 13932dcfe3e092dc23c63f0df643c0408d46f351	  - dcf55c490c5c2990c807e3d692bba872981b8952	  - b66eb8c7a54d0e55899149d04435eec448d11865	  - 76fdd4a29d892089c8da9f41b0c2247abfa1fd35	  - b6f8462bb68a248b20b031ffcbc227688e707804	  - 98e6ab557e7b113e1724572910ce0a9cb7eaf14d	  - 9c5fc3843246f894a5919164ae10c429c983db4f	  - 3ba59bc5dc341e1a5e51c6a62c8cfbcb4146d53b	  - 3df220dbe688896723b3975131a7427d8c9860c7	  - 80d3f1fcb9be8a4087652b5200c8dc8c66a1db1b		change-id: i8445bf3a8fb1a47385aa36d226fe5291c2cacc1e	|librenms use generic::systemuser		change-id: id3204bb15879d9a2b8bdc572179e86b6bbb389a1	|librenms: make main class' "config" option simpler		supplying install_dir, html_dir, rrd_dir & log file to the config hash	is kind of wrong, as it's not kiss: the class already knows the best	position for these and sets up other stuff based on these locations	(e.g. logrotate). pass them to the config.php template instead, outside	of the config hash and simplify the caller.		change-id: i6620ff7bb206d8fee4fb18607930195382611ec9	|librenms: add librenms::syslog class		add a librenms::syslog class which sets up a syslog listener that	pipes to librenms.		this sets up a separate rsyslog instance that receives messages in	syslog (udp 514) and pipes them to syslog.php.		using a separate instance seems more complicated at first but provides	certain important benefits:	* the separate instance runs as the librenms user and hence is able to read	  the configuration file without giving access to the whole syslog	  group.	* there's no mixing of system syslog with the remote syslog and no messy	  filtering to avoid logging the local system's logs to librenms.	* the received loglines are only stored in librenms and are not forwarded to	  the rest of the syslog config (local log files, remote syslog servers	  etc.).		while at it, also add some default options to ignore spammy juniper	lines from the logs.		change-id: i7428047f04ae690af807f211218537c8e79628d0	|librenms: discovery fixes		- add snmp-mibs-downloader to fetch proprietary mibs.	- explicitly set the autodiscovery modules, and disable snmp scan.	- switch from poller.php to pollerwrapper.py, per the manual.	- add html_dir config option to restore icons		change-id: ibbcc781093e04b133f80f712a56a4b1b0071e002	|librenms: another round of misc fixes		- add a project name, title & logo	- switch rrd storage to /srv/, as there's plenty of (lvm) space there.	- enable mod_rewrite, since it's used by .htaccess	- switch docroot to /html, as originally intended.	- change nagios check to mention "librenms http" in the description, to	  make clear which service is broken.	- remove now virtual php5-json; add php-net-ipv4/6	- fix a typo in one of the crontabs	- fix config.php to not override librenms' default settings		change-id: i80170aa558ff4d132c99582f4106731d980aae29	|librenms: more syntax fixups		change-id: ib6d7f358ae0b705acd64d0a6e829ca0854151d2a	|add librenms module and role class & apply it		librenms is a gpl observium fork. sets up apache, user accounts, cron	jobs and provisions via trebuchet from an internal git mirror.		change-id: i61073f915b8c5a5b26b28c60b6888563a268c6b1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/monitoring/manifests/group.pp,revert "monitoring: add config class"		this reverts commit 6a79118623d15560ca58ecb1fac6ea2a41346a63.		the	 class['monitoring::configuration'] -> monitoring::host <| |>	 class['monitoring::configuration'] -> monitoring::service <| |>	 class['monitoring::configuration'] -> monitoring::group <| |>	syntax does not just create a dependency but also realizes all exported	resources.		as the class gets included on every host (via base::monitoring::host),	this means that every single host realizes exported resources and writes	nagios configuration files to /etc/nagios.		revert for now, until a better solution is found.		change-id: i5754ac714ee204e8f07d443ccd94ada5769120a6	|monitoring: add config class		change-id: ib3250a17784df29aec4fb77737b9999b0927f038	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|monitoring: convert monitor_group to monitoring::group		also, move decommission_monitor_host, which seems useless anyway.		change-id: i52461750f38d8bff7da9358654bf45a5feeb44ae	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/gridengine/manifests/queue.pp,gridengine: lint fixes		change-id: i67605d493666c952d742d363a617d7720301d027	|tool labs: rm obsolete gridengine::resource param		completely, this time.		change-id: i59520e85c5dbd3caabb41de24da0ea84a75558f5	|tool labs: final fixes to gridengine iii		- make collection of dedicated queues depend on membership	- remove unneeded parameter to submit_host	- submit_host needs (noop) new-style config parameter	- add adminhosts support	- fix gridengine::hostgroup and gridengine::queue to use	  the new-style config parameter		change-id: ia41417e874e0152a889934a24bb30edad152ed28	|tool labs: final(?) fixes to gridengine iii		- add dedicated node queue config	- expand templates at the last minute so that $title is	  correct (and all variables are otherwise available)		change-id: i5bcc9d0cfbf9fc3962decd8a1b885cdde7c21398	|gridengine: proper puppetization, part deux		- fix default config (merge cannot support multiline values)	- group names must start with '@'	- rejigger how configuration is collected in the shared	  config directory	- move resource collection from the toollabs to its	  proper place in gridengine		change-id: id9249c61a0a5569e13e4a8fe1568bf9e79e9b1b9	|labs: further fixes to toollabs and gridengine		this reverts commit d67485f8d4cebe0cab1d9e2f6f585bed6e507e30.		change-id: i64627e202900b4d7bbf0334bf64261c9f86d73e7	|labs: puppetize gridengine		much of this will need tweaking and hacking; gridengine is /not/	amenable to simple puppetization because most of its configuration	lives in a bdb.		most actualy configuration bits are nooped with 'echo' at this	time while testing takes place.		change-id: i7856b65ebead6aae04777c4851ef3c7771b239f5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mirrors/spec/fixtures/manifests/site.pp,rspec install-server fixes		ubuntu-mirror has been removed from the install-server module and its	functionality moved into the mirrors module. update the install-server	module's rspec tests to reflect that and create rspec tests for the	mirrors module. update the tests as well and fix a latest=>present	ensure on atftpd as well		change-id: i8f959b6eaae3018b1f479d33557c581320f05b44	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/composer.pp,contint: decouple slave_scripts and composer		contint::slave_scripts installed a lot of stuff. with the recent removal	of phpcs, the class ended up:		* creating /srv/deployment/integration	* installing composer	* clone phpunit	* clone slave scripts		factor out /srv/deployment/integration creation to	contint::deployment_dir		move composer installation to contint::composer. update a toolllabs	reference.	move phpunit installation to contint::phpunit. it is still needed by	operations/mediawiki-config job.		while at it remove the git::clone ensure => absent for phpcs. no more needed.		finally, the sole place where we need composer and phpunit is on the ci	labs slaves, thus add contint::composer and contint::phpunit in the	role::ci::slave::labs.		bug: t128092	change-id: i4063ff1c1576b2bfc400cdb7a85c6b39ce0e44ca	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ci/publisher/labs.pp,ci: split and move role classes to modules/role/		split the large file into one file per class for	readability and per style guide and lint.		move them into ./modules/role/ and into the proper	autoload layout without renaming any classes or	changing content.		change-id: i3d514e64b56dcba5486ffbd2f22eb95d8326e1c9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nrpe/tests/check.pp,refactoring nrpe module (round 2/??)		/usr/local/lib/nagios/plugins directory for plugins shipped by module	merge nrpe::packages and nrpe::service classes in nrpe class	nrpe class now accepts an allowed_hosts argument. it defaults to undef.	cleaned-up service['nagios-nrpe-server']	 hasrestart defaults to true in puppet 2.7	 hasstatus defaults to true in puppet 2.7 so pattern is not needed	 restart not needed (init script works fine)	updated rspec examples	updated puppet tests	removed spec fixtures that caused a problem with puppet doc(cyclic deps)	added rake code to create and purge above fixtures before each run	updated nrpe_local.cfg.erb	nrpe::check now ships virtual resources which are realized by nrpe class	virtual monitor_service resources tagged nrpe are no longer realized by	nrpe class (none existed anyway)		change-id: i96bcccae226c0b308ec528a52259d4c1bf764afb	|refactor nrpe to a module		turned the manifests into a module, added/cleaned up documentation, made	puppet-lint happy, moved/created templates and/or files. added unit	tests. also update site.pp/base.pp to not explicitly load nrpe.pp	still needs some love but this will work for starters. rspec tests have	also been added, but fail at this point		change-id: i64a9f1d60cbabeef3a096981d634d7399d39bc45	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/manifests/role/access_new_install.pp,add "lint:ignore"s for several "puppet url without modules"		just adding lint:ignore's and comments. they are also	meant as a question if these should move into a module	or not and what the plan is for files that are actually	used by multiple modules. in other places we don't seem to	mind that modules use files from other modules but we also	don't like the global ./files/misc structure and neither	does puppet-lint.		fixes several "warning: puppet:// url without modules/ found"		bug:t93645	change-id: i1f510cb37a6391698519d5fd3f1f53a960dbef86	|puppetize the install_console script		change-id: i51595dff8668cb6a1aa1057a08f343516ce8ed76	|role: align arrows in manifests		change-id: i7f2777652de46349e175ab0e8c68a5a840e866d6	|move majority of privates/files usage to secret()		this is all of the trivial cases, where a fixed path was hardcoded	as the source attribute of a 'file', 'ssh::userkey', or	'exim4::dkim' definition, all of which are known to handle the	source/content switch ok.		change-id: i0db6fdb1c75355b58095e0ec29d6028bbc614649	|access_new_install: minor lint		change-id: i7ff1a3aff4ba11a5d342dfc58b7b1f96777aa22f	|puppetize the new_install key on palladium, add to iron.		change-id: i5a02a59e140d50b5301778b19c6f7feb457e80c3	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/ganglia.pp,kill a few more hardy references		change-id: i0a121e18d1381afea8c8b68e7b68adadeeea8553	|ganglia: drop the "gmond" service alias		now that gmond is ganglia-monitor everywhere, drop the alias => gmond	from both ganglia and ganglia_new and adjust all call sites to notify	service['ganglia-monitor'] instead of service['gmond'].		change-id: if5dff9bd3f2032998a4712cb6d11a8e061874fe7	|mysql_wmf : lint cleanup		change-id: ie1062ceb9357e6a7502272c213e4324d49061217	|specify group & permissions for a couple of files.		for some reason these changed when these files were modularized.  safest	to be explicit.		change-id: id00a37206e18514610288c4c6812ced952e1b82b	|move mysql_wmf into a module.		the manifest changes here are pretty brainless -- i split the major	classes into separate files and rearranged the file and template	includes to reflect the new position of the source files.		i also moved quite a few files that were filed under ganglia	or icinga but only used by these classes -- now they live in the	mysql_wmf module instead.		change-id: i31b8d8562f8eda4a6fde4a6110d83a339fc38b94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/gridengine/manifests/join.pp,gridengine: proper puppetization, part deux		- fix default config (merge cannot support multiline values)	- group names must start with '@'	- rejigger how configuration is collected in the shared	  config directory	- move resource collection from the toollabs to its	  proper place in gridengine		change-id: id9249c61a0a5569e13e4a8fe1568bf9e79e9b1b9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/tools/static.pp,tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/elasticsearch/manifests/decommission.pp,setup logrotation for elasticsearch.		also remove some log files that are confusing.		change-id: icbb1cb49e28cb0b662309ac3ef3efd6420300e77	|add elasticsearch module and role.		i make three changes from the default debian install, all of which are	recommended by	http://www.elasticsearch.org/guide/reference/setup/installation/	1.  make heap size configurable in the module but default it to 2g which	is good for labs and probably beta.  i just guessed a big number for	production and imagine we'll change it.	2.  turn on mlockall.	3.  turn on logging to see if mlockall works.		change-id: i0d764c34c7a35f53fa0b22a4732697ab98ff70ec	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/osm/manifests/ganglia.pp,fix indentation in various files		change-id: ib442c919c46f5ec0176de46e10f0d51a2aa94afe	|ganglia: drop the "gmond" service alias		now that gmond is ganglia-monitor everywhere, drop the alias => gmond	from both ganglia and ganglia_new and adjust all call sites to notify	service['ganglia-monitor'] instead of service['gmond'].		change-id: if5dff9bd3f2032998a4712cb6d11a8e061874fe7	|set state file path for osm ganglia plugin		also fix the too strict permission for /srv/osmosis while at it so that	the plugin may work		change-id: ic87621f8d3a441ef240a284a768408761a4365c4	|ganglia plugin for openstreetmap sync delay		adapted the postgresql one to measure the osm planet lag		change-id: i5384372cce10d2108c246408cbd86f7babae05f2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/package_builder/manifests/pbuilder_base.pp,package_builder: set path for cron updates		cowbuilder calls pbuilder without an absolute path to it. while this	obviously works from the console, due to default cron entries missing	/usr/sbin from the path variable, cron updates fail. specify environment	explicitly to have this fixed since it is not currently fixable in	pbuilder itself		bug: t125999	change-id: ie3f0836b1e8b31eb58958926c5d88445c3863889	|package_builder: mute cron update commands		no reason to receive the cron spam		change-id: ia8aaf063b22d6e8dae2bafa85136851f5efd675f	|package_builder: keep environments updated		create a cron entry per environment to execute cowbuilder --update once	per day to keep the build environments updated, removing the need to	manually either update or clear manually the environment so it can be	recreated		change-id: ie019df522449902e75de14c2d0e2e5496bf5088c	|package_builder: support distribution name aliases		the default environement creates the debian image for sid/unstable with	the name sid.  some packages target the release 'unstable' and thus can	not be build because there is no image associated to it.		we could use the hook to transparently rename the distribution from	'unstable' to 'sid'.  seems easier to just symbolic link the image.		add to package_builder::pbuilder_base a $distribution_alias parameter	which let you create such symlink.	factor out dupe paths forging in a single variable $cowdir	document the package_builder::pbuilder_base define.		bug: t111097	change-id: i48f9f9a4e99db489e7d6c6a5c225dec4c5ccd9a8	|package builder module		a module used to create a debian package builder environment base on	cowbuilder. intended to be used in labs for streamlined debian package	building. creates 4 environments to build packages in:	 * precise	 * trusty	 * jessie	 * sid		respective hooks for the environments are being installed as well and a	mechanism to easily change between environment via an environment	variable is provided. tests included, as well as a readme		change-id: ic8452ee447dcf485f6af822627cc117b3931b795	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/quarry/killer.pp,quarry: move role classes to module role		change-id: idd7f078180d8d743de5f8602647b199421476ec0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/varnish/manifests/init.pp,re-added varnish module directly (no longer submod)		change-id: i499c01c37ce517d57fcb0178089c2ab68aace21e	|removing modules/varnish in prep for adding it as a git submodule		change-id: i3a331b40b21a506ed5e270a738ce9342084e8d6b	|move manifests/varnish.pp to a module		change-id: i12f9956c9a16829b4bcf53820c5df110dc81fbb5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/java.pp,mysql: make lint ignore classes inhering from params		instead of globally turning this off in puppet-lint.rc,	mark the few actual occurences as fixmes and let lint ignore	them in those specific places only.		change-id: i5deef55101c5105007521ff366182af955baf29b	|initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/coredb/monitoring.pp,nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|rt 7090 - adding analytics contact group to researchdb icinga alerts		had to add parameterization for contact_group on	role::coredb::common and mysql_wmf::coredb::monitoring.		change-id: i1a01c7d0230c9a24e02f47e5473ba61c4a54e716	|appears to need same fix as if0117511497ee1457e63d2710f1c3e29f4f44bc0		change-id: ibdc0e3db56849b8bd2115a1880dd9d22f5a464db	|mysql: change nrpe monitoring to use nrpe::monitor		change-id: i100a7adb4211b7fc6f0e7a37471010d4371a795b	|mysql_wmf : lint cleanup		change-id: ie1062ceb9357e6a7502272c213e4324d49061217	|move mysql_wmf into a module.		the manifest changes here are pretty brainless -- i split the major	classes into separate files and rearranged the file and template	includes to reflect the new position of the source files.		i also moved quite a few files that were filed under ganglia	or icinga but only used by these classes -- now they live in the	mysql_wmf module instead.		change-id: i31b8d8562f8eda4a6fde4a6110d83a339fc38b94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/zuul/manifests/monitoring/server.pp,zuul: update monitoring regex check		0889192 switched zuul install to be provided by a debian package. the	merger and server process are now in /usr/bin and are invoked using	python from the zuul venv /usr/share/python/zuul/bin/python.		change-id: ia4d5667df870b7b60ef48c5dba412bd196ada5e5	|zuul: move icinga checks to zuul::monitoring::server		part of phasing out zuulwikimedia, move nrpe definitions to a new	zuul::monitoring::server class.  will later add one for merger.		the reason is that some servers will only run the merger, so we will not	want to monitor the server on those nodes.		change-id: i99bfb7a4a01d29925443fb4424b4341f26fe0e1b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/git/manifests/userconfig.pp,move and rename the (currently unused) gitconfig module.		now its one define lives in the 'git' modules as git::userconfig.		change-id: i75cb88052a09bcbdb39884d15c1b6ba7949f86da	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/systemd/manifests/sidekick.pp,systemd: add systemd::sidekick		sometimes it's useful to have secondary actions to be performed after a	service is started and after it has been stopped, and such actions do	not need to be performed synchronously with the startup/shutdown.		a classic example would be pooling/depooling one service from the load	balancer based on the service status here.		this small define introduces this functionality for systemd only.		change-id: ia121a20659bb0cca2c1cc0134279f18fbb230418	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/statistics/manifests/sites/pivot.pp,add the pivot.wikimedia.org vhost to stat1001		this site will be a simple reverse proxy to the nodejs service serving	the pivot ui, used to limit the access to authenticated clients (via ldap).		context up to september 2016:	there is a current dispute between imply and metamarkets about a possible	copyright infringement related to imply's pivot ui.	the analytics team set a while back a goal to provide a pivot ui	to their users with the assumption that all the code	used/deployed was open souce and freely available. if this assumption will	change in the future, for example after a legal sentence, the analytics team	will take the necessary actions.	for any question please reach out to the analytics team:	https://www.mediawiki.org/wiki/analytics#contact		bug: t138262	change-id: iefd2893a1dab5e2da660ba83d42813ad891ee8e2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/packages/ops.pp,contint: add python-etcd to the latest version (for conftool)		change-id: i1f47d5c5ce3635ca5b4eeebee950f49f07561f12	|contint: migrate ops dependencies to a new class		to migrate the jenkins tox jobs to nodepool, i need to build a new image	that has 'etcd' and the gdnsd linter.		the jobs are currently running on the light slaves, but i cant include	role::ci::slave::labs::light when building the image.		introduce the standalone contint::packages::ops which can then be	included in the nodepool images.		i added an harness based on $::operatingsystem since requires_os() does	not work when building the images (needs to override facts).		change-id: ib097f2131fa08445c83e378f829eee9d31220f4d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/conftool.pp,mediawiki::conftool: add mw-pool		this is a specialized script that you should use when pooling an	appserver for the first time or repooling it after it was set to "inactive".		change-id: i36420cd1533940baf4e0cd7960d37cc6c04e1cbc	|role::mediawiki::webserver: add conftool scripts		this will allow pooling/depooling from the appservers themselves.		change-id: id7e0d130a5b39d986239eeadc6a5a3945f178ea3	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/elasticsearch/common.pp,elasticsearch cirrus - align configuration for deployment-prep		while renaming elasticsearch roles, deplyoment-prep was not taken into	account. heap size need to be externalized for deployment-prep.		see also: https://gerrit.wikimedia.org/r/#/c/304067/		change-id: i8709b8d359bc2969b4407d5c56a8d08fa4d0cdcd	|elasticsearch - move relforge to its own role		as suggested during an irc discussion, create a specific role for relforge,	move all common bits in role::elasticsearch::common and simplify the hiera	configuration.		a few other clean up / improvements are part of this change:		* add icinga checks for relforge cluster	* update debdeploy configuration for relforge cluster to make it part	  of elastic canaries		change-id: i83d5ef5728aa5851ccf2d4d9cfde803bba0e9c6a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/clush/manifests/master.pp,clush: put clush config in correct location		change-id: i94d69d4454cb4012e34812eccb15927bd56c9fc5	|clush: fixup missing dependency + secret		not entirely sure how they got lost.		also enforce use only in labs. running this in production has	a lot of other challenges.		change-id: ia39f7b9672b90c462bb4312b1facfdefda46e098	|introduce 'clush' module and toollabs role		change-id: i6f3ffa16b759ddb4c2fd6bf5753b82796d84c6d8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/html5depurate/manifests/init.pp,html5depurate: notify on config changes and update security.policy		the jar file location changed in 1.1.2		change-id: i789bf716e3bea76203b634aaa4521030d9c35256	|add html5depurate module and role		change-id: i606a3645b865ef5d9c96c8f44b0f0cc4b9e3122b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/manifests/role/xhgui.pp,xhgui: move role to module structure		move the role to module/role and into a foo::bar	structure which fixes autoloader warnings.		change-id: i49bef86095657583804fcae8582d4c20b636f202	|xhgui: provision xhprof ui		it'll be useful for us to be able to upload and share xhprof profiles with one	another. so provision the xhprof_html ui that ships with the xhprof extension.		change-id: id29a55589284fc064bada78c881d3f2e9e3a9668	|fix whitespace-related lint issues		fix a lot of lint warnigns due to incorrectly aligned arrows.		change-id: ib062d7142a79a8cb6bb3abd86fd7499aa3edad03	|add a comment about manually-created mongodb indexes		in lieu of proper puppetization, add a comment which explains how to create the	indexes xhgui needs on the mongodb instance it is using.		change-id: i88fe13fbd7066b00b0eacacf845facdf3362e2d9	|xhgui: enable php opcache		change-id: i5fc3a30100784736bbe68ff8a2bc7c7262ea2197	|xhgui: increase memory limit to 512m		128m was causing requests to fail.		change-id: i9cd7d823962845eb2fd60216407eb9e53424c5a8	|xhgui: require ops / nda / wmf ldap group		the ui contains things like cookie headers.		change-id: ifda975fd3f473ab41dc1f9fe9be1291e03a70193	|role::xhgui: require php5-mongo; provision cache dir		follows idc3065856.		change-id: i33c5d3e1db2fceef22850c71aed5231ef1e21d09	|fix-up for idc3065856: correct xhgui repo name		change-id: ie8f432ddad53a3220d046600deb39993dde631fa	|complete xhgui role		- deploy xhgui with git.	- serve xhgui via apache.	- proxy performance.wikimedia.org/xhgui to xhgui vhost.		change-id: idc306585643229439a0a992d160e6c114efe11b3	|add role::xhgui; apply on hafnium		for now, this provisions a mongodb instance. this is what xhgui uses to store	profiling data. the app servers will be configured to write profiling data to	this mongodb instance.		change-id: i6c34c479f00b7b82aad12463998df22f2cb2c7f1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/conftool/master.pp,lint: double quoted strings pt.1		these are fixes for the specific puppet-lint check	"double quoted string containing no variables".		once all of them are removed (not hundreds, just dozens)	we can re-enable that check again.		change-id: i385a9da5d1c272ff853113ab554e7926dc2f2731	|role::conftool::master: fix puppet scoping (!!!)		change-id: i098cf543e8e59bb9d29e91b75b889928e4944cbc	|conftool: separate master role out		change-id: i1b6b8ff0a58808b26bab7d6b23802d7d0859d86a	|role::conftool::master: introduction, apply on palladium		change-id: i31af36d116fab8d7db49f91b1a9e1758f2cc9ffd	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/visualdiff/manifests/init.pp,ruthenium services: few more tweaks		* now that we know a little bit more about the pattern of	  memory usage with node v4, use 8 workers on the parsoid service,	  one per testreduce client.		* visual diffing testreduce clients post json to the testreduce server.		* visual diffing requires the pngs/ directory to save images to.		change-id: ifb04c2b5b8acb2ffb835cf2af52472b7a786566c	|ruthenium: some more tweaks to parsoid + visualdiffing services		* added packages used to build uprightdiff to the visualdiff manifest.	* added missing env vars to the parsoid-vd-client systemd script.	* added the nodejs-legacy package to the parsoid-tesing role	  since the phantomjs binary installed by the phantom node module	  requires 'node' (whereas debian installs nodejs by default).		change-id: ifeea9cc1fa68dffb130815a6ea9283aee87aa1c9	|visualdiff: do not install g++ package, debugging		change-id: i486ced6f1761897076001b19acf6f15c64202238	|visualdiff: move comments up above require_package		i suspect these comment lines create a syntax error.		change-id: i788d8912968a5f2259591c460d4ee208be565396	|ruthenium: slight syntax change for require_package		we got a puppet error, undefined method `function_create_resources' ,	and i want to see if this changes it. this syntax is what we use	in another place already to install multiple packages.		change-id: ie5d175566eac35e0c7754a60c15c27e15a54a85a	|visualdiff: add dependencies on required deb packages		change-id: i4546a01951cc2b37724b6f767fac81c01c8e0f84	|clone the 'ruthenium' branch of testreduce and visualdiff		* this ensures that node modules are available on ruthenium	  and eliminates the need for npm install run there.		* node_modules for visualdiff was built on a ubuntu 14.04	  labs vm using node 4.2.4 and npm 1.3 (libyaml wouldn't	  build with npm 2.14.x).		change-id: ic79a69b2b4f994733744ec37bde37af0332a878c	|add the visualdiff module + instantiate visualdiffing services		* the visualdiff module provides:	- diffserver: a standalone webapp for one-off visualdiffing	  not very useful and is not instantiated in this patch.	- parsoid-vd and parsoid-vd-client: testreduce-based server	  and client for comparing parsoid html output with php parser	  output.		* several minor non-functional tweaks to testreduce puppet code.		* replaced upstart config files with systemd native config files.		bug: t118778	change-id: iae0a9515ff43d81185ee11c103deb20002f8516a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/spec/fixtures/manifests/site.pp,base: add the service_unit init wrapper		the base::service_unit resource aims at being a init-system-agnostic way	to manage a service in puppet, including its own init scripts if they	are created by us. it should also take care of reloading systemd if the	service file has changed.		as suggested, it allows you to choose wether to notify config changes to	the daemon or not.		this is a (partial? good enough?) solution for t89086		change-id: i5d1472f7c737aa7a917509394ec997b8e25f6d2b	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/tests/scripts.pp,modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/analytics_cluster/mysql_password.pp,remove newline from rendered password		change-id: ie401ccbb7f029f8191dce32b638784d32cb1466f	|qualify path to echo in hdfs_put_mysql-analytics-research-client-pw.txt exec		change-id: i1bec6a870085cd102a7729c74f09cec2332fc7dd	|render analytics-research-user mysql password in hdfs so that we can automate sqoop via oozie		this password will only be readable by the hdfs user.		change-id: i1f39e3febf34cba3a449e77aa793c2af0a37036c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/zuul/git_daemon.pp,contint: rename git-daemon to git_daemon		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		change-id: i581c832444c4b1f3bfe1bc28148ac5facc448ae9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/labstore/manifests/fileserver/primary.pp,labstore cleanup and role vs module arrange		this more accurately reflects the module and role	schemes used for other config.  we are also staging	to have primary/second/misc nfs setups so rename as	primary and misc to that effect.		change-id: id66499d22a7f40df8174fdfab8a89e10899beb7c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/server/monitor.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ferm/manifests/ipsec_allow.pp,ipsec_allow: restrict to domain networks		the role is used by kafka*, mc* and rdb* systems. these systems in production	are all limited to accesss from production systems, while the use of	domain_networks also allows to use these roles for a base::firewall-enabled	labs instance.		change-id: iafe19683efb68c4751aeee0626738bdf1c358288	|ferm: add global class for allowing ipsec traffic		move the definitions from the kafka broker role to a standalone class,	and include said class in role::memcached as well		change-id: if6912b1552fa67ce0ee3239cc0f0ced4af0ae3a4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/phabricator/manifests/mailrelay.pp,phab: vcs user manages ssh interaction		the "vcs" user needs to own the bin/ssh scripts.		change-id: i1efc685dc25a86ef6417f2b0097e287c91197a09	|phabricator: lint fixes		"indentation of => is not properly aligned"	"variable not enclosed in {}"	"double quoted string containing no variables"		fixes more puppet-lint warnings	for t93645		change-id: i0f3197f45ce76761e5fa2f141d00ea414137a15a	|phab email pipe cleanup and allow maint		* if maint is true it rejects mail bound for phab.	* cleaned out env variable to reflect upstream	  best practice	* updated settings in puppet role		change-id: ia86643c00b3c27db5ecd01b4ee005de80330c018	|phab email pipe needs to be executable		change-id: i3648f84da42654bf198c1bf179fccd7cb228fa7b	|add $default param to phabricator::mailrelay		change-id: i94bf54262f6771314533d86e8c4e1e739b91b7c9	|revert "revert "phabricator better email relay settings""		puppet lint && pep8		this reverts commit 0844c50b04f23b8d655f3e21a76efc31f6edbe62.		change-id: ic9184fec58e560bd9fd51cc1b622cc0ed67184eb	|revert "phabricator better email relay settings"		this reverts commit cfac7413a3c0242fdb13fe7ee71f02c96a02d5cf.		change-id: i8841ebba7419e6fec8354aa02ba7c74b1e53870b	|phabricator better email relay settings		change-id: ib4a07af8086cdcc920fd5a46955f2f7eca102e20	|phab::mail renamed to phab::mailrelay		change-id: idda4fddffd31ed5c29d7a3dc107fd0d1422d1a7e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/jenkins/manifests/user.pp,jenkins: retab + some linting		change-id: i34ae59204fa397473c277a7c56ae00986f037296	|jenkins - replace generic::systemuser with user		we want to get rid of generic::systemuser	and replace it with the regular puppet user type	again to remove a layer of abstraction that isn't	really needed.		change-id: i2f9158462a6790f3b7612e3395bca5322dd523b1	|add a 'generic' module.		this is a catch-all for bits of the old manifests/generic-definitions.pp	that had nowhere else to go.		change-id: i3a5ef3a200bf0d0722c99ab351ba0be98c1e9de1	|revert "create jenkins user with systemuser"		come back to using the user {} definition. systemuser {} defines the	group which would prevents us from keeping the group definition inside	the jenkins module.		this reverts commit bff1865e793de6aa812fe18cfd5b913210e8588e.		change-id: i7482ca5dce574e6557656b8c15d640b07df20b0c	|jenkins systemuser call was invalid		when i have migrated the jenkins user definition from `user` to	`systemuser` define, i forgot to drop the 'gid' parameter.  the require	is not needed too since that is included in the `systemuser` def.		caused:	invalid parameter gid at modules/jenkins/manifests/user.pp:12		change-id: i55a3ff9af00362b362411704c9e691a8dee28594	|create jenkins user with systemuser		since systemuser learned 'managehome', we can now replace the `user`	call by `systemuser` and make sure puppet is never going to manage the	jenkins homedir.		change-id: id459a1c1fdb314d4d22b25d4ff433eb6d33ecc54	|jenkins module created out of contint manifests		misc::contint contained a jenkins class for the continuous integration.	i have extracted out the part which are only related to jenkins in a new	jenkins module.  simply 'include jenkins' and you get an installation.		moved the jenkins group definition to the module, dropping gid 561 in	the process and letting puppet manage it for us.		the jenkins instance might need to be proxying via apache, that	configuration is not part of the jenkins module.		change-id: i33bce60e08fd4c1e8184d6fac5ba0d3f9798fe35	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/geowiki/manifests/job/data.pp,fix another variable reference		change-id: i04b3ed13a5f245b3c8d29aaa743c2672c3fe5776	|create geowiki module		this commit finally removes misc/statistics.pp!		change-id: ib36c02b36a4bd4cb4e4ee8293108fe61754aba94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/monitor/percona.pp,mysql_wmf, protoproxy: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i0934c29fa212e0f18d82500b32ad6592dc49ce98	|nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|mysql_wmf - autoload layout and lint fixes		move classes into autoload layout	fix lint warnings		change-id: ie7510e8c90e365f43ce621c3f524aa1e87e2c584	|mysql: change nrpe monitoring to use nrpe::monitor		change-id: i100a7adb4211b7fc6f0e7a37471010d4371a795b	|mysql_wmf : lint cleanup		change-id: ie1062ceb9357e6a7502272c213e4324d49061217	|move mysql_wmf into a module.		the manifest changes here are pretty brainless -- i split the major	classes into separate files and rearranged the file and template	includes to reflect the new position of the source files.		i also moved quite a few files that were filed under ganglia	or icinga but only used by these classes -- now they live in the	mysql_wmf module instead.		change-id: i31b8d8562f8eda4a6fde4a6110d83a339fc38b94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/install_server/manifests/dhcp_server.pp,installserver: rename classes with dash characters		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		this is a follow-up to icb2122da0a43b7a1	where the module was already renamed due to this,	but not the classes inside it.		the classes ubuntu-mirror and caching-proxy are removed	from comments because they either moved to module/mirrors	or have been deleted meanwhile. this change doesn't touch them.		change-id: ib91faf62a8c4d2292f2a51e30fbf1c6583f15eaf	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/console.pp,fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/elasticsearch/relforge.pp,elasticsearch - move relforge to its own role		as suggested during an irc discussion, create a specific role for relforge,	move all common bits in role::elasticsearch::common and simplify the hiera	configuration.		a few other clean up / improvements are part of this change:		* add icinga checks for relforge cluster	* update debdeploy configuration for relforge cluster to make it part	  of elastic canaries		change-id: i83d5ef5728aa5851ccf2d4d9cfde803bba0e9c6a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/planet/manifests/apachesite.pp,planet: rm ssl settings and ports.conf.ssl		no ssl related settings are used here anymore, we are terminating	ssl at misc-web nginx.		change-id: i222c7ff1a1de3a719a4033de84acefb40b7d0786	|planet - use ssl_ciphersuite		change-id: i9d4b01fdd82a0a97beb899c3e5c6dbd26d8d384f	|fix apache site setup for planet languages		follow-up fix to iddc778a281639	which put these directly into sites-enabled		we want them to be properly in sites-available	though and then symlink like they did before with	the old apache-site method		change-id: i306feeb35196e8fd57f7a954483ffff2da38dd18	|kill apache_site		all that apache_site is doing is creating a symlink to the relevant file in	sites-available. the approach of the new apache module is to provision files	directly in sites-enabled rather than symlinks to files in sites-available.		thus the following is true:		* each apache_site resource has a corresponding	  file['/etc/apache2/sites-available/foo'] resource.	* by replacing sites-available with sites-enabled, the need for a symlink is	  gone, and the apache_site resource can be discarded.		change-id: iddc778a28163947edef53a288bd986d0bfe2f309	|rename planet::site to planet::apachesite		did this for style reasons because i did not like	to have site.pp in the module, rename it to	apachesite, but do it properly		change-id: i46df31bfe3842fc8d643e0a6fd24b1e7fb415785	|turn planet into a module		there has been an older attempt to do this	that had to be reverted due to a bug causing	puppet issues		so this is along the lines of	https://gerrit.wikimedia.org/r/#/c/54502/3	https://gerrit.wikimedia.org/r/#/c/58495/ etc,		but entirely new and _doesn't_ do things like dropping	the role class, putting config into module etc.		change-id: i980f9dc9f48e80d53dd2c920622ae67672d575df	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/prometheus/manifests/blackbox_exporter.pp,prometheus: add blackbox exporter role/class		https://wikitech.wikimedia.org/wiki/prometheus/black_box_exporter	explains how to build the deb. deb is currently available only	in the tools project		change-id: i9050ff361ecf4dcc432bab2c0b5cb3627c6bfbff	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/vmbuilder.pp,labs: move vmbuilder role into module		change-id: i65bd115fd7af18082794ae275c2674efb49f8102	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/planet/manifests/user.pp,planet - add system group for system user		change-id: i43a1f97776b9caa69361e073f1b3686161339e3b	|planet - replace generic::systemuser with user		we want to get rid of generic::systemuser	and replace it with the regular puppet user type	again to remove a layer of abstraction that isn't	really needed		change-id: i7de8415110e601ed7fa0caf81c3a2b43abed306b	|turn planet into a module		there has been an older attempt to do this	that had to be reverted due to a bug causing	puppet issues		so this is along the lines of	https://gerrit.wikimedia.org/r/#/c/54502/3	https://gerrit.wikimedia.org/r/#/c/58495/ etc,		but entirely new and _doesn't_ do things like dropping	the role class, putting config into module etc.		change-id: i980f9dc9f48e80d53dd2c920622ae67672d575df	|revert "make the planet logo a "per language" thing"		this reverts commit f2264e7a97f26b6b2d6548e9d730e01ce42baebe.		revert "resource references should now be capitalized"		this reverts commit 54d5baca9de9ea519c216ceb08030eb93cffc674.		revert "remove duplicate definition of locales package"		this reverts commit ebd76e02e4d7322a57a605b33afde16e4bf93a72.		revert "turn planet into a puppet module"		this reverts commit ec09aaefb8b9f7eafc82aaca5dff7e940c243f4e.		change-id: i093cfc85d1ca8550c19a246ae9ed8fb0e91149e3	|turn planet into a puppet module		- move all files, templates, into module subdirs	- add readme.md and turn role file into init.pp	- quoting and arrow alignment	- 2-space softtabs, etc. per puppet style guide		change-id: i9d0fda3f27715282068e760d2f01c2fc298314b7		rename planet class, per docs init.pp must exist and contain	a class matching the module name		change-id: i19034d090692387ca7e9d7f2d87fe4f9e13793e7		move defined resource types into separate files, one definition	per file inside a module as recommended by puppet docs		change-id: i91fc1ccad73b5498441de39a3e150e65e017df1b		move package install to own class and file,	move generic::locales out of init.pp		change-id: i63217308b7d3c6469ba3c30bc4a183e62f8b2b77		move webserver setup for planet out of init.pp		change-id: i00dde9965afe86b58ba609810bcaa6b588ac17af		move locales install and generation into own file,	step 1 to making module self contained instead	of declaring stuff from generic-definitions.pp		change-id: i239fa19a8bd40eadeb7a6aea3ab9feddb480610c		move needed planet directories to own class		change-id: i153848976801f3bd378f83dcfab0d70a4984fd66		move user/theme/apache_sites out of venus.pp, move index_site	setup to own file, move webserver setup out of init.pp		change-id: i9769542394ff96a46e0cf46e8269f9fbe9cc8e92		move language prefixes and translations to own class/file languages.	use a qualified variable to access it		change-id: i88a12546e4ed42b5d6ced9a4d68bf22fff64c486		various fixes to make puppet-lint like it,	like wrong quoting, unaligned arrows, variables without explicit scope,	lines longer than 80 chars, and more		change-id: i260c28ab1028f8d11e6e155540a708a45f63745f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/swift/manifests/container_sync.pp,rename swift_new to swift		can be reproduced with:	  git mv modules/swift{_new,}	  git mv hieradata/common/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}.yaml	  git mv hieradata/codfw/swift{_new,}	  git mv hieradata/codfw/swift{_new,}.yaml	  git mv hieradata/esams/swift{_new,}	  git mv hieradata/esams/swift{_new,}.yaml	  git grep -l swift_new | xargs sed -i 's/swift_new/swift/g'		change-id: i22102da8b14a31719927355ff3efbe19717fcfae	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/stdlib/tests/has_interface_with.pp,update stdlib to latest supported release from puppetlabs		this patch updates the stdlib module to v3.2.1.	3.2.1 is compatible with puppet >=2.7.20. there are no breaking changes.		change-id: i570046371713b05c1ed99c771da2d405f782b191	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ganglia/web.pp,ganglia: limit to production networks and fundraising networks		we're getting rid of all_networks by refactoring the existing ferm	services into more specific networks. ganglia is accessed from	production hosts and in addition also from fundraising.		change-id: i494313754ee411b511c28458723f72c66bc883bc	|remove misc/monitoring.pp, remove import 'misc/*.pp'		remove misc/monitoring.pp, rename and move all the classes	to ganglia::views in the ganglia module.		this also removes the entire import 'misc/*.pp' from site.pp	because this was the last file in there. there is even	an error if i don't also remove that at the same time.		http://puppet-compiler.wmflabs.org/3244/uranium.wikimedia.org/		change-id: ie62b3041a6eae5aa06f7f172d80d223b10194cce	|add fixme's/ignores for all variable scope issues		all of these show up as "top-scope var without namespace" warnings	in puppet-lint.		and in the global puppet-lint.rc we have this comment:		# we still use the 2.6 way of referencing variables	# 2.8 will requires $::globalname. skip for now.	--no-variable_scope-check		so what i'm doing here is to mark the actual occurences of this	as fixmes and let lint ignore them, but then in turn will remove	that global exception that just turned this off all the time.		that way ci will discourage adding new variables without specific scope.		the existing ones should be fixed, but some cases are easy and some can	be pretty tricky. the ones that are left are mostly of the harder category.	a _lot_ of easy ones have been fixed in the past already,	but for example i remember we tried to fix the one in ganglia before	and it caused problems. so these have to be carefully tested.		we will have to get the fixmes done one by one before puppet 2.8, help	with that would be appreciated.				bug:t125042	change-id: i02619ef50ecb01905b6184bddd3d53fec212d7a3	|ganglia: move roles to modules/role/		split the roles into one file per class and move	them into autoloader layout in the role module.		the config class is just included in the web class, 	used on uranium. 		change-id: i82ed200ddfc5c500e9ad801a37a92a4270340bde	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/pybal/manifests/conf_file.pp,pybal: don't write pool files using confd		change-id: id6439e6362be80699624b580fd98ce15180ab109	|pybal: fix dependencies		change-id: id66b443981a51d3dce2a3851f2e6edb9626dafa1	|pybal: refactor pybal::pool, print pools in pybal::web		since we're moving away from out traditional schema where the pybal	pools are directly operated on via raw files, we still want to present	what's pooled and what's not pooled via an http request. so we:	- factor out the confd file generation from pybal::pool	- create the resources for all pools on hosts with the pybal::web	definition	- avoid monitoring all of those on palladium, as that's not really critical.		change-id: i30dd4ae6a0bce64c02c809e214fd868a897a97e7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/chromium/manifests/init.pp,ve: switch jsbench/chromium user/groups to system		the jsbench user was created and destroyed by "enforce-users-groups" on	every puppet run for months -- this switches it to a system user to	fix this.		the chromium user was not, but this is because enforce-users-groups had	this whitelisted as one out of a very few exceptions. remove that	exception as well.		change-id: i4177b0866b2c5f64ec69dd092ff813d9574cdf0c	|chromium: indentation fix		t93645		change-id: iaa63675a0ce1f18ccb17dedb8577e546df37eb80	|manage the home of the chromium user		change-id: i29512b9ab84154d13a3cf254d290ecbed517f733	|import chromium module from mediawiki-vagrant		to be used for ve performance testing rig, which will be introduced in a	follow-up commit.		change-id: ic0e2d1480a391832d6cbfdf0c251165f9ad7e2ba	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ldap/manifests/client/sudo.pp,ldap: split client.pp into one file per class		each class should be in a separate file. so i'm	removing the existing client.pp and put each class	into a separate file. no other changes to the classes.		this is the right structure and fixes these:		error: ldap::client::pam not in autoload module layout on line 1	error: ldap::client::nss not in autoload module layout on line 37	error: ldap::client::utils not in autoload module layout on line 116	error: ldap::client::sudo not in autoload module layout on line 245	error: ldap::client::openldap not in autoload module layout on line 256	error: ldap::client::includes not in autoload module layout on line 269		change-id: i01bfae251fff687fce1efcbbb94794be9bf863b2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ifttt/staging.pp,ifttt: set up wikimedia ifttt channel service using puppet on labs		change-id: i4460e1886e376a526df4e8babfce92d516a2b484	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mailman/manifests/webui.pp,ssl_ciphersuite: standardize sts preload		now that wikimedia.org can preload, switch the hsts argument to a	boolean that always sets our standard 1y/includesub/preload sts	string.  the default/false leaves out hsts completely, leaving it	up to manual config to set any hsts, in case of e.g. labs-based	services which are outside the scope of our canonical	domains/policies.		bug: t132685	change-id: i271336e264b01d7a352577dcc5afa0b4ca2be31f	|ssl_ciphersuite refactoring, jessie+apache dhe support		1. uses function_os_version to sort out apache and nginx feature	support, so we don't forget to change the arguments at the caller	when underlying os is upgraded.	2. switches remainder of code to using feature flags set at the	beginning, rather than server_version	3. dhe support turned on for jessie + apache	4. various other minor refactoring		bug: t133217	change-id: i851580f72a9d38b5fed92a5f706151d04912e745	|fix whitespace-related lint issues		fix a lot of lint warnigns due to incorrectly aligned arrows.		change-id: ib062d7142a79a8cb6bb3abd86fd7499aa3edad03	|lists: fix duplicate definition re: status module		trying to disable the status module like this causes a duplicate	definition. it is already defined in the apache module.		so instead we are denying access to it.		change-id: i94c343dfc910e863fb5888938d353f4c3509cf9a	|lists: don't load mod status		the status module is not desired on the list server.		change-id: i61921bbdf512fef5d772ab6913459b0013b889d9	|mailman: ssl settings to apache 2.4 and "mid"		changes the ssl settings for lists/mailman to apache 2.4	and the "mid" option for the ciphers list, when on jessie or greater.		<snip>	   - mid:        supports tlsv1.0 and higher, and adds several forward-secret	                 options which are not aead.  this is compatible with many	                 more clients than "strong".  with a dhe-capable server,	                 should only be incompatible with ie8/xp, ancient/un-updated	                 java6, and some small corner cases like nokia feature	                 phones.  with a non-dhe server, compatibility is also lost	                 with android 2.x, openssl 0.9.8, and more java6 clients.	   - compat:     supports most legacy clients, pfs optional but preferred.	</snip>		can only be merged after lists is off of sodium and on fermium.		bug:t90351	change-id: ibe761a194fe0ba32f2a3f46a217b1e5e60ae1a81	|move majority of privates/files usage to secret()		this is all of the trivial cases, where a fixed path was hardcoded	as the source attribute of a 'file', 'ssh::userkey', or	'exim4::dkim' definition, all of which are known to handle the	source/content switch ok.		change-id: i0db6fdb1c75355b58095e0ec29d6028bbc614649	|mail: hiera-ise mailman and lists		add default hiera values and turn hard coded values into hiera strings.	this adds supports for having puppetised and working mailman in labs allowing	us to replicate production, test changes like base::firewall and compatibility	of current puppet code with debian jessie.		change-id: i877a50737ccb141fb2a51e557a2abafefd1e6da6	|mailman: move into a new, separate module		move all the mailman manifests & files into a separate module. this is	fairly wikimedia-specific by design. there are some grey lines between	this and the role class that could probably be improved in a later	patchset.		change-id: i38660ba8533c47caf823a77890dc66b38c870957	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sslcert/manifests/dhparam.pp,sslcert: add preamble for sslcert::dhparam		change-id: i411e00a97f8f07f0a681d6caa0d18496c30245b2	|move dhparam support from tlsproxy to sslcert/ciphersuite		this moves the distribution of the dhparam file to the sslcert	module, where it will be installed at a standard path for any	machine that installs server certificates, regardless of whether	it's really needed		separately, ssl_ciphersuite decides whether dhe-based ciphers are	acceptable (apache versions are key here) and configures the use	of the dhparam file if applicable.		change-id: i443d9ac682d31142ad4fe5ebba839ec63dd44c19	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/coredb_mysql/manifests/base.pp,modules/coredb_mysql/ sans systemuser		we want to get rid of generic::systemuser	and replace it with the regular puppet user type	again to remove a layer of abstraction that isn't	really needed		change-id: i2f52bf76bcd96849f4c9f2b0df035ca7ec2bba85	|add a 'generic' module.		this is a catch-all for bits of the old manifests/generic-definitions.pp	that had nowhere else to go.		change-id: i3a5ef3a200bf0d0722c99ab351ba0be98c1e9de1	|coredb_mysql: lint		no changes to behavior; only presentational changes in this commit.	 - spaces rather than tabs.	 - align arrows.	 - don't align equal sign, except in function signature	 - single quotes when not interpolating.	 - single resource per block.	 - quote strings.	 - quote octal permissions.	 - 'ensure' always first property.	 - use ensure => link w/ target rather than implicit symlinks.	 - every property ends with a comma	 - one class per include.	 - resource name and resource type on same line.	 - [ space ] in arrays	 - '&>/dev/null' instead of '>/dev/null 2>&1'		change-id: i419f48c9713e5c59deac093ac86142d4d938a25c	|coredb: a bit more re-merging		change-id: if4c81eee47814ae20bb837e34b615e2193d6c5f1	|add name for mysql user		change-id: i85fadc04b816d1021982b263231bb01bb6c233a5	|renaming coredb module to coredb_mysql to avoid module/role class namespace fuckery		change-id: i1c8ab607514c63be7a9ab36ac337ae20918cfa6f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/servermon/manifests/init.pp,servermon: inform puppet gunicorn has no status command		the gunicorn initscript does not have status command, hence querying for	status makes no sense. pass hasstatus as false, to inform puppet of	that. also pass enable as true		change-id: i18aaface616271b44ccba360519a4d34b514d597	|servermon: amend the make_updates.py path		we no longer need to specify the servermon path there, amend it		change-id: i680860d2b61ea8d98fe0dfca1dbcb2d94d5b5d4d	|servermon: add managed_puppet_modules parameter		using the managed_puppet_models parameters, which defaults to false to	allow test and development installations that will by design not share	their tables with a running puppet installation to create the various	puppet managed tables. also default the service to binding to all	interfaces instead of just localhost and add some comments		change-id: i3d03c29c299b0873f72c885a69fe0f9db064e2a6	|servermon: require_package python-ldap instead		otherwise it conflicts with modules/ldap/manifests/client/utils.pp:13		change-id: i06a8d5a205fcaca7e7c67da36bfcd999cd7b862b	|update servermon configuration for 0.7		updating django settings.py for servermon 0.7. add a debug parameter to	the module that allows easier development using it in vagrants	environments defaulting to false. update settings.py to the ones in	master that will be in servermon 0.7		change-id: i6a1e8d508ca8afdabf51aba5f1c07c8abaca6800	|servermon,ganglia,gerrit: minimal lint fixes		just removing the last couple occurences of this specific	warnign to later re-enable the check globally.		change-id: iaa6d9c569b59f3f15750e4cda0bb3cffffb4533b	|fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|update servermon settings		update rspecs, rakefile and update the settings and stop managing	urls.py		change-id: i4f1b41d18c454d0226b8bd3bc70af1c1175cbc6b	|servermon: execute make_updates every hour		but not on :00 but rather on :35		change-id: i28ca07213a32f7a8ec1f8fa87231d800eb467be9	|servermon: run make_update 6 times a day		every 4 hours		change-id: i80b14c2fd9cbeab47b48e5f665740604b8bd1eb1	|servermon: set a cron for the make_updates command		use the (old) new make_updates.py django management command that	populates package updates		change-id: ib507c1aaa5dcd9328ae792e13e4ebb8385a5dbe2	|ensure_service(): fix docs, add more usage		change-id: i8ad1a6fffa691afda814ae54cb7b0fc5539ddd1e	|module/role class for servermon		introduce a module class for servermon and a role class for it as well	include rspec	include tests	using the deployment infrastructure. no upstream for now	settings.py/urls.py files added	linted	tested	apache reverse proxying to gunicorn	netmon1001 picked as the server to run this on	module/role documentation		change-id: ib48a0736a1d96e24c33d7a59c75e40eb73e3ceff	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/system/manifests/role.pp,use motd::script instead of file across the tree		this is almost search-and-replace, with two exceptions:	- remove toollabs' recursive handling of /etc/update-motd.d. the motd	  module does this now.	- remove backup's rspec test for the file existence. this is internal to	  the motd module now.		change-id: i5764f74dec2a197de71e5b84314d04aaaf9129c5	|clean up system::role		* add documentation	* make description parameter optional, to avoid things like:		    system::role { 'misc::fundraising::mail': description => 'fundraising mail server' }	    system::role { "misc::management::ipmi": description => "ipmi management" }	    system::role { "misc::noc-wikimedia": description => "noc.wikimedia.org" }		* remove dead code		i'm still not sure this deserves to be its own module, but at least it's	a bit better now.		change-id: ic36f85461f6eff5ef521fef4ef4ab27e91de4a4d	|deactivating salt grain-ensure in global role		because it causes problems for new installs		commented for now, deactivating the feature introduced in	ie8a53c7f478401b53444e8f187243f9c41603054		which added a salt grain with the puppet role name		as reported by faidon this breaks on new servers installs		it has a dependency on a minion config and a signed salt	key already being there or the grain-ensure blocks forever		< paravoid> it's not just a dependency on the minion config,	it also hangs if you haven't signed the salt key on the master		< paravoid> i think the best would be for grain-ensure to try once,	then just fail		change-id: iaede927aa4abfb680bb7b7ef78b8f138925dfe19	|add salt grains automatically in system::role		< ryan_lane1> mutante: yes, that's exactly what i wanted to do, use puppet roles		< ryan_lane1> the grain name should be role (or rolename) and the value should be rolename		< ryan_lane1> so, there's a problem with grains and ::	< ryan_lane1> oh: https://github.com/saltstack/salt/issues/5799	< ryan_lane1> seems it was fixed		< ryan_lane1> it should add the grain, rather than overwriting, since multiple roles can exist	< ryan_lane1> ah, the default is add		change-id: ie8a53c7f478401b53444e8f187243f9c41603054	|role.pp: minor lint clean		change-id: ib22d19ce9b2827e533d3bfe418d1956c52c496c1	|added the system module and the system::role class.		also, massive search and replace!  s/system_role/system::role/g		some other things will land in here after while.		change-id: i1000245464fca3e0e98184f790fe01e7d6e98525	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/authdns/manifests/lint.pp,authdns: introduce an authdns::lint class		it sets up gdnsd & dependencies but without the service running. this is	to be used by contint to lint authdns proposed changesets.		rt: 5688	change-id: ic204f65c6fd5743249ba90391cf3874d39932693	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/quarry/web.pp,quarry: move role classes to module role		change-id: idd7f078180d8d743de5f8602647b199421476ec0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/tests/server/account_security.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ifttt/manifests/base.pp,ifttt: set up wikimedia ifttt channel service using puppet on labs		change-id: i4460e1886e376a526df4e8babfce92d516a2b484	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/yubiauth/server.pp,avoid cron spam in aead sync		change-id: if05d9aa7c95280ed4734589275d13786f9fc55fd	|add cron job to synchronise aead files from primary auth server		change-id: i0f605e6ecfb1410db8e1e75ae1f833388a81c91c	|configure an rsync server which is used to synchronise the aead key files between the auth servers		after creation on the key generation site (laptop at oit), they are synchronised to the server	specified in hiera via yubiauth_server_primary. all other yubico authentication servers synchronise	from that host.		this class configures an rsync server which makes the aead spool accessible.		change-id: i3b971d09c1edc7bcf88de71be752017fdaed192f	|add yubico aeads to backup		strictly speaking we'd only need to add these files to the backup on	a single authentication server (since the other syncs via rsync), but	the disk space requirement is tiny, so i doubt it's worth the effort:	a single aead file is 54 bytes and we'll use one per user.		change-id: i2b76be7bf9fa43efb7f79c0bfc813f5add0aa05c	|allow access to yubikey validation server from bastion hosts		change-id: if65f668500e8a8b5e7bbe8af63fce7e10a6fee21	|include yhsm-yubikey-ksm in yubiauth role		change-id: iee325e53043288cae1fd5b6d34c04ffe6843fdda	|yubiauth: adjust class name after move to role module		change-id: i9a7432505c4c8241fafaeaeac860809ca11ff5a6	|yubiauth: move role to modules/role/		move the role into modules/role/ into autoloader layout and make	puppet-lint happy.		change-id: i8fb11fc2a43a3e86760936ef3c438759eb363b10	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ganglia/config.pp,ganglia: move roles to modules/role/		split the roles into one file per class and move	them into autoloader layout in the role module.		the config class is just included in the web class, 	used on uranium. 		change-id: i82ed200ddfc5c500e9ad801a37a92a4270340bde	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/otrs/tests/mail.pp,modularize otrs		this was a single role before, move it to the module/role paradigm,	splitting up the various classes and moving templates/files around.	add tests, documentation for the new classes.		change-id: i04cc8d734cd83acc2ce4c4d26cea9c0fbd1da2ec	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetdbquery/examples/query_node_examples.pp,puppetmaster: add puppetdbquery module		also install puppetdb-terminus that is needed for the parser	functions. the module is version 1.6.1 (the latest version compatible	with puppetdb 2.3) from https://github.com/dalen/puppet-puppetdbquery		change-id: i305fc0eea19e75c4ba0ad511e0c76a842a1ec140	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/icinga/manifests/nsca/firewall.pp,icinga: fix nsca/firewall.pp, missing labs-hosts variable		in iecbb7c382d79d4b142008, labs-hosts1-a-eqiad was renamed	to labs-support1-a-eqiad. this broke the ferm rules on neon.		* reloading firewall configuration...	error in /etc/ferm/conf.d/10_ncsa_allowed line 13:		no such variable: $eqiad_private_labs_hosts1_a_eqiad		change-id: if3e481c26789f7728385c1ee3a293aaee6d29cb1	|network: split frack into its proper subnets		change-id: i352e6bf8c89a5400dc52066ff51bd83011fb94b0	|fix typos from i67a16556		change-id: i22f6b233691346f05a2abcf3c5efc8afb250e588	|add frack subnets to network.pp, add frack-codfw to icinga firewall policy		change-id: i67a16556f92bebb4a334585dcc2ace6e539ba99a	|make icinga firewall more readable		used \ to wrap.		change-id: i2e85ecda8826f9092e69088cbc9cbf03ccd2b370	|icinga: fix ferm rules on neon		in i667a95ec7e5d79ebd2 the esams public network was renamed, leading	to this when trying to apply an unrelated change:		 * stopping firewall ferm       	 error in /etc/ferm/conf.d/10_ncsa_allowed line 8:                                                                                                      	no such variable: $esams_public_public_services		change-id: i6670906c18ac56d939f94681e84e48649efd163f	|remove pmtpa from icinga::nsca::firewall		change-id: i6ac271153de6a1ccbbc2e402e9a08498319a46c1	|icinga: move nsca code into module		- nsca::client does not seem to be used anywhere except the	  hadoop nodes	- the firewall rules misspelt nsca as ncsa, corrected (i assume,	  since the port numbers match nsca, and ncsa seems totally	  unrelated)		change-id: i4c6e84da376796253689a980a382ff62c8e29f56	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/otrs/tests/otrs.pp,modularize otrs		this was a single role before, move it to the module/role paradigm,	splitting up the various classes and moving templates/files around.	add tests, documentation for the new classes.		change-id: i04cc8d734cd83acc2ce4c4d26cea9c0fbd1da2ec	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/admin/manifests/hashgroup.pp,admin: stop passing around a huge data structure		our current puppet catalogs are huge becuse for every group and every	user we have a specialized copy of $::admin::data, which is a very large	hash indeed. use direct references to it instead.		change-id: i526f659dccabb1726c7dda14b3a50cc6fd5a0828	|admin: rename "privs" to "privileges"		currently, the "sudo" module is using "privileges", but the "admin"	module is using "privs". this is confusing, so pick one of the two.	since "privileges" is more explicit (and the "admin" module even	iterated "privs" into "privilege"), keep that one.		change-id: id4e793cf41b05b8e9bbe98ebd47ebc63fc9bb00d	|admin yaml stat* and analytics fixups		there is a use case for the stats group not easily handled	by a centralized grouping system.  the workaround here is to	allow group names in yaml to not be the on box final name.		including:		    include accounts::dr0ptp4kt    # rt 7569	    include accounts::brion        # rt 7568		change-id: i6a3ef6d1cb5d835f3cdb9bbf2ca8bad099af2ecf	|admin module for user/group/permissions cleanup		users/groups/perms are meant to be defined in yaml.		applied like:		yaml:		  groups:	    test1:	      gid: 1	      members: [foo]	    test2:	      gid: 2	      members: []		  users:	    foo:	      uid: 1	      ...		.pp	  node /foo/ {	    #groups create their users (can overlap) and permissions	    #as well as system groups and handling user membership	    class { 'admin': groups => ['test', 'test2'], }	  }		more info see: admin/readme		change-id: i6982bfced50a22faac37246dff4d52ff163a34ed	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/spare/system.pp,spare: move role to module structure		move the role class to module/role and into a foo::bar	structure which fixes autoloader warnings (we want to move	the entire manifests/role eventually).		change-id: i0d4fe058d9f260cf647571a04438520bb636a1b6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/no_nfs_client.pp,no_nfs_client: fix service dep order		if puppet happens to stop rpcbind before stopping nfs-common, it	gets restarted instantly, and then doesn't truly stop until the	next puppet run.		change-id: ib1b41e0b3c5d8b9a6d8e4f4e34546252fc608cb5	|base::no_nfs_client - define and use on cp*/lvs*		some classes of machines don't use nfs client services and	shouldn't be running the unecessary daemons (which possibly have	security risks of their own).  on jessie nfs-common and rpcbind	seem to be installed/enabled by default, and this disables them.		change-id: iaa1afcbfbcd323764187861d9d6810e34fab907a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/icinga/manifests/group.pp,monitoring: move stuff out of nagios.pp, part 4		moved out the two nagios:: classes, and renamed icinga:: in the process		change-id: iafca3c665795aef054dd620dc91236016cc340fc	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/debdeploy/master.pp,debdeploy: move role to modules/role/		move the role class into autoload layout in the	role module.		change-id: i797ac4326d13c51b9feed5f9e8bec79a4628a251	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/installserver/dhcp.pp,installserver: split dhcp part out into own role		split the dhcp server part out of the generic installserver role	that did everything and into a separate role.		apply that role on carbon (it's a no-op there).		does not touch install1001 or 2001		bug: t132757	change-id: iab414bb3b17836b535912d47feeb9409af494193	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ocg/manifests/ganglia.pp,ocg: simplify module hierarchy		there is no reason for "ocg::ganglia::module", "ocg::ganglia" should be	enough. similarly for nagios, with the extra catch that there is no need	for two separate classes, one of which is only used by the other and	only contains a single resource.		change-id: ia5c16bfc20d7e9e10cd6860a29a06a65506335b2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/tools/mailrelay.pp,tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/manifests/init.pp,ganglia: rename ganglia_new to ganglia		change-id: i1e92bc3e994e9a522c82b3b7c3b5136622d34250	|ganglia: re-define generic ganglia class		change-id: if6daf577c38098cb9b25eb39c558b5c93a60015f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/snapshot/monitor.pp,add system::role to the dump related roles for snapshots		also fix up the role name in existing system role		change-id: i7334862ea2ae9aa2dc2c8ce0b4e2c2d90044a2c4	|move dump related commonly included classes out to common role		change-id: i996ac5442320b42f6ca3304c29bdacfb31a30dab	|remove obsolete manifests from snapshot module/role		also include role::snapshot::common everywhere it should be		change-id: id3deb3814afccb584ac7f68d58cfd6977b707e78	|set up proper dump monitor role and add to snapshot1007		change-id: ibf89f1754c26390f675741cc3d70137a0857954f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/quarry/redis.pp,quarry: move role classes to module role		change-id: idd7f078180d8d743de5f8602647b199421476ec0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/icinga/manifests/monitor/wikidata.pp,increase wikidata dispatch lag critical to >300s		this makes it similar to db replication lag.	make the check more frequent.		change-id: i413c9405c2a12c6459cfbec8a468761ad7e4e829	|nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|monitoring: move monitor_host to monitoring::host		change-id: i362dac76eb4d2d58d91c138a2b708396888ad721	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|icinga - lint fixes		change-id: if51fd45693a262f9a797ea6e4286e5bf808bb349	|icinga: move wikidata monitoring into module		change-id: i001f9356ca565b54d5523204610c150ed9196a6f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/admin/manifests/group.pp,revert "revert "admin group sudoers permissions cleanup""		this reverts commit 434a2b997772964c3503da73e9891bcadb17528f.		change-id: iae4b1d2bf0c3178e55546ebd7a898b84bd4ebb28	|revert "admin group sudoers permissions cleanup"		this reverts commit 10c4604f7459189fd25ff157027da6bf919cceca.		change-id: i6ba3a3a3ff89dec80dadd7a8937bfd86d5409270	|admin group sudoers permissions cleanup		if an empty priv array is specified now we leave	it behind on cleanup.  this is disingenuous in	terms of group cleanup.		change-id: ie82019144bda9296032f10ecb07ce97602cb6fea	|admin: remove ::sudo in favor of sudo::user/group		now that we've fully converged the two modules, there's really no point	in duplicating this sort of functionality in two places; it's confusing	already (as evident by previous commits) and wouldn't be dry.		make the sudo::user/group definitions canonical and remove admin::sudo	altogether.		change-id: i4745c83b1357a764c066f5aa74ef3e2f9799e84a	|admin: rename "privs" to "privileges"		currently, the "sudo" module is using "privileges", but the "admin"	module is using "privs". this is confusing, so pick one of the two.	since "privileges" is more explicit (and the "admin" module even	iterated "privs" into "privilege"), keep that one.		change-id: id4e793cf41b05b8e9bbe98ebd47ebc63fc9bb00d	|admin: puppet lint fixes		change-id: i809afb19a74926f303ebb47bc128fcf2a76f3d96	|admin module for user/group/permissions cleanup		users/groups/perms are meant to be defined in yaml.		applied like:		yaml:		  groups:	    test1:	      gid: 1	      members: [foo]	    test2:	      gid: 2	      members: []		  users:	    foo:	      uid: 1	      ...		.pp	  node /foo/ {	    #groups create their users (can overlap) and permissions	    #as well as system groups and handling user membership	    class { 'admin': groups => ['test', 'test2'], }	  }		more info see: admin/readme		change-id: i6982bfced50a22faac37246dff4d52ff163a34ed	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/openstack/manifests/nova/partition.pp,openstack: add links to docs for components, lint		adds comments with links to docs or info about	the various components of openstack.		by doing that fixes a bunch of	"class not documented in line 1" lint warnings.		also fixes a few other lint warnings such as aligned arrows	or "ensure" being first.		change-id: i592677d0f089f59bf72b1dbd2bd31f97f5932ac7	|fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|remove the /srv mount point for /dev/sdb		/dev/sdb will be /var/lib/nova/instances.  the /srv mount point	didn't work, and wasn't good for anything anyway.		change-id: i87f3708dd1a8ede7c6864ccf7466ef7bce6e11fa	|customize the nova instance partition to support different server types		change-id: i682152d1eef9fb83410ee9fdd48c2b5d3c6c0efd	|hm, not this one.		change-id: i9b2d83f684c9feda012a94074a3082eb54b5b988	|oops, these are in base.		change-id: i101391d03456d4da422019ae2dd8678645983b8e	|fix alignment in parted command		change-id: i500db4acac0be6e341eb8c7ecd2550510669f9eb	|we're going to need these packages		change-id: i02804b48f7cfcd96353db6724b927d01925391c9	|create a big filesystem for virt storage on the hp virt servers.		change-id: ic883a138dc499fdc3834d2d21ef1d8c5982f1a9a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/stdlib/manifests/stages.pp,add the upstream stdlib module to the repo		change-id: i5b7c29b7fd20373b0d74f660609c628e5f3c8d54	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/tools/compute.pp,tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/monitoring/manifests/decommission_monitor_host.pp,monitoring: move decom_host define into autoload		error: decommission_monitor_host not in autoload module layout		make the file name match the class name to fix that		and minor warnings:	 double quoted string containing no variables	 ensure found on line but it's not the first attribute 		change-id: i3b852672e910d1efa2f920eb8ed556579d70530c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/conftool/manifests/scripts.pp,mediawiki::conftool: add mw-pool		this is a specialized script that you should use when pooling an	appserver for the first time or repooling it after it was set to "inactive".		change-id: i36420cd1533940baf4e0cd7960d37cc6c04e1cbc	|role::cache: install conftool scripts		change-id: ic24d829802ec77edb68f76a544c240bd3eba5915	|conftool: add support for acls, helper scripts		* if conftool::password is defined via hiera/private, install the	  corresponding etc user and role from the conftool master	* add conftool::credentials that allows to install an etcdrc file for a	  specific user with conftool's own credentials, for read/write access	* add some helper scripts that can be used e.g. from scap to	  pool/depool/drain servers.		change-id: i08f3f6ce581c764e327f55c5cd41c1685aabdd90	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/varnish/manifests/netmapper_update_common.pp,varnish: mv wikimedia_vcl, netmapper_upd to separate files		fixing:		./modules/varnish/manifests/instance.pp -	error: varnish::wikimedia_vcl not in autoload module layout on line 1		./modules/varnish/manifests/zero_update.pp -	error: varnish::netmapper_update_common not in autoload module layout on line 2		change-id: i5e94fb5000d2bf38e39cd207a525ec421a5240d1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/server/account_security.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/tests/server.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/openstack/nodepool.pp,openstack: more refactor and cleanup for multisite		this started as getting controller_firewall.pp out of the	module and into a role based abstraction.  there are various	levels of cleanup here as i removed portions of the controller	role there were not used and options that were obsolete.		change-id: ied6758c8eb13d438384a4255a45577d5abc82ab0	|openstack: catch nodepool up with manifest reorg		change-id: i75250bc36be660f6dfa49cca47971c1ecd6c19f5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/aptly/manifests/repo.pp,aptly: get rid of 'main' in aptly repo name		just cluttery		change-id: i48329e28f0abf5a345b2eadd3bb58f058bf2fd49	|aptly: change naming schemes for repositories		this one is simpler, and more closely matches jessie-wikimedia,	trusty-wikimedia, etc		change-id: i524f50ed43cdc96b28828bd4ef61fbd3b14ce150	|aptly: setup depnedencies properly		change-id: i465aa0e579ca1c5a919f5daa4d20939ee324b165	|aptly: specify arch explicitly for publishing		change-id: if2fa2c50bd5ec036155e5bed67888e1673c62edb	|aptly: switch class to define		change-id: i13e0857faa3580df5b2a652b18833d6fe483aaec	|aptly: auto setup published repos by default		change-id: i2f74b783a0b3df34572bb23f1151c60ec2019b1d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/tools/bastion.pp,tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/tests/mysql_grant.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/tests/geoip.pp,modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/master_dir.pp,role::contint::*: try to resolve circular dependencies correctly		change-id: ie0ea276575272af94d395b8a59fa7b42e93f5982	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/beta/puppetmaster.pp,beta: move roles to modules/role/		- split the large file into one file per class,	  per style guide and lint		- move them into autoload layout in the role module	  and out of manifests/role/		change-id: if8f08467126ec607806c7b704f9953c96dc17e88	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/shinken/manifests/init.pp,nagios_common: kill all the love		remove the ❤❤❤❤❤ suffices and $lover_name. i'm really no fun.		change-id: i5d21f7d405d8ae0169c7d5d5bb0b228f164d7bcb	|monitoring: use nagios_common for contactgroups		deduplicate contactgroups by moving the stanza to the abstracting module	nagios_common		change-id: i37995f98b67a360abbb592b2f6601d9f7c9ef122	|shinken: add fixed up init script		see line 76 of init file for why		change-id: i1666f548e2aa835928d7026cc1848fc129ded95f	|shinken: unify shinken::hosts and shinken::services		change-id: i8511a08aa183474f24a1f5005c44678c5449de73	|shinken: setup irc notification for shinken		also remove unused perfdata commands from notification	config	change-id: i9a9880fdf414cdf23a114651f917e97ea701b3f1	|shinken: cleanup to be better compatible with autoload layout		change-id: if8d4d1af1f11b8e1cd39c1cee738f709d5bfdae4	|puppetmaster: add script to track upstream changes		this is currently in use by deployment-prep, and seems general	enough for wider use as is. adds a puppetvar that makes this	usable.		note that before merging must munge the roles applied on	deployment-salt.		bug: t1150	change-id: ifa3229d6fb3424f75d14dd2569efca3b93936aeb	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nagios_common/manifests/user_macros.pp,fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|icinga: make all config files belong to icinga:icinga		no reason they should all belong to root.		also remove the exec{} that munged permissions. add explicit	modes where required.		left as root ownership is:	- executable files	- files that specifically have a mode set that would not allow	  any access to non-root		change-id: i6d95a9b45e868d13b07dd5be42007b263c8f2cf3	|nagios_common: extract user_definitions from icinga		- use same config in shinken as well	- add $pluginsdir$ to refer to plugins folder.	  this is what shinken uses by default, and is	  way more descriptive anyway		change-id: i00691021a634a8568cc0485e48dbbdb8c59f78fe	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/manifests/discovery/ddxfile.pp,modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/elasticsearch/manifests/proxy.pp,elasticsearch: fixup i9c2e50ec2fd		change-id: i7f087f43489d7a3fbeb5aa7613458d058c933584	|elasticsearch: add read-only reverse proxy for labs es		this is pretty much the bare minimum that could possibly	work, it's probably plenty.		change-id: i9c2e50ec2fda25e8742fa7f26fd2692e5647f12a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/mediawiki/appserver.pp,mediawiki: split role classes, move to modules		instead of stuffing all roles into a single file,	use the correct structure for autoload layout and use	one file per class as per style guide.		move the classes to modules/role/ structure		change-id: if7626dba62cc14ff62a12cc1df7af49a61211429	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/init.pp,mysql: make lint ignore classes inhering from params		instead of globally turning this off in puppet-lint.rc,	mark the few actual occurences as fixmes and let lint ignore	them in those specific places only.		change-id: i5deef55101c5105007521ff366182af955baf29b	|initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/toollabs/manifests/images.pp,tools: add a role to help build tools images		change-id: i4ca11e3922604554fbc3dad334f0a087a0df0dbd	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/statistics/manifests/sites/metrics.pp,statistics: lint fixes		fixes more puppet-lint warnings	for t93645		change-id: ie3adcc01011acaed04ee41331263ed0c91c0172c	|require statistics::web in statistics::sites classes		change-id: i3ec5366046d8a1952899e2a54b3d1d04cf63a8d8	|fix dependency, fix template variables		change-id: i1cb102d6a5220e3ce34b6be4e5cd12cdaa9298f5	|use proper path for statistics::sites templates		change-id: iee382cce771fabb41ed4ff7459269f844d280275	|first commit in a multi-commit effort to move misc/statistics.pp into modules/		t87450		change-id: i49140d85ddea99f5d4d9a3c71e60cf7fa57d49b6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/identd/manifests/init.pp,identd:lint		change-id: ieb3c290d0469abf3dcca6a5e316ff6146bd3533d	|identd daemon module		ridiculously trivial for now.		change-id: i68216f9ba34805a0240983fc729e7e8782c174df	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/jenkins/manifests/group.pp,jenkins: retab + some linting		change-id: i34ae59204fa397473c277a7c56ae00986f037296	|fix jenkins::group class		it had a subclass and was thus defined as jenkins::group::jenkins.	also make the group a system group.		change-id: i474c54e6142762c9836f057f18c71d3e9f8578fa	|jenkins module created out of contint manifests		misc::contint contained a jenkins class for the continuous integration.	i have extracted out the part which are only related to jenkins in a new	jenkins module.  simply 'include jenkins' and you get an installation.		moved the jenkins group definition to the module, dropping gid 561 in	the process and letting puppet manage it for us.		the jenkins instance might need to be proxying via apache, that	configuration is not part of the jenkins module.		change-id: i33bce60e08fd4c1e8184d6fac5ba0d3f9798fe35	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/grafana/manifests/init.pp,grafana: provide the ability to provision dashboards via puppet		grafana dashboards are stored either in grafana's database, or as json files	in a specially-configured folder that grafana watches. this patch adds a puppet	resource representing a json file dashboard definition.		change-id: ia558d44249db98cedf9d2187709c0de6e8ed595a	|drop grafana 1.x; promote grafana 2.x		* remove 'grafana' role and module.	* rename 'grafana2' role and module to 'grafana'.	* make 'grafana-test.wikimedia.org' 'grafana.wikimedia.org'		change-id: i4bb1c5a281767bf192eac81b788b3b37d0a13f73	|grafana: set a default dashboard		by default the default_route is 'dashboard/file/default.json'	which is immutable and not very useful.	https://grafana.wikimedia.org/#/dashboard/file/default.json		instead, point to an actual dashboard; one that we can modify:	https://grafana.wikimedia.org/#/dashboard/db/home		also fix dead-end url to annotated settings file on github.	that file no longer existed in latest upstream master.	use a permalink to v1.8.1 instead, which applies to our install.		avoid naming our custom home 'db/grafana' which is the default	name that is chosen when trying to save the file/default.json	dashboard – thus overwriting our custom home page.		change-id: i5f117822ac737f16a1b8e82a585e16dc2dce459e	|add grafana module & role		* grafana deployed via trebuchet.	* provision on zirconium, place behind misc-varnish.		related dns change: i6b1ec4aa0.		change-id: ic0433374136ab468441a13a9abeba875fe92be99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/toollabs/manifests/node/all.pp,tools: create separate partitions only in the tools project		currently on each execution node a 16 gbyte partition for /tmp and a	swap partition of three times the physical memory are created.  in	practice this means that all execution nodes must be of type m1.large	or m1.xlarge because only they provide enough disk space.		this makes testing setups involving multiple execution nodes in	toolsbeta more difficult as those types of instances consume a huge	portion of the cpu and ram quotas, while for testing the interactions	between grid nodes instances of type m1.small would be more than	sufficient.		this change conditions the creation of those partitions on class	parameters which can be disabled for toolsbeta via wikitech.		change-id: ia2505aaa96cca1e0fb0799e29dfaba68a0bb3c9e	|tools: can't actually use ../init.pp in a subdirectory		rename node/init.pp to node/all.pp and adjust includes accordingly		change-id: ifa32978f48daf64ccad934fadbc64cd6fad18511	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sslcert/manifests/ocsp/init.pp,update-ocsp-all: write output to logfile		use a logfile (and rotate it) instead of cronspamming.		bug: t132835	bug: t132324	change-id: id4a73844d6218a0e257191690feec898f48db371	|move tlsproxy's ocsp stapler/updater to sslcert		now that the tlsproxy's ocsp stapler/updater has been made more generic,	create the necessary abstractions within the sslcert module,	sslcert::ocsp::conf and sslcert::ocsp::hook, and move the vast majority	of the contents there. this makes it useful to other modules as well and	factors out functionality that doesn't fit the tlsproxy module all that	well.		change-id: i0a050585cb5f61fae8411f8db93228e9b81078cd	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ceilometer/controller.pp,ceilometer: move roles to modules/role/		split the file into one file per class and move	it into proper autoload layout in the role module.		change-id: i3f985795d4e63268823e684f7821e68b2c2c9884	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/pybal/testing.pp,allow pybal::testing to vary the pybal config		change-id: i4b203e5a55637977d596da379380b44ae2cd9b53	|pybal: introduce role for testing machines		this should guarantee that a functioning setup of pybal is provided,	including a pybal configuration that should include all services from	the whole datacenter.		change-id: i0882db68c5a8d87b4312925a666ef13250f8305c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/tests/ssl.pp,modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/otrs/manifests/web.pp,otrs: remove ssl cert and config		since otrs moved behind misc-web (t122320#2014594), it doesn't	actually speak ssl/tls anymore. also see the apache config template,	no more virtualhost *:443, just:80. ssl termination is before that.		the certificate is about to expire and deleted in i03c33fb9e79a6adff	which should go with this and removal of the key in the private repo.		bug:t122320	bug:t105554	change-id: i4ca009b3ad275865e25cc9b2b47ea36cf5194edb	|otrs: add support for apache's mod_remoteip		the new otrs box is behind misc-web, so the remote ip as seen by apache	is actually one of the (currently four) misc-lb cache servers. this	affects the access logs, which could be easily fixed by substituting %h	with %{x-real-ip}i.		however, this also affects otrs itself, since it it checks users' remote	ip to validate sessions (also see t87217 for background).		use mod_remoteip (an apache 2.4-only module, rpaf's replacement) to make	apache trust x-real-ip coming from the varnish servers as the real ip.	restrict the trusted servers to just the misc-lb cluster, and use hiera	for that, to make sure it never gets outdated.		change-id: i8be2697d1b1f207c0cf0cfff95e83d4883bad0d7	|modularize otrs		this was a single role before, move it to the module/role paradigm,	splitting up the various classes and moving templates/files around.	add tests, documentation for the new classes.		change-id: i04cc8d734cd83acc2ce4c4d26cea9c0fbd1da2ec	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/tmpreaper/manifests/reap.pp,fix whitespace-related lint issues		fix a lot of lint warnigns due to incorrectly aligned arrows.		change-id: ib062d7142a79a8cb6bb3abd86fd7499aa3edad03	|add tmpreaper module		adds a tmpreaper module with two custom resource types:		* tmpreaper::dir adds a directory to the set of directories which are 'reaped'	  by tmpreaper during its daily cron run. it does so by appending the directory	  to tmpreaper_dirs in /etc/tmpreaper.conf.	* tmpreaper::reap allows a path to be reaped by puppet, like puppet's native	  'tidy' resource, except not insanely broken. this may be used when the age	  setting or other settings in /etc/tmpreaper.conf (which are applied to all	  directories) are not optimal for the given path.		change-id: ibc013bbf58340664213273bbb97954e5a1e08f9c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sysctl/manifests/parameters.pp,sysctl: make the default priority 70		udp2log broke because the kernel parameters it requires were being clobbered.	this is because both sysctl::parameters['big rmem'] and	sysctl::parameters['wikimedia base'] were set to the default priority of 60,	and each was attempting to set net.core.rmem_max to a different value.		in change i50d929847, andrew b. and i fixed things by setting the priority on	sysctl::parameters['big rmem'] to 70. in hindsight, this doesn't go far enough.	we can safely assume that in case of conflict between 'wikimedia base' and some	other sysctl::parameters resource, it's the other resource that should win,	since it is more specific than 'wikimedia base', which specifies cluster-wide	defaults.		having the default priority set to 60 is unfortunate, because that is the	lowest possible value that is not reserved by debian/ubuntu for sysctl configs	bundled with packages, so it doesn't leave room for declaring broad defaults.	so: make the default 70, and change 'wikimedia base' to 60.		also add documentation and remove the 'filename' parameter from both	sysctl::parameters and sysctl::conffile, since it is both unnecessary and	leaves a way to circumvent the naming convention.		i tested this on vagrant. i also confirmed that integer values are	automatically cast to strings for the purpose of regex matching, so a literal	'70' (the number, not the string) does indeed match /^\d?\d$/.		change-id: i02673456fdaec1e065dff449a12435c5ecccf14a	|add icinga checks for important sysctl params		add 'check_sysctl', an icinga plug-in that issues alerts whenever the actual	and expected values of sysctl parameters are not the same.		i made two additional changes that were prompted by rereading the readme of the	debian procps package:		  "in general, files in the 10-*.conf range come from the procps package and	  serve as system defaults.  other packages install their files in the	  30-*.conf range, to override system defaults.  end-users can use 60-*.conf	  and above, or use /etc/sysctl.conf directly, which overrides anything in	  this directory."		thus:		* make the default priority of sysctl::conffile and sysctl::parameters	  resources 60, rather than 10. any additional sysctl::parameters resources	  won't come from the procps package itself, so the default priority of 10 is	  neither sensible nor safe.	* change priority of sysctl::parameters['lvs'] to 60 so that it conforms with	  the priority namespacing policy of the package. (the 50 range is not	  defined.)		change-id: if004835fb369810bba553dce2d2b8df7b8d364ac	|remove a bunch of dangling commas in param lists.		puppet 2.7.7 chokes on these.		change-id: id8a5d8efa8fe3b1d004c21d72668dccaa04a2f81	|clean up sysctl parameters.		this patch reorganizes the sysctlfile module and sysctl resource into a	reworked sysctl module and configures puppet to manage /etc/sysctl.d	recursively. this means puppet _will_ purge defaults installed into	/etc/sysctl.d by default. however, the defaults installed by ubuntu precise	have been expressed as sysctl::parameters['ubuntu precise defaults'] in class	base::sysctl.		change-id: ib294b691dad8500c2e0cd39896882f8cf4f3a286	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/openstack/manifests/envscripts.pp,use proper novaconfig[] settings in environment scripts.		followup to e2513914819f5f121c42e9714d048aebb9b68689		change-id: i68d478e317676b4b2f7cfe974f815432c2e10769	|add wmflabsorg-domainadminenv.sh script and refactor novaenv.sh classes		we're going to need special credentials for designate's handling	of the wmflabs.org domain; this patch sets up credentials for	that and adds a new script, 'designateenv.sh' to use with	commandline tools.		this patch also creates a new class to create both novaenv.sh	and designateenv.sh, and adds those files to the horizon host.		change-id: iba8f6ad97807fafc36b4995750a208801b4019d9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/proxy_zuul.pp,contint: proxy only enabled on wikimedia.org		the proxy configuration is server wide, which cause any virtual host to	serve them (ex: http://doc.mediawiki.org/ci/ ) when we only want to have	them served from integration.wikimedia.org.		this patch moves the proxy declaration from conf.d/ directly under the	serverroot where they can be included using 'include *_proxy'.		as a side effect, that makes the bots to honor the robots.txt :-]		change-id: i022a3b086bb9822a9c123440d2e71d6056dafbc7	|contint: move apache proxy configuration to module		continuous integration has two internal webservices (jenkins and zuul)	which are exposed publicly via an apache proxy. this patch moves the	definitions under the contint module and factor out common code in a new	contint::proxy_common class.		the zuul proxy is included in the role::zuul::* class.	the jenkins proxy is included from the old misc::contint::test::jenkins	which is roughly the equivalent of a role class.		change-id: ia140f6ed7ab9dc12d41422f109750e4018211516	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/programdashboard/app.pp,fix role::programdashboard include and hieradata		change-id: i74d9c18284bc9827e4a2dce2f9a5c8e08a1a0336	|programdashboard: move role to modules/role		change-id: i79fe8a55e94d5f8c365b380c430befcead92c33f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/toollabs/clush/target.pp,introduce 'clush' module and toollabs role		change-id: i6f3ffa16b759ddb4c2fd6bf5753b82796d84c6d8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sysctl/manifests/init.pp,sysctl: move selector outside resource block		change-id: i53d29d32752b7c282d707714d9adf5d286c16a52	|fix sysctl application on jessie		change-id: i1c8c4086e940b9896fd597d60304ce79ce35bdef	|sysctl: brown-paper bag fix for service's exec		change-id: i41ca9a3a8daacf213943105415af7e20ac355d27	|sysctl: make service call init system-agnostic		remove an onlyif that checked for an upstart unit, that was a remnant	from a workaround for ubuntu hardy boxes. switch "start" to a "service"	call so that it works equally under all init systems.		change-id: i0952cb041036ff2bce4e3007c272e009e7780c74	|replace service['procps'] with an exec		procps is a task job, not a service, and it is only hackery that makes it	appear like a well-behaved service. so replace it with a refreshonly exec.		change-id: i8edb51a519c68050f577aebea1df9045b2c4b933	|fixing ownerships, permissions in various places		change-id: i5e912b4fb1d48b7dbd2e82c362989fb515da0575	|clean up sysctl parameters.		this patch reorganizes the sysctlfile module and sysctl resource into a	reworked sysctl module and configures puppet to manage /etc/sysctl.d	recursively. this means puppet _will_ purge defaults installed into	/etc/sysctl.d by default. however, the defaults installed by ubuntu precise	have been expressed as sysctl::parameters['ubuntu precise defaults'] in class	base::sysctl.		change-id: ib294b691dad8500c2e0cd39896882f8cf4f3a286	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/apache/manifests/mpm.pp,apache: install mpm files after the package		change-id: i6a4556eeb7359e08ca46a07603a8dfa22a3b21d9	|replace usage of requires_ubuntu / ubuntu_version with requires_os / os_version		change-id: ia7a2052559fb46ae2d2b3e096ce37f90919a18f4	|apache: change mpm dependency to work on trusty as well.		change-id: ibbfec0a1e07fd6f333b8121860f9e4b81bc9c4a5	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|apache: remove $rejected_pkgs		- on precise, the module is just a stub and doesn't have anything to do	  with the real work of apache. the version of apache installed will be	  decided by which mpm you chose, and it will automatically remove upon	  installation all other mpms. if config is not badly broken by us, the	  os will take care of this itself.		- on trusty, removing the module config cannot depend on removing the	  mpm packages, which are just transitional and empty.		change-id: i319adfb5769688da802125d3731d609d47b13eb2	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|mediawiki: use mods-enabled, prepare for hat		we move the whole management of all apache modules to the standard	debian location, mods-enabled, and out of the apache2 main config file,	that becomes much shorter with this modifications.		we also include modules depending on whether we're on a hat installation	or on a standard mod_php5 installation.		this change needs patchset 147086 to be merged in order to work.		change-id: ia463120718dceab087ad3f8e3f35917fa879f387	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|apache: cherry-pick mods added in ia46312071		* make ia46312071 smaller and safer by introducing the mods it depends on.	* make mpm changes do a config test.		change-id: if903d5cb39f561203271a87fe192533fb7fd299d	|fix-up for ic952146b5: check $mpm, not $selected_mod		change-id: i3f1bb771318831e2989a67c4385f9327677575c9	|apache: add apache::mpm		adds a class that lets you select an apache multi-processing module (mpm).	prefork, worker and event are available. prefork is the default. trusty and	precise are both seamlessly supported.		tested via vagrant on both precise and trusty.		change-id: ic952146b5eecb1d2e163e91fc08232202c728249	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/tests/java.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/irqbalance/manifests/disable.pp,irqbalance: double quoted strings		change-id: i0414f4b3b9ce9e9c6d455c1d7377938cf644bafb	|*really* disable irqbalance if doing rss		change-id: i2f871659990efcd0370454682fb7424cf0a03099	|add optional rss setup to interface rps script		adds a second parameter as an rss pattern match in	/proc/interrupts for finding the rss irqs that match	the rps queues.  if specified, it will be used to do	matching rss+rps assignments to the cpus.  the pattern	must contain a "%d" placeholder for the location	of the queue number in the interrupt action name.		unfortunately i haven't found any generic way to	figure out the rss irq action name automagically, or	to avoid text-parsing /proc/interrupts.  the parameter,	when used, will be driver/hardware -specific.		this also disables irqbalance if rss is in use.		change-id: ib51ad49935e86d858362c5f8df3d6c16bbe21a6b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/sslcert/manifests/ca.pp,sslcert: fix ::ca's ensure => absent		confusingly, files under /etc/ssl/certs have a .pem file extension, not	a .crt like it is required for /usr/share/ca-certificates.		change-id: id7d24477a9b29c31b3e872f280862364c313c0bb	|run update-ca-certificates on ca removal as well		change-id: i91a4245072082f4e1ccf4f9c7b22383f1306a56e	|sslcert: cleanup for ::ca ensure => absents		it looks like update-ca-certificates only adds /usr/local/share/...	certificates to the trust store but does not ever remove them. clean up	manually.		change-id: i9df11dd95216346ee2b28a29fb3505bd10688271	|sslcert: remove source/content checks		these fail with ensure => absent callers, which rightfully have neither	source nor content.		change-id: ic73a2bd776b614ed73582e41f5ca932f6ec2f683	|sslcert: whitespace & comment cleanups		change-id: i778f330cfc7d7751015c0321aa667b295233b0ae	|sslcert: add sslcert::ca define, use it from certs		add a new sslcert::ca definition that installs a ca. use it in certs.pp,	making a little more dry.		change-id: i15f96bb5cc790a68f29a3516acf8977d1343008e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/programdashboard/manifests/app.pp,lint: fix some of the few remaining warnings		there is not that much left in this area, a small follow-up	to ib062d7142a79. very few warnings left in general.		change-id: i71dbdb10b6a480d120893262a2db05d23d311a05	|program dashboard configuration for initial labs rollout		defined role::programdashboard::app and programdashboard::app which	provision rails application dependencies, passenger setup, and the	deployment directory. this setup assumes that deployments will be	executed using capistrano and the existing configuration within the	application repo.		a labs specific database setup will be included in a follow-up patch.		bug: t105967	change-id: if6d8deed74dd6def372dee6df786c7594bddbe0c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/openstack/manifests/nova/instancersync.pp,openstack: move instancersync define to own file		change-id: ibb86285d99123c3e04f5a60d04c98864d8ca4e26	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/elasticsearch/manifests/log/hot_threads.pp,fix stdout/stderr shell redirection syntax - take #2		followup from idbc339cafe0		change-id: i4e6add0a18eab686b1370fd404cbc1aed3648c83	|elasticsearch: lint fixes			hosts where compilation is identical:		    elastic1001.eqiad.wmnet		http://puppet-compiler.wmflabs.org/479/change/170496/html/		change-id: i13dea5c6dbf4f4d2526af72d2ac415b23e44d94c	|log elasticsearch hot_threads		logs them once every five minutes when under low load and once every	minute when load goes above half of cpus.		change-id: i436c91a60bcc93d6b8ca6c40409784b6649f0916	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nrpe/spec/fixtures/manifests/site.pp,refactor nrpe to a module		turned the manifests into a module, added/cleaned up documentation, made	puppet-lint happy, moved/created templates and/or files. added unit	tests. also update site.pp/base.pp to not explicitly load nrpe.pp	still needs some love but this will work for starters. rspec tests have	also been added, but fail at this point		change-id: i64a9f1d60cbabeef3a096981d634d7399d39bc45	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/admin/manifests/groupmembers.pp,admin: stop passing around a huge data structure		our current puppet catalogs are huge becuse for every group and every	user we have a specialized copy of $::admin::data, which is a very large	hash indeed. use direct references to it instead.		change-id: i526f659dccabb1726c7dda14b3a50cc6fd5a0828	|admin yaml stat* and analytics fixups		there is a use case for the stats group not easily handled	by a centralized grouping system.  the workaround here is to	allow group names in yaml to not be the on box final name.		including:		    include accounts::dr0ptp4kt    # rt 7569	    include accounts::brion        # rt 7568		change-id: i6a3ef6d1cb5d835f3cdb9bbf2ca8bad099af2ecf	|admin module for user/group/permissions cleanup		users/groups/perms are meant to be defined in yaml.		applied like:		yaml:		  groups:	    test1:	      gid: 1	      members: [foo]	    test2:	      gid: 2	      members: []		  users:	    foo:	      uid: 1	      ...		.pp	  node /foo/ {	    #groups create their users (can overlap) and permissions	    #as well as system groups and handling user membership	    class { 'admin': groups => ['test', 'test2'], }	  }		more info see: admin/readme		change-id: i6982bfced50a22faac37246dff4d52ff163a34ed	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/tests/console.pp,introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/html5depurate/manifests/monitoring.pp,add html5depurate::monitoring		already referenced in the role class		change-id: i4b0c7be1046e40beaf4db7664486f2b8ac05ed2f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/dataset/common.pp,role::dataset::common: limit to production networks		this is only accessed from hosts in production and the whole setup	isn't really suitable for labs, so limit to production networks.		change-id: if601b494ea50340db4e4b322a1e78b58acdfc9d3	|move ferm rules for dataset roles into common manifest		also include standard and base::firewall there and move out of node	declarations		change-id: ia310d4ce92fdf4a9c9867f41e0d1cfbdc376f55f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/swift/manifests/init_device.pp,swift: align partition to 1m boundary		on jessie mkfs.xfs is strict about partition alignment and will refuse to	create the filesystem unless forced, set partitions to start at 1m boundary	(arbitrary)		change-id: i56ff0e33a88318d8f340bd19bdd5db1f4b38583f	|rename swift_new to swift		can be reproduced with:	  git mv modules/swift{_new,}	  git mv hieradata/common/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}.yaml	  git mv hieradata/codfw/swift{_new,}	  git mv hieradata/codfw/swift{_new,}.yaml	  git mv hieradata/esams/swift{_new,}	  git mv hieradata/esams/swift{_new,}.yaml	  git grep -l swift_new | xargs sed -i 's/swift_new/swift/g'		change-id: i22102da8b14a31719927355ff3efbe19717fcfae	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/rsync/manifests/get.pp,manually adding modules/rsync for managing rsyncd modules.		puppetlabs-rsync:  https://github.com/puppetlabs/puppetlabs-rsync		see also abandoned change where i attempted to add these as git submodules:	https://gerrit.wikimedia.org/r/#/c/21744/		change-id: i2c811843b414fcbdbea4224157847135402af590	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/diamond/manifests/collector/minimalpuppetagent.pp,diamond: stop referencing to python-diamond		old and transitional package name		change-id: i12db1315c8abc084f5690deffa4b764feca4484d	|diamond: use require_package instead of ensure_packages		conflicts with an require_package on other places,	such as modules/service/manifests/monitoring.pp		change-id: i50a7d0816ac47987c24f39d31ebd219939648aa7	|make sure that python-diamond is included before adding the labs collector.		change-id: i06b7a0282cfd85deccd06f711e2f24afc073e99b	|replace admin::sudo calls with sudo::user/group		admin::sudo was never meant for system users and it was misused across	the tree. replace with sudo::user & sudo::group instead. the distinction	is subtle and is about to go away as part of a broader admin/sudo	consolidation.		change-id: i51ccfe7a5e1d8e1c341e5c0ece4385c62aafceca	|admin::sudo: remove comment support		this is sparsely used and when it is, it's really obvious comments, so	this probably encourages a bad behavior. besides, if there's something	really important that belongs into a comment, it can be placed in a	puppet comment; reading /etc/sudoers.d files manually isn't going to	give the full picture anyway.		change-id: i15506c376c811ce79ec1dfd6f0d714814e0dd670	|diamond: let diamond read the puppet state file (take 2)		this reverts commit 07bc23c866fb90c712bffaff7564b8ca960f7708,	and also adds a few fixes to prevent spam from happening again.		the spam was because of an older version cherry-picked on	to betacluster, which has been fixed by bd808.		agent now first checks if it can sudo before attempting	to do so. such sudo failures will be logged to diamond.log.		change-id: ia2fc78fadbfa9dbc036d9dfb210e8e0db222fe62	|revert "diamond: let diamond read the puppet state file"		the sudo rule isn't everywhere, causing diamond to very much spam root.		this reverts commit a2fba3ac4446d377d4dccc9d387d34a5bd971d45.		change-id: i045d854ffde5a29e7dc574204ef3303688a19f08	|diamond: let diamond read the puppet state file		currently, /var/lib/puppet is set to have no permissions for o,	causing diamond to not be able to read the last_run_summary.yaml	file despite that file having appropriate permissions set by	puppet.		so instead, we let diamond sudo to puppet just to be able to	read that particular file, via cat.		change-id: i615963917a5a042e645b2caec441369149a9ea8a	|use ensure_packages for things that include python-yaml		puppet resource conflicts are stupid		change-id: i2b28980ffdaa712f0397b2a952e19e339adb4168	|labs: enable  minimalpuppetagent collector on all nodes		this declares the python-yaml package, which surprisingly	isn't declared explicitly in anything else that runs on labs.		this collects only:	    - time since last puppet run	    - total time it took for puppet to run		change-id: i74239d0e502d9f6ac336137331511c8cb96e92f1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/vagrant/manifests/init.pp,vagrant,statistics: fix indentation warnings		change-id: i86ceedf0f8830cfcf81f0e229ca4f128dedeefb8	|add role::labs::mediawiki_vagrant		add a role and modules to provision and configure vagrant to manage an lxc	container to run as a mediawiki-vagrant instance.		* create a new trusty instance (doesn't work on jessie)	* apply ::role::labs::mediawiki_vagrant	* force a puppet run	* log out and log back in to pick up profile.d magic	* cd /srv/mediawiki-vagrant	* vagrant up	* setup wikitech to proxy to :8080 on your vm	* profit!		requires: i343c8da6e345933e29f92523638d3b19e133894b	requires: i0ee0caf19019ce6415519561ff33b3453b310468	bug: t106213	change-id: i04cfa3d143cad92b2be57d3813f0b09ecfb45bf5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/install_server/tests/preseed_server.pp,installserver: rename classes with dash characters		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		this is a follow-up to icb2122da0a43b7a1	where the module was already renamed due to this,	but not the classes inside it.		the classes ubuntu-mirror and caching-proxy are removed	from comments because they either moved to module/mirrors	or have been deleted meanwhile. this change doesn't touch them.		change-id: ib91faf62a8c4d2292f2a51e30fbf1c6583f15eaf	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/coal/manifests/init.pp,uwsgi: always die on term!		there are no cases when we do not want to have the normal	unix behavior of dying on sigterm, instead of whatever uwsgi	used to think was normal.		change-id: i010cdefa7604ba7af1dd77afb45fb73d51822f5f	|coal-web: use linear interpolation to estimate missing values		...and since doing that requires pulling in numpy, use numpy to calculate the	median as well.		change-id: i6f66e5fa808988be6ebefea5fbecb72a2329c423	|serve coal from performance.wikimedia.org/coal		* move coal role into performance role	* add coal/ mountpoint for coal webapp.		change-id: i16fba8f2b64fa82d77f34dc395ada0ff08363c39	|coal: turn into a module; add uwsgi app		* consolidate ::webperf::coal and ::brrd into a single module, coal.	* add flask uwsgi app for serving metrics.		change-id: i86aa41eb784c116d106443356e35d7d8259027cd	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/snapshot/manifests/dumps/dirs.pp,use fixed repodir setting for dumps jobs		old hosts are gone, new hosts all use the same location, no	need for hiera settings check		change-id: ib19109b4b963e4f13b74c1a8b8ea41fb5b77f3f1	|clean up dumps dirs manifest for snapshots		remove user/group params, never used	get rid of scriptsdir, no longer used	add vars for dirs that don't have them, so hardcoded paths can be	avoided in all other manifests		change-id: i4ee590012b453220549b98d5aed5c8815643e1c7	|move addschanges dumps to snapshot1007		these dumps become just one more misc cron job included in	the cronrunner role.  cruft like the 'enable' parameter gets	removed, scripts, templates and conf files are run out of the	same directory as the regular dumps.		bug: t141282	change-id: i109583619dc3f6dfaa9ac0aa86360adfb26f9f40	|remove obsolete wikiqueries references from snapshot hosts		change-id: i9ba4a0b64eb68496428af3710a0dad9bb1918bca	|dumps: fix up all references to directory with config files		except for misc cron jobs which should not yet be touched, everything	else should use the definition in dumps::dirs and now it does		this being wrong prevented the regular dump cron from starting		change-id: i00386a6401b8bbdd79fe6c65675325e241afba26	|fix repodir reference for monitor script for dumps		change-id: i2309806bc355acefdb52c495aca31504d86c0194	|explicitly define repodir on snpashots for cron run		the other definition is in the source file for scap3, can't be	used here.		change-id: i183376d18a215e2a070e30b3c6a3cf2fe398a59b	|snapshots: fix up all variable refs to dump dirs in templates		change-id: ibc1027b69289793a621937a65544268c1ed313fa	|snapshots: move dumps cron job script to same location as the rest		also fix up the variables for the dirs it references, as they	have changed, and add placeholders for the scap repo dirs and	associated vars		add back the /srv/dumps script dir for now until scap is set and going		fix up a couple cron jobs that were referencing the wrong script dir		change-id: id2e32765ecb80acd1fd45258aad61cba7e25ac20	|snapshots: restructure directory handling a bit		* move all dumps dirs to /etc out of dumps repo area	* remove the declaration for the dumps repo dir, that now	  will be taken care of elsewhere	* move the actual dirs manifest into the dumps directory	* remove all hardcoded refs to dumps dir and replace	  them with snapshot::dumps::dirs::dumpsdir which means	  a few script files turned into templates and manifests	  setting those up were altered accordingly		* still to move: addschanges and wikiqueries dirs under /srv		change-id: i73b0072a6b50fb92a64c3bd3aa6d4ff427d5051f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/slow_digest.pp,mysql_wmf - autoload layout and lint fixes		move classes into autoload layout	fix lint warnings		change-id: ie7510e8c90e365f43ce621c3f524aa1e87e2c584	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/icinga/manifests/nsca/client.pp,move majority of privates/files usage to secret()		this is all of the trivial cases, where a fixed path was hardcoded	as the source attribute of a 'file', 'ssh::userkey', or	'exim4::dkim' definition, all of which are known to handle the	source/content switch ok.		change-id: i0db6fdb1c75355b58095e0ec29d6028bbc614649	|icinga: move nsca code into module		- nsca::client does not seem to be used anywhere except the	  hadoop nodes	- the firewall rules misspelt nsca as ncsa, corrected (i assume,	  since the port numbers match nsca, and ncsa seems totally	  unrelated)		change-id: i4c6e84da376796253689a980a382ff62c8e29f56	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/etherpad/manifests/init.pp,etherpad: simplify module and role		these days we no longer have apache for etherpad. remove all apache	configuration from role, and simplify the module by setting some	sensible defaults for some parameters and stop declaring them on the	role level. also:		* remove the old apache configuration file	* remove the autorestarter that never really worked	* set default charset to utf8mb4		change-id: i54a8c3314f4dc34f7af8325ca722e90b5241a953	|etherpad: require the package before populating robots.txt		change-id: i0e0a91bbc8c9952b3734f067a63a31159a8b88a0	|etherpad: ensure present		as per policy, let's avoid latest		change-id: i04ee2f83b5eae8d2a732bc39d6f3c48ac8cf91f2	|etherpad: minor lint		change-id: ibccdee45684f56dd8536c06f21dcdc91227fc78d	|etherpad: convert into a module		some heavy refactoring to achieve this.	use the new ::apache module definitions	reorganize into a module and role class	drop server alias support	update to the latest coding standards		change-id: i4826098f875045e10f1e0a5a69c9ea972dc8e9d8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/contint/manifests/tmpfs.pp,contint: use device=none in tmpfs		it's ignored either way, but might as well for consistency.		change-id: ia2801cd86b173cbea190540142c01d7c5a235d9d	|contint: tmpfs is now root:root and world writable		when enabling the tmpfs on labs instances, we found out that the instance	ends up deadlocked upon reboot. the jenkins-slave user is not known to	the bootup mount command since it is only in ldap.		instead, change the contint tmpfs to be owned by root:root, world	writable and with prevent deletion bit set (1777).		the file {} directive does not set any user/group/mode to prevent puppet	from changing them after the tmpfs has been mounted.		bug: t76250	change-id: i4713ff77a7835ec5cd1dc000c85198732e40ed64	|contint: vary tmpfs conf on master and slaves		i am going to need tmpfs filesystem on jenkins slaves.  jenkins runs	under a different usernamee (jenkins-slave instead of jenkins). to	achieve that this patch:		make contint::tmpfs a define which let us call it several time on the	same server, for example whenever the master also has a slave setup.		change-id: ie77991f70459436b749d7b5d347e92959a648788	|contint: 100% passing puppet-lint		i have added a few dummy class comments to make puppet-lint happy:		before:		  $ cd modules/contint/	  $ puppet-lint --with-filename .	  ./manifests/packages.pp - warning: class not documented on line 1	  ./manifests/testswarm.pp - warning: class not documented on line 1	  ./manifests/tmpfs.pp - warning: class not documented on line 1	  $		after:		  $ cd modules/contint/	  $ puppet-lint --with-filename .	  $		\o/		change-id: i2de54b7badc93140055558f2130ff3109efcd49b	|contint: move tmpfs disk to the module		the continuous integration server requires a tmpfs mount to write sqlite	files too. this is due to precise introducing some slower disks access	that cripples the tests.		change-id: i659c126abe3917d7ca4d0215582c008ac9ae8d1f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/service/manifests/deployment_script.pp,service: add deployment_script define		we introduce a define that helps releasing the code at a specific	version, locally, by first checking out the code, then refreshing	the config file with a tagged puppet run, and finally checking the	health of the system.		change-id: id226d368378c9223ce96e0993b0e668397337ccb	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/elasticsearch/manifests/nagios/plugin.pp,fix whitespace-related lint issues		fix a lot of lint warnigns due to incorrectly aligned arrows.		change-id: ib062d7142a79a8cb6bb3abd86fd7499aa3edad03	|elasticsearch: move dependencies at the correct level		out of module dependencies cause problems with lookups and tests and are	an anti-paradigm for puppet development.	the containing class icinga::plugins anyway already has the correct	require and notify parameters. remove the 2 redundant and harmful	requires		change-id: ia41128896ed76e154ca4ba96670caa3dc6fc8623	|elasticsearch: lint fixes			hosts where compilation is identical:		    elastic1001.eqiad.wmnet		http://puppet-compiler.wmflabs.org/479/change/170496/html/		change-id: i13dea5c6dbf4f4d2526af72d2ac415b23e44d94c	|elasticsearch: add python-requests dependency		change-id: i7f21b1fee2df8bdbf804cc96522bd42372902343	|elasticsearch: deploy shard percentage check		this is the initial deploy alongside the existing check to verify it works as	expected. once that's validated we can switch over.	judging from past alarms it would have fired a few times:		0.030303 2014-02 19:51	0.574468 2014-02 21:33	1.714290 2014-03 23:20	0.079008 2014-04 19:58	0.080046 2014-04 20:24	0.078593 2014-04 20:37	0.071414 2014-04 22:19	0.038087 2014-05 03:47	0.072611 2014-05 19:52	0.072611 2014-05 20:15	0.073936 2014-05 21:28	0.032132 2014-07 16:36		change-id: ia83d2aa3f0e329e7212ad66c5e7d631f9f6ce939	|tune up installation behavior for /usr/lib/nagios/plugins/check_elasticsearch		previously we were relying on a dependency error to install this	file only when icinga was installed.		now that's managed by a virtual file def which is realized by	icinga.		change-id: i710c34fd73a37a601fc654b28f3920b57bd10bce	|adding nagios/icinga plugin and check for elasticsearch.		plugin swiped from: https://github.com/orthecreedence/check_elasticsearch		change-id: i5343ce236973fed0f590013cc5a68a26e1faba51	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/vm/manifests/higher_min_free_kbytes.pp,bump vm.min_free_kbytes on lvs/cache nodes		also, introduces new module "vm" and vm::min_free_kbytes() to	set a somewhat-dynamic value based on memory size that's safe	and reasonable, and moves old generic::higher_min_free_kbytes	to vm::higher_min_free_kbytes as well (without change).		change-id: i4682a08d967f873bd069aaf0c17ad2b02a0d4d78	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/tests/init.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/manifests/views/varnishkafka.pp,remove misc/monitoring.pp, remove import 'misc/*.pp'		remove misc/monitoring.pp, rename and move all the classes	to ganglia::views in the ganglia module.		this also removes the entire import 'misc/*.pp' from site.pp	because this was the last file in there. there is even	an error if i don't also remove that at the same time.		http://puppet-compiler.wmflabs.org/3244/uranium.wikimedia.org/		change-id: ie62b3041a6eae5aa06f7f172d80d223b10194cce	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/memcached/manifests/monitoring.pp,ganglia: drop the "gmond" service alias		now that gmond is ganglia-monitor everywhere, drop the alias => gmond	from both ganglia and ganglia_new and adjust all call sites to notify	service['ganglia-monitor'] instead of service['gmond'].		change-id: if5dff9bd3f2032998a4712cb6d11a8e061874fe7	|memcached: tidy		change-id: i6ffeb3f02868cc3fb5a0461952d650826401d8a8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/mha/manager.pp,add lint:ignore's for remaining files outside modules		these are all the remaining files that are not in modules	that don't already have lint-ignores or have been moved.		yea, that's all.		bug:t93645	change-id: i504b3f7bfccd2ddc12bf69fc9e36680f00cd3be7	|mha: add fixme/lint-ignore for inherit across namespaces		change-id: i78682820ca788e82bdbf898207b4b6c9e5511aeb	|mha: let lint ignore nested classes/defines		change-id: i08c1acd226b84a27b2bc2e4f92b9b212fa845247	|mha: move roles to module/role/		change-id: ia125c22c3d8ed9c2069d3c0920bff4e028b71f3a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/test/system.pp,testsystem: move role class to test::system		change-id: iac8ae297b5031c62e3fcffc3b9b3622e205c1dc4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/manifests/role/debug_proxy.pp,debug_proxy: limit to production networks		only accessed from hosts in production networks.		change-id: icaca1ba98a2844d6b8afa3540b1451fc49ff2ab9	|debug_proxy: allow all wmf networks		change-id: ifb63cc13b59281bd92ea8a731f6113ee3438e881	|add ferm service for debug proxy		change-id: i4df9cbd3bd489d4294ee160f6e05b85b44788aed	|puppet-lint: last 3 files with alignment issue, globally		change-id: i31d5b9e9e9e879981124d78de236f5788d8c777f	|debug_proxy: add mw[12]099 to backend_regexp		in addition to mw[12]017, make mw[12]099 selectable via x-wikimedia-debug.	mw1099 is already de-pooled.		change-id: i4f7923a31310fa93abe693363beee2838847e023	|debug_proxy: add resolver param and set it to $::nameservers		change-id: i9b1707f0bbcb940489f67b776b4ad7fe1b0ff859	|add debug_proxy module, for x-wikimedia-debug request routing		the module configures an nginx instance that listens on port 80 and acts	as a transparent proxy which passes requests to a set of un-pooled app	servers that are reserved for debugging, based on the content of the	x-wikimedia-debug http header. the set of permissable backends which may	be selected via the header is configurable via a regexp.		bug: t129000	bug: t129003	change-id: i2ef40124c891c7f9039850f90c7dc2f6e2641487	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/sysctl.pp,cve-2016-5696 mitigation		also, i hate arrow alignment		change-id: i51631e264b76300c6c563b8c3cd28bebd748856f	|disable unprivileged bpf on linux >= 4.4		change-id: id3e84a84e00b5abeb06e8b95de787dfb3313d159	|bump ipv6 route max_size to 131072 for all		bug: t113154	change-id: id0911a20669615e57318f2951425621b40d9e064	|base: lint fixes		change-id: ibc7a03213b5e86b37602d79690d87b1d7a935b2c	|base: update base::sysctl for trusty's new keys		trusty's procps introduced a few more keys. fs.protected_hardlinks &	fs.protected_symlinks (a linux 3.6) is probably a good idea, so update	our file.		while at it, remove the "precise" from the resource's name (and thus,	/etc/sysctl.d filename) and add a note explaining how we're	intentionally provision these on debian systems as well.		change-id: i6982f8eb94763855c28ef2a767624fbc0c3714d1	|sysctl: make the default priority 70		udp2log broke because the kernel parameters it requires were being clobbered.	this is because both sysctl::parameters['big rmem'] and	sysctl::parameters['wikimedia base'] were set to the default priority of 60,	and each was attempting to set net.core.rmem_max to a different value.		in change i50d929847, andrew b. and i fixed things by setting the priority on	sysctl::parameters['big rmem'] to 70. in hindsight, this doesn't go far enough.	we can safely assume that in case of conflict between 'wikimedia base' and some	other sysctl::parameters resource, it's the other resource that should win,	since it is more specific than 'wikimedia base', which specifies cluster-wide	defaults.		having the default priority set to 60 is unfortunate, because that is the	lowest possible value that is not reserved by debian/ubuntu for sysctl configs	bundled with packages, so it doesn't leave room for declaring broad defaults.	so: make the default 70, and change 'wikimedia base' to 60.		also add documentation and remove the 'filename' parameter from both	sysctl::parameters and sysctl::conffile, since it is both unnecessary and	leaves a way to circumvent the naming convention.		i tested this on vagrant. i also confirmed that integer values are	automatically cast to strings for the purpose of regex matching, so a literal	'70' (the number, not the string) does indeed match /^\d?\d$/.		change-id: i02673456fdaec1e065dff449a12435c5ecccf14a	|add icinga checks for important sysctl params		add 'check_sysctl', an icinga plug-in that issues alerts whenever the actual	and expected values of sysctl parameters are not the same.		i made two additional changes that were prompted by rereading the readme of the	debian procps package:		  "in general, files in the 10-*.conf range come from the procps package and	  serve as system defaults.  other packages install their files in the	  30-*.conf range, to override system defaults.  end-users can use 60-*.conf	  and above, or use /etc/sysctl.conf directly, which overrides anything in	  this directory."		thus:		* make the default priority of sysctl::conffile and sysctl::parameters	  resources 60, rather than 10. any additional sysctl::parameters resources	  won't come from the procps package itself, so the default priority of 10 is	  neither sensible nor safe.	* change priority of sysctl::parameters['lvs'] to 60 so that it conforms with	  the priority namespacing policy of the package. (the 50 range is not	  defined.)		change-id: if004835fb369810bba553dce2d2b8df7b8d364ac	|move base class and subclasses into a 'base' module.		this isn't perfect, but it should be a safe change...	more to come.		change-id: i81db39b163533530f0b5b19945ca9cf54c596400	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/tools/cronrunner.pp,tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/syslogs.pp,base/syslogs: fix "defined typed defined inside a class"		change-id: i1690f29f7d86a92cc2aecbfad17bf7b5db57c07a	|base: move syslogs/remote-syslogs to manifests		change-id: i6f2293d8d2c276eaa85c8f430be760ca5364aa3e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bastionhost/manifests/init.pp,bastion: install mtr-tiny, cleanup		change-id: ic63a9e91c22c62f1572665588f5b45cc5b341a24	|add a ferm service for ssh on all bastionhosts		this is done to ensure continuous ssh access on all bastion hosts	while at it, create a simple role class for bastionhost, and assign it	to all bastion hosts and delete older ssh rules marked to be removed		change-id: i61f2f9fcb6392ea13276748926fdc7f058f3fc2d	|bastion: lint		change-id: i9f1a78d5fc5fc54ef3d84d88ed387e2f4587d776	|remove mysql client from bastionhost		don't encourage people to use these from bastions...		- remove from bastion role	- just add it to fenari until that is gone, because	  fenari has a weird historical role		change-id: ibbcfdb6eb7451ebee5598331030c333801e5b114	|remove sudo::appserver from bastions		- remove the include from bastion role	- add to fenari so nothing breaks there		bastion hosts are not supposed to be used for	deployment.		let's not have another fenari in the end		i would like this as a pre-requisite to	i922e4ee5e		if this breaks anything please tell me what		change-id: i82cabbe9f6faac4de3829bf5d20ca5e140d1c27a	|added the system module and the system::role class.		also, massive search and replace!  s/system_role/system::role/g		some other things will land in here after while.		change-id: i1000245464fca3e0e98184f790fe01e7d6e98525	|rename 'bastion' module to 'bastionhost'		change-id: i12cb355b40c75c715745cef3122ad253f4c70b19	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/snapshot/manifests/dumps/wikiconf.pp,dumps: fix up all references to directory with config files		except for misc cron jobs which should not yet be touched, everything	else should use the definition in dumps::dirs and now it does		this being wrong prevented the regular dump cron from starting		change-id: i00386a6401b8bbdd79fe6c65675325e241afba26	|dumps: move dump-related templates to templates/dumps		change-id: i7921ee20bc798f77adea8987d242cde72ea029b3	|dumps: clean up some dir refs in templates to be more readable		change-id: ie246fee9cc43c835832555dcb199adb5e48d5998	|snapshots: restructure directory handling a bit		* move all dumps dirs to /etc out of dumps repo area	* remove the declaration for the dumps repo dir, that now	  will be taken care of elsewhere	* move the actual dirs manifest into the dumps directory	* remove all hardcoded refs to dumps dir and replace	  them with snapshot::dumps::dirs::dumpsdir which means	  a few script files turned into templates and manifests	  setting those up were altered accordingly		* still to move: addschanges and wikiqueries dirs under /srv		change-id: i73b0072a6b50fb92a64c3bd3aa6d4ff427d5051f	|dumps templates, configs, dblists added to snapshot module		these were formerly unpuppetized, though sample templates	live in the dumps repo	this is the start of moving things to /srv on snapshot hosts	change-id: i1c8f2f61ff2d8986514bc75f80b678c4f4e4697a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mirrors/manifests/init.pp,mirrors: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: iebf6b43f559cf93d15b8afcbae70c3e6dc6bf6d3	|mirrors: move to /srv/mirrors; new class ::serve		split mirrors into a separate /srv subdir, /srv/mirrors and set up an	index page for it		also, create a new subclass mirrors::serve that sets up a separate nginx	virtual host to serve just /srv/mirrors and include it from the	install-server role class (to be moved later).		change-id: i48ff568e52ea1c9c367ac9f41909c6ef20dfb89f	|mirrors: introduce mirrors::debian and use it		introduce a mirrors::debian class that mirrors a debian ftp. this uses	debian's official mirrors scripts, archvsync (aka ftpsync). include the	class from the respective role class and while at it, add monitoring	based on the preexisting ubuntu check_apt_mirror, which now takes a	parameter. note that the mirror pulse for debian is set also every 6	hours but 40' far apart from the ubuntu pulse as to avoid overlap	between the two.		it should be noted that instead of archvsync, debmirror was also	explored. while debmirror was more well-documented and packaged, in the	end it seemed more oriented to "local" mirrors and tried to be too smart	in this regard. there were multiple occurences of this but the tipping	point was when debmirror choked when "experimental" had failing	checksums and ended up not syncing *any* suite.		so, stick with archvsync, which while a bit crude will allow us to	potentially become a (partial) official mirror.		finally, the mirrors module in general could probably use some extra	love as it's not very configurable right now and hardcodes a bunch of	settings. it isn't /too/ bad and should do it for now, though.		change-id: icafeaa3d0c80d5249bcc2027471a56bc8a487395	|install-server::ubuntu-mirror -> mirrors::ubuntu		move install-server::ubuntu-mirror into a class in a separate new	module, mirrors::ubuntu. also move the mirror system user/group from the	install-server role class into the top mirrors class.		the class is module "mirrors", mainly to avoid confusion with	role::mirror which is something else entirely, namely our "mirrors"	service, which is the name e.g. kernel.org has picked for the same	service. while it /could/ still lead to confusion, there's really no	other name to call this; in the long-run, role::mirror should probably	be renamed instead to something more descriptive.		change-id: ib3e2b99a119b0cea4f5a14a8846bf2df92ffc261	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/apache/manifests/static_site.pp,introduce apache::static_site		add a custom resource type for apache static sites. automatically sets up	https, hsts, firewall rule, apache config file, and (if needed) ldap auth.		change-id: i8ba8d039a85a970aee0d73e259e62dc4c4f1e7ca	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/manifests/views/hadoop.pp,delete misc::monitoring::view::analytics::data		change-id: i9f1c1970a2e831a3d38330696f07363c7b91034f	|remove misc/monitoring.pp, remove import 'misc/*.pp'		remove misc/monitoring.pp, rename and move all the classes	to ganglia::views in the ganglia module.		this also removes the entire import 'misc/*.pp' from site.pp	because this was the last file in there. there is even	an error if i don't also remove that at the same time.		http://puppet-compiler.wmflabs.org/3244/uranium.wikimedia.org/		change-id: ie62b3041a6eae5aa06f7f172d80d223b10194cce	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/wikimetrics/production.pp,wikimetrics: rename prod role, move to module/role		- rename production role to ::production just like	  the description right below says, for consistent	  structure, like wikimetrics::staging	- mode to module/role into autoload layout		change-id: i3c0546bcba23b81ca636ca75efe2192ed15db0b0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/bastionhost/twofa.pp,2fa: fix file name		since we renamed the class, let's also rename the containing file		change-id: id78ac17d7e0f37f62959d94d11cb11c0939a0d43	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/celery/manifests/worker.pp,celery: because puppet is possessive of parameters named loglevel		lolpuppet.		change-id: i80c0ba4139c1ee4edbf054f700de3ce4f6099207	|celery: allow customizing loglevels		change-id: ica4f3b2241fd72fab2ccf3f36976586bd808a8a6	|celery: specify template_name for systemd unit explicitly		change-id: i8c42c7a446f5f807af560ddd780c113160713067	|celery: make celery::worker a define rather than a class		change-id: i13b188cad343babcfa63b4f7da00cb20a44a6924	|ores: worker role to do celery processing		change-id: ia8dd63709cb8aaf097881bc7f825683cf1b51ae4	|celery: create simple module for celery workers		only supports debian atm		change-id: i96133b0f61ff30e3d8e5a10bc773d4e82152db8a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/ores/redisproxy.pp,ores: move redisproxy into the labs role module		ores::redisproxy is environment specific and hence there is no reason	for it to be present in the ores module. move it to the labs role		change-id: i83af8f8dd151eb9a3d3b05082ebce1b375c363cf	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dataset/manifests/cron/kiwix.pp,use full paths and explicitly invoke bash for kiwix rsync cron script		change-id: i3898b722517fa84a3bf2271448dc21fda606b5a8	|fix up rsync of kiwix openzim files to dataset host		don't start a new rsync if a previous one is still running	run once every two hours, that's plenty	don't use verbose option to rsync and then redirect all output to /dev/null	send email to dumps-ops on failure (so all dataset/dumps-related mail	  goes to the same alias)		change-id: idef8df19c6435e8545bb6cd9b73a4429169d7304	|dataset: remove system::role from the dataset module		add system::role to the dataset roles and remove it from classes of the	dataset module. they don't belong there and under no definition of a	role is a cronjob a role.		change-id: ibb7027f280b8c6253691e8ed581af569cd143fb1	|datasets: rsync from kiwix once an hour instead of every 15 minutes		change-id: ib8cf621e7d8d0a6c7ead9afb6cce326d2276b79d	|datasets: bw limit the kiwix rsync		change-id: ib16898112d191c386a3d3beb39b695b47929208a	|datasets: pick up the newer kiwix wikipedia files		change-id: if5995178a95d291e80605de49591d79736dbe5e0	|remove role::mirror classes		role:mirror::media can be removed:	< apergos> at this point role/mirror.pp can go, actually	< apergos> we don't serve media via rsync to anyone	< apergos> so just pull it from any host that claims to have it		role::mirror::common was included from a bunch of the dataset module's	classes. it was simple enough and has now been renamed to	dataset::common, under the dataset module.		change-id: i9a45120bfdfae949f72e6f60cec132de137417e9	|revert recent generic::systemuser conversions		this isn't prettier, or more abstract. it's just uglier in syntax,	includes far too much magic that is also wrong. it's also conceptually	wrong as it adds a membership to a virtual supplementary group of	"systemusers" that won't and can't include all system users.		the right way to go here is to keep using system => true to mark system	users, that would in turn use adduser & adduser.conf's fist_system_uid &	last_system_uid to designate whether a user is system or not.		this reverts the conversions for the following users:	icinga, mirror, gitblit, ipython, librenms, limn, ocg, tcpircbot.		this reverts commits:	  - 13932dcfe3e092dc23c63f0df643c0408d46f351	  - dcf55c490c5c2990c807e3d692bba872981b8952	  - b66eb8c7a54d0e55899149d04435eec448d11865	  - 76fdd4a29d892089c8da9f41b0c2247abfa1fd35	  - b6f8462bb68a248b20b031ffcbc227688e707804	  - 98e6ab557e7b113e1724572910ce0a9cb7eaf14d	  - 9c5fc3843246f894a5919164ae10c429c983db4f	  - 3ba59bc5dc341e1a5e51c6a62c8cfbcb4146d53b	  - 3df220dbe688896723b3975131a7427d8c9860c7	  - 80d3f1fcb9be8a4087652b5200c8dc8c66a1db1b		change-id: i8445bf3a8fb1a47385aa36d226fe5291c2cacc1e	|kiwix use generic::systemuser		change-id: if70502796a8d54912a3647e841be779844256ca6	|pull rsync and cron jobs out of 'download' into new dataset module		rsync from/to dataset hosts and cron jobs doing copies may	move among servers, so this breaks up the rsync config into	small pieces that can be assembled as needed for a given	server; the dataset class will expect to be told explicitly	which cron/rsync jobs should be running.		additionally this code should be much more 'module-like'.		change-id: idbe3edadf95c049b0c8cc8a89cb33fdfce84316a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/eventlogging/manifests/monitoring/jobs.pp,don't alert on stopped eventlogging jobs on analytics1010		change-id: i0d325800554eb23bcc18d1d4e6300eff46200f4d	|refactor eventlogging monitoring classes		this makes it easier to apply monitoring on nodes where it makes sense		change-id: i1b18c8645d40850b8864e2db71cdb65140961e3a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/maps/postgresql_common.pp,move everything postgres-related out of role::maps::server		this decouples database from kartotherian and allows provisioning	them seaprately. i need this for testing in labs but this could	also be useful in prod.		change-id: i4bce77574b3492c3e3487efc6a304ceae6707a0f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/manifests/director/pool.pp,backups: support next pool directive		the next pool directive is used to indicate the destination of migration	and copy jobs. we did not have support for that, add it		change-id: i0f7898e4d655b3dd8def3ed5c9d1547a858910ce	|fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/manifests/role/wdq_mm.pp,wdq_mm: kill 'labs' part in lb role		change-id: i0fbfbd567eb57926f5d7993a4c1c722ed4453fec	|wdq: rename role to fit with autolayout		also mark it clearly as labs only		change-id: i236f8e7a854529c60c2a3928ded54e7971fa6660	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/ruby.pp,mysql: make lint ignore classes inhering from params		instead of globally turning this off in puppet-lint.rc,	mark the few actual occurences as fixmes and let lint ignore	them in those specific places only.		change-id: i5deef55101c5105007521ff366182af955baf29b	|initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/analytics_cluster/hadoop/logstash.pp,remove symlinks made for $cdh::hadoop::gelf_logging_enabled when it is disabled		change-id: i15763950afdfd60f1ad6be6d04b9c96a9430bbbd	|remove {templates,files}/hadoop files		these are now in analytics_cluster role		change-id: i58395a476fc88e2541d74a619eaae9151b671496	|use proper path for grep in analytics_cluster/hadoop/logstash.pp		change-id: i198e913d201ce7c98648a2e3222b3bb76e369561	|fix hadoop_namenode_opts param, move hadoop logstash logging configs into separate class		change-id: i11aba4281a5fcfdbd532d84defe1985026549fb9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nrpe/manifests/init.pp,nrpe: remove redundant ferm::rule		we have a redundant ferm::rule for nrpe connections from monitoring	hosts. the rule is redundant cause all monitoring hosts get full access	anyway by being whitelisted in a allow all rule. so, remove the	redundant nrpe specific rule		change-id: i013d8a6070b30c4506914cb4409208d1b4f3737b	|nrpe: lint fixes		fixes more puppet-lint warnings	for t93645		change-id: id91be1f9f657bd763c5b23e56129c4c4b3adad33	|hieraize nrpe		move allowed_hosts to hiera and cleanup the class and the template	correspondingly		change-id: i45904f70bac59b5b9ecd14193a456169e9346434	|nrpe: do not install nagios-plugins-extra		nagios-plugins-extra is an ubuntuism; it's a custom patch on top of the	nagios-plugins debian package that creates it. moreover, it seems to	only contain two(!?) plugins: check_fping & check_game, neither of which	we use. drop the superfluous dependency.		change-id: i69cdaa3508ddd43fd64c4ae6c8906609a9d91829	|updating nrpe allowed hosts to new icinga instance (pmtpa to eqiad migration)		change-id: i21f45c4adb325d5ed518e92e8c3cae9e68543dee	|fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|updated ip address of icinga for labs.		change-id: ida5f935ed0f6e652166b8500fd9dfcaad46264cd	|nrpe: two space to 4 space		change-id: ifc1bf4ace8bae62e451889f0e966f60cf9f3ab76	|remove redundant drop rules.		now that drop is the default policy in ferm, no need for extra drop	rules		change-id: i7fccf98db4d5c1491a85c2f867460387da669a71	|revert "nrpe: iptables accept neon public ip address"		not needed since https://gerrit.wikimedia.org/r/96511		this reverts commit ffb390f1b8bdd4187d28d57b79cb794e12a052ac.		change-id: i48ec1822b5b0824b8bdb98496859ae2502630abb	|nrpe: iptables accept neon public ip address		whenever monitoring a public host (such as gallium), the icinga public	ip address will be used (neon.wikimedia.org). tweak the iptables rule to	accept that source address as well.		change-id: i5d6c751ab7a1047e916b3a01097249c7f90724db	|add ferm rule to only allow nrpe/5666 from intern		rt #6342		ps2: i had it in role/gitblit	ps3: decided it should be in nrpe itself,	     then you can include nrpe in the gitblit role		change-id: i84658abc260664df4be29a72749518d780329855	|nrpe: /usr/lib/nagios/plugins/check_dpkg should be absent everywhere.		removed puppet absent command for the file.		change-id: i79c584ccd7e0ee12e0aa6feec2a1db0645fbb9f3	|nrpe plugin files need to be executable		change-id: icc9bd48180ee05d3a9010be90f07b454f2d2af10	|require nrpe package before collecting		there was a race condition where collection of virtual resources defined	by nrpe::check and collected by nrpe class could happen before the	directory /etc/nagios/nrpe.d/ would be created. this directory is	created by package nagios-nrpe-server so we depend the collection on	this package.		change-id: i1c1d276b4bffb8cea787c5c6c403c0b6152e0216	|refactoring nrpe module (round 2/??)		/usr/local/lib/nagios/plugins directory for plugins shipped by module	merge nrpe::packages and nrpe::service classes in nrpe class	nrpe class now accepts an allowed_hosts argument. it defaults to undef.	cleaned-up service['nagios-nrpe-server']	 hasrestart defaults to true in puppet 2.7	 hasstatus defaults to true in puppet 2.7 so pattern is not needed	 restart not needed (init script works fine)	updated rspec examples	updated puppet tests	removed spec fixtures that caused a problem with puppet doc(cyclic deps)	added rake code to create and purge above fixtures before each run	updated nrpe_local.cfg.erb	nrpe::check now ships virtual resources which are realized by nrpe class	virtual monitor_service resources tagged nrpe are no longer realized by	nrpe class (none existed anyway)		change-id: i96bcccae226c0b308ec528a52259d4c1bf764afb	|refactor nrpe to a module		turned the manifests into a module, added/cleaned up documentation, made	puppet-lint happy, moved/created templates and/or files. added unit	tests. also update site.pp/base.pp to not explicitly load nrpe.pp	still needs some love but this will work for starters. rspec tests have	also been added, but fail at this point		change-id: i64a9f1d60cbabeef3a096981d634d7399d39bc45	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/requesttracker/manifests/plugins.pp,turn rt from misc/* into puppet module		move rt from misc/rt-server-apache to module	structure		add role class, move variables into role,	formatting, quoting, misc..		seperate into classes by function:		- packages	- config	- forms	- plugins	- apache		move all the apache related stuff together,	make separate file for installing more plugins,	same for the password reset form which still has issues,		move the files into module and fix "source"s		move the templates into module and fix "content"s		add monitoring		remove 2-spaces,.more..		change-id: ib0e7476a612b25f37905f9f475521606d3bb73d7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/manifests/plugin/python.pp,ganglia: move ganglia::plugins::python to the correct location		change-id: i66b165c594163bfda1d2d425acfedd5ac3078352	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/puppet/common.pp,fix multiple definition of /var/lib/puppet		we introduced a definition of file[/var/lib/puppet] in	https://gerrit.wikimedia.org/r/#/c/268684/.		however, file[/var/lib/puppet] was already defined in puppetmaster::ssl.		this patch introduces a new class called base::puppet::common which is	then included by base::puppet as well as puppetmaster::ssl to fix the	issue.		change-id: ia6f17457bccf33bb7b155c619bfc08f990899f71	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dataset/manifests/cron/rsync/peers.pp,reduce cronspam, eliminate dataset rsync whines about vanished files		followup to e6f42d4b602246b5e225378871cb2eef72ad7706		change-id: i2b6f678e8cc2b9d3f7b5c33b783bbc938892cfa9	|reduce cronspam: filter out dataset rsync error messages about vanishing files		change-id: i9ca02962dede42f5f8428033acd19f196a84b111	|dumps rsync jobs: leave files for cron in place when job is disabled		change-id: i48f944b50291013c632594c1e91270698cee1381	|dumps: remove last reference to outdated rsync bash script		change-id: iff30071108876375a126d0d996ef5b86831dd727	|dataset: fix top-scope var without namespace		./modules/dataset/manifests/nfs.pp	warning: top-scope variable being used without an explicit namespace on line 25		./modules/dataset/manifests/cron/rsync/peers.pp	warning: top-scope variable being used without an explicit namespace on line 12		the second one looks like a mistake, you meant $enabled here, not $absent, right?		change-id: i43b22198c16602a14bcbb553821aff6474b53f2f	|remove role::mirror classes		role:mirror::media can be removed:	< apergos> at this point role/mirror.pp can go, actually	< apergos> we don't serve media via rsync to anyone	< apergos> so just pull it from any host that claims to have it		role::mirror::common was included from a bunch of the dataset module's	classes. it was simple enough and has now been renamed to	dataset::common, under the dataset module.		change-id: i9a45120bfdfae949f72e6f60cec132de137417e9	|datasets: remove obsoleted script rsync-dumps.sh		change-id: i1243527002838c6619b39de3dccb4fee7b5f7bb4	|python cron script needs python		change-id: i99bdef9d69004ac83d83aa4c816b9939ddcc7dc7	|datasets: enable the python rsync script in cron		change-id: ie05c4ff1d2672e56bcdfeb9fb51809435a58fc04	|pull rsync and cron jobs out of 'download' into new dataset module		rsync from/to dataset hosts and cron jobs doing copies may	move among servers, so this breaks up the rsync config into	small pieces that can be assembled as needed for a given	server; the dataset class will expect to be told explicitly	which cron/rsync jobs should be running.		additionally this code should be much more 'module-like'.		change-id: idbe3edadf95c049b0c8cc8a89cb33fdfce84316a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/tests/gitpuppet.pp,modularizing puppetmaster		create modules:		puppetmaster		puppet	moved respective classes in the 2 modules	added tests and made minor changes to make tests pass	make sure $gitdir/operations/{puppet,private} exist before git cloning	into them	amend the changeset for system_role => system::role change in fa42658	retab and linted the files	removed unused dashboard class	removed unused puppetmaster::self class after andrew bogott made sure	it is not used anywhere in labs		change-id: i1f09d6169ca4289272409b8d4a66efe6dde077c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/base/manifests/standard_packages.pp,standard_packages: add moreutils		add moreutils to standard_packages.		moreutils is a collection of useful unix tools including:		- sponge: soak up standard input and write to a file	- ts: timestamp standard input	- vipe: insert a text editor into a pipe		change-id: i71fb339197a7da187b5c3f6f4d032eb0ef990678	|base: add gdisk to standard packages		used for gpt partitioning.		change-id: ib18cd571a9bf658ef856157097c325edfc4cac5f	|don't use package-> latest for apt-transport-https		this makes the binary packages built from src:apt out of sync, since	apt-transport-https is upgraded while the others are not. apt updates	can better be distributed via debdeploy like other security or bugfix	updates.		change-id: if5ef5f57f9c125969e0373d7fe6168a1c9fbf897	|base: apt-listchanges ensure => absent		apt-listchanges is responsible for some really annoying cronspam for	news.debian (e.g. with the recent ca-certificates upgrade) and is not	very useful across our fleet. add it to the ensure => absent list in	base.		change-id: i386a6f994ebfc7b3f839814b6b84383af89f8fe5	|standard_packages: add dstat and ncdu		add dstat and ncdu to standard_packages.		dstat allows to view and compare resource usage (disk, cpu, network and	so on). ncdu is a convenient du interface.		all dependencies should already be installed as far as i can tell:	libncursesw5, libtinfo5, python.		change-id: i408abac2c2501172eb014c38f6bff98aa298018c	|base: add support for https apt repos		this reverts commit ec317848ca61e00ef4f14085aec103252ff07053.		the revert wasn't accurate, since apt-repository.pp is included	only on carbon and nowhere else		change-id: i70b0a41eabd74ad2c0b79cb9a41cd20b2f90656b	|base: rename standard-packages to standard_packages		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		change-id: id36a409917e3738fe6b24ae3edd047db1bacde0f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/tests/rrdcached.pp,ganglia: rename ganglia_new to ganglia		change-id: i1e92bc3e994e9a522c82b3b7c3b5136622d34250	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/gridengine/manifests/collector.pp,fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|tool labs: final(?) fixes to gridengine iii		- add dedicated node queue config	- expand templates at the last minute so that $title is	  correct (and all variables are otherwise available)		change-id: i5bcc9d0cfbf9fc3962decd8a1b885cdde7c21398	|gridengine: proper puppetization, part deux		- fix default config (merge cannot support multiline values)	- group names must start with '@'	- rejigger how configuration is collected in the shared	  config directory	- move resource collection from the toollabs to its	  proper place in gridengine		change-id: id9249c61a0a5569e13e4a8fe1568bf9e79e9b1b9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/labs/bastion.pp,labs: cleanup and move role classes (part #1)		move to autolayout setup		change-id: i8e3489dbb5cf0d87fc6213c9303fde8cd180fd2d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/tor/manifests/init.pp,tor: add support for multiple instances		debian packages for tor newer than 0.2.7.4-rc-1 support running multiple	instances of tor on the same server, using systemd. add support for this	feature to the tor module.		change-id: idfed5613c924a37bb543f2c61c3299174e528a2d	|tor: drop default parameter values		be more dry and drop the default parameter values for the module, since	a) these are not the package's defaults, b) we were defining them in our	single call-site.		change-id: ib9053fafb538026575b090bcef465c7a26a7a249	|tor: drop tor_ prefix from all class variables		change-id: i6cd476598e0b39ae6365809e8ca1f175aa0f1cbf	|tor: pass hashed_control_password as a class variable		do not lookup from passwords directly from the tor module, but pass it	down from the role class instead.		change-id: i8916d697271c26fdf8720302f1f914f323cf1153	|tor: drop motd::script from the module		it's inaccurate, not that helpful and will be even more obsolete in the	future.		change-id: if58bf9655e929b9c07963207740ebaf72b43b23a	|tor: move the ferm rules into the role		change-id: ia2e26dea3a13e32cf3ae500c9c42fd865b916e99	|icinga ircbot, tor: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i45617cabc9afa3277ccb2d5d8204e97c55f06864	|fix indentation in various files		change-id: ib442c919c46f5ec0176de46e10f0d51a2aa94afe	|tor: remove redundant firewall rule		"srange => $::internal" is wrong, since there is no global (puppet)	variable $::internal (the author meant '$internal', for the ferm	variable). this means that te default value of $srange is used, which is	"undef", so this rule basically whitelists all 0/0.		fortunately, that's not as bad as it sounds: the controlport only binds	to localhost, so there's no way to access the port remotely right now.	since we don't really need this, remove the rule altogether.		change-id: idb6aaaed07db11fa3d915ad1b448dc667f5edd05	|tor - motd script needs shebang line		scripts in /etc/update-motd.d/ need to be executable	scripts and have a shebang line or run-parts executed	in the motd module will not execute and add it.		failed to exec .. "exec format error"		change-id: i5ba44e5514fb253b769ecf53064ea76a476e7cdc	|tor - fix syntax error in motd script		change-id: idd5a0e5dfd5654a0a406908ebc0be187764958a6	|tor - add custom motd message about arm		use ori's motd module to add a custom motd	message (i think it's the first time it's being used	outside of vagrant)		to add info that there is the 'arm' tool and how to	run it		change-id: i666acd9ed4398534686386dc6e5ce91f80ccdd60	|tor - not using /srv, it's /var/lib		not using this in config - see idc7f6bfeba48a6	so puppet also should not create an unused dir		change-id: i72344f990ee568bccda8784b67817475b31a7ee3	|tor - ensure /srv/tor exists/owned by debian-tor		this is the configured data directory,	make sure it exists. the debian-tor user is added	by the distro package		change-id: ib18f0e68be0674be3d05e6d8467e45582302ec6f	|tor-relay - add firewalling		as requested in #7971, let this	have strict ferm rules before using it	on radium		base::firewall added to radium in separate change		change-id: ie800d4ef97563dc4bdeefc2d58c5562ae3e3ae2b	rt: 7971	|add puppet module for a tor relay		rt: 7667		change-id: ifcc6070f6ad62e5dbc03a09e4e6df6e0ae973532	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/tests/ruby.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/swift/manifests/storage/monitoring.pp,rename swift_new to swift		can be reproduced with:	  git mv modules/swift{_new,}	  git mv hieradata/common/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}.yaml	  git mv hieradata/codfw/swift{_new,}	  git mv hieradata/codfw/swift{_new,}.yaml	  git mv hieradata/esams/swift{_new,}	  git mv hieradata/esams/swift{_new,}.yaml	  git grep -l swift_new | xargs sed -i 's/swift_new/swift/g'		change-id: i22102da8b14a31719927355ff3efbe19717fcfae	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/swift/manifests/label_filesystem.pp,rename swift_new to swift		can be reproduced with:	  git mv modules/swift{_new,}	  git mv hieradata/common/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}.yaml	  git mv hieradata/codfw/swift{_new,}	  git mv hieradata/codfw/swift{_new,}.yaml	  git mv hieradata/esams/swift{_new,}	  git mv hieradata/esams/swift{_new,}.yaml	  git grep -l swift_new | xargs sed -i 's/swift_new/swift/g'		change-id: i22102da8b14a31719927355ff3efbe19717fcfae	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/conftool/manifests/credentials.pp,scap: add conftool class		for a wide variety of hosts, scap will need to be able to	programmatically pool/depool hosts when deploying a change; it will be	enough to include the scap::conftool class in your project in order to	have that work.		change-id: i8b874b7b758f2dda123449532fd9451fbcfc1a47	|role::mediawiki::webserver: add conftool scripts		this will allow pooling/depooling from the appservers themselves.		change-id: id7e0d130a5b39d986239eeadc6a5a3945f178ea3	|conftool: add support for acls, helper scripts		* if conftool::password is defined via hiera/private, install the	  corresponding etc user and role from the conftool master	* add conftool::credentials that allows to install an etcdrc file for a	  specific user with conftool's own credentials, for read/write access	* add some helper scripts that can be used e.g. from scap to	  pool/depool/drain servers.		change-id: i08f3f6ce581c764e327f55c5cd41c1685aabdd90	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ceilometer/compute.pp,ceilometer: move roles to modules/role/		split the file into one file per class and move	it into proper autoload layout in the role module.		change-id: i3f985795d4e63268823e684f7821e68b2c2c9884	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/salt/manifests/reactors.pp,salt: lint cleanup		change-id: i71dc0694f0d14b7064b8e880529d6c26f3c9f31c	|simplify salt module		change-id: i228b3294022efa391f0f79353ac1db8a2f8f35f4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/tests/init.pp,introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/osm/manifests/shapefile_import.pp,osm, rsync: lint fixes		unquoted file modes, indentation of => is not properly aligned,..		fixes more puppet-lint warnings	for t93645		change-id: if365c93cd0da1d558f332f3480c340a200319a01	|import coastlines and land polygons into osm db		* using a manually and previously downloaded wgs84 coastline file from	http://openstreetmapdata.com/data/coastlines we populate a coastlines	table in osm dbs	* using a manually and previously downloaded wgs84 land polygon file from	http://openstreetmapdata.com/data/coastlines we populate a land_polygons	table in osm dbs	* while at it, fix sysctl::parameter priority	* rename osm::populatedb to osm::planet_import and move the shapefile	import functions to osm::shapefile_import	* update docs and rspec tests		change-id: i457b92a8a9339a80874db3e7e13fc364fd8b0822	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/packages/math.pp,separate math and tex packages classes		we need to deploy texvc on silver to allow the math extension	to work on wikitech.		as we need to cherry-pick among packages included in the	mediawiki::packages class, this change moves the tex and	math packages into separate classes.		change-id: ib5deed6dece2a78f8004f1ff6a2d3d371aa164a6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/syslog/centralserver.pp,syslog: limit source range to $production_networks		change-id: i00aa695d40e341a9f65490c06639ae54d08426b3	|syslog: move role class to autoloader layout		moves syslog::centralserver to module/role		no-op on lithium:		http://puppet-compiler.wmflabs.org/2926/		change-id: ibdff558784257506d51a69337c06b19b0422fab1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ganglia/tests/view.pp,ganglia: rename ganglia_new to ganglia		change-id: i1e92bc3e994e9a522c82b3b7c3b5136622d34250	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/datadirs.pp,mysql_wmf - autoload layout and lint fixes		move classes into autoload layout	fix lint warnings		change-id: ie7510e8c90e365f43ce621c3f524aa1e87e2c584	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/yubiauth/manifests/yhsm_aead_sync.pp,configure an rsync server which is used to synchronise the aead key files between the auth servers		after creation on the key generation site (laptop at oit), they are synchronised to the server	specified in hiera via yubiauth_server_primary. all other yubico authentication servers synchronise	from that host.		this class configures an rsync server which makes the aead spool accessible.		change-id: i3b971d09c1edc7bcf88de71be752017fdaed192f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nagios_common/manifests/check_command.pp,nagios: move check_command/config to own file		change-id: if4a86c988f35792175cb1e76262ff76604b70021	|icinga: check its own configuration		at the moment, whenever one puppet change breaks the icinga config we	get exactly one puppet failure from neon, which then recovers (as the	icinga config will be reloaded just once), but it seems we can't notice	it promptly. the net effect is that the icinga config is often broken	and it requires me and others to fix it a posteriori when we're doing	another change.		introducting an icinga check on its own configuration should allow us to	notice the problem more explicitly, and persistently.		change-id: i166e1113478e64f9763702f9b391e78027edcafe	|fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|nagios_common: allow content to be set for command config		change-id: iade54a5c938091e9abb1d65bdf1435b64305986b	|icinga: make all config files belong to icinga:icinga		no reason they should all belong to root.		also remove the exec{} that munged permissions. add explicit	modes where required.		left as root ownership is:	- executable files	- files that specifically have a mode set that would not allow	  any access to non-root		change-id: i6d95a9b45e868d13b07dd5be42007b263c8f2cf3	|nagios_common: fix stupid copy paste error		change-id: i31640565705f1712ff21837a11b519269877cfd9	|nagios_common: move users check into module		also setup a define for commands that don't have an associated	executable script		change-id: i2cac9ff3d3bea938a17bcb16e5a3a0121e04c76b	|nagios_common: refactor custom command definitions		- setup a check_command define	- separate commands config into one file per set of commands	- move command config into a folder /etc/icinga/commands	- move check_graphite to use the new system	- setup a class that'll house all check_commands	- setup custom checks in shinken as well		todo:		- need to find a way to specify a template as well. see	  ps6 of this change for issues with that		change-id: i3c3bc48bf8730cd262ec32785ee6a7360f7e24aa	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/backup/host.pp,backup: move roles to modules/role/		change-id: i39e8d35f8a19b6aa23ec681cc5efcb63e91292eb	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/package_builder/tests/environments.pp,improve package_builder tests		unit tests where missing for package_builder classes and definitions so	add them. also refactor a bit the use of basepath variable while at it		change-id: i51d2ba029cd0365b5dd24ca4dbc56a1d0924b809	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/pybal/manifests/web/service.pp,pybal::web: only generate existing pools		change-id: i5dd74c16082d84a7e113ce7688dfad04c4261f6e	|pybal: fix dependencies		change-id: id66b443981a51d3dce2a3851f2e6edb9626dafa1	|pybal: refactor pybal::pool, print pools in pybal::web		since we're moving away from out traditional schema where the pybal	pools are directly operated on via raw files, we still want to present	what's pooled and what's not pooled via an http request. so we:	- factor out the confd file generation from pybal::pool	- create the resources for all pools on hosts with the pybal::web	definition	- avoid monitoring all of those on palladium, as that's not really critical.		change-id: i30dd4ae6a0bce64c02c809e214fd868a897a97e7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ldap/manifests/role/config.pp,remove a couple of unused settings from ldap config		change-id: i72b374f8fb9c47f31b442dd435a9040db44e0798	|create the labsldapconfig hiera struct		so far this only contains server names and passwords.  this should	be a no-op in 'real' labs and fix some things in labtest.		change-id: i5034c9c93966a3926c2212c62f5aaee42add63cf	|ldap: fix top-scope var without namespace		./modules/ldap/manifests/role/config.pp	warning: top-scope variable being used without an explicit namespace on line 5	warning: top-scope variable being used without an explicit namespace on line 10	warning: top-scope variable being used without an explicit namespace on line 11	./modules/ldap/manifests/role/client.pp	warning: top-scope variable being used without an explicit namespace on line 28		change-id: i8fbb141a27ab0873d6cfcf87f6fb93436e016d71	|move labs instances to the new ldap servers.		change-id: ia24f548da3ddf28ba669512a3560cad0dc7192ff	|add labtest realm for ldap/manifests/role/config.pp		change-id: ib67e1f9e1c34813e7ca32df0f0118b368a1dbf66	|use the labsproject fact rather than $::instanceproject from ldap		change-id: if339c2534516efb8c556b186063153ff67d4b26a	|ldap: kill ldap::role::config::production/corp roles		unreferenced, plus could not have been possibly working for many months	now (the ca config is wrong).		change-id: i5abcc3c5c79ba8c28334e00d1919cef612927a71	|ldap: point tls_cacertfile to ca-certificates.crt		and not a specific ca, that happens to not exist anymore.		change-id: ia7d0c047e7a542e2c8a9934e580505e79ff999b4	|decom nfs1		remove nfs1 from:	- dsh groups	- site.pp	- dhcp	- base module / rsyslog	- ldap config (!??) <-- what is replacing it?		please somebody especially look at the ldap config	part, the todo and what replaces this here?		# todo: kill this role at some point	class ldap::role::config::production		does this really mean eqiad uses pmtpa?		'eqiad' => [ 'nfs1.pmtpa.wmnet' ],		rt: 7295	change-id: i6989717f02afebffa6e01abf594eda3d0aaf0b34	|replace sanger,sfo-aaa1 with ldap1/ldap2.corp		use new server names for corp ldap		sanger should be replaced		rt: 6163		change-id: id33b4c5d1a9a9003542882ac02753d48cb887eb1	|update labs instances to use the new ldap-eqiad server		change-id: i0a68dd9c69179e51cdfeded7b9336f6ee378a5af	|set up ldap servers for codfw		change-id: iec60d787aaa4b1004b5c472e8c7f520034d5b632	|don't rely on labcontrol2001 quite yet.		change-id: i6c7be1f55236085f00ef692cc31d9a2750984253	|turn on dns and ldap on labcontrol2001.		remove virt0 from dns and ldap replication.		change-id: i6c7787eb495160c3e266198fae86e6cfd2c22418	|remove nfs2 from ldap and base config		decom per		rt #7341		change-id: i650d5dc2fe35d0742cfaeb11cdd1d241fef49e82	|revert "update ldapconfig ca to rapidssl"		rapidssl isn't available by default on the systems.	we can actually construct a chain to equifax, so use that	instead.		this reverts commit 88064277998f8df30f7ef8e0a6a741fe917cfbe2.		change-id: iefb8f62519236d5eb30e4cfc340f0f243f1af39f	|update ldapconfig ca to rapidssl		the new virt0/virt1000 certificates are rapidssl-issued, not equifax.	switch ldap.conf to trust rapidssl instead.		change-id: i5eef4d868e40344125de6a7ca1f095875bdb8ddd	|ldap: remove lookupvar and replace with top scope @ var		change-id: i045ef3a9c5ac808529eb850b3b5280b6de9ab7fa	|ldap : lint cleanup		change-id: iee4873e9bf95fe831ca7d47b5bbabe34e3747f9c	|move ldap into a module		change-id: i3261299a5e2d237eb7f6555ed8b43f2321770e76	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/packages.pp,remove support for ubuntu lucid/10.04		change-id: i49b16d717559c8126e2517bb5131dc0ae88e27bd	|use apt::repository instead of file resources		change-id: ica0bf234c404dd7e32e9ca928da1b4766b966582	|coredb_mysql/mysql_wmf: remove mysql-fb support		we've migrated fully to mariadb now. also, no lucid in any database \o/		there's still some ubuntu-12.04-specific code, but since the two modules	are deprecated in favor of the mariadb module, just add an "else fail()"	and be done with it.		change-id: i8b218226cb00c51b1a0708f32d4823683ae3bfad	|pc1001 upgrade to mariadb		add wikimedia-mariadb.list to mysql_wmf on 12.04	use the same known-to-work package setup as coredb		change-id: id7256153333ff2d80aa7d6b93a774555518c5f4a	|move mysql_wmf into a module.		the manifest changes here are pretty brainless -- i split the major	classes into separate files and rearranged the file and template	includes to reflect the new position of the source files.		i also moved quite a few files that were filed under ganglia	or icinga but only used by these classes -- now they live in the	mysql_wmf module instead.		change-id: i31b8d8562f8eda4a6fde4a6110d83a339fc38b94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/package_builder/manifests/pbuilder_hook.pp,revert "package::builder: experimental=yes support"		this reverts commit 11c7b20efe650333ff3468e7cea305b40099d81a.		change-id: i4d1b826908d2c3e5360bea4d088503c04ca60860	|package::builder: experimental=yes support		change-id: i8587ff03330ac27620b07a4a3adafba994b6d833	|introduce $upstream_mirror parameter		we've always separated mirrors of upstream repos (debian/ubuntu) from	our own local repositories. most hooks need our own repos, but in	some cases we need to refer to upstream.		change-id: i0013ce52664e7f6723855b45157bdd2e5b23494d	|add backports=yes hook to include $dist-backports apt source		change-id: i3bae4d811678036930cecc0330e581081ac0cb03	|package_builder: add option to use built packages during build		example:	sid's tesseract-ocr requires a newer version of libleptonic-dev	than trusty bundles. no problem -- we can build a newer version,	but this version will not be used in the build of tesseract-ocr!		this patch provides an environment option to allow using the	built packages as dependencies during build.		change-id: i073e0b5c152d53f6d541f3801a643364faed5fda	|jenkins,package_builder,labs_bootstrapvz: lint		fixes more puppet-lint warnings	for t93645		change-id: ib0c848f169356b59f25f3b9e0afc344799a38b78	|package_builder: fix dependency order for hooks		on labs the d01.apt.wikimedia.org was never released because the	parent directory creation depended on the file being created!		per doc at:	https://docs.puppetlabs.com/puppet/latest/reference/lang_relationships.html#chaining-arrows		-> (ordering arrow)	    causes the resource on the left to be applied before the resource on	    the right. written with a hyphen and a greater-than sign.		flip the dependencies to have the directory created before the file.		change-id: iaf195dbfd4f657e3743505fa2eb80d778f4b33a6|package builder module		a module used to create a debian package builder environment base on	cowbuilder. intended to be used in labs for streamlined debian package	building. creates 4 environments to build packages in:	 * precise	 * trusty	 * jessie	 * sid		respective hooks for the environments are being installed as well and a	mechanism to easily change between environment via an environment	variable is provided. tests included, as well as a readme		change-id: ic8452ee447dcf485f6af822627cc117b3931b795	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/tests/mysql_user.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/maven/manifests/init.pp,set proper source file path for maven settings.xml		change-id: i6caea8f4694e35c351bd55646f028c3025091704	|move maven init.pp into proper directory		change-id: i93a5517c0f33e58a7e6b6ee29d583cacaf904b24	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/server/mysqltuner.pp,mysql: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i712bb124c16d625cc639fca30a683dc11583b77c	|initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/labstore/manifests/monitoring/nfsd.pp,labstore cleanup and role vs module arrange		this more accurately reflects the module and role	schemes used for other config.  we are also staging	to have primary/second/misc nfs setups so rename as	primary and misc to that effect.		change-id: id66499d22a7f40df8174fdfab8a89e10899beb7c	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/logstash/manifests/input/irc.pp,labs: new role::logstash::stashbot class		add a new role and configuration for use in the stashbot labs project to	create instances for logging irc messages.		the irc filters have special handling for messages with certain prefixes:	* !log for server admin log (sal) logging	* !bash for quips logging		* remove role::logstash::ircbot which was previously only used in the	  beta cluster.	* refactor role::logstash to include role::logstash::elasticsearch	  rather than duplicating its configuration.	* update role::logstash::elasticsearch to only apply	  ::elasticsearch::ganglia when $::standard::has_ganglia is true. this	  mirrors usage in role::elasticsearch.	* refactor role::kibana to allow fine grained configuration via hiera.		change-id: ia04219138f3dab667d7c2a667994681aeeabc563	|logstash: add support for logging irc !log messages		add logstash::input::irc and filter configuration for storing !log	messages seen in subscribed irc channels. also add role::logstash::beta	which can be applied in labs to enable logstash::input::irc.		change-id: i409fec919bce3d1340c44212f58f89104f2ff203	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/microsites/releases.pp,releases: delete unused role::releases::upload		this class has been renamed and moved to	role::microsites::releases::upload in ie8dcd8ff0d8cf75,	i74c16340c44318876 but was not removed here as it should have been.		change-id: icbf42299bb01c3863e3b9f108b42f349a5d6369d	|move microsite roles into a common place		move roles that setup microsites into one a common place.		this makes it easier to find similar roles in one place,	and it also moves more roles into proper autoloader layout.		also move the peopleweb::migration class into a separate file.		change-id: i74c16340c44318876db701ff37f84f780a40c5d3	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/rsync/tests/server_with_motd.pp,manually adding modules/rsync for managing rsyncd modules.		puppetlabs-rsync:  https://github.com/puppetlabs/puppetlabs-rsync		see also abandoned change where i attempted to add these as git submodules:	https://gerrit.wikimedia.org/r/#/c/21744/		change-id: i2c811843b414fcbdbea4224157847135402af590	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/tor/manifests/instance.pp,tor: add support for multiple instances		debian packages for tor newer than 0.2.7.4-rc-1 support running multiple	instances of tor on the same server, using systemd. add support for this	feature to the tor module.		change-id: idfed5613c924a37bb543f2c61c3299174e528a2d	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nrpe/manifests/monitor_service.pp,nrpe: convert contact_groups to hiera		change-id: i50bf1cb67de05972ea177bba4815076bba54570f	|root out a long chain of quoted bools in nagios/icinga/nrpe		bug: t113783	change-id: i16cee528ddf05f90b2cc7c9f474fe8a4db914582	|nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|adding critical parameter to nrpe::monitor_service		this turned out to be needed. add the parameter, documentation as well	as tests. also update tests while at it		change-id: i48df9d344223390ac9156e33eddfe67e9568f336	|nrpe: let us specify timeout of check_nrpe		nrpe::monitor_service() define now let us pass a timeout parameter which	ends up being passed to the check_nrep utility as -t.  that raise the	default 10 seconds timeout which is useful for test we know to take a	bit longer than that.		the icinga command nrpe_check now require a second argument (the	timeout). it is only invoked from the nrpe::monitor_service define so i	guess it is not going to break anything.		one can later on raise the timeout of a check by doing something like:		 nrpe::monitor_service( 'check_job_queue': timeout => 30 )		change-id: id031c71ac18ba1bc19f04832edad655694406095	|refactoring nrpe module (round 2/??)		/usr/local/lib/nagios/plugins directory for plugins shipped by module	merge nrpe::packages and nrpe::service classes in nrpe class	nrpe class now accepts an allowed_hosts argument. it defaults to undef.	cleaned-up service['nagios-nrpe-server']	 hasrestart defaults to true in puppet 2.7	 hasstatus defaults to true in puppet 2.7 so pattern is not needed	 restart not needed (init script works fine)	updated rspec examples	updated puppet tests	removed spec fixtures that caused a problem with puppet doc(cyclic deps)	added rake code to create and purge above fixtures before each run	updated nrpe_local.cfg.erb	nrpe::check now ships virtual resources which are realized by nrpe class	virtual monitor_service resources tagged nrpe are no longer realized by	nrpe class (none existed anyway)		change-id: i96bcccae226c0b308ec528a52259d4c1bf764afb	|refactor nrpe to a module		turned the manifests into a module, added/cleaned up documentation, made	puppet-lint happy, moved/created templates and/or files. added unit	tests. also update site.pp/base.pp to not explicitly load nrpe.pp	still needs some love but this will work for starters. rspec tests have	also been added, but fail at this point		change-id: i64a9f1d60cbabeef3a096981d634d7399d39bc45	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/aptly/server.pp,aptly: move role to modules		rename role::aptly to role::aptly::server to avoid having a lonely	manifest under modules/role/manifests/		update the sole use in role::labs::tools::services		change-id: i67b40a9582239b52d6ee969898c7cbc99753cbfc	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/lvs/manifests/init.pp,lvs: split monitors to respective files		split to respective files. lvs::monitor_service_custom and	monitor_service_https are not used anywhere, so they are removed		change-id: iac0e72bfe67f51b5aca5c8744a72dca43ed67ad8	|lvs: init.pp lint		change-id: if9b0514793c19d8b9a03de153d20ac8934bfe43a	|properly align indentation of =>		change-id: i8dc5216e22dfe3a496383a4953b395d60edce7ea	|nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|monitoring: move monitor_host to monitoring::host		change-id: i362dac76eb4d2d58d91c138a2b708396888ad721	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|lvs: convert to a module		change-id: i07cf6227f3d443df006cb18c2dbf73b9c03ad280	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/squid3/manifests/init.pp,fix indentation in various files		change-id: ib442c919c46f5ec0176de46e10f0d51a2aa94afe	|add a new squid3 module and replace in-grown use		install-server::caching-proxy and url_downloader both install &	configure squid3 and are *very* similar to each other (in fact they seem	derived from one another, then diverged a bit).		abstract away the squid3 bits into a simple squid3 module that accepts a	configuration file or template and use it from the two modules.		the new module doesn't have rspec tests but the callsites do. this	should probably be fixed, by someone more knowledgeable in rspec, like	the author of both of these other two modules *cough*.		change-id: i86377761019fb65106ce56e99d8ba39f1dc4b10b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/coredb_mysql/manifests/purge_slow_digest.pp,use m1-master cname		change-id: i9bfe74f8bd283059dafcac4fd867281fe580f951	|coredb_mysql: lint		no changes to behavior; only presentational changes in this commit.	 - spaces rather than tabs.	 - align arrows.	 - don't align equal sign, except in function signature	 - single quotes when not interpolating.	 - single resource per block.	 - quote strings.	 - quote octal permissions.	 - 'ensure' always first property.	 - use ensure => link w/ target rather than implicit symlinks.	 - every property ends with a comma	 - one class per include.	 - resource name and resource type on same line.	 - [ space ] in arrays	 - '&>/dev/null' instead of '>/dev/null 2>&1'		change-id: i419f48c9713e5c59deac093ac86142d4d938a25c	|script to handle purging of query digest data older than 4 weeks.		change-id: i9cd5f79184df5bdf97246ce1c98b32c33f0926e2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/prometheus/tools.pp,tools: provision /srv volume for prometheus		change-id: ie3ace1d363853761383fc085c7edc57a3654b6d3	|prometheus: restore node exporter prefix requirements		i removed this earlier, and now see why it is required -	so that we can have other target files described as other	jobs! i've restored it and added explicit lines for the	jobs i needed		change-id: iee2c49c5e4ad668f2e7cc3f1ac679dc0c8e973e1	|tools: add ssh checks to prometheus		change-id: ifcb8f93e3f6bcfdc2d6d05d31d31a4b1f6174ca3	|prometheus: use 4sp indent rather than 2sp		change-id: i48da9a257f6d5866d0bd7ce1bf4d103c860042eb	|prometheus: add blackbox exporter role/class		https://wikitech.wikimedia.org/wiki/prometheus/black_box_exporter	explains how to build the deb. deb is currently available only	in the tools project		change-id: i9050ff361ecf4dcc432bab2c0b5cb3627c6bfbff	|tools: scrape etcd metrics too		also allow writing out node definitions based on prefix	matching		change-id: i4b67b6d0e6f3ca58dcf64e851326b57e9a34ab8c	|prometheus: add tools role		change-id: ia5e1c50a64268422b5aabeffdf8ba23ca5f8b247	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/manifests/certmanager.pp,puppetmaster: puppet-lint fixes		change-id: ib2526afffd7270eee0432bce18e12ec396f8ae7b	|puppetmaster: do not manage certmanager's home		it's empty anyway, no reason for the user to have a homedir		change-id: icf9ec60a1b407554d7bc9bd1f624f1d85db59ff2	|we need -y when calling salt-key -d remotely		change-id: iee93599c653e498954b012a560667de98322db2d	|give certmanager a homedir		change-id: iae41e9987912953be3a3b21abb780d092546a7f3	|set up ssh keys so that designate can clear salt and puppet certs.		change-id: i1ecca050b2ce2eb3020f36d2e09bc5cc32f259e0	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/poolcounter/manifests/init.pp,poolcounter: ensure => installed		change-id: id70ce5f27dafa92731f8b762423c30adaf160be9	|poolcounter: convert into a module		move checks to role class	use nrpe::monitor service instead of monitor_service	clear old nrpe definitions	move poolcounter class to a module		change-id: i976edd7743f2139e0bd5a1a7f3d447d4345510d8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_multi_instance/manifests/config.pp,mysql_multi_instance : lint cleanup		change-id: id36f8ad8621124fa9751129a53c77c520ed22214	|really basic module for multiple instance of mysql on a node		needs some more work, monitoring, white space, etc		change-id: idc956372f31906e72a582a377c5ff90ade595248	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/phabricator/manifests/mpm.pp,phabricator: minor nit, move things that aren't templates out of templates		change-id: i32033101af2bd4521fceca4dd22aa66785082e0e	|phab: use apache::conf for mpm_prefork		change-id: i84e2ccaae6658ae38c86417c9fc444fdf92bcf81	|phab: persist current mpm_worker tweaks		ref t109941		we have been segfaulting on worker	exhaustion these settings seem to be	working alright.		change-id: i98da7ad6a01d5da24efa0466ba77dd58314ed974	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/bacula/tests/storage.pp,bacula: lint fixes		change-id: id6584d139ec6f69bb71c2f217fbfea7d9b04bcc6	|introducing bacula module		a bacula module used to handle the basic concepts of bacula (director,	filedaemon, storage daemon etc) and setting up a full backup	architecture. classes are provided for the basic concepts and	definitions for the other ones (pools, filesets, jobs, schedules,	catalog). encryption is achieved using the puppet pki infrastucture	providing secure communication for control paths as well as encrypted	storage. a readme file is provided to display basic usage	the corresponding roles are also included for wmf's configuration. we	also use backups.pp to add the new classes and the old ones will be	deprecated later on		change-id: icb9531053fd6766ea08d3e7eccba04798858edb7	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nagios_common/manifests/timeperiods.pp,fix all 'variable not enclosed by {}'		fix all occurences of variables not enclosed in {}.	(except submodules)		change-id: ie9788d54ab8555eedcaa0d08413ac59676c07bc6	|icinga: make all config files belong to icinga:icinga		no reason they should all belong to root.		also remove the exec{} that munged permissions. add explicit	modes where required.		left as root ownership is:	- executable files	- files that specifically have a mode set that would not allow	  any access to non-root		change-id: i6d95a9b45e868d13b07dd5be42007b263c8f2cf3	|nagios_common: move timeperiods definition into module		change-id: ieeab484c64434b6f14c24deaf90a78f2fcdef051	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/apparmor/manifests/init.pp,fix to the ssl_certs apparmor profile install		a few boxen do not include any package that install	a /etc/apparmor.d/abstractions/ profile, causing the	directory to be missing.  this makes the directory	always exist and ensures installing the ssl_certs	profile notifies the apparmor setting.		change-id: i9c0bac10a7c5e7adf78bfa21396dda55872c864b	|apparmor module and profile for ocg		introducing the apparmor module! whoo!		ocg uses this to sandbox itself away from the rest of the world; so	does mysql but they weren't nice enough to create a module :'(		change-id: ie440d38cd9b792e084b1f3d159a9cbcbe54f3967	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/scap/manifests/ferm.pp,move role::scap::target to scap::ferm, add scap::target define		i don't see any reason for this to be a role class,	especially if it is specifically needed for scap deployment	servers to be able to deploy.		this change adds a scap::target define, which simplifies the process	of adding new scap::targets.		change-id: ia78d44b9b56ea165e9b584f8b30c0395da490f51	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/swift/manifests/stats/stats_account.pp,swift: allow disabling account stats		not all accounts need their stats reported, moreover it would lead to duplicate	stats.		change-id: i79e81581104dfda3d9c8d70717e90f283db26110	|rename swift_new to swift		can be reproduced with:	  git mv modules/swift{_new,}	  git mv hieradata/common/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}	  git mv hieradata/eqiad/swift{_new,}.yaml	  git mv hieradata/codfw/swift{_new,}	  git mv hieradata/codfw/swift{_new,}.yaml	  git mv hieradata/esams/swift{_new,}	  git mv hieradata/esams/swift{_new,}.yaml	  git grep -l swift_new | xargs sed -i 's/swift_new/swift/g'		change-id: i22102da8b14a31719927355ff3efbe19717fcfae	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/interface/manifests/setting.pp,interface: drop support for ubuntu < 10.04		change-id: ifb5f1761c63971f0d6320c3f8631b3857a325de2	|set rx ring params for bnx2x on 10gbe lvs		change-id: ibc5018145bbbdb9289525070e866c69a8efea9c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/gridengine/manifests/admin_host.pp,gridengine: lint fixes		change-id: i67605d493666c952d742d363a617d7720301d027	|tool labs: tweaks to gridengine puppetization		- actually support admin_host	- make collector exit 0 even when no hosts found	  (avoids needless puppet error messages)	- pass $gridmaster to toollabs::shadow	- remove unnecessary declarations of $etcdir		change-id: i07d17534552c1fe9c0d4d4a4b59c5843c0646610	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dnsrecursor/manifests/metalresolver.pp,labs dnsrecursor metaldns: use hiera's labs_tld instead of assuming its value		change-id: ic3558b5535e1e7ae2cda502694b7e2b961577dd2	|labs dnsrecursor: tidy up paths		change-id: if2391b815d726cb4f068a5096ce251825d466f50	|insert dns entries for labs bare-metal systems.		since the powerdns recursor only allows one lua hook file,	this patch also creates a new single-point-of-entry file,	recursorhooks.lua, which selectively imports other	lua scripts as specified in the $lua_hooks param.		change-id: i20453be668236dd86f1ca8a2ada18e997c10d8fc	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/celery/manifests/flower.pp,ores: add flower class /  role		to monitor state of the worker nodes		change-id: i1d61dd93d43f0c5230ba089881ba814bec330ba1	|celery: add celery::flower setup for setting up a flower monitor		change-id: id6df5f1164062dc1b3e3a08b7e1999062d30b960	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/manifests/puppetdb/client.pp,puppetmaster::puppetdb::client: add configs, directories		change-id: id664388852958be6ba6911c7312418f278b01b47	|puppetmaster: fix /etc/puppetdb.conf		newline characters are not evaluated inside single quotes and just	replacing the single quotes with double quotes seems wrong. populate a	file and ship it instead		change-id: i325606df55228a5d39a9bff80e85276526b46228	|puppetmaster::puppetdb::client: fix typo		change-id: i6d1205df4fd28c8eb9409920a692476ad3ca3e12	|puppetmaster: allow using puppetdb as a backend for storeconfigs		also, refactor a few non-dry thing from the frontend and backend roles.		change-id: i47fae084d1536372c1f9dc50b689c131d590c9ba	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mediawiki/manifests/php_enmod.pp,mediawiki: install extension config files in the correct path		on trusty/jessie, install the config files in the	'/etc/php5/mods-available/conf.d' directory; also activate	them. finally, do not install apc.ini on newer php version as it's	unstable/unsupported.		change-id: ib5734bb834b63145337d1ef3adce2975b201dd4e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/zuul/merger.pp,zuul::merger: allow contint1001		the new jenkins host will need access to the zuul-mergers git daemon	process to be able to build / publish documentation.		bug: t137323	change-id: i1d75b988e1c9d0f36115456a435a0f8bc55f770b	|zuul::merger: convert to ferm service and restrict to labs + gallium		we're getting rid of $internal, since it's needlessly broad. limit	access to the git daemon to gallium and labs networks (where the slaves	are running).		change-id: id183ed439676dff4ca071632a62a23b067df9c8a	|contint: remove zuul-merger from gallium		to ease the transition of ci services from gallium to contint1001 remove	the zuul-merger instance on gallium. one less service to migrate and we	have another instance on scandium.eqiad.wmnet		the zuul scheduler connects to gearman over the public ip, the ferm rule	comes from the zuul-merger though so:		* change the gearman_server setting so it can vary between server and	  merger instances	* have zuul scheduler to connect over 127.0.0.1	* ferm by default allow all traffic over 127.0.0.1, drop ::1 and	  127.0.0.1 from list of zuul merger hosts which was solely to open the	  firewall rule.		note: would need some manual changes:		* update /etc/default/zuul-merger and set start_daemon=0 to prevent it	  from running again	* prevent upstart from spawning it on boot		bug: t137418	change-id: i4b19cb348c883aa66e380746806ba5a12ec1fb5a	|contint: rename git-daemon to git_daemon		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		change-id: i581c832444c4b1f3bfe1bc28148ac5facc448ae9	|zuul/merge: fix lint warning		change-id: i5d70428d2fdca6e57454c1c9877e9ad2a9e0a815	|zuul: move roles into role module		move the classes from manifests/role/ to	the role module in the proper autoload layout.		change-id: i3238035ee75b5e14ecae105d73d84ba921b32b26	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/install_server/tests/dhcp_server.pp,installserver: rename classes with dash characters		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		this is a follow-up to icb2122da0a43b7a1	where the module was already renamed due to this,	but not the classes inside it.		the classes ubuntu-mirror and caching-proxy are removed	from comments because they either moved to module/mirrors	or have been deleted meanwhile. this change doesn't touch them.		change-id: ib91faf62a8c4d2292f2a51e30fbf1c6583f15eaf	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/openldap/labtest.pp,openldap::labtest: restrict to production/labs networks		we're getting rid of all_networks by refactoring the existing ferm services	into more specific networks. the labtest ldap service needs to be accessed	from both labs networks and production networks.		change-id: icad398bbce328c21821ad3ab8a2ef1155113eefa	|create the labsldapconfig hiera struct		so far this only contains server names and passwords.  this should	be a no-op in 'real' labs and fix some things in labtest.		change-id: i5034c9c93966a3926c2212c62f5aaee42add63cf	|move some ldap host/cert name stuff into hiera.		this is in support of using labtestservices2001 as an ldap host.		change-id: idaf7fc072fe422dfaa61e6dd16f00022e63e52a9	|add server_id arg for labtest openldap		change-id: ia0870eb7d454327b8808cbdb454c74f2ef0480a0	|add openldap to labtestservices2001		change-id: if105266c948a4e7edc611cf1de664d52e2bd4a87	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/dataset/manifests/cron/rsync/labs.pp,dataset: remove system::role from the dataset module		add system::role to the dataset roles and remove it from classes of the	dataset module. they don't belong there and under no definition of a	role is a cronjob a role.		change-id: ibb7027f280b8c6253691e8ed581af569cd143fb1	|remove role::mirror classes		role:mirror::media can be removed:	< apergos> at this point role/mirror.pp can go, actually	< apergos> we don't serve media via rsync to anyone	< apergos> so just pull it from any host that claims to have it		role::mirror::common was included from a bunch of the dataset module's	classes. it was simple enough and has now been renamed to	dataset::common, under the dataset module.		change-id: i9a45120bfdfae949f72e6f60cec132de137417e9	|dumps: reenable labs rsync		including properly paranoid mount options (soft)	- added timeout to the magic 1.4s value		change-id: i926c80969e5ef3a156183c8f6e1eab0a73d800d7	|revert "labs: switch dumps to the new server"		this reverts commit 502528c8099382ec5e64531d2203533c77470816.		reverting cause labstore1003 is not yet ready to accept mount requests	and labs machines would end having a mount process stuck at trying to	mount /dumps. puppet tries to ensure that mountpoint mounted and hence	gets stuck as well		conflicts:		modules/dataset/manifests/cron/rsync/labs.pp		change-id: i5c64b7988e153a75bf00fc0ecd5e15ca6862fb59	|datasets... still trying to kill labs cron with fire... grrrrr		change-id: i7c2251fcc6d4b13d8ca460064b81fe5b4a2171be	|datasets: remove labs cron file deps when cron itself is not enabled		change-id: ieec56c95b391385eda4e4e74c1cecf9d2727d75b	|datasets: don't mount labs fs if cron using it is not enabled		change-id: i3f5a874c8d0c51d77227c2595a0233fd22d1d5cb	|labs: switch dumps to the new server		(note: it'll take some time before the dumps are synced again)		change-id: i6bd35456a5fdc98b1ab09436f1d01b470b597ffe	|more tweaks to the labs rsync of public dumps		- create destination directory	- don't attempt to preserve (meaningless) ownership		change-id: i4f8b795ddaefd440dfd09b2a874ab3ce6bf0be7f	|change dumps to labs for eqiad		- rename some script to remove references to gluster	- alter paths and mounts to point at the new eqiad fileserver		change-id: i72a3ecf11f27f7d3bda276da3e03cc997e97b69e	|pull rsync and cron jobs out of 'download' into new dataset module		rsync from/to dataset hosts and cron jobs doing copies may	move among servers, so this breaks up the rsync config into	small pieces that can be assembled as needed for a given	server; the dataset class will expect to be told explicitly	which cron/rsync jobs should be running.		additionally this code should be much more 'module-like'.		change-id: idbe3edadf95c049b0c8cc8a89cb33fdfce84316a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/snapshot/manifests/dumps/stagesconf.pp,provide and use variable names for all dump related directories		instead of hardcoding in partial paths in many manifests and scripts,	provide variables in the manifest which declares the directories	and use those.		also fix a couple badly closed variable references in templates.		change-id: i40a78843f44f3b24a4deb0355dd530c54a7f8b42	|dumps: move dump-related templates to templates/dumps		change-id: i7921ee20bc798f77adea8987d242cde72ea029b3	|snapshots: restructure directory handling a bit		* move all dumps dirs to /etc out of dumps repo area	* remove the declaration for the dumps repo dir, that now	  will be taken care of elsewhere	* move the actual dirs manifest into the dumps directory	* remove all hardcoded refs to dumps dir and replace	  them with snapshot::dumps::dirs::dumpsdir which means	  a few script files turned into templates and manifests	  setting those up were altered accordingly		* still to move: addschanges and wikiqueries dirs under /srv		change-id: i73b0072a6b50fb92a64c3bd3aa6d4ff427d5051f	|dumps: generate conf files for dump stage scheduler		change-id: i8db89b6a1e4d4bc6996246d221b3c6c8ad068753	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/xenon/manifests/init.pp,xenon: add xenon-grep script		`xenon-grep` is a simple cli tool for parsing xenon logs	and printing a leaderboard of the functions which are most	frequently on-cpu.		change-id: i00852f03043c68a4977683f9bc1edf983b3662e1	|xenon: redirect stdout to /dev/null, avoid cronspam		subject: cron <xenon@fluorine> /usr/local/bin/xenon-generate-svgs		generating /srv/xenon/svgs/daily/2015-08-16.api.svgz...	generating /srv/xenon/svgs/daily/2015-08-16.api.reversed.svgz...	[...]		change-id: i7a0f5f9f67d665b10ab4fd4591715de4008481d1	|xenon: stop generating weekly logs; tag files with entry-point		change-id: i5a40257796fee03145f387462764d9752a9a4a88	|don't generate monthly xenon graphs		they don't reveal anything that the weekly graphs don't.		change-id: iad9ca5c1d48577d075d7567c7f7dc453fc66f82c	|xenon: links => follow for file['/srv/xenon']		tim pointed out that the disk mounted on /a/ is much faster. i don't want to	add references to /a/ in our puppet code, so i am going to move /srv/xenon to	/a/xenon and leave a symlink pointing to the new location. i think that this is	the right approach, because it means that when xenon is provisioned anew	anywhere, it would write to /srv/xenon again.		change-id: if5204069f135c50d598a99139e188d9960379c3d	|add 'xenon' module for aggregating ext_xenon-produced traces		provisions a simple python daemon that subscribes to xenon php traces published	on a redis server and writes them to disk, plus a cron job that uses	<https://github.com/brendangregg/flamegraph> to generate flame graphs from the	data.		change-id: i09926c8c26da29baedcf5ab3ef219770690be30a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/rancid/manifests/init.pp,ganeti, rancid: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i904f32459656e0415a9d079e888a39ca66a74d2c	|rancid - adjust file pathes to module structure		the files all need 'modules' in file path,	how do i not notice this, not even in compiler..hrmm :p		change-id: ifa96d973c529e86da2f29f12fc9315e8f2c6c4cf	|rancid - move to module		another one to be moved out of 'misc'	and into module format		change-id: i6f1f40a49ffbfc835952b6274627a5e0d4a2e062	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/logster/manifests/init.pp,adding logster module and using it to monitor cirrussearch-slow.log		this is for rt 7118		change-id: i92e4b9c4fd29f802de38ac127d4dcbc58addddf1	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/netops/manifests/init.pp,move network::checks to netops::monitoring		the term "network" has been overloaded in and outside our puppet tree to	mean different things. introduce a "netops" module that will deal with	all meta-things related to our networking infrastructure and move the	equipment checks out of network.pp and into netops::monitoring,	modularizing another piece of old manifest code in the process.		change-id: i882ffca41303b6f0a39dbf2a694a25b6bd708f11	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/openldap/management.pp,ldap: setup ldapvi + make a new role!		- make a new role for setting up ldapvi, eventaully	  all things wrt to management of users on ldap will move here	- setup ldapvi properly on terbium		change-id: i47464663406f3fc78b294177e48fabb443ddf563	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ipv6/relay.pp,ipv6relay: move role to module structure		move the role class into the module/role and	into a foo::bar structure which fixes warnings	about autoloader layout.		change-id: i38d0058a42e757258a1502dc7f8d877aef35ede8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/torrus/tests/config.pp,modularize torrus		modularize the torrus manifests	add tests	move files into module	introduce role classe	assign role class to netmon1001		change-id: i5fa9063299ac28b6e33f86c110b183a5b6883ce9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/standard/manifests/ntp/client.pp,ntp: further reorg, split of client and server code		since the ntp class was doing both client and server config at the same	time, mixing some configs that belong to the "standard" module and	things that do not, we split the two functions and we include the client	config in standard everywhere but on the ntp servers, where we declare a	role::ntp instead.		change-id: i4758c13a6e08b86d75492339bdce08eef154db54	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/geowiki/manifests/job/limn.pp,fix another variable reference		change-id: i04b3ed13a5f245b3c8d29aaa743c2672c3fe5776	|fix variable reference		change-id: i6fe1a3db5f5e6da9f7232ebf7babe622d289948d	|create geowiki module		this commit finally removes misc/statistics.pp!		change-id: ib36c02b36a4bd4cb4e4ee8293108fe61754aba94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/package_builder/tests/pbuilder_base.pp,improve package_builder tests		unit tests where missing for package_builder classes and definitions so	add them. also refactor a bit the use of basepath variable while at it		change-id: i51d2ba029cd0365b5dd24ca4dbc56a1d0924b809	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/postgresql/tests/server.pp,postgresql/postgis module		introduce a postgresql module capable of setting up databases in master	or slave mode, and postgis. module also allows for setting up users both	in databases and pg_hba.conf		module contains tests and rspecs.		change-id: i118a987de1c0ed38037cc3a15ba3fa2b299f55c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/puppetmaster/manifests/hiera.pp,puppetmaster: remove extraneous empty line		for documentation generator to work there should be no empty line	between comments and the class definition		change-id: id6d866ee437614945a77798ddb8b7db60e0c7d89	|puppet: hiera backend for the wmf		the hiera nuyaml backend will allow us to use hiera with ease and will	make it both easier to maintain (allowing for more atomic files) and	simpler to use in our setup where a lot of variables have a second order	dependency on other data.		a puppet class and conf files for both production and labs are included	in the patch, but hiera config will only be deployed to labs for now.		in our configurations, all hiera data will be under the hiera	subdirectory of /etc/puppet, and all private data (like passwords and	such) will be stored in /etc/puppet/private instead.		change-id: i24b1db4d0ef8394115e4830871e71e2d227ec374	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/wdq_mm/manifests/init.pp,wdq_mm: rename module to standard naming (underscores)		change-id: ifad416c7eaadc227fbcb806596821c40d59190a5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/package_builder/tests/pbuilder_hook.pp,improve package_builder tests		unit tests where missing for package_builder classes and definitions so	add them. also refactor a bit the use of basepath variable while at it		change-id: i51d2ba029cd0365b5dd24ca4dbc56a1d0924b809	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nagios_common/manifests/check/redis.pp,use parentheses in all custom functions		chase down all custom function calls and use parentheses in all of them.	this is require to make the manifests puppet 4 compatible		change-id: ib08a1cd0404940df1ac1b7880a2e2c22ef2b5855	|nagios_common::check::redis: create file, not a directory		change-id: i4115acc731c651323ec6e2a070b0d3cee3744755	|redis: add monitoring define		the monitoring define takes the same argument as the redis::instance	class.		it is also applied to role::memcached		change-id: ie8b56ae8115412644be9b21684767da71bb43d0e	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/snapshot/common.pp,include standard and base::firewall in manifest common to snapshots		this gets it out of the node declaration in site.pp		change-id: i41c97c18fee22ea08443429ec2e7e50ff693fd04	|include the dumps packages in the dumps manifest in snapshot module		treat it just like all the other dumps manifests		change-id: i9a30a3d2f111388f2ad821773092fe37a40fce63	|move dump related commonly included classes out to common role		change-id: i996ac5442320b42f6ca3304c29bdacfb31a30dab	|remove obsolete manifests from snapshot module/role		also include role::snapshot::common everywhere it should be		change-id: id3deb3814afccb584ac7f68d58cfd6977b707e78	|snapshot: one file per role class, move to modules/role		splits the role class file into one file per role class.		moves it into module/role/ structure. fixes autoloader layout warnings.		renames "role snapshot" to "role snapshot::producer".		the only difference on the hosts are the motd/role name.		http://puppet-compiler.wmflabs.org/2925/		change-id: i657d4de5731ea7d956c4b3afdda68c0d06b29693	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/beta/manifests/monitoring/shinken.pp,beta: rename shinken config file to make more sense		initially it was supposed to contain only shinken hosts definitions	but now it contains service definitions too		change-id: i3d2b481125ffc8744e8a7f243b8642afdc3a76be	|shinken: unify shinken::hosts and shinken::services		change-id: i8511a08aa183474f24a1f5005c44678c5449de73	|beta: linting and autoload modules		change-id: i9a1910630919ea362b6080347aab0ec7dd2def33	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/server/config.pp,wip: first bit of stuff for taming the mysql module and making the sanitarium		change-id: ifb7c6a717812906d584fe2a79fc7a507cf7fd45e	|initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/geowiki/manifests/job.pp,l10nupdate, geowiki: minimal lint fixes		change-id: i3ed3f7763e1b8c46fbcf734f72c309ab658565d7	|remove bad comma		change-id: i7a31c0cf7f18647603c71c505d5bcbd264f4d13a	|create geowiki module		this commit finally removes misc/statistics.pp!		change-id: ib36c02b36a4bd4cb4e4ee8293108fe61754aba94	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql_wmf/manifests/pc/conf.pp,fix template name typo "paresercache" -> "parsercache"		change-id: i68053741f89701a1195c0e2700ca44b2d6a8e3ae	|mysql_wmf - autoload layout and lint fixes		move classes into autoload layout	fix lint warnings		change-id: ie7510e8c90e365f43ce621c3f524aa1e87e2c584	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/stdlib/tests/has_ip_address.pp,update stdlib to latest supported release from puppetlabs		this patch updates the stdlib module to v3.2.1.	3.2.1 is compatible with puppet >=2.7.20. there are no breaking changes.		change-id: i570046371713b05c1ed99c771da2d405f782b191	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/lvs/manifests/monitor_service_http_https.pp,root out a long chain of quoted bools in nagios/icinga/nrpe		bug: t113783	change-id: i16cee528ddf05f90b2cc7c9f474fe8a4db914582	|fix for lvs::monitor_service_http_https		ipv6 needs to be ipv6		change-id: id3967d9954dd799fa6ab240f0dbae7e7ee8d8c15	|merge all lvs::monitor_service manifests into one		all the lvs::monitor* manifests are very similar. merge their	functionality into lvs::monitor_service_http_https		change-id: ib4259e9c833e8f13b85d058d1a0001118cfcb4bb	|lvs: split monitors to respective files		split to respective files. lvs::monitor_service_custom and	monitor_service_https are not used anywhere, so they are removed		change-id: iac0e72bfe67f51b5aca5c8744a72dca43ed67ad8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nrpe/manifests/check.pp,nagios: convert monitor_service to monitoring::service		change-id: i21a3ca32fd425dd201f763b157e6253616e846fb	|sanitize nrpe::check title parameter		it is possible to use spaces inside the title param of nrpe::check.	$title is used however as the file name the corresponding nrpe	configuration file this has already resulted once in false alerts	and will probably do so again. prevent this by sanitizing and munging	all non-alphanumeric characters from the file name		change-id: i8d813f316272024ef5f826139ac26824a00be6ce	|fix puppet doc for nrpe/bacula module		puppet doc does not work if empty newlines are between the documentation	comment and the actual definition. this is a documented behaviour. fix	nrpe/bacula modules' definitions to make sure puppet docs are generated	successfully		change-id: i3b8ffcac4a5789439f601a979933f7873fb5fbc2	|refactoring nrpe module (round 2/??)		/usr/local/lib/nagios/plugins directory for plugins shipped by module	merge nrpe::packages and nrpe::service classes in nrpe class	nrpe class now accepts an allowed_hosts argument. it defaults to undef.	cleaned-up service['nagios-nrpe-server']	 hasrestart defaults to true in puppet 2.7	 hasstatus defaults to true in puppet 2.7 so pattern is not needed	 restart not needed (init script works fine)	updated rspec examples	updated puppet tests	removed spec fixtures that caused a problem with puppet doc(cyclic deps)	added rake code to create and purge above fixtures before each run	updated nrpe_local.cfg.erb	nrpe::check now ships virtual resources which are realized by nrpe class	virtual monitor_service resources tagged nrpe are no longer realized by	nrpe class (none existed anyway)		change-id: i96bcccae226c0b308ec528a52259d4c1bf764afb	|refactor nrpe to a module		turned the manifests into a module, added/cleaned up documentation, made	puppet-lint happy, moved/created templates and/or files. added unit	tests. also update site.pp/base.pp to not explicitly load nrpe.pp	still needs some love but this will work for starters. rspec tests have	also been added, but fail at this point		change-id: i64a9f1d60cbabeef3a096981d634d7399d39bc45	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/ocg/manifests/decommission.pp,ocg: indentation fixes		fixes more puppet-lint warnings	for t93645		change-id: i3ea118175cf32216f07632117f8d2d07ca21ee48	|move ocg logging off of root partition; logrotate hourly.		we are using a size-limited logrotate configuration, but the size often	grows far past the bounds in a single day.  run logrotate hourly in order	to ensure that our size limits are respected.		the ocg machines have a very small root partition; move logging to	the much-larger /srv partition.  leave a symlink in /var/log/ocg	so that unfamiliar admins can easily find the logs.		change-id: id323dd9795f82b2307aa53f025a97e67e355a727	|de-lint modules/ocg/manifests/decommission.pp.		fixed 'error duplicate parameter found in resource (duplicate_params)'.		change-id: i009d92fd3eb581996595b57c4f6803e5341a4b14	|ocg: convert to package<|provider==trebuchet|>		the deployment::target resource has been deprecated in favor of	trebuchet's custom provider.		change-id: ic2de6aa63a129fad6687a21acca12ed59404f85d	|new variables for ocg service		the service is now able to store output files in a discrete directory	for file management purposes. this is the output_dir. these are saved	for 5 days currently.		it can also save files which caused errors in a discrete directory. this	is the postmortem_dir. right now puppet will save these for 3 days.		the service will also now log to logstash via the gelf structured logging	format.		change-id: id46ce90de1fe8b288c0a205bd3de8362b473e708	|some small lint/style fixes on 'ocg'		fixes some puppet-lint warnings,	removes a tab,	fixes some pathes in "managed by puppet" comments		change-id: i9afbdf5edd09f0991310453813cd636aa516e2e5	|collection renderer (now a module!)		ocg is a mediawiki service integrating with the collection extension	to provide article bundling and rendering for offline consumption. it	provides the 'print to pdf' sidebar functionality as well as book	creation through special:book.		change-id: i3c95af9a64a7d5830687cf3657c9afa6635a680f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/manifests/db.pp,wmflib: add validate_ensure()		the alternative forms are all annoying to type and are used inconsistently:		  validate_re($ensure, '^(present|absent)$', "\$ensure must be..., etc.")	  if $ensure !~ /^(present|absent)$/ { fail("\$ensure must be..., etc." )	  if !($ensure in ['present', 'absent']) ...		so add this one, which will be faster than using regexes anyway:		  validate_ensure($ensure)		yes, different resource types take other values for 'ensure'; but 'present' /	'absent' are the obvious universals, so i don't think that this will cause	confusion.		change-id: i1b55c0d4f9dede5690a3e3e8b72f4428eb49de86	|initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/stdlib/manifests/init.pp,add the upstream stdlib module to the repo		change-id: i5b7c29b7fd20373b0d74f660609c628e5f3c8d54	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/apache/manifests/logrotate.pp,apache: rotate logs daily, default to 30d		this doesn't impact mediawiki installations, they have a separate config,	but it does account for misc services where there is no explicit setting		change-id: ic7346157fc4ad39ea25a01c81edd2bb8b73863d6	|apache: allow tuning of logrotate parameters		change-id: ia4241a335ac6f6be1776079846194d4a815c18a9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/rsync/manifests/init.pp,manually adding modules/rsync for managing rsyncd modules.		puppetlabs-rsync:  https://github.com/puppetlabs/puppetlabs-rsync		see also abandoned change where i attempted to add these as git submodules:	https://gerrit.wikimedia.org/r/#/c/21744/		change-id: i2c811843b414fcbdbea4224157847135402af590	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/coredb_mysql/manifests/utils.pp,coredb_mysql: convert a few additional leftover tabs to spaces		follows i419f48c97. i missed a few spots.		change-id: i7183fa78ee2f1eb41cc69e987d7a853e35583732	|coredb_mysql: lint		no changes to behavior; only presentational changes in this commit.	 - spaces rather than tabs.	 - align arrows.	 - don't align equal sign, except in function signature	 - single quotes when not interpolating.	 - single resource per block.	 - quote strings.	 - quote octal permissions.	 - 'ensure' always first property.	 - use ensure => link w/ target rather than implicit symlinks.	 - every property ends with a comma	 - one class per include.	 - resource name and resource type on same line.	 - [ space ] in arrays	 - '&>/dev/null' instead of '>/dev/null 2>&1'		change-id: i419f48c9713e5c59deac093ac86142d4d938a25c	|eqiad migration: setting masterdom by  $mw_primary		change-id: i3b1a01f11d9c1dbdc15d0f6f309d47a0ebf6ce24	|removing no longer needed mod to mysql path		change-id: i6edfe1ae55cdb71b1253ff0104b18716a7fbf4ae	|renaming coredb module to coredb_mysql to avoid module/role class namespace fuckery		change-id: i1c8ab607514c63be7a9ab36ac337ae20918cfa6f	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/lxc/manifests/init.pp,add role::labs::mediawiki_vagrant		add a role and modules to provision and configure vagrant to manage an lxc	container to run as a mediawiki-vagrant instance.		* create a new trusty instance (doesn't work on jessie)	* apply ::role::labs::mediawiki_vagrant	* force a puppet run	* log out and log back in to pick up profile.d magic	* cd /srv/mediawiki-vagrant	* vagrant up	* setup wikitech to proxy to :8080 on your vm	* profit!		requires: i343c8da6e345933e29f92523638d3b19e133894b	requires: i0ee0caf19019ce6415519561ff33b3453b310468	bug: t106213	change-id: i04cfa3d143cad92b2be57d3813f0b09ecfb45bf5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/pybal/manifests/web.pp,pybal::web: add the pybal syntax checker		change-id: i2ec0d8b5e2ef450140ce3576b924a8abeaa1d72b	|pybal: refactor pybal::pool, print pools in pybal::web		since we're moving away from out traditional schema where the pybal	pools are directly operated on via raw files, we still want to present	what's pooled and what's not pooled via an http request. so we:	- factor out the confd file generation from pybal::pool	- create the resources for all pools on hosts with the pybal::web	definition	- avoid monitoring all of those on palladium, as that's not really critical.		change-id: i30dd4ae6a0bce64c02c809e214fd868a897a97e7	|pybal: use apache <ifversion> instead of os_version		the apache configuration template was having conditionals based on an	$is_24 variable, that was set in the manifest based on the operating	system's version. that's not so pretty, so convert to apache's	<ifversion> syntax for switching between the different configuration	directives.		change-id: i43e55a017cb56b219e55c7fb4b825fa1ecfdb18b	|replace usage of requires_ubuntu / ubuntu_version with requires_os / os_version		change-id: ia7a2052559fb46ae2d2b3e096ce37f90919a18f4	|pybal: serve the virtualhost with pybal lb files with a dedicated vhost		change-id: i030d8ccd9f77da50a2ba1509bbd953bdce1bcbc9	signed-off-by: giuseppe lavagetto <glavagetto@wikimedia.org>	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/nrpe/tests/monitor_service.pp,refactor nrpe to a module		turned the manifests into a module, added/cleaned up documentation, made	puppet-lint happy, moved/created templates and/or files. added unit	tests. also update site.pp/base.pp to not explicitly load nrpe.pp	still needs some love but this will work for starters. rspec tests have	also been added, but fail at this point		change-id: i64a9f1d60cbabeef3a096981d634d7399d39bc45	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/ci/website.pp,role::ci::website: require role::ci::slave		change-id: i0f4b7240b582a5ab18a6b1595106efcaf9eb2d57	|ci: split and move role classes to modules/role/		split the large file into one file per class for	readability and per style guide and lint.		move them into ./modules/role/ and into the proper	autoload layout without renaming any classes or	changing content.		change-id: i3d514e64b56dcba5486ffbd2f22eb95d8326e1c9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/rsyslog/manifests/conf.pp,revert "wmflib: add ensure_final_newline()"		this reverts commit 04945e956f835cb9849146db49df0559a6d28f94.		change-id: ida7f2e2c6b889cc2a04d3569bf8de5ea4e17ef2b	|wmflib: add ensure_final_newline()		if the argument is a string, ensure it ends with a final newline.	if it is not a string, pass it through unmodified.		this function is designed to make it easier to write custom puppet	resource types that delegate to file resources and that take	either a "content" or a "source" parameter.		change-id: ib1f88b11b6308900a0bf0279eaca863793f614cd	|add rsyslog module and port existing usage		* make puppet manage /etc/rsyslog.d recursively.	* this means that packages that include their own rsyslog.d config will need	  to have that config file declared in puppet or it will get clobbered on the	  next run.	* this is the same decision we made with respect to sysctl.d.	* per apt-file, the set of packages with rsyslog.d files are:		   arno-iptables-firewall, cloud-init, gforge-shell-postgresql, maas,	   maas-region-controller, mythtv-common, octopussy, postfix, qpidd, sagan,	   sympa, ubuntu-orchestra-client, ubuntu-orchestra-logging-server, and ufw		  we don't run any of these in production. (we do have ufw installed because	  it's part of the 'standard' tasksel task for ubuntu, but we don't use it.)	* remove reference to i-000003a9.pmtpa.wmflabs:5544 as a syslog sink for	  non-beta-cluster hosts; the instance no longer exists.		change-id: ibceb48bd8c475696b900e89f38dea686394069d8	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/otrs/manifests/mail.pp,otrs: pass the proxy parameter to spamassassin		use our webproxy to allow spamassassin to fetch daily new spamassassin	definitions using sa-update		change-id: i50000aabbb312f7bf15188c49dba874fd6bada98	|clamav: fix proxy support		1) make proxy support a parameter, not enabled by default. no reason to	add dependencies to webproxies if it isn't needed (we might reuse the	module on mail::mx); also makes the module a little bit cleaner.		2) ensure service['clamav-freshclam'] is ensured running only after the	clamav-freshclam package has been installed. since the package is	implicitly installed by apt, add a package['clamav-freshclam'] to do the	dependency the right way.		change-id: i10eb5aca5c08a2be7d427dab6e6e187fcdf5bbf1	|modularize otrs		this was a single role before, move it to the module/role paradigm,	splitting up the various classes and moving templates/files around.	add tests, documentation for the new classes.		change-id: i04cc8d734cd83acc2ce4c4d26cea9c0fbd1da2ec	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/toollabs/etcd/expose_metrics.pp,tools: expose etcd /metrics end point to everywhere		much safer than opening it up at the firewall level		change-id: ia6c754add6a1e64365530e65a3c73d90efb9eae2	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/toollabs/manifests/queue/task.pp,tool labs: final(?) fixes to gridengine iii		- add dedicated node queue config	- expand templates at the last minute so that $title is	  correct (and all variables are otherwise available)		change-id: i5bcc9d0cfbf9fc3962decd8a1b885cdde7c21398	|labs: puppetize gridengine		much of this will need tweaking and hacking; gridengine is /not/	amenable to simple puppetization because most of its configuration	lives in a bdb.		most actualy configuration bits are nooped with 'echo' at this	time while testing takes place.		change-id: i7856b65ebead6aae04777c4851ef3c7771b239f5	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/lvs/manifests/interface_tweaks.pp,lvs: rename interface-tweaks to interface_tweaks		puppet classes and defines should not contain	dash characters per lint and style guide and we only	have a handful of those left.		change-id: ib5d629a470e3078aac29c0716dc516dd5db9edc9	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/deprecated/mediawiki.pp,fixup and move 'mediawiki_singlenode' role to role/deprecated		- clearly marks it as deprecated	- removes the 'latest' variety - these two roles have been	  broken for a long time anyway (in many ways). there was one	  instance using it (in the mwreview project) that i replaced	  with the non-latest variety		change-id: i2b72cdf551e906221c47de1bb54e281e4be78e6b	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/postgresql/tests/slave.pp,postgresql/postgis module		introduce a postgresql module capable of setting up databases in master	or slave mode, and postgis. module also allows for setting up users both	in databases and pg_hba.conf		module contains tests and rspecs.		change-id: i118a987de1c0ed38037cc3a15ba3fa2b299f55c4	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/manifests/role/mirrors.pp,really split the mirrors role class		commit 4899ebb78bc323a1120cbea7018bc9617efe27e1 attempted to split the	mirrors role class but ended up splitting it to	role::installserver::mirrors which is hardly a role class.		split it to role::mirrors instead, as it conceptually has nothing to do	with installing servers or anything like that. include the class from	carbon, which should make this endeavour a noop.		change-id: i756457caa259e68ad4b481a9a1a8473875c2d5aa	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/backup/spec/fixtures/manifests/site.pp,modularize backups.pp		move all the dry defines in a wmf specific module	add (incomplete) rspec tests	add readme.md	delete backup::mysql which was unused		change-id: i7e2d1f933d57dc27f5933d826fadec2f64f74e47	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/statistics/manifests/dataset_mount.pp,remove nfs::common, replaced by require_package()		remove the class nfs::common whose single purpose has been to be a	singleton for installing the nfs-common package. we have	require_package() for this noawadays.		change-id: iee1f601aaa81a48e8388b9ce0a3aea0704167ce1	|first commit in a multi-commit effort to move misc/statistics.pp into modules/		t87450		change-id: i49140d85ddea99f5d4d9a3c71e60cf7fa57d49b6	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/toollabs/puppet/master.pp,tools: move role classes to module role		change-id: i006d5eee5dc0365279e954b3c184ce20a818ef99	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/mysql/tests/server/config.pp,initial dump in of puppet forge mysql module		needs cleanup and alteration for our purposes.		name 'puppetlabs-mysql'	version '0.6.1'	source 'git://github.com/puppetlabs/puppetlabs-mysql.git'		change-id: i8a88b486b0b417491d2330dee38f4ea1dd686e18	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/role/manifests/elasticsearch/cirrus.pp,elasticsearch - move relforge to its own role		as suggested during an irc discussion, create a specific role for relforge,	move all common bits in role::elasticsearch::common and simplify the hiera	configuration.		a few other clean up / improvements are part of this change:		* add icinga checks for relforge cluster	* update debdeploy configuration for relforge cluster to make it part	  of elastic canaries		change-id: i83d5ef5728aa5851ccf2d4d9cfde803bba0e9c6a	|
/Users/akond/PUPP_REPOS/v2/wikimedia_operations_puppet_only/puppet/modules/snapshot/manifests/cron/cirrussearch.pp,provide and use variable names for all dump related directories		instead of hardcoding in partial paths in many manifests and scripts,	provide variables in the manifest which declares the directories	and use those.		also fix a couple badly closed variable references in templates.		change-id: i40a78843f44f3b24a4deb0355dd530c54a7f8b42	|move dump of cirrus search data to snapshot1007		take the opportunity to do small amount of cleanup on the	cirrus dump manifest: no more 'enable' variable, no more	separate system roles per cron job		change-id: id6ba40759254a345d29025eb337